# 02. Installation & Setup

## Installation

### Linux (Ubuntu/Debian)

#### Method 1: APT Package Manager

```bash
sudo apt update
sudo apt install redis-server
```

#### Method 2: From Source (Latest Version)

```bash
# Download latest stable
wget http://download.redis.io/redis-stable.tar.gz
tar xzf redis-stable.tar.gz
cd redis-stable

# Compile
make

# Install
sudo make install

# Test
make test
```

#### Start Redis

```bash
# Start Redis server
redis-server

# Start as background service
sudo systemctl start redis-server

# Enable on boot
sudo systemctl enable redis-server

# Check status
sudo systemctl status redis-server
```

---

### macOS

#### Using Homebrew

```bash
# Install
brew install redis

# Start Redis
brew services start redis

# Stop Redis
brew services stop redis

# Restart Redis
brew services restart redis
```

#### Manual Start

```bash
redis-server /usr/local/etc/redis.conf
```

---

### Windows

#### Using WSL (Recommended)

```bash
# Install WSL and Ubuntu
wsl --install

# Inside WSL
sudo apt update
sudo apt install redis-server
redis-server
```

#### Using Docker (Recommended for Windows)

```bash
docker run -d -p 6379:6379 --name redis redis:latest
```

---

### Docker Installation

#### Basic Redis Container

```bash
# Pull Redis image
docker pull redis:latest

# Run Redis container
docker run -d \
  --name my-redis \
  -p 6379:6379 \
  redis:latest

# Run with password
docker run -d \
  --name my-redis \
  -p 6379:6379 \
  redis:latest redis-server --requirepass mypassword
```

#### Docker Compose

**docker-compose.yml:**

```yaml
version: '3.8'

services:
  redis:
    image: redis:7.2-alpine
    container_name: redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
      - ./redis.conf:/usr/local/etc/redis/redis.conf
    command: redis-server /usr/local/etc/redis/redis.conf
    restart: unless-stopped

volumes:
  redis-data:
```

```bash
# Start
docker-compose up -d

# Stop
docker-compose down
```

---

## Verify Installation

### Check Redis Server

```bash
# Check if Redis is running
redis-cli ping
# Expected output: PONG

# Check version
redis-server --version
# redis-server v=7.2.0

# Check Redis CLI version
redis-cli --version
# redis-cli 7.2.0
```

### Connect to Redis

```bash
# Connect to local Redis
redis-cli

# Connect to remote Redis
redis-cli -h 192.168.1.100 -p 6379

# Connect with password
redis-cli -h localhost -p 6379 -a mypassword

# Or authenticate after connecting
redis-cli
127.0.0.1:6379> AUTH mypassword
OK
```

---

## Configuration

### Redis Configuration File

**Location:**
- Linux: `/etc/redis/redis.conf`
- macOS: `/usr/local/etc/redis.conf`
- Docker: Mount custom config

### Key Configuration Options

#### 1. Network

```conf
# Bind to specific IP (default: 127.0.0.1)
bind 127.0.0.1

# Accept connections from any IP
bind 0.0.0.0

# Port (default: 6379)
port 6379

# Max number of clients
maxclients 10000
```

#### 2. Security

```conf
# Require password
requirepass myStrongPassword123

# Rename dangerous commands
rename-command CONFIG ""
rename-command FLUSHDB ""
rename-command FLUSHALL ""
```

#### 3. Memory Management

```conf
# Max memory (e.g., 2GB)
maxmemory 2gb

# Eviction policy
maxmemory-policy allkeys-lru

# Options:
# - noeviction: Return error when memory limit reached
# - allkeys-lru: Evict least recently used keys
# - volatile-lru: Evict LRU keys with TTL
# - allkeys-random: Evict random keys
# - volatile-ttl: Evict keys with shortest TTL
```

#### 4. Persistence (RDB)

```conf
# Save snapshots
save 900 1      # After 900 sec if 1 key changed
save 300 10     # After 300 sec if 10 keys changed
save 60 10000   # After 60 sec if 10000 keys changed

# RDB filename
dbfilename dump.rdb

# Directory
dir /var/lib/redis
```

#### 5. Persistence (AOF)

```conf
# Enable AOF
appendonly yes

# AOF filename
appendfilename "appendonly.aof"

# Fsync policy
appendfsync everysec
# Options: always, everysec, no
```

#### 6. Logging

```conf
# Log level
loglevel notice
# Options: debug, verbose, notice, warning

# Log file
logfile /var/log/redis/redis-server.log
```

---

## Start Redis with Custom Config

```bash
# Start with specific config file
redis-server /etc/redis/redis.conf

# Start with inline config
redis-server --port 6380 --requirepass mypassword
```

---

## Redis CLI Basics

### Connect and Test

```bash
# Connect
redis-cli

# Ping
127.0.0.1:6379> PING
PONG

# Set a key
127.0.0.1:6379> SET mykey "Hello Redis"
OK

# Get a key
127.0.0.1:6379> GET mykey
"Hello Redis"

# Check keys
127.0.0.1:6379> KEYS *
1) "mykey"

# Delete key
127.0.0.1:6379> DEL mykey
(integer) 1
```

### Useful CLI Commands

```bash
# Get server info
redis-cli INFO

# Get specific section
redis-cli INFO server
redis-cli INFO memory
redis-cli INFO stats

# Monitor all commands in real-time
redis-cli MONITOR

# Get current database size
redis-cli DBSIZE

# Flush all keys (dangerous!)
redis-cli FLUSHALL

# Execute command directly
redis-cli SET key1 value1
redis-cli GET key1
```

---

## Client Libraries

### Node.js

#### ioredis (Recommended)

```bash
npm install ioredis
```

```javascript
const Redis = require('ioredis');

const redis = new Redis({
  host: 'localhost',
  port: 6379,
  password: 'mypassword'
});

redis.set('key', 'value');
redis.get('key', (err, result) => {
  console.log(result); // 'value'
});
```

#### node-redis

```bash
npm install redis
```

```javascript
const redis = require('redis');
const client = redis.createClient({
  url: 'redis://localhost:6379'
});

await client.connect();
await client.set('key', 'value');
const value = await client.get('key');
```

---

### Python

#### redis-py

```bash
pip install redis
```

```python
import redis

r = redis.Redis(
    host='localhost',
    port=6379,
    password='mypassword',
    decode_responses=True
)

r.set('key', 'value')
value = r.get('key')
print(value)  # 'value'
```

---

### Java (Spring Boot)

#### Dependencies (pom.xml)

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
</dependency>
```

#### Configuration (application.properties)

```properties
spring.redis.host=localhost
spring.redis.port=6379
spring.redis.password=mypassword
spring.redis.database=0
```

---

## Redis GUI Tools

### 1. RedisInsight (Official)

```bash
# Download from: https://redis.com/redis-enterprise/redis-insight/
# Or via Docker:
docker run -d -p 8001:8001 redislabs/redisinsight:latest
```

### 2. Redis Commander

```bash
npm install -g redis-commander
redis-commander --redis-host localhost --redis-port 6379
# Access: http://localhost:8081
```

### 3. Medis (macOS)

```bash
brew install --cask medis
```

---

## Production Setup Checklist

### Security

✅ **Set strong password:**
```conf
requirepass VeryStr0ngP@ssw0rd!
```

✅ **Bind to private IP:**
```conf
bind 127.0.0.1 10.0.1.5
```

✅ **Disable dangerous commands:**
```conf
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG "CONFIG-abc123"
```

✅ **Enable firewall:**
```bash
sudo ufw allow from 10.0.1.0/24 to any port 6379
```

### Performance

✅ **Set max memory:**
```conf
maxmemory 4gb
maxmemory-policy allkeys-lru
```

✅ **Disable THP (Transparent Huge Pages):**
```bash
echo never > /sys/kernel/mm/transparent_hugepage/enabled
```

✅ **Increase max clients:**
```conf
maxclients 10000
```

### Persistence

✅ **Enable AOF:**
```conf
appendonly yes
appendfsync everysec
```

✅ **Configure RDB snapshots:**
```conf
save 900 1
save 300 10
save 60 10000
```

### Monitoring

✅ **Enable slowlog:**
```conf
slowlog-log-slower-than 10000
slowlog-max-len 128
```

✅ **Check slowlog:**
```bash
redis-cli SLOWLOG GET 10
```

---

## Common Issues & Solutions

### Issue 1: Connection Refused

**Problem:**
```
Could not connect to Redis at 127.0.0.1:6379: Connection refused
```

**Solution:**
```bash
# Check if Redis is running
sudo systemctl status redis-server

# Start Redis
sudo systemctl start redis-server
```

### Issue 2: NOAUTH Authentication required

**Problem:**
```
(error) NOAUTH Authentication required.
```

**Solution:**
```bash
redis-cli -a mypassword
# Or
redis-cli
127.0.0.1:6379> AUTH mypassword
```

### Issue 3: Memory Issues

**Problem:**
```
OOM command not allowed when used memory > 'maxmemory'
```

**Solution:**
```conf
# Set eviction policy
maxmemory-policy allkeys-lru

# Or increase maxmemory
maxmemory 8gb
```

---

## Summary

**Installation:**
- Linux: `apt install redis-server`
- macOS: `brew install redis`
- Docker: `docker run -d -p 6379:6379 redis`

**Configuration:**
- Config file: `/etc/redis/redis.conf`
- Set password: `requirepass`
- Max memory: `maxmemory`
- Persistence: `save` (RDB), `appendonly` (AOF)

**Client Libraries:**
- Node.js: ioredis, node-redis
- Python: redis-py
- Java: Spring Data Redis, Jedis

**Production:**
- Enable authentication
- Bind to private IP
- Configure persistence
- Set memory limits
- Monitor performance

---

## Interview Questions & Answers

### Q1: How do you install Redis on Linux?
**A:**
```bash
sudo apt update
sudo apt install redis-server
sudo systemctl start redis-server
redis-cli ping  # Test connection
```

### Q2: What is the default port for Redis?
**A:** **6379**

### Q3: How do you set a password for Redis?
**A:** In `redis.conf`:
```conf
requirepass myStrongPassword
```
Then connect with:
```bash
redis-cli -a myStrongPassword
```

### Q4: How do you check if Redis is running?
**A:**
```bash
# Method 1: systemctl
sudo systemctl status redis-server

# Method 2: ping
redis-cli ping
# Expected: PONG

# Method 3: check process
ps aux | grep redis
```

### Q5: What are the two persistence options in Redis?
**A:**
1. **RDB (Redis Database Backup)**: Point-in-time snapshots
   ```conf
   save 900 1
   ```
2. **AOF (Append-Only File)**: Logs every write
   ```conf
   appendonly yes
   appendfsync everysec
   ```

### Q6: How do you start Redis with a custom configuration file?
**A:**
```bash
redis-server /path/to/redis.conf
```

### Q7: What is the maxmemory-policy in Redis?
**A:** Defines what Redis does when max memory is reached:
- `noeviction`: Return errors (default)
- `allkeys-lru`: Evict least recently used keys
- `volatile-lru`: Evict LRU keys with TTL
- `allkeys-random`: Evict random keys
- `volatile-ttl`: Evict keys with shortest TTL

### Q8: How do you connect to a remote Redis server?
**A:**
```bash
redis-cli -h 192.168.1.100 -p 6379 -a password
```

### Q9: What are popular Redis GUI tools?
**A:**
1. **RedisInsight** (official, recommended)
2. **Redis Commander** (web-based)
3. **Medis** (macOS desktop app)
4. **Another Redis Desktop Manager**

### Q10: How do you enable AOF persistence?
**A:** In `redis.conf`:
```conf
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
```

### Q11: What does 'bind 0.0.0.0' mean in Redis configuration?
**A:** It allows Redis to accept connections from **any IP address** (not just localhost). **Security risk** - should bind to specific IPs in production:
```conf
bind 127.0.0.1 10.0.1.5
```

### Q12: How do you disable dangerous Redis commands?
**A:** In `redis.conf`:
```conf
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command CONFIG "CONFIG-secret123"
```

**Next:** Configuration & CLI Commands