# 02. Lists & Sets

## Redis Lists

**Lists** are linked lists of string values, ordered by insertion.

**Characteristics:**
- Ordered collection
- Allows duplicates
- Fast insert/delete at head/tail (O(1))
- Slow access by index for large lists (O(N))

**Use Cases:**
- Message queues
- Activity feeds
- Recent items (latest 100 posts)
- Undo/redo stacks

---

## List Commands - Push/Pop

### LPUSH / RPUSH - Add Elements

```bash
# Push to left (head)
LPUSH tasks "task1"
LPUSH tasks "task2" "task3"
# List: [task3, task2, task1]

# Push to right (tail)
RPUSH tasks "task4"
# List: [task3, task2, task1, task4]

# Push only if list exists
LPUSHX tasks "task5"  # Only pushes if 'tasks' exists
RPUSHX tasks "task6"
```

### LPOP / RPOP - Remove Elements

```bash
LPUSH queue "a" "b" "c"
# List: [c, b, a]

# Pop from left
LPOP queue
# "c"
# List: [b, a]

# Pop from right
RPOP queue
# "a"
# List: [b]

# Pop multiple elements (Redis 6.2+)
LPOP queue 2
# Returns: ["b", "c"]
```

### BLPOP / BRPOP - Blocking Pop

```bash
# Block until element available (timeout in seconds)
BLPOP queue 10
# Waits up to 10 seconds for element

# Block indefinitely
BLPOP queue 0

# Block on multiple lists
BLPOP queue1 queue2 queue3 0
# Pops from first non-empty list
```

---

## List Commands - Access

### LRANGE - Get Range

```bash
RPUSH mylist "a" "b" "c" "d" "e"

# Get all elements
LRANGE mylist 0 -1
# 1) "a" 2) "b" 3) "c" 4) "d" 5) "e"

# Get first 3
LRANGE mylist 0 2
# 1) "a" 2) "b" 3) "c"

# Get last 2
LRANGE mylist -2 -1
# 1) "d" 2) "e"
```

### LINDEX - Get by Index

```bash
LINDEX mylist 0   # "a" (first element)
LINDEX mylist 2   # "c"
LINDEX mylist -1  # "e" (last element)
LINDEX mylist 100 # (nil)
```

### LLEN - Get Length

```bash
LLEN mylist
# (integer) 5
```

---

## List Commands - Modification

### LSET - Set by Index

```bash
LSET mylist 0 "new_first"
LSET mylist -1 "new_last"
```

### LINSERT - Insert Before/After

```bash
RPUSH mylist "a" "c"

# Insert before 'c'
LINSERT mylist BEFORE "c" "b"
# List: [a, b, c]

# Insert after 'b'
LINSERT mylist AFTER "b" "b2"
# List: [a, b, b2, c]
```

### LREM - Remove Elements

```bash
RPUSH mylist "a" "b" "a" "c" "a"

# Remove first 2 occurrences of 'a'
LREM mylist 2 "a"
# List: [b, c, a]

# Remove last 1 occurrence of 'a'
LREM mylist -1 "a"
# List: [b, c]

# Remove all occurrences
LREM mylist 0 "b"
# List: [c]
```

### LTRIM - Trim List

```bash
RPUSH mylist "a" "b" "c" "d" "e"

# Keep only first 3 elements
LTRIM mylist 0 2
# List: [a, b, c]

# Keep only last 2 elements
LTRIM mylist -2 -1
```

---

## List Use Cases

### 1. Message Queue (FIFO)

```bash
# Producer: Add to right
RPUSH queue "job1"
RPUSH queue "job2"

# Consumer: Pop from left
BLPOP queue 0
# 1) "queue"
# 2) "job1"
```

### 2. Stack (LIFO)

```bash
# Push to left
LPUSH stack "item1"
LPUSH stack "item2"

# Pop from left
LPOP stack
# "item2"
```

### 3. Recent Items (Latest 100)

```bash
# Add new item
LPUSH recent:posts "post1"
LTRIM recent:posts 0 99  # Keep only 100 most recent

# Get recent items
LRANGE recent:posts 0 9  # Get 10 most recent
```

### 4. Activity Feed

```bash
# Add activity
LPUSH user:1001:feed "User liked post 123"
LPUSH user:1001:feed "User commented on post 456"

# Get latest 20 activities
LRANGE user:1001:feed 0 19
```

---

## Redis Sets

**Sets** are unordered collections of unique strings.

**Characteristics:**
- Unordered
- No duplicates
- Fast membership check (O(1))
- Set operations (union, intersection, difference)

**Use Cases:**
- Tags/categories
- Unique visitors
- Relationships (followers, friends)
- Online users

---

## Set Commands - Basic Operations

### SADD - Add Members

```bash
# Add single member
SADD tags "redis"

# Add multiple members
SADD tags "cache" "database" "nosql"

# Add duplicate (ignored)
SADD tags "redis"
# (integer) 0 (already exists)
```

### SMEMBERS - Get All Members

```bash
SMEMBERS tags
# 1) "redis"
# 2) "cache"
# 3) "database"
# 4) "nosql"
```

### SISMEMBER - Check Membership

```bash
SISMEMBER tags "redis"
# (integer) 1 (exists)

SISMEMBER tags "mysql"
# (integer) 0 (doesn't exist)

# Check multiple members (Redis 6.2+)
SMISMEMBER tags "redis" "mysql" "cache"
# 1) (integer) 1
# 2) (integer) 0
# 3) (integer) 1
```

### SCARD - Get Set Size

```bash
SCARD tags
# (integer) 4
```

### SREM - Remove Members

```bash
SREM tags "nosql"
# (integer) 1 (removed)

SREM tags "mysql"
# (integer) 0 (doesn't exist)

# Remove multiple
SREM tags "redis" "cache"
```

### SPOP - Remove Random Member

```bash
# Pop one random member
SPOP tags
# "database"

# Pop N random members
SPOP tags 2
# 1) "redis"
# 2) "cache"
```

### SRANDMEMBER - Get Random Member (without removing)

```bash
# Get one random member
SRANDMEMBER tags
# "redis"

# Get N random members
SRANDMEMBER tags 2
# 1) "cache"
# 2) "nosql"
```

---

## Set Commands - Set Operations

### SUNION - Union (Combine Sets)

```bash
SADD set1 "a" "b" "c"
SADD set2 "c" "d" "e"

SUNION set1 set2
# 1) "a" 2) "b" 3) "c" 4) "d" 5) "e"

# Store result
SUNIONSTORE set3 set1 set2
```

### SINTER - Intersection (Common Elements)

```bash
SINTER set1 set2
# 1) "c"

# Store result
SINTERSTORE set3 set1 set2

# Intersection of multiple sets
SINTER set1 set2 set3
```

### SDIFF - Difference (Elements in first set but not in others)

```bash
SDIFF set1 set2
# 1) "a" 2) "b"

SDIFF set2 set1
# 1) "d" 2) "e"

# Store result
SDIFFSTORE set3 set1 set2
```

---

## Set Use Cases

### 1. Unique Visitors

```bash
# Track daily visitors
SADD visitors:2024-12-30 "user123"
SADD visitors:2024-12-30 "user456"
SADD visitors:2024-12-30 "user123"  # Duplicate ignored

# Count unique visitors
SCARD visitors:2024-12-30
# (integer) 2
```

### 2. Tags/Categories

```bash
# Tag a post
SADD post:123:tags "redis" "cache" "nosql"

# Get all posts with tag 'redis'
SADD tag:redis:posts "123" "456" "789"
SMEMBERS tag:redis:posts
```

### 3. Followers/Following

```bash
# User 1001 follows 2001, 2002
SADD user:1001:following "2001" "2002"

# User 2001's followers
SADD user:2001:followers "1001" "3001"

# Check if 1001 follows 2001
SISMEMBER user:1001:following "2001"

# Mutual followers (intersection)
SINTER user:1001:following user:2001:following
```

### 4. Online Users

```bash
# User goes online
SADD online:users "user123"

# User goes offline
SREM online:users "user123"

# Count online users
SCARD online:users

# Check if user is online
SISMEMBER online:users "user123"
```

### 5. Lottery/Random Selection

```bash
# Add participants
SADD lottery "user1" "user2" "user3" ... "user1000"

# Pick random winner
SPOP lottery
# "user456"

# Pick 3 winners
SPOP lottery 3
```

---

## Performance Characteristics

### Lists

| Command | Time Complexity |
|---------|----------------|
| LPUSH/RPUSH | O(1) |
| LPOP/RPOP | O(1) |
| LRANGE | O(S+N) - S=offset, N=elements |
| LINDEX | O(N) |
| LLEN | O(1) |
| LREM | O(N+M) - N=length, M=removed |

### Sets

| Command | Time Complexity |
|---------|----------------|
| SADD | O(1) |
| SREM | O(1) |
| SISMEMBER | O(1) |
| SMEMBERS | O(N) |
| SCARD | O(1) |
| SUNION/SINTER/SDIFF | O(N) |

---

## Summary

**Lists:**
- Commands: `LPUSH`, `RPUSH`, `LPOP`, `RPOP`, `LRANGE`, `BLPOP`
- Use cases: Queues, stacks, feeds, recent items
- Ordered, allows duplicates

**Sets:**
- Commands: `SADD`, `SREM`, `SMEMBERS`, `SISMEMBER`, `SUNION`, `SINTER`, `SDIFF`
- Use cases: Tags, unique visitors, relationships, online users
- Unordered, no duplicates, O(1) membership check

---

## Interview Questions & Answers

### Q1: What's the difference between Lists and Sets in Redis?
**A:**

| Feature | Lists | Sets |
|---------|-------|------|
| **Order** | Ordered | Unordered |
| **Duplicates** | Allowed | Not allowed |
| **Access** | By index (O(N)) | By membership (O(1)) |
| **Use cases** | Queues, feeds | Tags, unique items |

### Q2: How do you implement a message queue with Redis Lists?
**A:** Use `RPUSH` to enqueue and `BLPOP` to dequeue:
```bash
# Producer
RPUSH queue "job1"

# Consumer (blocking)
BLPOP queue 0  # Blocks until element available
```
This creates a FIFO queue with blocking consumer.

### Q3: What's the difference between LPOP and BLPOP?
**A:**
- **LPOP**: Non-blocking, returns immediately (nil if empty)
- **BLPOP**: Blocking, waits for element (timeout parameter)

```bash
LPOP empty_queue   # (nil) - returns immediately
BLPOP empty_queue 10  # Waits up to 10 seconds
```

### Q4: How do you get only the last 100 items in a list?
**A:** Use `LTRIM` after each push:
```bash
LPUSH recent:posts "new_post"
LTRIM recent:posts 0 99  # Keep only 100 most recent
```

### Q5: Can you add duplicate elements to a Redis Set?
**A:** No, sets automatically deduplicate:
```bash
SADD myset "value"
SADD myset "value"  # Ignored, returns 0
SCARD myset         # 1 (only one element)
```

### Q6: How do you find common followers between two users?
**A:** Use `SINTER`:
```bash
SADD user:1001:following "2001" "2002" "2003"
SADD user:1002:following "2002" "2003" "2004"

SINTER user:1001:following user:1002:following
# 1) "2002" 2) "2003"
```

### Q7: What's the time complexity of LINDEX?
**A:** **O(N)** where N is the index. Lists are linked lists, not arrays, so accessing by index requires traversal. For frequent index access, consider using Sorted Sets or Hashes instead.

### Q8: How do you implement a stack with Redis Lists?
**A:** Use `LPUSH` to push and `LPOP` to pop (both at same end):
```bash
LPUSH stack "item1"
LPUSH stack "item2"
LPOP stack  # "item2" (LIFO)
```

### Q9: What's the difference between SPOP and SRANDMEMBER?
**A:**
- **SPOP**: Removes and returns random member
- **SRANDMEMBER**: Returns random member without removing

```bash
SPOP myset          # Removes member
SRANDMEMBER myset   # Doesn't remove
```

### Q10: How do you check if a user is online using Sets?
**A:**
```bash
# User goes online
SADD online:users "user123"

# Check if online
SISMEMBER online:users "user123"
# (integer) 1 (online)

# User goes offline
SREM online:users "user123"
```

### Q11: Can you get elements from a List without removing them?
**A:** Yes, use `LRANGE`:
```bash
LRANGE mylist 0 -1   # Get all without removing
LRANGE mylist 0 9    # Get first 10
```

### Q12: What does BLPOP return when timeout expires?
**A:** Returns `nil` if timeout expires without any element:
```bash
BLPOP empty_queue 5
# Waits 5 seconds, returns (nil) if still empty
```

### Q13: How do you count unique visitors per day?
**A:** Use Sets with date-based keys:
```bash
SADD visitors:2024-12-30 "user123"
SADD visitors:2024-12-30 "user456"
SCARD visitors:2024-12-30  # Count unique visitors
```

### Q14: What's the time complexity of SMEMBERS?
**A:** **O(N)** where N is the set size. Returns all members. For large sets, avoid `SMEMBERS` and use `SSCAN` instead:
```bash
SSCAN myset 0 COUNT 100  # Iterate in chunks
```

### Q15: How do you find users who follow A but not B?
**A:** Use `SDIFF`:
```bash
SDIFF user:A:followers user:B:followers
# Returns followers of A who don't follow B
```

**Next:** Hashes & Sorted Sets!