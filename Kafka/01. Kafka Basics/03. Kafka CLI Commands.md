# 03. Kafka CLI Commands

## Command Structure

All Kafka CLI commands follow this pattern:
```bash
bin/kafka-<command>.sh [options]
```

**Common Options:**
- `--bootstrap-server localhost:9092` - Kafka broker address
- `--topic <topic-name>` - Topic name
- `--partitions <num>` - Number of partitions
- `--replication-factor <num>` - Replication factor

---

## Topic Commands

### Create Topic

```bash
bin/kafka-topics.sh --create \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 1
```

**With specific config:**
```bash
bin/kafka-topics.sh --create \
  --topic orders \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 2 \
  --config retention.ms=604800000
```

---

### List Topics

```bash
bin/kafka-topics.sh --list --bootstrap-server localhost:9092
```

**Output:**
```
my-topic
orders
users
```

---

### Describe Topic

```bash
bin/kafka-topics.sh --describe \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

**Output:**
```
Topic: my-topic    PartitionCount: 3    ReplicationFactor: 1
  Topic: my-topic  Partition: 0    Leader: 0    Replicas: 0    Isr: 0
  Topic: my-topic  Partition: 1    Leader: 0    Replicas: 0    Isr: 0
  Topic: my-topic  Partition: 2    Leader: 0    Replicas: 0    Isr: 0
```

---

### Delete Topic

```bash
bin/kafka-topics.sh --delete \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

---

### Alter Topic

**Increase partitions:**
```bash
bin/kafka-topics.sh --alter \
  --topic my-topic \
  --partitions 5 \
  --bootstrap-server localhost:9092
```

**Change config:**
```bash
bin/kafka-configs.sh --alter \
  --entity-type topics \
  --entity-name my-topic \
  --add-config retention.ms=86400000 \
  --bootstrap-server localhost:9092
```

---

## Producer Commands

### Console Producer

**Basic producer:**
```bash
bin/kafka-console-producer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

Then type messages:
```
>Hello Kafka
>This is a test message
>Exit with Ctrl+C
```

**With key:**
```bash
bin/kafka-console-producer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --property "parse.key=true" \
  --property "key.separator=:"
```

Then type:
```
>key1:value1
>key2:value2
```

**From file:**
```bash
bin/kafka-console-producer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  < messages.txt
```

---

## Consumer Commands

### Console Consumer

**Basic consumer:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

**From beginning:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --from-beginning \
  --bootstrap-server localhost:9092
```

**With key and offset:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --property print.key=true \
  --property print.offset=true \
  --property print.partition=true
```

**Output:**
```
Partition:0  Offset:0  Key:key1  Value:value1
Partition:1  Offset:0  Key:key2  Value:value2
```

**With consumer group:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --group my-consumer-group
```

---

## Consumer Group Commands

### List Consumer Groups

```bash
bin/kafka-consumer-groups.sh --list \
  --bootstrap-server localhost:9092
```

---

### Describe Consumer Group

```bash
bin/kafka-consumer-groups.sh --describe \
  --group my-consumer-group \
  --bootstrap-server localhost:9092
```

**Output:**
```
GROUP              TOPIC      PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG
my-consumer-group  my-topic   0          10              15              5
my-consumer-group  my-topic   1          8               12              4
```

---

### Reset Consumer Group Offset

**To earliest:**
```bash
bin/kafka-consumer-groups.sh --reset-offsets \
  --group my-consumer-group \
  --topic my-topic \
  --to-earliest \
  --execute \
  --bootstrap-server localhost:9092
```

**To specific offset:**
```bash
bin/kafka-consumer-groups.sh --reset-offsets \
  --group my-consumer-group \
  --topic my-topic:0 \
  --to-offset 100 \
  --execute \
  --bootstrap-server localhost:9092
```

**To datetime:**
```bash
bin/kafka-consumer-groups.sh --reset-offsets \
  --group my-consumer-group \
  --topic my-topic \
  --to-datetime 2024-01-01T00:00:00.000 \
  --execute \
  --bootstrap-server localhost:9092
```

---

### Delete Consumer Group

```bash
bin/kafka-consumer-groups.sh --delete \
  --group my-consumer-group \
  --bootstrap-server localhost:9092
```

---

## Configuration Commands

### Describe Topic Config

```bash
bin/kafka-configs.sh --describe \
  --entity-type topics \
  --entity-name my-topic \
  --bootstrap-server localhost:9092
```

---

### Add Topic Config

```bash
bin/kafka-configs.sh --alter \
  --entity-type topics \
  --entity-name my-topic \
  --add-config retention.ms=86400000,cleanup.policy=compact \
  --bootstrap-server localhost:9092
```

---

### Delete Topic Config

```bash
bin/kafka-configs.sh --alter \
  --entity-type topics \
  --entity-name my-topic \
  --delete-config retention.ms \
  --bootstrap-server localhost:9092
```

---

## Performance Testing Commands

### Producer Performance Test

```bash
bin/kafka-producer-perf-test.sh \
  --topic my-topic \
  --num-records 1000000 \
  --record-size 100 \
  --throughput 10000 \
  --producer-props bootstrap.servers=localhost:9092
```

**Output:**
```
100000 records sent, 19960.1 records/sec (1.90 MB/sec)
```

---

### Consumer Performance Test

```bash
bin/kafka-consumer-perf-test.sh \
  --topic my-topic \
  --messages 1000000 \
  --bootstrap-server localhost:9092
```

---

## Partition Commands

### Get Topic Partition Info

```bash
bin/kafka-topics.sh --describe \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

---

### Reassign Partitions

**Create JSON file (reassignment.json):**
```json
{
  "version": 1,
  "partitions": [
    {"topic": "my-topic", "partition": 0, "replicas": [0, 1]},
    {"topic": "my-topic", "partition": 1, "replicas": [1, 2]}
  ]
}
```

**Execute reassignment:**
```bash
bin/kafka-reassign-partitions.sh --execute \
  --reassignment-json-file reassignment.json \
  --bootstrap-server localhost:9092
```

---

## Log Commands

### Dump Log Segments

```bash
bin/kafka-dump-log.sh \
  --files /tmp/kafka-logs/my-topic-0/00000000000000000000.log \
  --print-data-log
```

---

## ACL Commands (Security)

### Add ACL

```bash
bin/kafka-acls.sh --add \
  --allow-principal User:alice \
  --operation Read \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

### List ACLs

```bash
bin/kafka-acls.sh --list \
  --topic my-topic \
  --bootstrap-server localhost:9092
```

---

## Common Use Cases

### 1. Create Topic and Produce Messages

```bash
# Create topic
bin/kafka-topics.sh --create \
  --topic orders \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 1

# Produce messages
bin/kafka-console-producer.sh \
  --topic orders \
  --bootstrap-server localhost:9092
```

### 2. Consume Messages from Beginning

```bash
bin/kafka-console-consumer.sh \
  --topic orders \
  --from-beginning \
  --bootstrap-server localhost:9092
```

### 3. Check Consumer Lag

```bash
bin/kafka-consumer-groups.sh --describe \
  --group my-group \
  --bootstrap-server localhost:9092
```

### 4. Reset Offsets to Beginning

```bash
bin/kafka-consumer-groups.sh --reset-offsets \
  --group my-group \
  --topic orders \
  --to-earliest \
  --execute \
  --bootstrap-server localhost:9092
```

---

## Quick Reference

| Command | Purpose |
|---------|--------|
| `kafka-topics.sh` | Topic management |
| `kafka-console-producer.sh` | Send messages |
| `kafka-console-consumer.sh` | Read messages |
| `kafka-consumer-groups.sh` | Consumer group management |
| `kafka-configs.sh` | Configuration management |
| `kafka-reassign-partitions.sh` | Partition reassignment |
| `kafka-producer-perf-test.sh` | Producer performance test |
| `kafka-consumer-perf-test.sh` | Consumer performance test |

---

## Summary

**Most Used Commands:**

```bash
# Topics
kafka-topics.sh --create/list/describe/delete

# Producer
kafka-console-producer.sh --topic <name>

# Consumer
kafka-console-consumer.sh --topic <name> --from-beginning

# Consumer Groups
kafka-consumer-groups.sh --describe --group <name>
kafka-consumer-groups.sh --reset-offsets --to-earliest

# Config
kafka-configs.sh --describe/alter --entity-type topics
```

---

## Interview Questions & Answers

### Q1: How do you create a Kafka topic using CLI?
**A:**
```bash
bin/kafka-topics.sh --create \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 1
```

### Q2: How do you list all topics in Kafka?
**A:**
```bash
bin/kafka-topics.sh --list --bootstrap-server localhost:9092
```

### Q3: How do you produce messages from the command line?
**A:**
```bash
bin/kafka-console-producer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092
```
Then type messages line by line.

### Q4: How do you consume messages from the beginning of a topic?
**A:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --from-beginning \
  --bootstrap-server localhost:9092
```

### Q5: How do you check consumer lag?
**A:**
```bash
bin/kafka-consumer-groups.sh --describe \
  --group my-consumer-group \
  --bootstrap-server localhost:9092
```
Look at the LAG column in the output.

### Q6: How do you reset consumer group offset to earliest?
**A:**
```bash
bin/kafka-consumer-groups.sh --reset-offsets \
  --group my-consumer-group \
  --topic my-topic \
  --to-earliest \
  --execute \
  --bootstrap-server localhost:9092
```

### Q7: How do you describe a specific topic?
**A:**
```bash
bin/kafka-topics.sh --describe \
  --topic my-topic \
  --bootstrap-server localhost:9092
```
Shows partitions, leaders, replicas, and ISR.

### Q8: How do you delete a topic?
**A:**
```bash
bin/kafka-topics.sh --delete \
  --topic my-topic \
  --bootstrap-server localhost:9092
```
Note: `delete.topic.enable=true` must be set in server.properties.

### Q9: How do you increase the number of partitions for a topic?
**A:**
```bash
bin/kafka-topics.sh --alter \
  --topic my-topic \
  --partitions 5 \
  --bootstrap-server localhost:9092
```
Note: You can only increase partitions, not decrease.

### Q10: How do you list all consumer groups?
**A:**
```bash
bin/kafka-consumer-groups.sh --list \
  --bootstrap-server localhost:9092
```

### Q11: How do you produce messages with keys?
**A:**
```bash
bin/kafka-console-producer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --property "parse.key=true" \
  --property "key.separator=:"
```
Then type: `key1:value1`

### Q12: How do you consume messages and display keys, partitions, and offsets?
**A:**
```bash
bin/kafka-console-consumer.sh \
  --topic my-topic \
  --bootstrap-server localhost:9092 \
  --property print.key=true \
  --property print.partition=true \
  --property print.offset=true
```

### Q13: How do you change topic configuration?
**A:**
```bash
bin/kafka-configs.sh --alter \
  --entity-type topics \
  --entity-name my-topic \
  --add-config retention.ms=604800000 \
  --bootstrap-server localhost:9092
```

### Q14: What is the difference between --from-beginning and default consumer behavior?
**A:**
- **Default**: Consumes only new messages (from current offset)
- **--from-beginning**: Consumes all messages from offset 0 (useful for testing or reprocessing)

### Q15: How do you test Kafka producer performance?
**A:**
```bash
bin/kafka-producer-perf-test.sh \
  --topic my-topic \
  --num-records 1000000 \
  --record-size 100 \
  --throughput 10000 \
  --producer-props bootstrap.servers=localhost:9092
```
Shows records/sec and throughput.

**Kafka Basics Complete! ðŸŽ‰**

**Next:** Kafka Core Concepts