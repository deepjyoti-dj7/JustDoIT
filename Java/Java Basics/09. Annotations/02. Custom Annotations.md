# üé® Custom Annotations

## üìñ Overview

**Custom annotations** allow you to create your own metadata tags for specific purposes like validation, configuration, testing, or documentation.

**Syntax:** Use `@interface` keyword

---

## üíª Creating Simple Annotation

```java
// Define annotation
public @interface Author {
    String name();
    String date();
}

// Use annotation
@Author(name = "Alice", date = "2024-01-15")
public class MyClass {
    // Class implementation
}
```

---

## üíª Annotation Elements

### Element Types

```java
public @interface MyAnnotation {
    // Allowed types:
    String stringValue();
    int intValue();
    long longValue();
    boolean booleanValue();
    double doubleValue();
    
    Class<?> classValue();
    String[] arrayValue();
    
    // Enum
    Priority priority();
    
    // Another annotation
    Author author();
}

enum Priority {
    LOW, MEDIUM, HIGH
}
```

### Default Values

```java
public @interface Config {
    String name() default "default";
    int value() default 0;
    boolean enabled() default true;
    String[] tags() default {};
}

// Usage with defaults
@Config  // Uses all defaults

@Config(name = "custom")  // Overrides name only

@Config(name = "custom", value = 100)
```

---

## üíª Marker Annotations

Annotations with no elements.

```java
// Define marker annotation
public @interface Loggable {
}

// Use marker annotation
@Loggable
public class Service {
    public void process() {
        // Implementation
    }
}
```

---

## üíª Single-Value Annotations

```java
// Define with single element named "value"
public @interface Version {
    String value();
}

// Usage - no need for "value="
@Version("1.0.0")
public class Application {
}

// Equivalent to:
// @Version(value = "1.0.0")
```

---

## üéØ Real-World Examples

### Example 1: Field Validation

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface NotNull {
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Min {
    int value();
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Max {
    int value();
}

// Usage
public class User {
    @NotNull
    private String name;
    
    @Min(0)
    @Max(150)
    private int age;
    
    @NotNull
    private String email;
}
```

### Example 2: Method Annotations

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Test {
    String description() default "";
    int timeout() default 0;
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface BeforeTest {
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface AfterTest {
}

// Usage
public class MyTest {
    
    @BeforeTest
    public void setup() {
        // Setup code
    }
    
    @Test(description = "Test addition", timeout = 1000)
    public void testAdd() {
        // Test code
    }
    
    @AfterTest
    public void cleanup() {
        // Cleanup code
    }
}
```

### Example 3: API Documentation

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface API {
    String version();
    String description() default "";
    boolean deprecated() default false;
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Endpoint {
    String path();
    String method() default "GET";
    String description() default "";
}

// Usage
@API(version = "1.0", description = "User management API")
public class UserController {
    
    @Endpoint(path = "/users", method = "GET")
    public List<User> getUsers() {
        return null;
    }
    
    @Endpoint(path = "/users/{id}", method = "POST")
    public User createUser() {
        return null;
    }
}
```

### Example 4: Dependency Injection

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Inject {
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Component {
    String value() default "";
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Service {
    String value() default "";
}

// Usage
@Service
public class UserService {
    
    @Inject
    private UserRepository repository;
    
    public User findUser(int id) {
        return repository.findById(id);
    }
}

@Component
public class UserRepository {
    public User findById(int id) {
        return null;
    }
}
```

### Example 5: Configuration

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Configuration {
    String[] profiles() default {};
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Bean {
    String name() default "";
    boolean primary() default false;
}

// Usage
@Configuration
public class AppConfig {
    
    @Bean(name = "dataSource", primary = true)
    public DataSource dataSource() {
        return new DataSource();
    }
    
    @Bean
    public UserService userService() {
        return new UserService();
    }
}
```

### Example 6: Database Mapping

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Entity {
    String table() default "";
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Id {
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.FIELD)
public @interface Column {
    String name() default "";
    boolean nullable() default true;
}

// Usage
@Entity(table = "users")
public class User {
    
    @Id
    @Column(name = "user_id")
    private Long id;
    
    @Column(name = "user_name", nullable = false)
    private String name;
    
    @Column(name = "email")
    private String email;
}
```

### Example 7: Scheduled Tasks

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Scheduled {
    String cron() default "";
    long fixedDelay() default -1;
    long fixedRate() default -1;
}

// Usage
public class TaskScheduler {
    
    @Scheduled(cron = "0 0 * * * *")  // Every hour
    public void hourlyTask() {
        System.out.println("Running hourly task");
    }
    
    @Scheduled(fixedDelay = 5000)  // Every 5 seconds
    public void periodicTask() {
        System.out.println("Running periodic task");
    }
}
```

### Example 8: Access Control

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface RequireRole {
    String[] value();
}

@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface RequirePermission {
    String value();
}

// Usage
public class AdminController {
    
    @RequireRole({"ADMIN", "SUPER_ADMIN"})
    public void deleteUser(int id) {
        // Delete user
    }
    
    @RequirePermission("users:write")
    public void updateUser(User user) {
        // Update user
    }
}
```

---

## üìä Annotation Element Restrictions

| Allowed | Not Allowed |
|---------|-------------|
| Primitives (int, long, etc.) | null values |
| String | Generic types |
| Class | Any other object |
| Enum | Wrapper classes as return |
| Arrays of above | Multi-dimensional arrays |
| Other annotations | Methods with parameters |

---

## üìä Common Annotation Patterns

| Pattern | Use Case | Example |
|---------|----------|---------|
| Marker | Flag presence | @Loggable |
| Single-value | One property | @Version("1.0") |
| Multi-value | Multiple properties | @Author(name="...", date="...") |
| Container | Hold other annotations | @Authors({@Author...}) |

---

## ‚ö° Best Practices

| Practice | Description |
|----------|-------------|
| ‚úÖ Use clear names | Self-documenting |
| ‚úÖ Provide defaults | Reduce verbosity |
| ‚úÖ Use "value" for single element | Enable shorthand |
| ‚úÖ Document purpose | Explain usage |
| ‚úÖ Keep it simple | Don't overcomplicate |
| ‚úÖ Use appropriate targets | Restrict where used |
| ‚úÖ Choose right retention | Based on use case |
| ‚ùå Don't use for logic | Metadata only |
| ‚ùå Don't create too many | Causes confusion |

---

## üéØ Annotation Design Guidelines

```java
// ‚úÖ GOOD - Clear, simple, with defaults
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Cache {
    String key() default "";
    int ttl() default 3600;
    boolean enabled() default true;
}

// ‚ùå BAD - Too complex
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface ComplexCache {
    String key();
    int ttl();
    String provider();
    String serializer();
    String deserializer();
    boolean compress();
    int compressionLevel();
    // Too many required fields!
}

// ‚úÖ GOOD - Using "value" for single element
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
public @interface Controller {
    String value() default "";  // Enables @Controller("/path")
}

// ‚úÖ GOOD - Marker annotation
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Async {  // No elements needed
}
```

---

## üîó Related Topics

- [Built-in Annotations](01.%20Built-in%20Annotations.md)
- [Meta-Annotations](03.%20Meta-Annotations.md)
- [Annotation Processing](04.%20Annotation%20Processing.md)

---

## üí° Key Takeaways

- Use @interface to create custom annotations
- Elements can be primitives, String, Class, enum, arrays, or annotations
- Provide default values for optional elements
- "value" element enables shorthand syntax
- Marker annotations have no elements
- Apply meta-annotations (@Retention, @Target) to control behavior
- Keep annotations simple and focused
- Document annotation purpose and usage
- Use appropriate retention policy (runtime, source, class)
- Annotations are just metadata - processing logic is separate
