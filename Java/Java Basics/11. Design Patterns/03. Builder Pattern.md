# üèóÔ∏è Builder Pattern

## üìñ Overview

**Builder Pattern** separates the construction of complex objects from their representation, allowing step-by-step construction.

**When to Use:**
- Many constructor parameters
- Optional parameters
- Immutable objects
- Complex object creation process

---

## üíª Basic Builder Pattern

```java
public class User {
    // Required parameters
    private final String firstName;
    private final String lastName;
    
    // Optional parameters
    private final int age;
    private final String phone;
    private final String address;
    private final String email;
    
    private User(UserBuilder builder) {
        this.firstName = builder.firstName;
        this.lastName = builder.lastName;
        this.age = builder.age;
        this.phone = builder.phone;
        this.address = builder.address;
        this.email = builder.email;
    }
    
    // Static nested Builder class
    public static class UserBuilder {
        // Required parameters
        private final String firstName;
        private final String lastName;
        
        // Optional parameters - initialized to default values
        private int age = 0;
        private String phone = "";
        private String address = "";
        private String email = "";
        
        public UserBuilder(String firstName, String lastName) {
            this.firstName = firstName;
            this.lastName = lastName;
        }
        
        public UserBuilder age(int age) {
            this.age = age;
            return this;
        }
        
        public UserBuilder phone(String phone) {
            this.phone = phone;
            return this;
        }
        
        public UserBuilder address(String address) {
            this.address = address;
            return this;
        }
        
        public UserBuilder email(String email) {
            this.email = email;
            return this;
        }
        
        public User build() {
            return new User(this);
        }
    }
    
    @Override
    public String toString() {
        return "User{" +
                "firstName='" + firstName + '\'' +
                ", lastName='" + lastName + '\'' +
                ", age=" + age +
                ", phone='" + phone + '\'' +
                ", address='" + address + '\'' +
                ", email='" + email + '\'' +
                '}';
    }
}

// Usage
User user = new User.UserBuilder("John", "Doe")
    .age(30)
    .email("john@example.com")
    .phone("123-456-7890")
    .build();
```

---

## üíª Builder with Validation

```java
public class Product {
    private final String name;
    private final double price;
    private final String category;
    private final int stock;
    
    private Product(ProductBuilder builder) {
        this.name = builder.name;
        this.price = builder.price;
        this.category = builder.category;
        this.stock = builder.stock;
    }
    
    public static class ProductBuilder {
        private String name;
        private double price;
        private String category = "General";
        private int stock = 0;
        
        public ProductBuilder(String name, double price) {
            this.name = name;
            this.price = price;
        }
        
        public ProductBuilder category(String category) {
            this.category = category;
            return this;
        }
        
        public ProductBuilder stock(int stock) {
            this.stock = stock;
            return this;
        }
        
        public Product build() {
            // Validation
            if (name == null || name.isEmpty()) {
                throw new IllegalArgumentException("Name is required");
            }
            if (price < 0) {
                throw new IllegalArgumentException("Price cannot be negative");
            }
            if (stock < 0) {
                throw new IllegalArgumentException("Stock cannot be negative");
            }
            
            return new Product(this);
        }
    }
}

// Usage
Product product = new Product.ProductBuilder("Laptop", 999.99)
    .category("Electronics")
    .stock(50)
    .build();
```

---

## üéØ Complete Examples

### Example 1: HTTP Request Builder

```java
public class HttpRequest {
    private final String url;
    private final String method;
    private final Map<String, String> headers;
    private final Map<String, String> parameters;
    private final String body;
    private final int timeout;
    
    private HttpRequest(HttpRequestBuilder builder) {
        this.url = builder.url;
        this.method = builder.method;
        this.headers = builder.headers;
        this.parameters = builder.parameters;
        this.body = builder.body;
        this.timeout = builder.timeout;
    }
    
    public static class HttpRequestBuilder {
        private final String url;
        private String method = "GET";
        private Map<String, String> headers = new HashMap<>();
        private Map<String, String> parameters = new HashMap<>();
        private String body = "";
        private int timeout = 30000;
        
        public HttpRequestBuilder(String url) {
            this.url = url;
        }
        
        public HttpRequestBuilder method(String method) {
            this.method = method;
            return this;
        }
        
        public HttpRequestBuilder addHeader(String key, String value) {
            this.headers.put(key, value);
            return this;
        }
        
        public HttpRequestBuilder addParameter(String key, String value) {
            this.parameters.put(key, value);
            return this;
        }
        
        public HttpRequestBuilder body(String body) {
            this.body = body;
            return this;
        }
        
        public HttpRequestBuilder timeout(int timeout) {
            this.timeout = timeout;
            return this;
        }
        
        public HttpRequest build() {
            if (url == null || url.isEmpty()) {
                throw new IllegalArgumentException("URL is required");
            }
            return new HttpRequest(this);
        }
    }
    
    public void execute() {
        System.out.println("Executing " + method + " request to " + url);
        System.out.println("Headers: " + headers);
        System.out.println("Parameters: " + parameters);
        System.out.println("Body: " + body);
        System.out.println("Timeout: " + timeout + "ms");
    }
}

// Usage
HttpRequest request = new HttpRequest.HttpRequestBuilder("https://api.example.com/users")
    .method("POST")
    .addHeader("Content-Type", "application/json")
    .addHeader("Authorization", "Bearer token123")
    .addParameter("page", "1")
    .addParameter("size", "10")
    .body("{\"name\":\"John\"}")
    .timeout(5000)
    .build();

request.execute();
```

### Example 2: Email Builder

```java
public class Email {
    private final String from;
    private final List<String> to;
    private final List<String> cc;
    private final List<String> bcc;
    private final String subject;
    private final String body;
    private final List<String> attachments;
    private final boolean isHtml;
    
    private Email(EmailBuilder builder) {
        this.from = builder.from;
        this.to = builder.to;
        this.cc = builder.cc;
        this.bcc = builder.bcc;
        this.subject = builder.subject;
        this.body = builder.body;
        this.attachments = builder.attachments;
        this.isHtml = builder.isHtml;
    }
    
    public static class EmailBuilder {
        private final String from;
        private final List<String> to = new ArrayList<>();
        private List<String> cc = new ArrayList<>();
        private List<String> bcc = new ArrayList<>();
        private String subject = "";
        private String body = "";
        private List<String> attachments = new ArrayList<>();
        private boolean isHtml = false;
        
        public EmailBuilder(String from) {
            this.from = from;
        }
        
        public EmailBuilder to(String... recipients) {
            this.to.addAll(Arrays.asList(recipients));
            return this;
        }
        
        public EmailBuilder cc(String... recipients) {
            this.cc.addAll(Arrays.asList(recipients));
            return this;
        }
        
        public EmailBuilder bcc(String... recipients) {
            this.bcc.addAll(Arrays.asList(recipients));
            return this;
        }
        
        public EmailBuilder subject(String subject) {
            this.subject = subject;
            return this;
        }
        
        public EmailBuilder body(String body) {
            this.body = body;
            return this;
        }
        
        public EmailBuilder attach(String... files) {
            this.attachments.addAll(Arrays.asList(files));
            return this;
        }
        
        public EmailBuilder html(boolean isHtml) {
            this.isHtml = isHtml;
            return this;
        }
        
        public Email build() {
            if (from == null || from.isEmpty()) {
                throw new IllegalArgumentException("From address is required");
            }
            if (to.isEmpty()) {
                throw new IllegalArgumentException("At least one recipient is required");
            }
            return new Email(this);
        }
    }
    
    public void send() {
        System.out.println("Sending email:");
        System.out.println("From: " + from);
        System.out.println("To: " + to);
        System.out.println("CC: " + cc);
        System.out.println("BCC: " + bcc);
        System.out.println("Subject: " + subject);
        System.out.println("Body: " + body);
        System.out.println("Attachments: " + attachments);
        System.out.println("HTML: " + isHtml);
    }
}

// Usage
Email email = new Email.EmailBuilder("sender@example.com")
    .to("user1@example.com", "user2@example.com")
    .cc("manager@example.com")
    .subject("Meeting Reminder")
    .body("<h1>Don't forget the meeting at 3 PM</h1>")
    .html(true)
    .attach("agenda.pdf", "presentation.pptx")
    .build();

email.send();
```

### Example 3: SQL Query Builder

```java
public class SQLQuery {
    private final String table;
    private final List<String> columns;
    private final String whereClause;
    private final String orderBy;
    private final Integer limit;
    private final Integer offset;
    
    private SQLQuery(SQLQueryBuilder builder) {
        this.table = builder.table;
        this.columns = builder.columns;
        this.whereClause = builder.whereClause;
        this.orderBy = builder.orderBy;
        this.limit = builder.limit;
        this.offset = builder.offset;
    }
    
    public static class SQLQueryBuilder {
        private final String table;
        private List<String> columns = new ArrayList<>();
        private String whereClause = "";
        private String orderBy = "";
        private Integer limit = null;
        private Integer offset = null;
        
        public SQLQueryBuilder(String table) {
            this.table = table;
        }
        
        public SQLQueryBuilder select(String... columns) {
            this.columns.addAll(Arrays.asList(columns));
            return this;
        }
        
        public SQLQueryBuilder where(String condition) {
            this.whereClause = condition;
            return this;
        }
        
        public SQLQueryBuilder orderBy(String column) {
            this.orderBy = column;
            return this;
        }
        
        public SQLQueryBuilder limit(int limit) {
            this.limit = limit;
            return this;
        }
        
        public SQLQueryBuilder offset(int offset) {
            this.offset = offset;
            return this;
        }
        
        public SQLQuery build() {
            if (table == null || table.isEmpty()) {
                throw new IllegalArgumentException("Table name is required");
            }
            return new SQLQuery(this);
        }
    }
    
    public String toSQL() {
        StringBuilder sql = new StringBuilder("SELECT ");
        
        if (columns.isEmpty()) {
            sql.append("*");
        } else {
            sql.append(String.join(", ", columns));
        }
        
        sql.append(" FROM ").append(table);
        
        if (!whereClause.isEmpty()) {
            sql.append(" WHERE ").append(whereClause);
        }
        
        if (!orderBy.isEmpty()) {
            sql.append(" ORDER BY ").append(orderBy);
        }
        
        if (limit != null) {
            sql.append(" LIMIT ").append(limit);
        }
        
        if (offset != null) {
            sql.append(" OFFSET ").append(offset);
        }
        
        return sql.toString();
    }
}

// Usage
SQLQuery query = new SQLQuery.SQLQueryBuilder("users")
    .select("id", "name", "email")
    .where("age > 18")
    .orderBy("name ASC")
    .limit(10)
    .offset(20)
    .build();

System.out.println(query.toSQL());
// SELECT id, name, email FROM users WHERE age > 18 ORDER BY name ASC LIMIT 10 OFFSET 20
```

### Example 4: Pizza Builder

```java
public class Pizza {
    private final String size;
    private final boolean cheese;
    private final boolean pepperoni;
    private final boolean mushrooms;
    private final boolean onions;
    private final boolean bacon;
    private final String crustType;
    
    private Pizza(PizzaBuilder builder) {
        this.size = builder.size;
        this.cheese = builder.cheese;
        this.pepperoni = builder.pepperoni;
        this.mushrooms = builder.mushrooms;
        this.onions = builder.onions;
        this.bacon = builder.bacon;
        this.crustType = builder.crustType;
    }
    
    public static class PizzaBuilder {
        private final String size;
        private boolean cheese = false;
        private boolean pepperoni = false;
        private boolean mushrooms = false;
        private boolean onions = false;
        private boolean bacon = false;
        private String crustType = "Regular";
        
        public PizzaBuilder(String size) {
            this.size = size;
        }
        
        public PizzaBuilder cheese() {
            this.cheese = true;
            return this;
        }
        
        public PizzaBuilder pepperoni() {
            this.pepperoni = true;
            return this;
        }
        
        public PizzaBuilder mushrooms() {
            this.mushrooms = true;
            return this;
        }
        
        public PizzaBuilder onions() {
            this.onions = true;
            return this;
        }
        
        public PizzaBuilder bacon() {
            this.bacon = true;
            return this;
        }
        
        public PizzaBuilder crust(String type) {
            this.crustType = type;
            return this;
        }
        
        public Pizza build() {
            return new Pizza(this);
        }
    }
    
    @Override
    public String toString() {
        List<String> toppings = new ArrayList<>();
        if (cheese) toppings.add("Cheese");
        if (pepperoni) toppings.add("Pepperoni");
        if (mushrooms) toppings.add("Mushrooms");
        if (onions) toppings.add("Onions");
        if (bacon) toppings.add("Bacon");
        
        return size + " Pizza with " + crustType + " crust, Toppings: " + 
               (toppings.isEmpty() ? "None" : String.join(", ", toppings));
    }
}

// Usage
Pizza pizza = new Pizza.PizzaBuilder("Large")
    .cheese()
    .pepperoni()
    .mushrooms()
    .crust("Thin")
    .build();

System.out.println(pizza);
```

---

## üìä Builder vs Constructor

| Aspect | Constructor | Builder |
|--------|------------|---------|
| Many parameters | Telescoping constructors | Clean, fluent API |
| Optional parameters | Overloaded constructors | Optional chaining |
| Readability | Hard to read | Very readable |
| Immutability | Supported | Supported |
| Validation | In constructor | In build() |

---

## ‚ö° Best Practices

| Practice | Description |
|----------|-------------|
| ‚úÖ Use for 4+ parameters | Improves readability |
| ‚úÖ Make class immutable | Final fields |
| ‚úÖ Return `this` from setters | Method chaining |
| ‚úÖ Validate in build() | Ensure object consistency |
| ‚úÖ Use static nested class | Standard pattern |
| ‚úÖ Provide default values | For optional parameters |
| ‚ùå Don't use for simple objects | Overkill |

---

## üéØ Advantages

- Readable code with method chaining
- Handles optional parameters elegantly
- Immutable objects (thread-safe)
- Better control over construction process
- Easy to add new parameters
- Validation before object creation

---

## üîó Related Topics

- [Singleton Pattern](01.%20Singleton%20Pattern.md)
- [Factory Pattern](02.%20Factory%20Pattern.md)

---

## üí° Key Takeaways

- Builder pattern constructs complex objects step-by-step
- Use for classes with many parameters (especially optional ones)
- Provides fluent, readable API
- Returns `this` from builder methods for chaining
- Create immutable objects (final fields)
- Validate in build() method before construction
- Use static nested Builder class
- Better alternative to telescoping constructors
- Excellent for creating immutable objects
- Makes code more maintainable and readable
