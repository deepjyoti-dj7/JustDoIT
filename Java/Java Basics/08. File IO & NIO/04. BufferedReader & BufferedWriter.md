# üìö BufferedReader & BufferedWriter

## üìñ Overview

**BufferedReader** and **BufferedWriter** provide efficient reading and writing by buffering data in memory, reducing the number of I/O operations.

**Key Benefits:**
- Faster than unbuffered I/O
- Read/write entire lines easily
- Configurable buffer size
- Auto-flush support

---

## üíª BufferedReader

### Basic Usage

```java
import java.io.*;

try (BufferedReader reader = new BufferedReader(new FileReader("input.txt"))) {
    
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }
    
} catch (IOException e) {
    e.printStackTrace();
}
```

### With Charset

```java
try (BufferedReader reader = new BufferedReader(
        new InputStreamReader(
            new FileInputStream("input.txt"),
            StandardCharsets.UTF_8))) {
    
    String line;
    while ((line = reader.readLine()) != null) {
        System.out.println(line);
    }
}
```

### Reading Methods

```java
BufferedReader reader = new BufferedReader(new FileReader("file.txt"));

// Read single character
int ch = reader.read();

// Read into character array
char[] buffer = new char[1024];
int charsRead = reader.read(buffer);

// Read line (most common)
String line = reader.readLine();

// Skip characters
reader.skip(10);

// Check if ready
boolean ready = reader.ready();

// Mark and reset
reader.mark(100);  // Mark with 100 char read-ahead limit
String data = reader.readLine();
reader.reset();    // Go back to mark

reader.close();
```

### Custom Buffer Size

```java
// Default buffer size is 8192
BufferedReader reader1 = new BufferedReader(new FileReader("file.txt"));

// Custom buffer size
BufferedReader reader2 = new BufferedReader(new FileReader("file.txt"), 16384);
```

---

## üíª BufferedWriter

### Basic Usage

```java
try (BufferedWriter writer = new BufferedWriter(new FileWriter("output.txt"))) {
    
    writer.write("Line 1");
    writer.newLine();
    writer.write("Line 2");
    writer.newLine();
    
} catch (IOException e) {
    e.printStackTrace();
}
```

### With Charset

```java
try (BufferedWriter writer = new BufferedWriter(
        new OutputStreamWriter(
            new FileOutputStream("output.txt"),
            StandardCharsets.UTF_8))) {
    
    writer.write("Hello, UTF-8!");
    writer.newLine();
}
```

### Writing Methods

```java
BufferedWriter writer = new BufferedWriter(new FileWriter("file.txt"));

// Write string
writer.write("Hello");

// Write substring
writer.write("Hello, World!", 0, 5);  // Writes "Hello"

// Write single character
writer.write('A');

// Write character array
char[] chars = {'H', 'e', 'l', 'l', 'o'};
writer.write(chars);

// Write line separator
writer.newLine();  // Platform-independent

// Flush buffer
writer.flush();

writer.close();
```

### Append Mode

```java
try (BufferedWriter writer = new BufferedWriter(
        new FileWriter("output.txt", true))) {  // true = append
    
    writer.write("Appended line");
    writer.newLine();
}
```

### Custom Buffer Size

```java
// Default buffer size is 8192
BufferedWriter writer1 = new BufferedWriter(new FileWriter("file.txt"));

// Custom buffer size
BufferedWriter writer2 = new BufferedWriter(new FileWriter("file.txt"), 16384);
```

---

## üéØ Complete Examples

### Example 1: Copy File Line by Line

```java
public class FileCopy {
    public static void copyFile(String source, String dest) {
        try (BufferedReader reader = new BufferedReader(new FileReader(source));
             BufferedWriter writer = new BufferedWriter(new FileWriter(dest))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                writer.write(line);
                writer.newLine();
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### Example 2: Read and Process Large File

```java
public class LogProcessor {
    public static void processLogs(String filename) {
        int lineCount = 0;
        int errorCount = 0;
        
        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                lineCount++;
                if (line.contains("ERROR")) {
                    errorCount++;
                    System.out.println("Line " + lineCount + ": " + line);
                }
            }
            
            System.out.println("\nTotal lines: " + lineCount);
            System.out.println("Errors found: " + errorCount);
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### Example 3: Write CSV with BufferedWriter

```java
public class CSVWriter {
    public static void writeCSV(List<String[]> data, String filename) {
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filename))) {
            
            for (String[] row : data) {
                writer.write(String.join(",", row));
                writer.newLine();
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    public static void main(String[] args) {
        List<String[]> data = Arrays.asList(
            new String[]{"Name", "Age", "City"},
            new String[]{"Alice", "25", "NYC"},
            new String[]{"Bob", "30", "LA"}
        );
        writeCSV(data, "people.csv");
    }
}
```

### Example 4: Read CSV with BufferedReader

```java
public class CSVReader {
    public static List<String[]> readCSV(String filename) {
        List<String[]> data = new ArrayList<>();
        
        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                String[] values = line.split(",");
                data.add(values);
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        return data;
    }
    
    public static void main(String[] args) {
        List<String[]> data = readCSV("people.csv");
        for (String[] row : data) {
            System.out.println(Arrays.toString(row));
        }
    }
}
```

### Example 5: Filter and Transform File

```java
public class FileFilter {
    public static void filterFile(String input, String output, 
                                  Predicate<String> filter,
                                  Function<String, String> transform) {
        
        try (BufferedReader reader = new BufferedReader(new FileReader(input));
             BufferedWriter writer = new BufferedWriter(new FileWriter(output))) {
            
            String line;
            while ((line = reader.readLine()) != null) {
                if (filter.test(line)) {
                    String transformed = transform.apply(line);
                    writer.write(transformed);
                    writer.newLine();
                }
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    public static void main(String[] args) {
        filterFile(
            "input.txt",
            "output.txt",
            line -> line.length() > 10,           // Filter
            String::toUpperCase                    // Transform
        );
    }
}
```

### Example 6: Read with Line Numbers

```java
public class LineNumberReader {
    public static void readWithLineNumbers(String filename) {
        try (BufferedReader reader = new BufferedReader(new FileReader(filename))) {
            
            String line;
            int lineNumber = 1;
            
            while ((line = reader.readLine()) != null) {
                System.out.printf("%4d: %s%n", lineNumber++, line);
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### Example 7: Write with Periodic Flush

```java
public class PeriodicFlush {
    public static void writeWithFlush(List<String> data, String filename) {
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filename))) {
            
            int count = 0;
            for (String line : data) {
                writer.write(line);
                writer.newLine();
                
                count++;
                if (count % 100 == 0) {
                    writer.flush();  // Flush every 100 lines
                }
            }
            
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

---

## üìä BufferedReader vs Scanner

| Feature | BufferedReader | Scanner |
|---------|----------------|---------|
| **Speed** | Faster | Slower |
| **Buffer** | Buffered | Not buffered |
| **Parsing** | Manual | Built-in |
| **Thread Safety** | Not thread-safe | Not thread-safe |
| **Use Case** | Simple line reading | Parsing structured data |

```java
// BufferedReader - Fast
try (BufferedReader reader = new BufferedReader(new FileReader("file.txt"))) {
    String line;
    while ((line = reader.readLine()) != null) {
        int number = Integer.parseInt(line);  // Manual parsing
    }
}

// Scanner - Convenient
try (Scanner scanner = new Scanner(new File("file.txt"))) {
    while (scanner.hasNextInt()) {
        int number = scanner.nextInt();  // Built-in parsing
    }
}
```

---

## üìä BufferedWriter vs PrintWriter

| Feature | BufferedWriter | PrintWriter |
|---------|----------------|-------------|
| **Performance** | Faster | Slightly slower |
| **Formatting** | No | Yes (printf) |
| **Exception** | Throws | Suppresses |
| **Auto-flush** | Manual | Optional |
| **Use Case** | Performance-critical | Convenience |

```java
// BufferedWriter - Performance
try (BufferedWriter writer = new BufferedWriter(new FileWriter("file.txt"))) {
    writer.write("Value: " + value);
    writer.newLine();
}

// PrintWriter - Convenience
try (PrintWriter writer = new PrintWriter("file.txt")) {
    writer.printf("Value: %d%n", value);
}
```

---

## ‚ö° Performance Optimization

### Buffer Size Impact

```java
// Small buffer - many I/O operations
BufferedReader small = new BufferedReader(new FileReader("file.txt"), 1024);

// Large buffer - fewer I/O operations
BufferedReader large = new BufferedReader(new FileReader("file.txt"), 65536);
```

### Benchmark Example

```java
public class BufferBenchmark {
    public static void testBufferSize(String filename, int bufferSize) {
        long start = System.currentTimeMillis();
        
        try (BufferedReader reader = new BufferedReader(
                new FileReader(filename), bufferSize)) {
            
            while (reader.readLine() != null);
            
        } catch (IOException e) {
            e.printStackTrace();
        }
        
        long end = System.currentTimeMillis();
        System.out.println("Buffer " + bufferSize + ": " + (end - start) + "ms");
    }
    
    public static void main(String[] args) {
        testBufferSize("large.txt", 1024);    // 1 KB
        testBufferSize("large.txt", 8192);    // 8 KB (default)
        testBufferSize("large.txt", 65536);   // 64 KB
    }
}
```

---

## ‚ö° Best Practices

| Practice | Description |
|----------|-------------|
| ‚úÖ Use try-with-resources | Auto-close and flush |
| ‚úÖ Use newLine() | Platform-independent |
| ‚úÖ Specify charset | UTF-8 recommended |
| ‚úÖ Flush when needed | Important data |
| ‚úÖ Tune buffer size | For very large files |
| ‚úÖ Reuse instances | Where possible |
| ‚ùå Don't forget to close | Resource leaks |
| ‚ùå Don't flush too often | Hurts performance |
| ‚ùå Don't mix read/write | Use separate streams |

---

## üîó Related Topics

- [Reading Files](02.%20Reading%20Files.md)
- [Writing Files](03.%20Writing%20Files.md)
- [NIO Files Class](05.%20NIO%20Files%20Class.md)

---

## üí° Key Takeaways

- BufferedReader/Writer add buffering for performance
- readLine() and newLine() most commonly used
- Default buffer size is 8192 bytes
- Always use try-with-resources
- Specify charset explicitly with InputStreamReader/OutputStreamWriter
- BufferedReader faster than Scanner for simple reading
- BufferedWriter faster than PrintWriter
- Tune buffer size for very large files
- flush() ensures data is written immediately
- Platform-independent newLine() preferred over \n
