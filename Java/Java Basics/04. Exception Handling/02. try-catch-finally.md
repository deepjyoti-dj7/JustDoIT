# ðŸ”’ try-catch-finally

## ðŸ“– Overview

The **try-catch-finally** blocks are fundamental constructs for exception handling in Java. They allow you to handle exceptions gracefully and ensure cleanup code always executes.

**Structure:**
- **try** - Contains code that might throw exception
- **catch** - Handles the exception
- **finally** - Always executes (cleanup code)

---

## ðŸŽ¯ Syntax

```java
try {
    // Code that may throw exception
} catch (ExceptionType e) {
    // Handle exception
} finally {
    // Always executes (optional)
}
```

---

## ðŸ’» Example 1: Basic try-catch

```java
public class BasicTryCatch {
    public static void main(String[] args) {
        System.out.println("Program started");
        
        try {
            System.out.println("Inside try block");
            int result = 10 / 0;  // ArithmeticException
            System.out.println("Result: " + result);  // Never executes
        } catch (ArithmeticException e) {
            System.out.println("Inside catch block");
            System.out.println("Error: " + e.getMessage());
        }
        
        System.out.println("Program continues after exception");
    }
}
```

**Output:**
```
Program started
Inside try block
Inside catch block
Error: / by zero
Program continues after exception
```

---

## ðŸ’» Example 2: try-catch-finally

```java
public class TryCatchFinally {
    public static void main(String[] args) {
        System.out.println("=== Example 1: Exception occurs ===");
        try {
            System.out.println("Try block");
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            System.out.println("Catch block");
        } finally {
            System.out.println("Finally block - always executes");
        }
        
        System.out.println("\n=== Example 2: No exception ===");
        try {
            System.out.println("Try block");
            int result = 10 / 2;
            System.out.println("Result: " + result);
        } catch (ArithmeticException e) {
            System.out.println("Catch block");
        } finally {
            System.out.println("Finally block - always executes");
        }
    }
}
```

**Output:**
```
=== Example 1: Exception occurs ===
Try block
Catch block
Finally block - always executes

=== Example 2: No exception ===
Try block
Result: 5
Finally block - always executes
```

---

## ðŸ’» Example 3: Multiple Catch Blocks

```java
public class MultipleCatchBlocks {
    public static void main(String[] args) {
        String[] tests = {"10", "abc", null};
        
        for (int i = 0; i < tests.length; i++) {
            System.out.println("\n=== Test " + (i + 1) + ": " + tests[i] + " ===");
            
            try {
                String str = tests[i];
                System.out.println("Length: " + str.length());
                int num = Integer.parseInt(str);
                int result = 100 / num;
                System.out.println("Result: " + result);
            } catch (NullPointerException e) {
                System.out.println("Caught NullPointerException");
            } catch (NumberFormatException e) {
                System.out.println("Caught NumberFormatException");
            } catch (ArithmeticException e) {
                System.out.println("Caught ArithmeticException");
            } finally {
                System.out.println("Finally: Test completed");
            }
        }
    }
}
```

---

## ðŸ’» Example 4: Catch Order (Specific to General)

```java
public class CatchOrder {
    public static void main(String[] args) {
        // Correct order: Specific to general
        try {
            int[] arr = null;
            System.out.println(arr[0]);
        } catch (NullPointerException e) {
            System.out.println("Null pointer exception");
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("Array index exception");
        } catch (Exception e) {
            System.out.println("General exception");
        }
        
        // Wrong order - won't compile
        // try {
        //     int[] arr = null;
        //     System.out.println(arr[0]);
        // } catch (Exception e) {
        //     System.out.println("General exception");
        // } catch (NullPointerException e) {  // ERROR: Already caught
        //     System.out.println("Null pointer exception");
        // }
    }
}
```

---

## ðŸ’» Example 5: Multi-Catch (Java 7+)

```java
public class MultiCatch {
    public static void main(String[] args) {
        // Old way: Separate catch blocks
        System.out.println("=== Old Way ===");
        try {
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            System.out.println("Arithmetic or Null Pointer");
        } catch (NullPointerException e) {
            System.out.println("Arithmetic or Null Pointer");
        }
        
        // New way: Multi-catch (Java 7+)
        System.out.println("\n=== New Way (Multi-Catch) ===");
        try {
            int result = 10 / 0;
        } catch (ArithmeticException | NullPointerException e) {
            System.out.println("Arithmetic or Null Pointer");
            System.out.println("Exception type: " + e.getClass().getSimpleName());
        }
        
        // Multiple multi-catch blocks
        System.out.println("\n=== Multiple Multi-Catch ===");
        try {
            String str = null;
            System.out.println(str.length());
        } catch (NullPointerException | ArithmeticException e) {
            System.out.println("Group 1: " + e.getClass().getSimpleName());
        } catch (ArrayIndexOutOfBoundsException | NumberFormatException e) {
            System.out.println("Group 2: " + e.getClass().getSimpleName());
        }
    }
}
```

---

## ðŸ’» Example 6: Finally with Return

```java
public class FinallyWithReturn {
    static int test1() {
        try {
            System.out.println("Try block");
            return 10;
        } finally {
            System.out.println("Finally block");
            // Finally executes before return
        }
    }
    
    static int test2() {
        try {
            System.out.println("Try block");
            return 10;
        } finally {
            System.out.println("Finally block");
            return 20;  // Overrides try's return
        }
    }
    
    static int test3() {
        try {
            System.out.println("Try block");
            int result = 10 / 0;
            return result;
        } catch (ArithmeticException e) {
            System.out.println("Catch block");
            return 30;
        } finally {
            System.out.println("Finally block");
            // Try and catch's return is remembered
        }
    }
    
    public static void main(String[] args) {
        System.out.println("=== Test 1 ===");
        System.out.println("Returned: " + test1());
        
        System.out.println("\n=== Test 2 ===");
        System.out.println("Returned: " + test2());
        
        System.out.println("\n=== Test 3 ===");
        System.out.println("Returned: " + test3());
    }
}
```

**Output:**
```
=== Test 1 ===
Try block
Finally block
Returned: 10

=== Test 2 ===
Try block
Finally block
Returned: 20

=== Test 3 ===
Try block
Catch block
Finally block
Returned: 30
```

---

## ðŸ’» Example 7: Nested try-catch-finally

```java
public class NestedTryCatchFinally {
    public static void main(String[] args) {
        try {
            System.out.println("Outer try");
            
            try {
                System.out.println("Inner try");
                int result = 10 / 0;
            } catch (ArithmeticException e) {
                System.out.println("Inner catch");
            } finally {
                System.out.println("Inner finally");
            }
            
            System.out.println("Back to outer try");
            String str = null;
            System.out.println(str.length());
            
        } catch (NullPointerException e) {
            System.out.println("Outer catch");
        } finally {
            System.out.println("Outer finally");
        }
        
        System.out.println("Program continues");
    }
}
```

---

## ðŸ’» Example 8: Resource Cleanup with Finally

```java
import java.io.*;

public class ResourceCleanup {
    // Old way: Manual cleanup in finally
    static void readFileOldWay(String filename) {
        BufferedReader reader = null;
        try {
            reader = new BufferedReader(new FileReader(filename));
            String line;
            while ((line = reader.readLine()) != null) {
                System.out.println(line);
            }
        } catch (IOException e) {
            System.out.println("Error reading file: " + e.getMessage());
        } finally {
            // Always close resources
            System.out.println("Finally: Closing resources");
            try {
                if (reader != null) {
                    reader.close();
                }
            } catch (IOException e) {
                System.out.println("Error closing file: " + e.getMessage());
            }
        }
    }
    
    public static void main(String[] args) {
        System.out.println("Attempting to read file...");
        readFileOldWay("nonexistent.txt");
        System.out.println("Program ended");
    }
}
```

---

## ðŸ’» Example 9: Finally Block Scenarios

```java
public class FinallyScenarios {
    // Scenario 1: Exception in try, caught
    static void scenario1() {
        System.out.println("=== Scenario 1: Exception caught ===");
        try {
            System.out.println("1. Try");
            int x = 10 / 0;
        } catch (ArithmeticException e) {
            System.out.println("2. Catch");
        } finally {
            System.out.println("3. Finally");
        }
        System.out.println("4. After try-catch-finally");
    }
    
    // Scenario 2: No exception
    static void scenario2() {
        System.out.println("\n=== Scenario 2: No exception ===");
        try {
            System.out.println("1. Try");
            int x = 10 / 2;
        } catch (ArithmeticException e) {
            System.out.println("2. Catch");
        } finally {
            System.out.println("3. Finally");
        }
        System.out.println("4. After try-catch-finally");
    }
    
    // Scenario 3: Exception not caught
    static void scenario3() {
        System.out.println("\n=== Scenario 3: Exception not caught ===");
        try {
            try {
                System.out.println("1. Try");
                String str = null;
                str.length();
            } catch (ArithmeticException e) {
                System.out.println("2. Catch (won't execute)");
            } finally {
                System.out.println("3. Finally (still executes)");
            }
        } catch (NullPointerException e) {
            System.out.println("4. Outer catch");
        }
    }
    
    // Scenario 4: System.exit()
    static void scenario4() {
        System.out.println("\n=== Scenario 4: System.exit() ===");
        try {
            System.out.println("1. Try");
            System.exit(0);  // Finally won't execute
        } finally {
            System.out.println("2. Finally (won't execute)");
        }
    }
    
    public static void main(String[] args) {
        scenario1();
        scenario2();
        scenario3();
        // scenario4();  // Uncomment to test (terminates program)
    }
}
```

---

## ðŸ’» Example 10: Real-World Database Connection Example

```java
class DatabaseConnection {
    private boolean connected = false;
    
    void connect() {
        System.out.println("Connecting to database...");
        connected = true;
        System.out.println("Connected!");
    }
    
    void executeQuery(String query) {
        if (!connected) {
            throw new IllegalStateException("Not connected");
        }
        
        if (query.contains("ERROR")) {
            throw new RuntimeException("Query execution failed");
        }
        
        System.out.println("Executing: " + query);
        System.out.println("Query executed successfully");
    }
    
    void close() {
        System.out.println("Closing connection...");
        connected = false;
        System.out.println("Connection closed");
    }
}

public class DatabaseExample {
    public static void main(String[] args) {
        DatabaseConnection db = new DatabaseConnection();
        
        // Test 1: Successful execution
        System.out.println("=== Test 1: Success ===");
        try {
            db.connect();
            db.executeQuery("SELECT * FROM users");
        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        } finally {
            db.close();  // Always close connection
        }
        
        // Test 2: Query fails
        System.out.println("\n=== Test 2: Query Error ===");
        try {
            db.connect();
            db.executeQuery("ERROR QUERY");
        } catch (Exception e) {
            System.out.println("Error: " + e.getMessage());
        } finally {
            db.close();  // Connection still closed
        }
        
        System.out.println("\nProgram completed");
    }
}
```

---

## ðŸ“Š try-catch-finally Execution Flow

```
Scenario 1: No Exception
try â†’ finally â†’ rest of code

Scenario 2: Exception Caught
try â†’ catch â†’ finally â†’ rest of code

Scenario 3: Exception Not Caught
try â†’ finally â†’ exception propagates

Scenario 4: Return in try
try (with return) â†’ finally â†’ return to caller

Scenario 5: System.exit()
try â†’ System.exit() â†’ program terminates (finally NOT executed)
```

---

## ðŸ“Š Finally Block Rules

| Rule | Description |
|------|-------------|
| **Always executes** | Except System.exit() or fatal errors |
| **After try** | If no exception |
| **After catch** | If exception caught |
| **Before return** | Even if return in try/catch |
| **Before propagation** | If exception not caught |
| **Optional** | Can have try-catch without finally |

---

## ðŸ’¡ Best Practices

1. âœ… **Use finally for cleanup**
   ```java
   finally {
       // Close resources
       // Release locks
       // Cleanup operations
   }
   ```

2. âœ… **Close resources in finally**
   ```java
   Connection conn = null;
   try {
       conn = getConnection();
   } finally {
       if (conn != null) conn.close();
   }
   ```

3. âœ… **Order catch blocks correctly**
   ```java
   catch (SpecificException e) { }
   catch (GeneralException e) { }
   ```

4. âœ… **Use multi-catch for similar handling**
   ```java
   catch (IOException | SQLException e) { }
   ```

5. âœ… **Don't ignore exceptions**
   ```java
   catch (Exception e) {
       log.error("Error", e);  // Good
   }
   ```

---

## âš ï¸ Common Pitfalls

```java
public class TryCatchPitfalls {
    void demonstrate() {
        // 1. Wrong catch order
        // try { }
        // catch (Exception e) { }
        // catch (IOException e) { }  // ERROR: Already caught
        
        // 2. Empty catch block
        try {
            // code
        } catch (Exception e) {
            // BAD: Silent failure
        }
        
        // 3. Swallowing exceptions
        try {
            // code
        } catch (Exception e) {
            System.out.println("Error");  // Lost important info
        }
        
        // 4. Finally with return
        try {
            return 1;
        } finally {
            return 2;  // BAD: Confusing, overrides try's return
        }
        
        // 5. Not closing resources
        try {
            // Open resource
        } catch (Exception e) {
            // Handle
        }
        // Resource not closed!
    }
}
```

---

## ðŸŽ¯ Interview Questions

1. **What is try-catch-finally in Java?**
2. **Can we have try without catch?**
3. **Can we have multiple catch blocks?**
4. **What is finally block?**
5. **When does finally block not execute?**
6. **Can finally block have return statement?**
7. **What is multi-catch block?**
8. **Order of catch blocks?**
9. **Difference between final, finally, and finalize?**
10. **Can we have try-finally without catch?**
11. **What happens if exception occurs in finally?**
12. **Can we have nested try-catch?**
13. **Does finally execute after return?**
14. **What is try-with-resources?**
15. **Best practices for exception handling?**

---

## ðŸ“š Related Topics

- [Exception Basics](01.%20Exception%20Basics.md)
- [Exception Hierarchy](03.%20Exception%20Hierarchy.md)
- [try-with-resources](07.%20try-with-resources.md)
- [Custom Exceptions](06.%20Custom%20Exceptions.md)
- [Best Practices](08.%20Best%20Practices.md)
