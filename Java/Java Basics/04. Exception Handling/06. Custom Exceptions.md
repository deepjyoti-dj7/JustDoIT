# üé® Custom Exceptions

## üìñ Overview

**Custom exceptions** are user-defined exception classes created by extending existing exception classes. They provide meaningful, application-specific error handling.

**Why create custom exceptions?**
- More descriptive error messages
- Business logic-specific exceptions
- Better error categorization
- Easier debugging and maintenance

---

## üéØ Types of Custom Exceptions

```java
// Checked custom exception
class MyCheckedException extends Exception { }

// Unchecked custom exception
class MyUncheckedException extends RuntimeException { }

// Specific exception hierarchy
class ApplicationException extends Exception { }
class BusinessException extends ApplicationException { }
class ValidationException extends ApplicationException { }
```

---

## üíª Example 1: Basic Custom Exception

```java
// Custom checked exception
class InvalidAgeException extends Exception {
    public InvalidAgeException() {
        super("Age is invalid");
    }
    
    public InvalidAgeException(String message) {
        super(message);
    }
}

public class BasicCustomException {
    static void validateAge(int age) throws InvalidAgeException {
        if (age < 0 || age > 150) {
            throw new InvalidAgeException("Age must be between 0 and 150, got: " + age);
        }
        System.out.println("Valid age: " + age);
    }
    
    public static void main(String[] args) {
        System.out.println("=== Basic Custom Exception ===\n");
        
        // Test 1: Valid age
        try {
            validateAge(25);
        } catch (InvalidAgeException e) {
            System.out.println("Error: " + e.getMessage());
        }
        
        // Test 2: Invalid age
        try {
            validateAge(-5);
        } catch (InvalidAgeException e) {
            System.out.println("Error: " + e.getMessage());
        }
        
        // Test 3: Invalid age
        try {
            validateAge(200);
        } catch (InvalidAgeException e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
}
```

---

## üíª Example 2: Custom Exception with Additional Fields

```java
class InsufficientBalanceException extends Exception {
    private double balance;
    private double requestedAmount;
    private String accountNumber;
    
    public InsufficientBalanceException(String accountNumber, double balance, double requestedAmount) {
        super("Insufficient balance in account " + accountNumber + 
              ". Balance: " + balance + ", Requested: " + requestedAmount);
        this.accountNumber = accountNumber;
        this.balance = balance;
        this.requestedAmount = requestedAmount;
    }
    
    public double getBalance() {
        return balance;
    }
    
    public double getRequestedAmount() {
        return requestedAmount;
    }
    
    public double getDeficit() {
        return requestedAmount - balance;
    }
    
    public String getAccountNumber() {
        return accountNumber;
    }
}

class BankAccount {
    private String accountNumber;
    private double balance;
    
    public BankAccount(String accountNumber, double balance) {
        this.accountNumber = accountNumber;
        this.balance = balance;
    }
    
    public void withdraw(double amount) throws InsufficientBalanceException {
        if (amount > balance) {
            throw new InsufficientBalanceException(accountNumber, balance, amount);
        }
        balance -= amount;
        System.out.println("Withdrawn: " + amount + ", New balance: " + balance);
    }
    
    public double getBalance() {
        return balance;
    }
}

public class CustomExceptionWithFields {
    public static void main(String[] args) {
        System.out.println("=== Custom Exception with Additional Fields ===\n");
        
        BankAccount account = new BankAccount("ACC123", 1000);
        
        System.out.println("Initial balance: " + account.getBalance());
        
        try {
            account.withdraw(500);
            account.withdraw(800);  // Will fail
        } catch (InsufficientBalanceException e) {
            System.out.println("\nException caught:");
            System.out.println("Message: " + e.getMessage());
            System.out.println("Account: " + e.getAccountNumber());
            System.out.println("Balance: " + e.getBalance());
            System.out.println("Requested: " + e.getRequestedAmount());
            System.out.println("Deficit: " + e.getDeficit());
            System.out.println("\nAction: Please deposit at least " + e.getDeficit());
        }
    }
}
```

---

## üíª Example 3: Exception Hierarchy

```java
// Base application exception
class ApplicationException extends Exception {
    public ApplicationException(String message) {
        super(message);
    }
    
    public ApplicationException(String message, Throwable cause) {
        super(message, cause);
    }
}

// Business logic exception
class BusinessException extends ApplicationException {
    public BusinessException(String message) {
        super(message);
    }
}

// Validation exception
class ValidationException extends ApplicationException {
    public ValidationException(String message) {
        super(message);
    }
}

// Technical exception
class TechnicalException extends ApplicationException {
    public TechnicalException(String message, Throwable cause) {
        super(message, cause);
    }
}

public class ExceptionHierarchy {
    static void processOrder(int quantity, double price) throws ApplicationException {
        // Validation
        if (quantity <= 0) {
            throw new ValidationException("Quantity must be positive: " + quantity);
        }
        
        // Business rule
        if (price * quantity > 10000) {
            throw new BusinessException("Order exceeds maximum limit of 10000");
        }
        
        System.out.println("Order processed: " + quantity + " items at " + price);
    }
    
    public static void main(String[] args) {
        System.out.println("=== Exception Hierarchy ===\n");
        
        // Test 1: Validation error
        System.out.println("1. Validation error:");
        try {
            processOrder(-5, 100);
        } catch (ValidationException e) {
            System.out.println("Validation: " + e.getMessage());
        } catch (ApplicationException e) {
            System.out.println("Application: " + e.getMessage());
        }
        
        // Test 2: Business rule error
        System.out.println("\n2. Business rule error:");
        try {
            processOrder(200, 100);
        } catch (BusinessException e) {
            System.out.println("Business: " + e.getMessage());
        } catch (ApplicationException e) {
            System.out.println("Application: " + e.getMessage());
        }
        
        // Test 3: Success
        System.out.println("\n3. Success:");
        try {
            processOrder(50, 100);
        } catch (ApplicationException e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
}
```

---

## üíª Example 4: Checked vs Unchecked Custom Exceptions

```java
// Checked - User can recover
class EmailAlreadyExistsException extends Exception {
    public EmailAlreadyExistsException(String email) {
        super("Email already registered: " + email);
    }
}

// Unchecked - Programming error
class InvalidEmailFormatException extends RuntimeException {
    public InvalidEmailFormatException(String email) {
        super("Invalid email format: " + email);
    }
}

class UserService {
    private String[] existingEmails = {"user@example.com"};
    
    public void registerUser(String email) throws EmailAlreadyExistsException {
        // Unchecked for invalid format (should be validated before calling)
        if (!email.contains("@")) {
            throw new InvalidEmailFormatException(email);
        }
        
        // Checked for duplicate (user can try different email)
        for (String existing : existingEmails) {
            if (existing.equals(email)) {
                throw new EmailAlreadyExistsException(email);
            }
        }
        
        System.out.println("User registered: " + email);
    }
}

public class CheckedVsUncheckedCustom {
    public static void main(String[] args) {
        System.out.println("=== Checked vs Unchecked Custom Exceptions ===\n");
        
        UserService service = new UserService();
        
        // Test 1: Invalid format (unchecked)
        System.out.println("1. Invalid format (unchecked):");
        try {
            service.registerUser("invalidemail");
        } catch (InvalidEmailFormatException e) {
            System.out.println("Format error: " + e.getMessage());
        } catch (EmailAlreadyExistsException e) {
            System.out.println("Duplicate: " + e.getMessage());
        }
        
        // Test 2: Duplicate email (checked)
        System.out.println("\n2. Duplicate email (checked):");
        try {
            service.registerUser("user@example.com");
        } catch (EmailAlreadyExistsException e) {
            System.out.println("Error: " + e.getMessage());
            System.out.println("Action: Try different email or login");
        }
        
        // Test 3: Valid
        System.out.println("\n3. Valid registration:");
        try {
            service.registerUser("newuser@example.com");
        } catch (EmailAlreadyExistsException e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
}
```

---

## üíª Example 5: Exception with Constructors

```java
class PaymentException extends Exception {
    private String transactionId;
    private double amount;
    
    // Default constructor
    public PaymentException() {
        super("Payment failed");
    }
    
    // Constructor with message
    public PaymentException(String message) {
        super(message);
    }
    
    // Constructor with message and cause
    public PaymentException(String message, Throwable cause) {
        super(message, cause);
    }
    
    // Constructor with custom fields
    public PaymentException(String transactionId, double amount, String message) {
        super(message);
        this.transactionId = transactionId;
        this.amount = amount;
    }
    
    // Constructor with all
    public PaymentException(String transactionId, double amount, String message, Throwable cause) {
        super(message, cause);
        this.transactionId = transactionId;
        this.amount = amount;
    }
    
    public String getTransactionId() { return transactionId; }
    public double getAmount() { return amount; }
}

public class ExceptionConstructors {
    public static void main(String[] args) {
        System.out.println("=== Exception with Multiple Constructors ===\n");
        
        // Test 1: Default
        try {
            throw new PaymentException();
        } catch (PaymentException e) {
            System.out.println("1. Default: " + e.getMessage());
        }
        
        // Test 2: With message
        try {
            throw new PaymentException("Card declined");
        } catch (PaymentException e) {
            System.out.println("2. Message: " + e.getMessage());
        }
        
        // Test 3: With cause
        try {
            Exception cause = new Exception("Network timeout");
            throw new PaymentException("Payment failed", cause);
        } catch (PaymentException e) {
            System.out.println("3. With cause: " + e.getMessage());
            System.out.println("   Cause: " + e.getCause().getMessage());
        }
        
        // Test 4: With custom fields
        try {
            throw new PaymentException("TXN123", 500.00, "Insufficient funds");
        } catch (PaymentException e) {
            System.out.println("4. Custom fields: " + e.getMessage());
            System.out.println("   Transaction: " + e.getTransactionId());
            System.out.println("   Amount: " + e.getAmount());
        }
    }
}
```

---

## üíª Example 6: Exception Chaining

```java
class DatabaseException extends Exception {
    public DatabaseException(String message) {
        super(message);
    }
    
    public DatabaseException(String message, Throwable cause) {
        super(message, cause);
    }
}

class ServiceException extends Exception {
    public ServiceException(String message, Throwable cause) {
        super(message, cause);
    }
}

public class ExceptionChaining {
    static void databaseOperation() throws DatabaseException {
        try {
            // Simulate database error
            throw new java.sql.SQLException("Connection failed");
        } catch (java.sql.SQLException e) {
            // Wrap in custom exception
            throw new DatabaseException("Database operation failed", e);
        }
    }
    
    static void businessOperation() throws ServiceException {
        try {
            databaseOperation();
        } catch (DatabaseException e) {
            // Chain exceptions
            throw new ServiceException("Business operation failed", e);
        }
    }
    
    public static void main(String[] args) {
        System.out.println("=== Exception Chaining ===\n");
        
        try {
            businessOperation();
        } catch (ServiceException e) {
            System.out.println("Top-level exception: " + e.getMessage());
            
            Throwable cause = e.getCause();
            int level = 1;
            while (cause != null) {
                System.out.println("  Level " + level + ": " + cause.getClass().getSimpleName());
                System.out.println("  Message: " + cause.getMessage());
                cause = cause.getCause();
                level++;
            }
        }
    }
}
```

---

## üíª Example 7: Real-World Example - E-Commerce

```java
// Product not found
class ProductNotFoundException extends Exception {
    private String productId;
    
    public ProductNotFoundException(String productId) {
        super("Product not found: " + productId);
        this.productId = productId;
    }
    
    public String getProductId() { return productId; }
}

// Out of stock
class OutOfStockException extends Exception {
    private String productId;
    private int available;
    private int requested;
    
    public OutOfStockException(String productId, int available, int requested) {
        super("Product " + productId + " is out of stock. Available: " + available + ", Requested: " + requested);
        this.productId = productId;
        this.available = available;
        this.requested = requested;
    }
    
    public String getProductId() { return productId; }
    public int getAvailable() { return available; }
    public int getRequested() { return requested; }
}

// Invalid quantity
class InvalidQuantityException extends RuntimeException {
    public InvalidQuantityException(int quantity) {
        super("Invalid quantity: " + quantity + ". Must be greater than 0");
    }
}

class Product {
    private String id;
    private String name;
    private int stock;
    
    public Product(String id, String name, int stock) {
        this.id = id;
        this.name = name;
        this.stock = stock;
    }
    
    public String getId() { return id; }
    public String getName() { return name; }
    public int getStock() { return stock; }
    public void reduceStock(int quantity) { stock -= quantity; }
}

class OrderService {
    private Product[] products = {
        new Product("P1", "Laptop", 5),
        new Product("P2", "Mouse", 0),
        new Product("P3", "Keyboard", 10)
    };
    
    public void placeOrder(String productId, int quantity) 
            throws ProductNotFoundException, OutOfStockException {
        
        // Validate quantity (unchecked)
        if (quantity <= 0) {
            throw new InvalidQuantityException(quantity);
        }
        
        // Find product (checked)
        Product product = null;
        for (Product p : products) {
            if (p.getId().equals(productId)) {
                product = p;
                break;
            }
        }
        
        if (product == null) {
            throw new ProductNotFoundException(productId);
        }
        
        // Check stock (checked)
        if (product.getStock() < quantity) {
            throw new OutOfStockException(productId, product.getStock(), quantity);
        }
        
        // Process order
        product.reduceStock(quantity);
        System.out.println("Order placed: " + quantity + "x " + product.getName());
    }
}

public class ECommerceExample {
    public static void main(String[] args) {
        System.out.println("=== E-Commerce Custom Exceptions ===\n");
        
        OrderService service = new OrderService();
        
        // Test 1: Success
        System.out.println("1. Valid order:");
        try {
            service.placeOrder("P1", 2);
        } catch (ProductNotFoundException | OutOfStockException e) {
            System.out.println("Error: " + e.getMessage());
        }
        
        // Test 2: Invalid quantity (unchecked)
        System.out.println("\n2. Invalid quantity:");
        try {
            service.placeOrder("P1", -1);
        } catch (InvalidQuantityException e) {
            System.out.println("Validation error: " + e.getMessage());
        } catch (ProductNotFoundException | OutOfStockException e) {
            System.out.println("Error: " + e.getMessage());
        }
        
        // Test 3: Product not found
        System.out.println("\n3. Product not found:");
        try {
            service.placeOrder("P99", 1);
        } catch (ProductNotFoundException e) {
            System.out.println("Error: " + e.getMessage());
            System.out.println("Product ID: " + e.getProductId());
        } catch (OutOfStockException e) {
            System.out.println("Error: " + e.getMessage());
        }
        
        // Test 4: Out of stock
        System.out.println("\n4. Out of stock:");
        try {
            service.placeOrder("P2", 5);
        } catch (OutOfStockException e) {
            System.out.println("Error: " + e.getMessage());
            System.out.println("Available: " + e.getAvailable());
            System.out.println("Requested: " + e.getRequested());
            System.out.println("Action: Reduce quantity or wait for restock");
        } catch (ProductNotFoundException e) {
            System.out.println("Error: " + e.getMessage());
        }
    }
}
```

---

## üíª Example 8: Exception with Enums

```java
enum ErrorCode {
    INVALID_INPUT("E001", "Invalid input provided"),
    RESOURCE_NOT_FOUND("E002", "Resource not found"),
    UNAUTHORIZED("E003", "Unauthorized access"),
    SERVER_ERROR("E004", "Internal server error");
    
    private final String code;
    private final String description;
    
    ErrorCode(String code, String description) {
        this.code = code;
        this.description = description;
    }
    
    public String getCode() { return code; }
    public String getDescription() { return description; }
}

class ApplicationException extends Exception {
    private ErrorCode errorCode;
    private String details;
    
    public ApplicationException(ErrorCode errorCode, String details) {
        super(errorCode.getDescription() + ": " + details);
        this.errorCode = errorCode;
        this.details = details;
    }
    
    public ErrorCode getErrorCode() { return errorCode; }
    public String getDetails() { return details; }
    public String getFormattedError() {
        return "[" + errorCode.getCode() + "] " + getMessage();
    }
}

public class ExceptionWithEnum {
    public static void main(String[] args) {
        System.out.println("=== Exception with Enums ===\n");
        
        // Test different error codes
        ErrorCode[] errors = {
            ErrorCode.INVALID_INPUT,
            ErrorCode.RESOURCE_NOT_FOUND,
            ErrorCode.UNAUTHORIZED
        };
        
        String[] details = {
            "Email format is invalid",
            "User ID 123 not found",
            "Token expired"
        };
        
        for (int i = 0; i < errors.length; i++) {
            try {
                throw new ApplicationException(errors[i], details[i]);
            } catch (ApplicationException e) {
                System.out.println((i + 1) + ". " + e.getFormattedError());
                System.out.println("   Code: " + e.getErrorCode().getCode());
                System.out.println("   Details: " + e.getDetails());
                System.out.println();
            }
        }
    }
}
```

---

## üíª Example 9: Exception with Timestamp

```java
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

class LoggedException extends Exception {
    private LocalDateTime timestamp;
    private String userId;
    private String operation;
    
    public LoggedException(String message, String userId, String operation) {
        super(message);
        this.timestamp = LocalDateTime.now();
        this.userId = userId;
        this.operation = operation;
    }
    
    public String getFormattedTimestamp() {
        DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        return timestamp.format(formatter);
    }
    
    public String getLogEntry() {
        return String.format("[%s] User: %s, Operation: %s, Error: %s",
            getFormattedTimestamp(), userId, operation, getMessage());
    }
}

public class ExceptionWithTimestamp {
    public static void main(String[] args) {
        System.out.println("=== Exception with Timestamp ===\n");
        
        try {
            throw new LoggedException("Database connection failed", "user123", "getData");
        } catch (LoggedException e) {
            System.out.println("Log Entry:");
            System.out.println(e.getLogEntry());
        }
        
        try {
            Thread.sleep(1000);
            throw new LoggedException("Unauthorized access", "user456", "deleteRecord");
        } catch (LoggedException e) {
            System.out.println("\nLog Entry:");
            System.out.println(e.getLogEntry());
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
    }
}
```

---

## üíª Example 10: Exception Factory Pattern

```java
class ExceptionFactory {
    public static RuntimeException createValidationException(String field, Object value) {
        return new IllegalArgumentException(
            String.format("Validation failed for field '%s' with value '%s'", field, value));
    }
    
    public static Exception createNotFoundException(String resource, String id) {
        return new Exception(
            String.format("%s with ID '%s' not found", resource, id));
    }
    
    public static RuntimeException createBusinessException(String rule, String details) {
        return new IllegalStateException(
            String.format("Business rule '%s' violated: %s", rule, details));
    }
}

public class ExceptionFactory Pattern {
    static void validateUser(String name, int age) {
        if (name == null || name.isEmpty()) {
            throw ExceptionFactory.createValidationException("name", name);
        }
        if (age < 0) {
            throw ExceptionFactory.createValidationException("age", age);
        }
    }
    
    static void processOrder(double amount) {
        if (amount > 10000) {
            throw ExceptionFactory.createBusinessException(
                "MAX_ORDER_AMOUNT", 
                "Amount " + amount + " exceeds limit of 10000");
        }
    }
    
    public static void main(String[] args) {
        System.out.println("=== Exception Factory Pattern ===\n");
        
        // Test 1: Validation
        System.out.println("1. Validation exception:");
        try {
            validateUser("", 25);
        } catch (RuntimeException e) {
            System.out.println(e.getMessage());
        }
        
        // Test 2: Not found
        System.out.println("\n2. Not found exception:");
        try {
            throw ExceptionFactory.createNotFoundException("User", "123");
        } catch (Exception e) {
            System.out.println(e.getMessage());
        }
        
        // Test 3: Business rule
        System.out.println("\n3. Business exception:");
        try {
            processOrder(15000);
        } catch (RuntimeException e) {
            System.out.println(e.getMessage());
        }
    }
}
```

---

## üìä Custom Exception Design Guide

| Aspect | Recommendation |
|--------|----------------|
| **Extends** | Exception (checked) or RuntimeException (unchecked) |
| **Naming** | Descriptive + "Exception" suffix |
| **Constructors** | Default, message, message+cause, custom fields |
| **Fields** | Add relevant context (IDs, amounts, etc.) |
| **Methods** | Getters for fields, formatted output |
| **Documentation** | Javadoc with @throws |

---

## üí° Best Practices

1. ‚úÖ **Name clearly**
   ```java
   class InsufficientBalanceException extends Exception { }  // Good
   class BalanceException extends Exception { }              // Vague
   ```

2. ‚úÖ **Add context**
   ```java
   class OrderException extends Exception {
       private String orderId;
       private double amount;
       // ... getters
   }
   ```

3. ‚úÖ **Provide multiple constructors**
   ```java
   public MyException() { }
   public MyException(String message) { }
   public MyException(String message, Throwable cause) { }
   ```

4. ‚úÖ **Choose checked vs unchecked wisely**
   ```java
   // Checked - recoverable
   class FileNotFoundException extends Exception { }
   
   // Unchecked - programming error
   class InvalidConfigException extends RuntimeException { }
   ```

5. ‚úÖ **Don't over-engineer**
   ```java
   // Sometimes built-in exceptions are enough
   throw new IllegalArgumentException("Invalid input");
   ```

---

## ‚ö†Ô∏è Common Pitfalls

```java
public class CustomExceptionPitfalls {
    // 1. Too many custom exceptions
    // class Exception1, Exception2, Exception3... Exception50
    
    // 2. Empty custom exception
    class MyException extends Exception { }  // No added value
    
    // 3. Catching own exception too broadly
    try {
        throw new MyException();
    } catch (Exception e) {  // Too broad
        // Lost specificity
    }
    
    // 4. Not serializable
    // Add serialVersionUID if exception needs to be serialized
}
```

---

## üéØ Interview Questions

1. **What are custom exceptions?**
2. **Why create custom exceptions?**
3. **How to create custom exception?**
4. **Checked or unchecked custom exception?**
5. **What constructors should custom exception have?**
6. **Can we add fields to custom exception?**
7. **What is exception chaining?**
8. **When to use custom vs built-in exceptions?**
9. **How to create exception hierarchy?**
10. **What is exception factory pattern?**
11. **Should custom exceptions be serializable?**
12. **Can we override methods in custom exception?**
13. **What is suppressed exception?**
14. **Best practices for custom exceptions?**
15. **Common mistakes in custom exceptions?**

---

## üìö Related Topics

- [Exception Basics](01.%20Exception%20Basics.md)
- [Exception Hierarchy](03.%20Exception%20Hierarchy.md)
- [throw & throws](05.%20throw%20%26%20throws.md)
- [Best Practices](08.%20Best%20Practices.md)
