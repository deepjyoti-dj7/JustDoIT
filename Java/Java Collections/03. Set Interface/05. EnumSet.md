# üéØ EnumSet

## üìñ Overview

`EnumSet` is a **specialized Set implementation for enum types**. It's extremely **fast and memory-efficient**, internally using a **bit vector**.

```java
public abstract class EnumSet<E extends Enum<E>> extends AbstractSet<E>
    implements Cloneable, Serializable
```

---

## üîë Key Characteristics

1. **Only for Enums** - Works exclusively with enum types
2. **Extremely Fast** - All operations in O(1) time
3. **Memory Efficient** - Uses bit vector (64 bits for ‚â§64 enums)
4. **No Null** - Does not allow null elements
5. **Maintains Enum Order** - Elements in enum declaration order
6. **Not Synchronized** - Not thread-safe
7. **Type-Safe** - Compile-time type checking

---

## üíª Creating EnumSet

```java
enum Day {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
}

public class EnumSetDemo {
    public static void main(String[] args) {
        // 1. Empty set
        EnumSet<Day> empty = EnumSet.noneOf(Day.class);
        
        // 2. All elements
        EnumSet<Day> allDays = EnumSet.allOf(Day.class);
        System.out.println(allDays);  // [MONDAY, TUESDAY, ..., SUNDAY]
        
        // 3. Specific elements
        EnumSet<Day> weekend = EnumSet.of(Day.SATURDAY, Day.SUNDAY);
        System.out.println(weekend);  // [SATURDAY, SUNDAY]
        
        // 4. Range of elements
        EnumSet<Day> weekdays = EnumSet.range(Day.MONDAY, Day.FRIDAY);
        System.out.println(weekdays);  // [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY]
        
        // 5. Complement (opposite)
        EnumSet<Day> notWeekend = EnumSet.complementOf(weekend);
        System.out.println(notWeekend);  // [MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY]
        
        // 6. Copy from collection
        List<Day> list = Arrays.asList(Day.MONDAY, Day.WEDNESDAY, Day.FRIDAY);
        EnumSet<Day> fromList = EnumSet.copyOf(list);
        System.out.println(fromList);  // [MONDAY, WEDNESDAY, FRIDAY]
        
        // 7. Copy from another EnumSet
        EnumSet<Day> copy = EnumSet.copyOf(weekend);
    }
}
```

---

## üé® Basic Operations

```java
enum Status {
    NEW, IN_PROGRESS, TESTING, COMPLETED, CANCELLED
}

public class OperationsDemo {
    public static void main(String[] args) {
        EnumSet<Status> activeStatuses = EnumSet.of(Status.NEW, Status.IN_PROGRESS);
        
        // Add element
        activeStatuses.add(Status.TESTING);
        System.out.println(activeStatuses);  // [NEW, IN_PROGRESS, TESTING]
        
        // Remove element
        activeStatuses.remove(Status.TESTING);
        
        // Contains
        System.out.println(activeStatuses.contains(Status.NEW));  // true
        
        // Size
        System.out.println("Size: " + activeStatuses.size());  // 2
        
        // Check empty
        System.out.println(activeStatuses.isEmpty());  // false
        
        // Clear
        activeStatuses.clear();
        System.out.println(activeStatuses.isEmpty());  // true
        
        // Cannot add null
        // activeStatuses.add(null);  // NullPointerException
    }
}
```

---

## üèóÔ∏è Internal Structure

```java
// For enums with ‚â§ 64 elements - uses long (64 bits)
class RegularEnumSet<E extends Enum<E>> extends EnumSet<E> {
    private long elements = 0L;  // Bit vector
    
    public boolean add(E e) {
        long oldElements = elements;
        elements |= (1L << e.ordinal());  // Set bit
        return elements != oldElements;
    }
    
    public boolean contains(Object o) {
        return (elements & (1L << ((Enum)o).ordinal())) != 0;  // Check bit
    }
}

// For enums with > 64 elements - uses long[]
class JumboEnumSet<E extends Enum<E>> extends EnumSet<E> {
    private long[] elements;  // Array of bit vectors
}
```

**Bit Vector Example:**
```
Enum: MONDAY(0), TUESDAY(1), WEDNESDAY(2), THURSDAY(3), FRIDAY(4), SATURDAY(5), SUNDAY(6)

EnumSet.of(MONDAY, WEDNESDAY, FRIDAY)
Binary: 0010101 (bits 0, 2, 4 set)
Decimal: 21
```

---

## üìä Performance

| Operation | Time Complexity | Note |
|-----------|----------------|------|
| `add(E e)` | O(1) | Bit operation |
| `remove(Object o)` | O(1) | Bit operation |
| `contains(Object o)` | O(1) | Bit operation |
| `size()` | O(1) | Count bits |
| Bulk operations | O(1) | Bit operations |
| Iteration | O(n) | n = enum size |

**Memory:**
- ‚â§ 64 enums: 8 bytes (one `long`)
- \> 64 enums: 8 √ó ‚åàn/64‚åâ bytes

---

## üîß Set Operations

```java
enum Permission {
    READ, WRITE, EXECUTE, DELETE, ADMIN
}

public class SetOperationsDemo {
    public static void main(String[] args) {
        EnumSet<Permission> basic = EnumSet.of(Permission.READ, Permission.WRITE);
        EnumSet<Permission> advanced = EnumSet.of(Permission.WRITE, Permission.DELETE);
        
        // Union
        EnumSet<Permission> union = EnumSet.copyOf(basic);
        union.addAll(advanced);
        System.out.println("Union: " + union);  // [READ, WRITE, DELETE]
        
        // Intersection
        EnumSet<Permission> intersection = EnumSet.copyOf(basic);
        intersection.retainAll(advanced);
        System.out.println("Intersection: " + intersection);  // [WRITE]
        
        // Difference
        EnumSet<Permission> difference = EnumSet.copyOf(basic);
        difference.removeAll(advanced);
        System.out.println("Difference: " + difference);  // [READ]
        
        // Complement
        EnumSet<Permission> complement = EnumSet.complementOf(basic);
        System.out.println("Complement: " + complement);  // [EXECUTE, DELETE, ADMIN]
    }
}
```

---

## üîÑ Iteration

```java
enum Month {
    JAN, FEB, MAR, APR, MAY, JUN, JUL, AUG, SEP, OCT, NOV, DEC
}

EnumSet<Month> quarters = EnumSet.range(Month.JAN, Month.MAR);

// For-each loop - in enum declaration order
for (Month month : quarters) {
    System.out.println(month);  // JAN, FEB, MAR
}

// Iterator
Iterator<Month> iterator = quarters.iterator();
while (iterator.hasNext()) {
    System.out.println(iterator.next());
}

// Java 8 forEach
quarters.forEach(System.out::println);

// Stream
quarters.stream()
        .filter(m -> m.name().startsWith("M"))
        .forEach(System.out::println);  // MAR
```

---

## üéØ Real-World Examples

### Example 1: Days of Operation

```java
enum Day {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
}

class Restaurant {
    private EnumSet<Day> openDays;
    
    public Restaurant() {
        // Open Monday to Saturday
        openDays = EnumSet.range(Day.MONDAY, Day.SATURDAY);
    }
    
    public boolean isOpen(Day day) {
        return openDays.contains(day);
    }
    
    public void addDay(Day day) {
        openDays.add(day);
    }
    
    public void removeDay(Day day) {
        openDays.remove(day);
    }
}

// Usage
Restaurant restaurant = new Restaurant();
System.out.println("Open on Sunday? " + restaurant.isOpen(Day.SUNDAY));  // false
restaurant.addDay(Day.SUNDAY);
System.out.println("Open on Sunday? " + restaurant.isOpen(Day.SUNDAY));  // true
```

---

### Example 2: User Permissions

```java
enum Permission {
    READ, WRITE, EXECUTE, DELETE, ADMIN
}

class User {
    private String name;
    private EnumSet<Permission> permissions;
    
    public User(String name) {
        this.name = name;
        this.permissions = EnumSet.noneOf(Permission.class);
    }
    
    public void grantPermission(Permission permission) {
        permissions.add(permission);
    }
    
    public void grantPermissions(EnumSet<Permission> perms) {
        permissions.addAll(perms);
    }
    
    public void revokePermission(Permission permission) {
        permissions.remove(permission);
    }
    
    public boolean hasPermission(Permission permission) {
        return permissions.contains(permission);
    }
    
    public void makeAdmin() {
        permissions = EnumSet.allOf(Permission.class);
    }
}

// Usage
User user = new User("Alice");
user.grantPermission(Permission.READ);
user.grantPermission(Permission.WRITE);
System.out.println("Can write? " + user.hasPermission(Permission.WRITE));  // true
System.out.println("Can delete? " + user.hasPermission(Permission.DELETE)); // false

user.makeAdmin();
System.out.println("Can delete? " + user.hasPermission(Permission.DELETE)); // true
```

---

### Example 3: Pizza Toppings

```java
enum Topping {
    CHEESE, PEPPERONI, MUSHROOMS, ONIONS, PEPPERS, OLIVES, SAUSAGE
}

class Pizza {
    private EnumSet<Topping> toppings;
    
    public Pizza() {
        // Cheese pizza by default
        toppings = EnumSet.of(Topping.CHEESE);
    }
    
    public void addTopping(Topping topping) {
        toppings.add(topping);
    }
    
    public void removeTopping(Topping topping) {
        toppings.remove(topping);
    }
    
    public void makeVeggie() {
        toppings = EnumSet.of(Topping.CHEESE, Topping.MUSHROOMS, 
                             Topping.ONIONS, Topping.PEPPERS, Topping.OLIVES);
    }
    
    public void makeMeatLovers() {
        toppings = EnumSet.of(Topping.CHEESE, Topping.PEPPERONI, Topping.SAUSAGE);
    }
    
    @Override
    public String toString() {
        return "Pizza with: " + toppings;
    }
}

// Usage
Pizza pizza = new Pizza();
pizza.addTopping(Topping.PEPPERONI);
pizza.addTopping(Topping.MUSHROOMS);
System.out.println(pizza);  // Pizza with: [CHEESE, PEPPERONI, MUSHROOMS]
```

---

### Example 4: File Attributes

```java
enum FileAttribute {
    READ_ONLY, HIDDEN, SYSTEM, ARCHIVE, ENCRYPTED, COMPRESSED
}

class File {
    private String name;
    private EnumSet<FileAttribute> attributes;
    
    public File(String name) {
        this.name = name;
        this.attributes = EnumSet.noneOf(FileAttribute.class);
    }
    
    public void setAttribute(FileAttribute attr) {
        attributes.add(attr);
    }
    
    public void removeAttribute(FileAttribute attr) {
        attributes.remove(attr);
    }
    
    public boolean hasAttribute(FileAttribute attr) {
        return attributes.contains(attr);
    }
    
    public boolean isReadOnly() {
        return attributes.contains(FileAttribute.READ_ONLY);
    }
    
    public void makeSystemFile() {
        attributes.add(FileAttribute.SYSTEM);
        attributes.add(FileAttribute.HIDDEN);
        attributes.add(FileAttribute.READ_ONLY);
    }
}
```

---

## üÜö EnumSet vs HashSet<Enum>

| Feature | EnumSet | HashSet<Enum> |
|---------|---------|---------------|
| **Performance** | Faster (bit ops) | Slower (hashing) |
| **Memory** | Very efficient | More memory |
| **Type** | Only enums | Any type |
| **Null** | Not allowed | One null |
| **Order** | Enum order | No order |

```java
enum Color { RED, GREEN, BLUE }

// EnumSet - fast, efficient
EnumSet<Color> colors1 = EnumSet.of(Color.RED, Color.BLUE);

// HashSet - slower, more memory
Set<Color> colors2 = new HashSet<>(Arrays.asList(Color.RED, Color.BLUE));

// Performance difference
long start = System.nanoTime();
for (int i = 0; i < 1_000_000; i++) {
    colors1.contains(Color.GREEN);
}
long enumSetTime = System.nanoTime() - start;

start = System.nanoTime();
for (int i = 0; i < 1_000_000; i++) {
    colors2.contains(Color.GREEN);
}
long hashSetTime = System.nanoTime() - start;

System.out.println("EnumSet: " + enumSetTime + " ns");
System.out.println("HashSet: " + hashSetTime + " ns");
// EnumSet is significantly faster
```

---

## ‚ö†Ô∏è Common Pitfalls

```java
// 1. Cannot use with non-enum types
// EnumSet<String> set = EnumSet.noneOf(String.class);  // Compilation error

// 2. Null not allowed
EnumSet<Day> days = EnumSet.noneOf(Day.class);
// days.add(null);  // NullPointerException

// 3. Thread safety
EnumSet<Day> days = EnumSet.allOf(Day.class);
// Not thread-safe for concurrent modifications
// Use Collections.synchronizedSet() if needed

// 4. Range requires correct order
enum Priority { LOW, MEDIUM, HIGH }
// EnumSet.range(Priority.HIGH, Priority.LOW);  // IllegalArgumentException
EnumSet.range(Priority.LOW, Priority.HIGH);  // ‚úÖ Correct
```

---

## üí° Best Practices

1. **Always use EnumSet** instead of Set<Enum> for enum collections
2. **Use static imports** for cleaner code:
   ```java
   import static java.util.EnumSet.*;
   EnumSet<Day> days = of(MONDAY, FRIDAY);
   ```
3. **Use `allOf()`, `noneOf()`, `range()`** factory methods
4. **Use `complementOf()`** for opposite sets
5. **Synchronize** for concurrent access if needed
6. **Prefer EnumSet over bit fields** (more type-safe and readable)

---

## üéØ When to Use EnumSet

**Use EnumSet when:**
- ‚úÖ Working exclusively with enum types
- ‚úÖ Need maximum performance
- ‚úÖ Memory efficiency is important
- ‚úÖ Representing flags or options
- ‚úÖ Need set operations on enums

**Don't use EnumSet when:**
- ‚ùå Not working with enums ‚Üí Use other Set implementations
- ‚ùå Need to store null ‚Üí Use HashSet
- ‚ùå Enum is not fixed ‚Üí Use HashSet

---

## üìö Summary

- **EnumSet**: Specialized Set for enum types only
- **Extremely fast** - bit vector operations (O(1))
- **Memory efficient** - 64 enums use only 8 bytes
- **Maintains enum order** - declaration order preserved
- **No null** elements allowed
- **Type-safe** at compile time
- Always **prefer EnumSet over HashSet** for enums
- Use factory methods: `of()`, `allOf()`, `noneOf()`, `range()`, `complementOf()`
- **Not thread-safe** - synchronize if needed
