# üéØ EnumMap

## üìñ Overview

`EnumMap` is a **highly specialized and efficient** Map implementation designed specifically for **enum keys**. It uses an **array internally** for extremely fast operations.

```java
public class EnumMap<K extends Enum<K>, V> extends AbstractMap<K,V>
    implements Serializable, Cloneable
```

**Core Feature:** Enum-specific map with array-based O(1) operations.

---

## üîë Key Characteristics

1. **Enum Keys Only** - Keys must be enum type
2. **Array-Based** - Uses simple array internally
3. **Extremely Fast** - Faster than HashMap for enums
4. **Compact** - Very memory efficient
5. **Natural Order** - Iteration in enum declaration order
6. **Null Values** - Allows null values (not keys)
7. **Not Thread-Safe** - Synchronize externally if needed

---

## üíª Creating EnumMap

```java
import java.util.*;

enum Day {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
}

// 1. With enum class
Map<Day, String> map1 = new EnumMap<>(Day.class);

// 2. From another EnumMap
EnumMap<Day, String> original = new EnumMap<>(Day.class);
original.put(Day.MONDAY, "Work");
Map<Day, String> map2 = new EnumMap<>(original);

// 3. From any map with enum keys
Map<Day, String> hashMap = new HashMap<>();
hashMap.put(Day.FRIDAY, "Party");
Map<Day, String> map3 = new EnumMap<>(hashMap);
```

---

## üé® Basic Operations

```java
public class EnumMapDemo {
    enum Priority {
        LOW, MEDIUM, HIGH, CRITICAL
    }
    
    public static void main(String[] args) {
        EnumMap<Priority, String> tasks = new EnumMap<>(Priority.class);
        
        // PUT
        tasks.put(Priority.HIGH, "Fix security bug");
        tasks.put(Priority.LOW, "Update documentation");
        tasks.put(Priority.CRITICAL, "Server down!");
        tasks.put(Priority.MEDIUM, "Code review");
        
        // Iteration in enum declaration order
        System.out.println("Tasks by priority:");
        for (Map.Entry<Priority, String> entry : tasks.entrySet()) {
            System.out.println(entry.getKey() + ": " + entry.getValue());
        }
        // Output in order: LOW, MEDIUM, HIGH, CRITICAL
        
        // GET
        String critical = tasks.get(Priority.CRITICAL);
        System.out.println("Critical task: " + critical);
        
        // CONTAINS
        System.out.println("Has HIGH? " + tasks.containsKey(Priority.HIGH));
        
        // SIZE
        System.out.println("Task count: " + tasks.size());
        
        // REMOVE
        tasks.remove(Priority.LOW);
        
        // NULL value allowed
        tasks.put(Priority.MEDIUM, null);
        System.out.println("Medium task: " + tasks.get(Priority.MEDIUM));  // null
    }
}
```

---

## üèóÔ∏è Internal Structure

```java
public class EnumMap<K extends Enum<K>, V> {
    // The enum type
    private final Class<K> keyType;
    
    // Array to store values (indexed by enum ordinal)
    private transient Object[] vals;
    
    // Size
    private transient int size = 0;
    
    // Universe of enum constants
    private final K[] keyUniverse;
}
```

**How it works:**
```
enum Day { MON, TUE, WED, THU, FRI, SAT, SUN }
         ordinal: 0    1    2    3    4    5    6

EnumMap internal array:
Index:  0     1     2     3     4     5     6
Value: "W"   "W"   "W"   "W"   "W"   null  null

map.put(Day.MON, "W");  // vals[0] = "W"
map.get(Day.MON);       // return vals[0]

O(1) direct array access!
```

---

## üìä Performance

| Operation | Time Complexity | Note |
|-----------|----------------|------|
| `get(key)` | O(1) | Array access by ordinal |
| `put(key, value)` | O(1) | Array assignment |
| `remove(key)` | O(1) | Array nullify |
| `containsKey(key)` | O(1) | Check array slot |
| `size()` | O(1) | Cached count |
| Iteration | O(n) | n = enum constants |

**Space:** O(m) where m = number of enum constants (not entries!)

---

## üéØ Real-World Examples

### Example 1: HTTP Status Handlers

```java
enum HttpStatus {
    OK(200), CREATED(201), BAD_REQUEST(400), 
    UNAUTHORIZED(401), NOT_FOUND(404), SERVER_ERROR(500);
    
    final int code;
    HttpStatus(int code) { this.code = code; }
}

class HttpHandler {
    private EnumMap<HttpStatus, Runnable> handlers;
    
    public HttpHandler() {
        handlers = new EnumMap<>(HttpStatus.class);
        
        // Register handlers
        handlers.put(HttpStatus.OK, () -> 
            System.out.println("Success!"));
        handlers.put(HttpStatus.NOT_FOUND, () -> 
            System.out.println("Page not found"));
        handlers.put(HttpStatus.SERVER_ERROR, () -> 
            System.out.println("Internal server error"));
    }
    
    public void handle(HttpStatus status) {
        Runnable handler = handlers.get(status);
        if (handler != null) {
            handler.run();
        } else {
            System.out.println("No handler for: " + status);
        }
    }
}

// Usage
HttpHandler handler = new HttpHandler();
handler.handle(HttpStatus.OK);           // Success!
handler.handle(HttpStatus.NOT_FOUND);    // Page not found
handler.handle(HttpStatus.UNAUTHORIZED); // No handler for: UNAUTHORIZED
```

---

### Example 2: Daily Schedule

```java
enum Day {
    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY
}

class Schedule {
    private EnumMap<Day, List<String>> schedule;
    
    public Schedule() {
        schedule = new EnumMap<>(Day.class);
        for (Day day : Day.values()) {
            schedule.put(day, new ArrayList<>());
        }
    }
    
    public void addActivity(Day day, String activity) {
        schedule.get(day).add(activity);
    }
    
    public List<String> getActivities(Day day) {
        return schedule.get(day);
    }
    
    public void printSchedule() {
        for (Day day : Day.values()) {
            List<String> activities = schedule.get(day);
            System.out.println(day + ": " + activities);
        }
    }
}

// Usage
Schedule schedule = new Schedule();
schedule.addActivity(Day.MONDAY, "Team meeting");
schedule.addActivity(Day.MONDAY, "Code review");
schedule.addActivity(Day.FRIDAY, "Deploy to prod");
schedule.printSchedule();
```

---

### Example 3: Game State Machine

```java
enum GameState {
    MENU, PLAYING, PAUSED, GAME_OVER
}

class Game {
    private GameState currentState;
    private EnumMap<GameState, Runnable> stateHandlers;
    
    public Game() {
        currentState = GameState.MENU;
        stateHandlers = new EnumMap<>(GameState.class);
        
        stateHandlers.put(GameState.MENU, this::handleMenu);
        stateHandlers.put(GameState.PLAYING, this::handlePlaying);
        stateHandlers.put(GameState.PAUSED, this::handlePaused);
        stateHandlers.put(GameState.GAME_OVER, this::handleGameOver);
    }
    
    public void update() {
        Runnable handler = stateHandlers.get(currentState);
        if (handler != null) {
            handler.run();
        }
    }
    
    public void setState(GameState state) {
        System.out.println("Transitioning to: " + state);
        currentState = state;
    }
    
    private void handleMenu() {
        System.out.println("In menu...");
    }
    
    private void handlePlaying() {
        System.out.println("Game running...");
    }
    
    private void handlePaused() {
        System.out.println("Game paused");
    }
    
    private void handleGameOver() {
        System.out.println("Game over!");
    }
}

// Usage
Game game = new Game();
game.update();  // In menu...
game.setState(GameState.PLAYING);
game.update();  // Game running...
```

---

### Example 4: Permission Management

```java
enum Permission {
    READ, WRITE, EXECUTE, DELETE, ADMIN
}

class User {
    private String name;
    private EnumMap<Permission, Boolean> permissions;
    
    public User(String name) {
        this.name = name;
        permissions = new EnumMap<>(Permission.class);
        
        // Default: no permissions
        for (Permission perm : Permission.values()) {
            permissions.put(perm, false);
        }
    }
    
    public void grant(Permission permission) {
        permissions.put(permission, true);
    }
    
    public void revoke(Permission permission) {
        permissions.put(permission, false);
    }
    
    public boolean has(Permission permission) {
        return permissions.getOrDefault(permission, false);
    }
    
    public void printPermissions() {
        System.out.println(name + "'s permissions:");
        for (Permission perm : Permission.values()) {
            if (permissions.get(perm)) {
                System.out.println("  ‚úì " + perm);
            }
        }
    }
}

// Usage
User user = new User("Alice");
user.grant(Permission.READ);
user.grant(Permission.WRITE);
user.printPermissions();
// Alice's permissions:
//   ‚úì READ
//   ‚úì WRITE

System.out.println("Can delete? " + user.has(Permission.DELETE));  // false
```

---

### Example 5: Season Temperatures

```java
enum Season {
    SPRING, SUMMER, FALL, WINTER
}

class WeatherData {
    private EnumMap<Season, Double> avgTemperatures;
    
    public WeatherData() {
        avgTemperatures = new EnumMap<>(Season.class);
    }
    
    public void setAvgTemperature(Season season, double temp) {
        avgTemperatures.put(season, temp);
    }
    
    public double getAvgTemperature(Season season) {
        return avgTemperatures.getOrDefault(season, 0.0);
    }
    
    public Season getWarmestSeason() {
        Season warmest = null;
        double maxTemp = Double.MIN_VALUE;
        
        for (Map.Entry<Season, Double> entry : avgTemperatures.entrySet()) {
            if (entry.getValue() > maxTemp) {
                maxTemp = entry.getValue();
                warmest = entry.getKey();
            }
        }
        
        return warmest;
    }
}

// Usage
WeatherData data = new WeatherData();
data.setAvgTemperature(Season.SPRING, 15.5);
data.setAvgTemperature(Season.SUMMER, 28.3);
data.setAvgTemperature(Season.FALL, 12.1);
data.setAvgTemperature(Season.WINTER, -2.7);

System.out.println("Warmest: " + data.getWarmestSeason());  // SUMMER
```

---

## üÜö EnumMap vs HashMap

| Feature | EnumMap | HashMap |
|---------|---------|---------|
| **Key type** | Enum only | Any |
| **Structure** | Array | Hash table |
| **Performance** | Faster (O(1) array) | Fast (O(1) hash) |
| **Memory** | Very compact | More overhead |
| **Order** | Enum declaration | None |
| **Null key** | No | 1 allowed |
| **Type safety** | Strong | Less |

**Performance Comparison:**
```java
enum Size { SMALL, MEDIUM, LARGE }

// EnumMap - Fastest
EnumMap<Size, Integer> enumMap = new EnumMap<>(Size.class);
enumMap.put(Size.SMALL, 1);  // vals[0] = 1 (direct array access)

// HashMap - Slower
HashMap<Size, Integer> hashMap = new HashMap<>();
hashMap.put(Size.SMALL, 1);  // hash calculation + bucket lookup
```

---

## ‚ö†Ô∏è Common Pitfalls

```java
// 1. Keys must be enum
// EnumMap<String, Integer> map = new EnumMap<>(String.class);  // ‚ùå Compile error

// 2. Must specify enum class
// EnumMap<Day, String> map = new EnumMap<>();  // ‚ùå Compile error
EnumMap<Day, String> map = new EnumMap<>(Day.class);  // ‚úÖ Correct

// 3. Null keys not allowed
enum Status { ACTIVE, INACTIVE }
EnumMap<Status, String> map = new EnumMap<>(Status.class);
// map.put(null, "value");  // NullPointerException

// 4. Null values ARE allowed
map.put(Status.ACTIVE, null);  // ‚úÖ OK

// 5. All enum constants in memory (even if not used)
// Space = O(enum constants), not O(entries)
```

---

## üí° Best Practices

1. **Always use for enum keys** - much faster than HashMap
2. **Initialize with enum class** - required by constructor
3. **Memory efficient** - uses array, not hash table
4. **Natural ordering** - iteration follows enum declaration
5. **Type safe** - compile-time enum checking
6. **Perfect for** state machines, flags, configurations
7. **Consider EnumSet** - for enum value sets (not key-value)

---

## üéØ When to Use EnumMap

**Use EnumMap when:**
- ‚úÖ Keys are enum type
- ‚úÖ Need fast O(1) operations
- ‚úÖ Memory efficiency important
- ‚úÖ Want natural enum order
- ‚úÖ State machines
- ‚úÖ Configuration maps
- ‚úÖ Permission/flag mappings

**Don't use EnumMap when:**
- ‚ùå Keys are not enum ‚Üí Use `HashMap`
- ‚ùå Need null keys ‚Üí Use `HashMap`
- ‚ùå Keys are dynamic ‚Üí Use `HashMap`

---

## üéì Interview Questions

**Q: What is EnumMap?**
A: Specialized Map for enum keys using array-based implementation.

**Q: Why use EnumMap over HashMap?**
A: Faster (O(1) array access), more compact, natural enum order.

**Q: How is EnumMap implemented?**
A: Array indexed by enum ordinal (enum.ordinal() ‚Üí array index).

**Q: Can EnumMap have null keys?**
A: No, keys must be valid enum constants.

**Q: Can EnumMap have null values?**
A: Yes, null values allowed.

**Q: What is iteration order?**
A: Enum declaration order (natural order).

**Q: Space complexity?**
A: O(m) where m = number of enum constants (not entries).

**Q: When to use EnumMap?**
A: Always use when keys are enums (faster and more compact than HashMap).

---

## üìö Summary

- **EnumMap**: Specialized Map for enum keys
- **Array-based** - O(1) operations via enum ordinal
- **Extremely fast** - faster than HashMap for enums
- **Memory efficient** - compact array storage
- **Natural order** - iteration in enum declaration order
- **Null values** allowed, null keys not allowed
- Perfect for **state machines, configs, permissions, handlers**
- **Always prefer** over HashMap when keys are enums
