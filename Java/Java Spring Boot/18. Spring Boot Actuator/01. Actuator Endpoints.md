# Actuator Endpoints - Complete Guide

---

## 1. Introduction to Spring Boot Actuator

Spring Boot Actuator provides production-ready features to help monitor and manage applications.

### What is Actuator?

Actuator exposes operational endpoints for:
- Health monitoring
- Metrics collection
- Application information
- Environment details
- Configuration properties
- Thread dumps
- Heap dumps

### Why Actuator?

- **Production monitoring** - Track application health
- **Metrics** - Performance and usage data
- **Diagnostics** - Debug production issues
- **Management** - Runtime configuration changes
- **Auditing** - Track application events

---

## 2. Setup and Configuration

### 2.1. Dependencies

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

### 2.2. Basic Configuration

```yaml
management:
  endpoints:
    web:
      exposure:
        include: '*'  # Expose all endpoints (not recommended for production)
      base-path: /actuator  # Default base path
  
  endpoint:
    health:
      show-details: always  # Show health details
    
  server:
    port: 8081  # Separate port for management endpoints (optional)
```

### 2.3. Production Configuration

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
        exclude: shutdown  # Exclude dangerous endpoints
      base-path: /management
  
  endpoint:
    health:
      show-details: when-authorized  # Show details only for authorized users
    shutdown:
      enabled: false  # Disable shutdown endpoint
```

---

## 3. Built-in Endpoints

### 3.1. Endpoint Overview

| Endpoint | Description | HTTP Methods | Sensitive |
|----------|-------------|--------------|-----------|
| `/actuator/health` | Application health | GET | No |
| `/actuator/info` | Application information | GET | No |
| `/actuator/metrics` | Application metrics | GET | Yes |
| `/actuator/env` | Environment properties | GET | Yes |
| `/actuator/loggers` | Logger configuration | GET, POST | Yes |
| `/actuator/beans` | Application beans | GET | Yes |
| `/actuator/mappings` | Request mappings | GET | Yes |
| `/actuator/configprops` | Configuration properties | GET | Yes |
| `/actuator/threaddump` | Thread dump | GET | Yes |
| `/actuator/heapdump` | Heap dump | GET | Yes |
| `/actuator/shutdown` | Graceful shutdown | POST | Yes |
| `/actuator/prometheus` | Prometheus metrics | GET | Yes |

### 3.2. Enabling Specific Endpoints

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  
  endpoint:
    health:
      enabled: true
    info:
      enabled: true
    metrics:
      enabled: true
    shutdown:
      enabled: false
```

---

## 4. Health Endpoint

### 4.1. Basic Health Check

**URL:** `GET /actuator/health`

**Response:**
```json
{
  "status": "UP"
}
```

### 4.2. Detailed Health Information

```yaml
management:
  endpoint:
    health:
      show-details: always
```

**Response:**
```json
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "PostgreSQL",
        "validationQuery": "isValid()"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 499963174912,
        "free": 336764821504,
        "threshold": 10485760,
        "exists": true
      }
    },
    "ping": {
      "status": "UP"
    },
    "redis": {
      "status": "UP",
      "details": {
        "version": "7.0.5"
      }
    }
  }
}
```

### 4.3. Health Status Values

- **UP** - Component is functioning normally
- **DOWN** - Component has failed
- **OUT_OF_SERVICE** - Component is temporarily out of service
- **UNKNOWN** - Component status is unknown

---

## 5. Info Endpoint

### 5.1. Basic Info

**URL:** `GET /actuator/info`

**Configuration:**
```yaml
info:
  app:
    name: Product Service
    description: E-commerce Product Management Service
    version: 1.0.0
  company:
    name: Example Corp
  contact:
    email: support@example.com
```

**Response:**
```json
{
  "app": {
    "name": "Product Service",
    "description": "E-commerce Product Management Service",
    "version": "1.0.0"
  },
  "company": {
    "name": "Example Corp"
  },
  "contact": {
    "email": "support@example.com"
  }
}
```

### 5.2. Build Information

Add to `pom.xml`:
```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-maven-plugin</artifactId>
      <executions>
        <execution>
          <goals>
            <goal>build-info</goal>
          </goals>
        </execution>
      </executions>
    </plugin>
  </plugins>
</build>
```

**Response includes:**
```json
{
  "build": {
    "artifact": "product-service",
    "name": "product-service",
    "version": "1.0.0",
    "group": "com.example",
    "time": "2024-01-15T10:30:00.000Z"
  }
}
```

### 5.3. Git Information

Add to `pom.xml`:
```xml
<plugin>
  <groupId>pl.project13.maven</groupId>
  <artifactId>git-commit-id-plugin</artifactId>
  <executions>
    <execution>
      <goals>
        <goal>revision</goal>
      </goals>
    </execution>
  </executions>
</plugin>
```

**Response includes:**
```json
{
  "git": {
    "branch": "main",
    "commit": {
      "id": "a1b2c3d",
      "time": "2024-01-15T10:00:00Z"
    }
  }
}
```

---

## 6. Metrics Endpoint

### 6.1. Available Metrics

**URL:** `GET /actuator/metrics`

**Response:**
```json
{
  "names": [
    "jvm.memory.used",
    "jvm.memory.max",
    "jvm.gc.memory.allocated",
    "http.server.requests",
    "system.cpu.usage",
    "process.uptime",
    "logback.events"
  ]
}
```

### 6.2. Specific Metric

**URL:** `GET /actuator/metrics/jvm.memory.used`

**Response:**
```json
{
  "name": "jvm.memory.used",
  "description": "The amount of used memory",
  "baseUnit": "bytes",
  "measurements": [
    {
      "statistic": "VALUE",
      "value": 157286400
    }
  ],
  "availableTags": [
    {
      "tag": "area",
      "values": ["heap", "nonheap"]
    },
    {
      "tag": "id",
      "values": ["PS Eden Space", "PS Old Gen", "PS Survivor Space"]
    }
  ]
}
```

### 6.3. Metric with Tags

**URL:** `GET /actuator/metrics/http.server.requests?tag=status:200&tag=method:GET`

**Response:**
```json
{
  "name": "http.server.requests",
  "measurements": [
    {
      "statistic": "COUNT",
      "value": 1523
    },
    {
      "statistic": "TOTAL_TIME",
      "value": 45.678
    },
    {
      "statistic": "MAX",
      "value": 0.234
    }
  ]
}
```

---

## 7. Environment Endpoint

### 7.1. All Environment Properties

**URL:** `GET /actuator/env`

**Response:**
```json
{
  "activeProfiles": ["production"],
  "propertySources": [
    {
      "name": "systemProperties",
      "properties": {
        "java.version": {
          "value": "17.0.5"
        }
      }
    },
    {
      "name": "applicationConfig: [classpath:/application.yml]",
      "properties": {
        "spring.application.name": {
          "value": "product-service"
        },
        "server.port": {
          "value": 8080
        }
      }
    }
  ]
}
```

### 7.2. Specific Property

**URL:** `GET /actuator/env/spring.application.name`

**Response:**
```json
{
  "property": {
    "source": "applicationConfig: [classpath:/application.yml]",
    "value": "product-service"
  },
  "activeProfiles": ["production"],
  "propertySources": [
    {
      "name": "applicationConfig: [classpath:/application.yml]",
      "property": {
        "value": "product-service",
        "origin": "class path resource [application.yml]:2:11"
      }
    }
  ]
}
```

---

## 8. Loggers Endpoint

### 8.1. View All Loggers

**URL:** `GET /actuator/loggers`

**Response:**
```json
{
  "levels": ["OFF", "ERROR", "WARN", "INFO", "DEBUG", "TRACE"],
  "loggers": {
    "ROOT": {
      "configuredLevel": "INFO",
      "effectiveLevel": "INFO"
    },
    "com.example": {
      "configuredLevel": "DEBUG",
      "effectiveLevel": "DEBUG"
    },
    "org.springframework.web": {
      "configuredLevel": null,
      "effectiveLevel": "INFO"
    }
  }
}
```

### 8.2. View Specific Logger

**URL:** `GET /actuator/loggers/com.example.service.OrderService`

**Response:**
```json
{
  "configuredLevel": "DEBUG",
  "effectiveLevel": "DEBUG"
}
```

### 8.3. Change Log Level at Runtime

**URL:** `POST /actuator/loggers/com.example.service.OrderService`

**Request Body:**
```json
{
  "configuredLevel": "TRACE"
}
```

**Example with curl:**
```bash
curl -X POST \
  http://localhost:8080/actuator/loggers/com.example.service.OrderService \
  -H 'Content-Type: application/json' \
  -d '{"configuredLevel":"TRACE"}'
```

---

## 9. Beans Endpoint

### 9.1. All Application Beans

**URL:** `GET /actuator/beans`

**Response:**
```json
{
  "contexts": {
    "application": {
      "beans": {
        "orderService": {
          "aliases": [],
          "scope": "singleton",
          "type": "com.example.service.OrderService",
          "resource": "file [OrderService.class]",
          "dependencies": ["orderRepository", "productService"]
        },
        "orderRepository": {
          "aliases": [],
          "scope": "singleton",
          "type": "com.example.repository.OrderRepository",
          "resource": "file [OrderRepository.class]",
          "dependencies": []
        }
      }
    }
  }
}
```

---

## 10. Mappings Endpoint

### 10.1. Request Mappings

**URL:** `GET /actuator/mappings`

**Response:**
```json
{
  "contexts": {
    "application": {
      "mappings": {
        "dispatcherServlets": {
          "dispatcherServlet": [
            {
              "handler": "com.example.controller.ProductController#getProduct(Long)",
              "predicate": "{GET /api/products/{id}}",
              "details": {
                "handlerMethod": {
                  "className": "com.example.controller.ProductController",
                  "name": "getProduct",
                  "descriptor": "(Ljava/lang/Long;)Lcom/example/dto/Product;"
                },
                "requestMappingConditions": {
                  "consumes": [],
                  "headers": [],
                  "methods": ["GET"],
                  "params": [],
                  "patterns": ["/api/products/{id}"],
                  "produces": []
                }
              }
            }
          ]
        }
      }
    }
  }
}
```

---

## 11. ConfigProps Endpoint

### 11.1. Configuration Properties

**URL:** `GET /actuator/configprops`

**Response:**
```json
{
  "contexts": {
    "application": {
      "beans": {
        "spring.datasource-org.springframework.boot.autoconfigure.jdbc.DataSourceProperties": {
          "prefix": "spring.datasource",
          "properties": {
            "url": "jdbc:postgresql://localhost:5432/mydb",
            "username": "user",
            "driverClassName": "org.postgresql.Driver"
          }
        },
        "server-org.springframework.boot.autoconfigure.web.ServerProperties": {
          "prefix": "server",
          "properties": {
            "port": 8080,
            "compression": {
              "enabled": true
            }
          }
        }
      }
    }
  }
}
```

---

## 12. Thread Dump Endpoint

### 12.1. Thread Dump

**URL:** `GET /actuator/threaddump`

**Response:**
```json
{
  "threads": [
    {
      "threadName": "http-nio-8080-exec-1",
      "threadId": 45,
      "blockedTime": -1,
      "blockedCount": 0,
      "waitedTime": -1,
      "waitedCount": 2,
      "lockName": null,
      "lockOwnerId": -1,
      "lockOwnerName": null,
      "inNative": false,
      "suspended": false,
      "threadState": "RUNNABLE",
      "stackTrace": [
        {
          "className": "java.net.SocketInputStream",
          "methodName": "socketRead0",
          "fileName": "SocketInputStream.java",
          "lineNumber": -2,
          "nativeMethod": true
        }
      ]
    }
  ]
}
```

---

## 13. Heap Dump Endpoint

### 13.1. Generate Heap Dump

**URL:** `GET /actuator/heapdump`

**Response:** Binary file (`.hprof`)

Downloads a GZip compressed heap dump file.

**Usage with curl:**
```bash
curl http://localhost:8080/actuator/heapdump -O heapdump.hprof
```

**Analyze with:**
- Eclipse Memory Analyzer (MAT)
- VisualVM
- JProfiler

---

## 14. Shutdown Endpoint

### 14.1. Graceful Shutdown

**Enable:**
```yaml
management:
  endpoint:
    shutdown:
      enabled: true
```

**URL:** `POST /actuator/shutdown`

**Response:**
```json
{
  "message": "Shutting down, bye..."
}
```

**Security Warning:** Always secure this endpoint in production!

---

## 15. Custom Endpoints

### 15.1. Creating Custom Endpoint

```java
import org.springframework.boot.actuate.endpoint.annotation.Endpoint;
import org.springframework.boot.actuate.endpoint.annotation.ReadOperation;
import org.springframework.stereotype.Component;

@Component
@Endpoint(id = "custom")
public class CustomEndpoint {
    
    @ReadOperation
    public CustomData getCustomData() {
        return new CustomData("Custom endpoint", System.currentTimeMillis());
    }
    
    public static class CustomData {
        private final String message;
        private final long timestamp;
        
        public CustomData(String message, long timestamp) {
            this.message = message;
            this.timestamp = timestamp;
        }
        
        // Getters
        public String getMessage() { return message; }
        public long getTimestamp() { return timestamp; }
    }
}
```

**Access:** `GET /actuator/custom`

---

## 16. Endpoint Security

### 16.1. Spring Security Integration

```java
import org.springframework.boot.actuate.autoconfigure.security.servlet.EndpointRequest;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class ActuatorSecurityConfig {
    
    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(authorize -> authorize
                .requestMatchers(EndpointRequest.to("health", "info")).permitAll()
                .requestMatchers(EndpointRequest.toAnyEndpoint()).hasRole("ADMIN")
                .anyRequest().authenticated()
            )
            .httpBasic();
        
        return http.build();
    }
}
```

### 16.2. Separate Management Port

```yaml
management:
  server:
    port: 8081  # Different from application port
    ssl:
      enabled: true
      key-store: classpath:keystore.p12
      key-store-password: changeit
```

---

## 17. CORS Configuration

```yaml
management:
  endpoints:
    web:
      cors:
        allowed-origins: "https://example.com"
        allowed-methods: GET,POST
        allowed-headers: "*"
        max-age: 3600
```

---

## 18. Best Practices

### 18.1. Production Recommendations

```yaml
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus  # Limited set
        exclude: shutdown,threaddump,heapdump
      base-path: /management  # Non-standard path
  
  endpoint:
    health:
      show-details: when-authorized  # Hide details from public
    shutdown:
      enabled: false  # Disable dangerous endpoints
  
  server:
    port: 8081  # Separate management port
```

### 18.2. Security Checklist

- ✅ Enable authentication for sensitive endpoints
- ✅ Use HTTPS for management endpoints
- ✅ Restrict network access to management port
- ✅ Hide sensitive information in responses
- ✅ Disable shutdown endpoint
- ✅ Use separate management port
- ✅ Enable audit logging for management operations

---

## 19. Interview Questions

**Q1: What is Spring Boot Actuator?**
**A:** Production-ready features for monitoring and managing Spring Boot applications.

**Q2: Name 5 important actuator endpoints.**
**A:** health, metrics, info, loggers, env.

**Q3: How to expose all actuator endpoints?**
**A:** `management.endpoints.web.exposure.include=*`

**Q4: What is /actuator/health used for?**
**A:** Checking application health status (UP, DOWN, OUT_OF_SERVICE).

**Q5: How to change log level at runtime?**
**A:** POST to `/actuator/loggers/{logger-name}` with new level.

**Q6: What is /actuator/metrics endpoint?**
**A:** Provides application metrics (JVM, HTTP, custom metrics).

**Q7: How to secure actuator endpoints?**
**A:** Use Spring Security with EndpointRequest matcher.

**Q8: What is /actuator/heapdump?**
**A:** Generates heap dump file for memory analysis.

**Q9: How to add custom info to /actuator/info?**
**A:** Configure `info.*` properties in application.yml.

**Q10: What is show-details in health endpoint?**
**A:** Controls when to show detailed health information (always, when-authorized, never).

**Q11: How to disable an endpoint?**
**A:** Set `management.endpoint.{name}.enabled=false`.

**Q12: What is /actuator/env?**
**A:** Shows environment properties and configuration sources.

**Q13: How to use separate port for actuator?**
**A:** Set `management.server.port` to different port.

**Q14: What is /actuator/beans?**
**A:** Lists all Spring beans in application context.

**Q15: What is /actuator/mappings?**
**A:** Shows all request mappings (controllers and their endpoints).

**Q16: Should shutdown endpoint be enabled in production?**
**A:** No, it's dangerous and should be disabled or heavily secured.

**Q17: What is base-path for actuator?**
**A:** URL prefix for all actuator endpoints (default: /actuator).

**Q18: How to get specific metric value?**
**A:** GET `/actuator/metrics/{metric-name}?tag=key:value`.

**Q19: What is /actuator/threaddump?**
**A:** Provides thread dump showing all application threads.

**Q20: How to enable build info in /actuator/info?**
**A:** Add build-info goal to spring-boot-maven-plugin.

---

## 20. Summary

Spring Boot Actuator provides production-ready monitoring endpoints. Key endpoints: health (application status), metrics (performance data), info (application info), loggers (runtime log level changes), env (configuration). Enable with spring-boot-starter-actuator dependency. Configure exposure with `management.endpoints.web.exposure.include`. Secure sensitive endpoints with Spring Security. Use separate management port for isolation. Show health details conditionally. Disable dangerous endpoints (shutdown, heapdump) in production. Essential for monitoring, debugging, and managing Spring Boot applications.

---

**Next:** Health Checks →
