# üåê @WebMvcTest - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [What is @WebMvcTest](#what-is-webmvctest)
- [Basic Usage](#basic-usage)
- [Testing Controllers](#testing-controllers)
- [Mocking Dependencies](#mocking-dependencies)
- [Testing Request/Response](#testing-requestresponse)
- [Advanced Scenarios](#advanced-scenarios)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**@WebMvcTest** is a Spring Boot test annotation that loads only the web layer components for testing controllers without starting the full application context.

### Why @WebMvcTest?

```
Benefits:
‚úÖ Faster than @SpringBootTest
‚úÖ Tests only web layer
‚úÖ Auto-configures MockMvc
‚úÖ Loads only controller beans
‚úÖ Perfect for controller unit tests
‚úÖ No database/service layers loaded
```

### @WebMvcTest vs @SpringBootTest

| Feature | @WebMvcTest | @SpringBootTest |
|---------|-------------|-----------------|
| **Speed** | Fast (< 1 sec) | Slower (3-5 sec) |
| **Context** | Web layer only | Full application |
| **Components** | Controllers, filters, advice | All beans |
| **Database** | Not loaded | Loaded |
| **Services** | Mocked | Real beans |
| **Use Case** | Controller unit tests | Integration tests |

---

## üìö What is @WebMvcTest

### Auto-Configuration

```java
@WebMvcTest
class MyControllerTest {
    // Automatically configures:
    // ‚úÖ MockMvc
    // ‚úÖ @Controller, @RestController
    // ‚úÖ @ControllerAdvice, @RestControllerAdvice
    // ‚úÖ @JsonComponent
    // ‚úÖ Converters, Formatters
    // ‚úÖ WebMvcConfigurer
    // ‚úÖ HandlerMethodArgumentResolver
    
    // NOT configured:
    // ‚ùå @Service, @Repository beans
    // ‚ùå @Component beans
    // ‚ùå Database connections
    // ‚ùå JPA repositories
}
```

### Loaded Components

```
Web Layer Components:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  @Controller                    ‚îÇ
‚îÇ  @RestController                ‚îÇ
‚îÇ  @ControllerAdvice              ‚îÇ
‚îÇ  @RestControllerAdvice          ‚îÇ
‚îÇ  @JsonComponent                 ‚îÇ
‚îÇ  WebMvcConfigurer               ‚îÇ
‚îÇ  Filters                        ‚îÇ
‚îÇ  Interceptors                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

NOT Loaded:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  @Service                       ‚îÇ
‚îÇ  @Repository                    ‚îÇ
‚îÇ  @Component                     ‚îÇ
‚îÇ  Database layers                ‚îÇ
‚îÇ  Message queues                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Basic Usage

### Simple Controller Test

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void shouldReturnUserById() throws Exception {
        // Given
        User user = new User(1L, "John Doe", "john@example.com");
        when(userService.findById(1L)).thenReturn(user);
        
        // When & Then
        mockMvc.perform(get("/api/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.name").value("John Doe"))
            .andExpect(jsonPath("$.email").value("john@example.com"));
    }
}
```

### Testing Multiple Controllers

```java
@WebMvcTest(controllers = {UserController.class, ProductController.class})
class MultipleControllersTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @MockBean
    private ProductService productService;
    
    @Test
    void shouldTestUserController() throws Exception {
        mockMvc.perform(get("/api/users/1"))
            .andExpect(status().isOk());
    }
    
    @Test
    void shouldTestProductController() throws Exception {
        mockMvc.perform(get("/api/products/1"))
            .andExpect(status().isOk());
    }
}
```

### Test All Controllers

```java
@WebMvcTest  // Without specifying controller - tests all
class AllControllersTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    // Mock all required services
    @MockBean
    private UserService userService;
    
    @MockBean
    private ProductService productService;
}
```

---

## üéÆ Testing Controllers

### GET Request Testing

```java
@WebMvcTest(UserController.class)
class UserControllerGetTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void shouldGetUserById() throws Exception {
        User user = new User(1L, "John", "john@example.com");
        when(userService.findById(1L)).thenReturn(user);
        
        mockMvc.perform(get("/api/users/{id}", 1L))
            .andExpect(status().isOk())
            .andExpect(content().contentType(MediaType.APPLICATION_JSON))
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.name").value("John"));
    }
    
    @Test
    void shouldGetAllUsers() throws Exception {
        List<User> users = Arrays.asList(
            new User(1L, "John", "john@example.com"),
            new User(2L, "Jane", "jane@example.com")
        );
        when(userService.findAll()).thenReturn(users);
        
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$").isArray())
            .andExpect(jsonPath("$.length()").value(2))
            .andExpect(jsonPath("$[0].name").value("John"))
            .andExpect(jsonPath("$[1].name").value("Jane"));
    }
    
    @Test
    void shouldReturnNotFoundWhenUserDoesNotExist() throws Exception {
        when(userService.findById(99L))
            .thenThrow(new UserNotFoundException("User not found"));
        
        mockMvc.perform(get("/api/users/99"))
            .andExpect(status().isNotFound());
    }
}
```

### POST Request Testing

```java
@WebMvcTest(UserController.class)
class UserControllerPostTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Test
    void shouldCreateUser() throws Exception {
        UserRequest request = new UserRequest("John", "john@example.com");
        User createdUser = new User(1L, "John", "john@example.com");
        
        when(userService.create(any(UserRequest.class))).thenReturn(createdUser);
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isCreated())
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.name").value("John"))
            .andExpect(header().exists("Location"));
    }
    
    @Test
    void shouldReturnBadRequestWhenInvalidData() throws Exception {
        UserRequest invalidRequest = new UserRequest("", "invalid-email");
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(invalidRequest)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.errors").exists());
    }
}
```

### PUT Request Testing

```java
@WebMvcTest(UserController.class)
class UserControllerPutTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Test
    void shouldUpdateUser() throws Exception {
        UserRequest request = new UserRequest("John Updated", "john.updated@example.com");
        User updatedUser = new User(1L, "John Updated", "john.updated@example.com");
        
        when(userService.update(eq(1L), any(UserRequest.class))).thenReturn(updatedUser);
        
        mockMvc.perform(put("/api/users/{id}", 1L)
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(request)))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.name").value("John Updated"));
    }
}
```

### DELETE Request Testing

```java
@WebMvcTest(UserController.class)
class UserControllerDeleteTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void shouldDeleteUser() throws Exception {
        doNothing().when(userService).delete(1L);
        
        mockMvc.perform(delete("/api/users/{id}", 1L))
            .andExpect(status().isNoContent());
        
        verify(userService, times(1)).delete(1L);
    }
    
    @Test
    void shouldReturnNotFoundWhenDeletingNonExistentUser() throws Exception {
        doThrow(new UserNotFoundException("User not found"))
            .when(userService).delete(99L);
        
        mockMvc.perform(delete("/api/users/99"))
            .andExpect(status().isNotFound());
    }
}
```

---

## üé≠ Mocking Dependencies

### Using @MockBean

```java
@WebMvcTest(UserController.class)
class UserControllerMockTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @MockBean
    private EmailService emailService;
    
    @Test
    void shouldMockMultipleDependencies() throws Exception {
        User user = new User(1L, "John", "john@example.com");
        when(userService.create(any())).thenReturn(user);
        when(emailService.sendWelcome(any())).thenReturn(true);
        
        UserRequest request = new UserRequest("John", "john@example.com");
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(new ObjectMapper().writeValueAsString(request)))
            .andExpect(status().isCreated());
        
        verify(userService, times(1)).create(any());
        verify(emailService, times(1)).sendWelcome(any());
    }
}
```

### Stubbing Service Methods

```java
@WebMvcTest(ProductController.class)
class ProductControllerStubTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ProductService productService;
    
    @Test
    void shouldStubDifferentScenarios() throws Exception {
        // Stub successful case
        when(productService.findById(1L))
            .thenReturn(new Product(1L, "Laptop", new BigDecimal("999.99")));
        
        // Stub error case
        when(productService.findById(99L))
            .thenThrow(new ProductNotFoundException("Product not found"));
        
        // Test successful case
        mockMvc.perform(get("/api/products/1"))
            .andExpect(status().isOk());
        
        // Test error case
        mockMvc.perform(get("/api/products/99"))
            .andExpect(status().isNotFound());
    }
}
```

---

## üì® Testing Request/Response

### Request Parameters

```java
@WebMvcTest(SearchController.class)
class SearchControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private SearchService searchService;
    
    @Test
    void shouldHandleRequestParams() throws Exception {
        List<Product> products = Arrays.asList(new Product(1L, "Laptop", null));
        when(searchService.search("laptop", 10, 0)).thenReturn(products);
        
        mockMvc.perform(get("/api/search")
                .param("query", "laptop")
                .param("limit", "10")
                .param("offset", "0"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.length()").value(1));
    }
    
    @Test
    void shouldHandleOptionalParams() throws Exception {
        when(searchService.search(eq("laptop"), anyInt(), anyInt()))
            .thenReturn(Collections.emptyList());
        
        mockMvc.perform(get("/api/search")
                .param("query", "laptop"))  // limit and offset optional
            .andExpect(status().isOk());
    }
}
```

### Request Headers

```java
@WebMvcTest(ApiController.class)
class ApiControllerHeaderTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ApiService apiService;
    
    @Test
    void shouldCheckRequestHeaders() throws Exception {
        mockMvc.perform(get("/api/data")
                .header("Authorization", "Bearer token123")
                .header("X-Custom-Header", "custom-value"))
            .andExpect(status().isOk());
    }
    
    @Test
    void shouldReturnUnauthorizedWithoutToken() throws Exception {
        mockMvc.perform(get("/api/data"))
            .andExpect(status().isUnauthorized());
    }
}
```

### Path Variables

```java
@WebMvcTest(UserController.class)
class PathVariableTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void shouldHandlePathVariables() throws Exception {
        User user = new User(1L, "John", "john@example.com");
        when(userService.findById(1L)).thenReturn(user);
        
        mockMvc.perform(get("/api/users/{id}", 1L))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(1));
    }
    
    @Test
    void shouldHandleMultiplePathVariables() throws Exception {
        Order order = new Order(1L, 10L, "PENDING");
        when(userService.getUserOrder(1L, 10L)).thenReturn(order);
        
        mockMvc.perform(get("/api/users/{userId}/orders/{orderId}", 1L, 10L))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(10));
    }
}
```

### Response Headers

```java
@WebMvcTest(FileController.class)
class ResponseHeaderTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private FileService fileService;
    
    @Test
    void shouldVerifyResponseHeaders() throws Exception {
        byte[] fileContent = "test content".getBytes();
        when(fileService.download(1L)).thenReturn(fileContent);
        
        mockMvc.perform(get("/api/files/{id}/download", 1L))
            .andExpect(status().isOk())
            .andExpect(header().string("Content-Type", "application/octet-stream"))
            .andExpect(header().string("Content-Disposition", "attachment; filename=file.txt"))
            .andExpect(content().bytes(fileContent));
    }
}
```

### JSON Response Validation

```java
@WebMvcTest(ProductController.class)
class JsonResponseTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ProductService productService;
    
    @Test
    void shouldValidateJsonResponse() throws Exception {
        Product product = new Product(1L, "Laptop", new BigDecimal("999.99"));
        when(productService.findById(1L)).thenReturn(product);
        
        mockMvc.perform(get("/api/products/1"))
            .andExpect(status().isOk())
            .andExpect(content().contentType(MediaType.APPLICATION_JSON))
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.name").value("Laptop"))
            .andExpect(jsonPath("$.price").value(999.99))
            .andExpect(jsonPath("$.description").doesNotExist());
    }
    
    @Test
    void shouldValidateJsonArray() throws Exception {
        List<Product> products = Arrays.asList(
            new Product(1L, "Laptop", new BigDecimal("999.99")),
            new Product(2L, "Phone", new BigDecimal("699.99"))
        );
        when(productService.findAll()).thenReturn(products);
        
        mockMvc.perform(get("/api/products"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$").isArray())
            .andExpect(jsonPath("$.length()").value(2))
            .andExpect(jsonPath("$[0].name").value("Laptop"))
            .andExpect(jsonPath("$[1].name").value("Phone"));
    }
}
```

---

## üöÄ Advanced Scenarios

### Testing Validation

```java
@WebMvcTest(UserController.class)
class ValidationTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    @Test
    void shouldValidateRequiredFields() throws Exception {
        UserRequest invalidRequest = new UserRequest(null, null);
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(invalidRequest)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.errors.name").value("Name is required"))
            .andExpect(jsonPath("$.errors.email").value("Email is required"));
    }
    
    @Test
    void shouldValidateEmailFormat() throws Exception {
        UserRequest invalidRequest = new UserRequest("John", "invalid-email");
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content(objectMapper.writeValueAsString(invalidRequest)))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.errors.email").value("Email must be valid"));
    }
}
```

### Testing Exception Handling

```java
@WebMvcTest(UserController.class)
class ExceptionHandlingTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void shouldHandleNotFoundException() throws Exception {
        when(userService.findById(99L))
            .thenThrow(new UserNotFoundException("User not found with id: 99"));
        
        mockMvc.perform(get("/api/users/99"))
            .andExpect(status().isNotFound())
            .andExpect(jsonPath("$.message").value("User not found with id: 99"));
    }
    
    @Test
    void shouldHandleValidationException() throws Exception {
        when(userService.create(any()))
            .thenThrow(new ValidationException("Invalid user data"));
        
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{}"))
            .andExpect(status().isBadRequest())
            .andExpect(jsonPath("$.message").value("Invalid user data"));
    }
}
```

### Testing with Security

```java
@WebMvcTest(UserController.class)
@Import(SecurityConfig.class)
class SecurityTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    @WithMockUser(username = "admin", roles = {"ADMIN"})
    void shouldAllowAdminAccess() throws Exception {
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isOk());
    }
    
    @Test
    @WithMockUser(username = "user", roles = {"USER"})
    void shouldDenyUserAccess() throws Exception {
        mockMvc.perform(delete("/api/users/1"))
            .andExpect(status().isForbidden());
    }
    
    @Test
    void shouldRequireAuthentication() throws Exception {
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isUnauthorized());
    }
}
```

### Testing Pagination

```java
@WebMvcTest(ProductController.class)
class PaginationTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private ProductService productService;
    
    @Test
    void shouldHandlePagination() throws Exception {
        Page<Product> page = new PageImpl<>(
            Arrays.asList(new Product(1L, "Laptop", null)),
            PageRequest.of(0, 10),
            1
        );
        when(productService.findAll(any(Pageable.class))).thenReturn(page);
        
        mockMvc.perform(get("/api/products")
                .param("page", "0")
                .param("size", "10"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.content").isArray())
            .andExpect(jsonPath("$.totalElements").value(1))
            .andExpect(jsonPath("$.totalPages").value(1));
    }
}
```

### Testing File Upload

```java
@WebMvcTest(FileController.class)
class FileUploadTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private FileService fileService;
    
    @Test
    void shouldUploadFile() throws Exception {
        MockMultipartFile file = new MockMultipartFile(
            "file",
            "test.txt",
            MediaType.TEXT_PLAIN_VALUE,
            "Hello World".getBytes()
        );
        
        when(fileService.store(any())).thenReturn("file-id-123");
        
        mockMvc.perform(multipart("/api/files/upload")
                .file(file))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.fileId").value("file-id-123"));
    }
}
```

---

## üí° Best Practices

### 1. Test Specific Controllers

```java
// ‚úÖ Good - Test specific controller
@WebMvcTest(UserController.class)
class UserControllerTest {
    @MockBean
    private UserService userService;
}

// ‚ùå Bad - Tests all controllers (slower, more mocks needed)
@WebMvcTest
class AllControllersTest {
    @MockBean
    private UserService userService;
    @MockBean
    private ProductService productService;
    @MockBean
    private OrderService orderService;
    // Many more mocks...
}
```

### 2. Use @MockBean for Dependencies

```java
// ‚úÖ Good - Mock service layer
@WebMvcTest(UserController.class)
class UserControllerTest {
    @MockBean
    private UserService userService;
}

// ‚ùå Bad - Don't use @SpringBootTest for controller tests
@SpringBootTest
@AutoConfigureMockMvc
class UserControllerTest {
    // Too heavy for controller testing
}
```

### 3. Test One Scenario Per Test

```java
// ‚úÖ Good - One scenario per test
@Test
void shouldReturnOkWhenUserExists() {
    // Test successful case
}

@Test
void shouldReturnNotFoundWhenUserDoesNotExist() {
    // Test error case
}

// ‚ùå Bad - Multiple scenarios in one test
@Test
void testGetUser() {
    // Test success
    // Test error
    // Test validation
}
```

### 4. Use Descriptive Test Names

```java
// ‚úÖ Good - Descriptive names
@Test
void shouldReturnCreatedStatusWhenUserIsSuccessfullyCreated() { }

@Test
void shouldReturnBadRequestWhenEmailIsInvalid() { }

// ‚ùå Bad - Vague names
@Test
void testCreateUser() { }

@Test
void test1() { }
```

### 5. Verify Mock Interactions

```java
// ‚úÖ Good - Verify service was called
@Test
void shouldCallServiceWhenCreatingUser() throws Exception {
    mockMvc.perform(post("/api/users")
            .contentType(MediaType.APPLICATION_JSON)
            .content("{}"))
        .andExpect(status().isCreated());
    
    verify(userService, times(1)).create(any());
}
```

---

## üé§ Interview Questions

### Q1: What is @WebMvcTest?
**Answer:** A Spring Boot test annotation that loads only web layer components (controllers, advice, filters) for testing without loading the full application context.

### Q2: What components does @WebMvcTest load?
**Answer:** Controllers, @ControllerAdvice, @JsonComponent, filters, WebMvcConfigurer, but NOT @Service, @Repository, or @Component beans.

### Q3: Difference between @WebMvcTest and @SpringBootTest?
**Answer:**
- @WebMvcTest: Web layer only, faster, uses @MockBean for dependencies
- @SpringBootTest: Full application context, slower, all layers loaded

### Q4: How to mock dependencies in @WebMvcTest?
**Answer:** Use `@MockBean` annotation to mock service layer dependencies.

### Q5: What is MockMvc?
**Answer:** Spring's testing utility to perform HTTP requests and assert responses without starting a real HTTP server.

### Q6: How to test POST requests with @WebMvcTest?
**Answer:**
```java
mockMvc.perform(post("/api/users")
    .contentType(MediaType.APPLICATION_JSON)
    .content(json))
    .andExpect(status().isCreated());
```

### Q7: How to test specific controller?
**Answer:** `@WebMvcTest(UserController.class)`

### Q8: How to verify JSON response?
**Answer:** Use `jsonPath()`:
```java
.andExpect(jsonPath("$.name").value("John"))
```

### Q9: How to test request parameters?
**Answer:**
```java
mockMvc.perform(get("/api/users")
    .param("page", "0")
    .param("size", "10"))
```

### Q10: How to test headers?
**Answer:**
```java
mockMvc.perform(get("/api/data")
    .header("Authorization", "Bearer token"))
    .andExpect(header().exists("Content-Type"))
```

### Q11: Can @WebMvcTest test repositories?
**Answer:** No, @WebMvcTest only loads web layer. Use @DataJpaTest for repository testing.

### Q12: How to test validation errors?
**Answer:**
```java
mockMvc.perform(post("/api/users")
    .content(invalidJson))
    .andExpect(status().isBadRequest())
    .andExpect(jsonPath("$.errors").exists());
```

### Q13: How to test exception handling?
**Answer:** Stub service to throw exception, verify response:
```java
when(service.findById(99L))
    .thenThrow(new NotFoundException());
mockMvc.perform(get("/api/users/99"))
    .andExpect(status().isNotFound());
```

### Q14: How to test file upload?
**Answer:**
```java
MockMultipartFile file = new MockMultipartFile(...);
mockMvc.perform(multipart("/upload").file(file))
```

### Q15: How to test with security?
**Answer:** Use `@WithMockUser` annotation:
```java
@Test
@WithMockUser(roles = "ADMIN")
void shouldAllowAdmin() { }
```

### Q16: What is @AutoConfigureMockMvc?
**Answer:** Auto-configures MockMvc bean. Not needed with @WebMvcTest (already included), but needed with @SpringBootTest.

### Q17: How to test pagination?
**Answer:**
```java
mockMvc.perform(get("/api/users")
    .param("page", "0")
    .param("size", "10"))
    .andExpect(jsonPath("$.content").isArray());
```

### Q18: Can you test multiple controllers together?
**Answer:** Yes: `@WebMvcTest(controllers = {Controller1.class, Controller2.class})`

### Q19: How to verify service method was called?
**Answer:**
```java
verify(userService, times(1)).findById(1L);
```

### Q20: When to use @WebMvcTest vs @SpringBootTest?
**Answer:**
- @WebMvcTest: Unit testing controllers (fast, focused)
- @SpringBootTest: Integration testing (complete workflow)

---

## üìö Summary

### Key Points

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;  // Auto-configured
    
    @MockBean
    private UserService userService;  // Mock dependencies
    
    @Test
    void shouldTestController() throws Exception {
        // Given
        when(userService.find()).thenReturn(user);
        
        // When & Then
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.name").value("John"));
        
        // Verify
        verify(userService).find();
    }
}
```

### Best Practices

```
‚úÖ Test specific controllers
‚úÖ Use @MockBean for dependencies
‚úÖ One scenario per test
‚úÖ Descriptive test names
‚úÖ Verify mock interactions
‚úÖ Test validation and errors
‚úÖ Use jsonPath for JSON assertions
```

**Next:** @DataJpaTest for Repository Testing ‚Üí

