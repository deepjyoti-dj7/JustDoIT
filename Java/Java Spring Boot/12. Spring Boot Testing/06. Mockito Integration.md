# üé≠ Mockito Integration - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [Mockito Basics](#mockito-basics)
- [Annotations](#annotations)
- [Stubbing Methods](#stubbing-methods)
- [Verification](#verification)
- [Argument Matchers](#argument-matchers)
- [Advanced Features](#advanced-features)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**Mockito** is the most popular mocking framework for Java testing, allowing you to create mock objects and stub their behavior.

### Why Mockito?

```
Benefits:
‚úÖ Mock external dependencies
‚úÖ Isolate unit under test
‚úÖ Verify method interactions
‚úÖ Stub method return values
‚úÖ Test exception scenarios
‚úÖ Avoid database/network calls
‚úÖ Fast test execution
```

### Mockito with Spring Boot

| Annotation | Purpose | Usage |
|------------|---------|-------|
| **@Mock** | Create mock object | Unit tests |
| **@MockBean** | Create & inject mock in Spring context | Integration tests |
| **@InjectMocks** | Inject mocks into object | Unit tests |
| **@Spy** | Partial mock (real methods + stubbing) | Advanced scenarios |
| **@Captor** | Capture method arguments | Verification |

---

## üìö Mockito Basics

### Maven Dependency

```xml
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-core</artifactId>
    <scope>test</scope>
</dependency>

<!-- For JUnit 5 -->
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-junit-jupiter</artifactId>
    <scope>test</scope>
</dependency>
```

### Simple Mock Example

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldFindUserById() {
        // Given
        User user = new User(1L, "John", "john@example.com");
        when(userRepository.findById(1L)).thenReturn(Optional.of(user));
        
        // When
        User found = userService.findById(1L);
        
        // Then
        assertThat(found).isNotNull();
        assertThat(found.getName()).isEqualTo("John");
    }
}
```

### Manual Mock Creation

```java
class UserServiceManualTest {
    
    private UserRepository userRepository;
    private UserService userService;
    
    @BeforeEach
    void setUp() {
        userRepository = Mockito.mock(UserRepository.class);
        userService = new UserService(userRepository);
    }
    
    @Test
    void shouldFindUser() {
        when(userRepository.findById(1L))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        User user = userService.findById(1L);
        
        assertThat(user.getName()).isEqualTo("John");
    }
}
```

---

## üè∑Ô∏è Annotations

### @Mock

```java
@ExtendWith(MockitoExtension.class)
class MockAnnotationTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private EmailService emailService;
    
    @Test
    void shouldCreateMocks() {
        // Mocks are automatically created
        assertThat(userRepository).isNotNull();
        assertThat(emailService).isNotNull();
    }
}
```

### @InjectMocks

```java
@ExtendWith(MockitoExtension.class)
class InjectMocksTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private EmailService emailService;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldInjectMocks() {
        // userService is created with injected mocks
        when(userRepository.findAll()).thenReturn(Collections.emptyList());
        
        List<User> users = userService.getAllUsers();
        
        assertThat(users).isEmpty();
    }
}
```

### @MockBean (Spring Boot)

```java
@SpringBootTest
class MockBeanTest {
    
    @MockBean
    private UserRepository userRepository;
    
    @Autowired
    private UserService userService;
    
    @Test
    void shouldUseMockBean() {
        // MockBean replaces real bean in Spring context
        when(userRepository.findById(1L))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        User user = userService.findById(1L);
        
        assertThat(user.getName()).isEqualTo("John");
    }
}
```

### @Spy

```java
@ExtendWith(MockitoExtension.class)
class SpyTest {
    
    @Spy
    private UserRepository userRepository = new UserRepositoryImpl();
    
    @Test
    void shouldUseRealMethodsUnlessStubbedSpy() {
        // Real method is called
        List<User> users = userRepository.findAll();
        
        // Stub specific method
        when(userRepository.findById(1L))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        // Stubbed method returns mocked value
        Optional<User> user = userRepository.findById(1L);
        assertThat(user).isPresent();
    }
}
```

### @Captor

```java
@ExtendWith(MockitoExtension.class)
class CaptorTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Captor
    private ArgumentCaptor<User> userCaptor;
    
    @Test
    void shouldCaptureArgument() {
        UserRequest request = new UserRequest("John", "john@example.com");
        
        userService.createUser(request);
        
        verify(userRepository).save(userCaptor.capture());
        
        User captured = userCaptor.getValue();
        assertThat(captured.getName()).isEqualTo("John");
    }
}
```

---

## üé¨ Stubbing Methods

### Basic Stubbing

```java
@ExtendWith(MockitoExtension.class)
class BasicStubbingTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldStubReturnValue() {
        // Stub method to return specific value
        when(userRepository.count()).thenReturn(5L);
        
        long count = userRepository.count();
        
        assertThat(count).isEqualTo(5);
    }
    
    @Test
    void shouldStubMultipleCalls() {
        // Different return values for multiple calls
        when(userRepository.count())
            .thenReturn(1L)
            .thenReturn(2L)
            .thenReturn(3L);
        
        assertThat(userRepository.count()).isEqualTo(1);
        assertThat(userRepository.count()).isEqualTo(2);
        assertThat(userRepository.count()).isEqualTo(3);
    }
}
```

### Stubbing with Exceptions

```java
@ExtendWith(MockitoExtension.class)
class ExceptionStubbingTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldThrowException() {
        when(userRepository.findById(99L))
            .thenThrow(new UserNotFoundException("User not found"));
        
        assertThrows(UserNotFoundException.class, () -> {
            userService.findById(99L);
        });
    }
    
    @Test
    void shouldThrowExceptionForVoidMethod() {
        doThrow(new RuntimeException("Error"))
            .when(userRepository).delete(any());
        
        assertThrows(RuntimeException.class, () -> {
            userRepository.delete(new User());
        });
    }
}
```

### Stubbing Void Methods

```java
@ExtendWith(MockitoExtension.class)
class VoidMethodStubbingTest {
    
    @Mock
    private EmailService emailService;
    
    @Test
    void shouldStubVoidMethod() {
        // Do nothing (default behavior)
        doNothing().when(emailService).send(any());
        
        emailService.send("test@example.com");
        
        verify(emailService).send("test@example.com");
    }
    
    @Test
    void shouldThrowOnVoidMethod() {
        doThrow(new EmailException("Failed to send"))
            .when(emailService).send(any());
        
        assertThrows(EmailException.class, () -> {
            emailService.send("test@example.com");
        });
    }
}
```

### Answer Callbacks

```java
@ExtendWith(MockitoExtension.class)
class AnswerCallbackTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldUseAnswer() {
        when(userRepository.save(any(User.class))).thenAnswer(invocation -> {
            User user = invocation.getArgument(0);
            user.setId(1L);  // Simulate ID generation
            return user;
        });
        
        User user = new User(null, "John", "john@example.com");
        User saved = userRepository.save(user);
        
        assertThat(saved.getId()).isEqualTo(1L);
    }
}
```

---

## ‚úÖ Verification

### Basic Verification

```java
@ExtendWith(MockitoExtension.class)
class VerificationTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldVerifyMethodCalled() {
        when(userRepository.findById(1L))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        userService.findById(1L);
        
        // Verify method was called
        verify(userRepository).findById(1L);
    }
    
    @Test
    void shouldVerifyNeverCalled() {
        // Verify method was never called
        verify(userRepository, never()).delete(any());
    }
}
```

### Verification with Times

```java
@ExtendWith(MockitoExtension.class)
class TimesVerificationTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldVerifyCalledOnce() {
        userService.findById(1L);
        
        verify(userRepository, times(1)).findById(1L);
        // Or simply:
        verify(userRepository).findById(1L);
    }
    
    @Test
    void shouldVerifyCalledMultipleTimes() {
        userService.findById(1L);
        userService.findById(1L);
        userService.findById(1L);
        
        verify(userRepository, times(3)).findById(1L);
    }
    
    @Test
    void shouldVerifyAtLeast() {
        userService.findById(1L);
        userService.findById(1L);
        
        verify(userRepository, atLeast(1)).findById(1L);
        verify(userRepository, atLeastOnce()).findById(1L);
    }
    
    @Test
    void shouldVerifyAtMost() {
        userService.findById(1L);
        
        verify(userRepository, atMost(2)).findById(1L);
    }
}
```

### Verification Order

```java
@ExtendWith(MockitoExtension.class)
class OrderVerificationTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Mock
    private EmailService emailService;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldVerifyInOrder() {
        UserRequest request = new UserRequest("John", "john@example.com");
        
        userService.createUser(request);
        
        InOrder inOrder = inOrder(userRepository, emailService);
        inOrder.verify(userRepository).save(any());
        inOrder.verify(emailService).sendWelcome(any());
    }
}
```

### Verify No Interactions

```java
@ExtendWith(MockitoExtension.class)
class NoInteractionsTest {
    
    @Mock
    private EmailService emailService;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldVerifyNoInteractions() {
        // Don't call any methods
        
        verifyNoInteractions(emailService);
    }
    
    @Test
    void shouldVerifyNoMoreInteractions() {
        emailService.send("test@example.com");
        
        verify(emailService).send("test@example.com");
        verifyNoMoreInteractions(emailService);
    }
}
```

---

## üéØ Argument Matchers

### Common Matchers

```java
@ExtendWith(MockitoExtension.class)
class ArgumentMatchersTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldUseAnyMatcher() {
        when(userRepository.save(any(User.class)))
            .thenReturn(new User(1L, "John", "john@example.com"));
        
        User user = userRepository.save(new User());
        
        assertThat(user.getId()).isEqualTo(1L);
    }
    
    @Test
    void shouldUseEqMatcher() {
        when(userRepository.findById(eq(1L)))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        Optional<User> user = userRepository.findById(1L);
        
        assertThat(user).isPresent();
    }
    
    @Test
    void shouldUseNullMatcher() {
        when(userRepository.findByEmail(isNull()))
            .thenReturn(Optional.empty());
        
        Optional<User> user = userRepository.findByEmail(null);
        
        assertThat(user).isEmpty();
    }
}
```

### String Matchers

```java
@ExtendWith(MockitoExtension.class)
class StringMatchersTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldUseStringMatchers() {
        // Any string
        when(userRepository.findByEmail(anyString()))
            .thenReturn(Optional.of(new User()));
        
        // Contains
        when(userRepository.findByEmail(contains("@gmail")))
            .thenReturn(Optional.of(new User()));
        
        // Starts with
        when(userRepository.findByEmail(startsWith("user")))
            .thenReturn(Optional.of(new User()));
        
        // Ends with
        when(userRepository.findByEmail(endsWith(".com")))
            .thenReturn(Optional.of(new User()));
        
        // Matches regex
        when(userRepository.findByEmail(matches(".*@example\\.com")))
            .thenReturn(Optional.of(new User()));
    }
}
```

### Collection Matchers

```java
@ExtendWith(MockitoExtension.class)
class CollectionMatchersTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldUseCollectionMatchers() {
        // Any list
        when(userRepository.saveAll(anyList()))
            .thenReturn(Arrays.asList(new User()));
        
        // Any collection
        when(userRepository.saveAll(anyCollection()))
            .thenReturn(Arrays.asList(new User()));
        
        // Any iterable
        when(userRepository.saveAll(anyIterable()))
            .thenReturn(Arrays.asList(new User()));
    }
}
```

### Custom Matchers

```java
@ExtendWith(MockitoExtension.class)
class CustomMatchersTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldUseCustomMatcher() {
        when(userRepository.save(argThat(user -> 
            user.getEmail().endsWith("@example.com")
        ))).thenReturn(new User(1L, "John", "john@example.com"));
        
        User user = new User(null, "John", "john@example.com");
        User saved = userRepository.save(user);
        
        assertThat(saved.getId()).isEqualTo(1L);
    }
}
```

---

## üöÄ Advanced Features

### Mocking Static Methods

```java
@ExtendWith(MockitoExtension.class)
class StaticMockingTest {
    
    @Test
    void shouldMockStaticMethod() {
        try (MockedStatic<LocalDateTime> mockedStatic = mockStatic(LocalDateTime.class)) {
            LocalDateTime fixedTime = LocalDateTime.of(2024, 1, 1, 12, 0);
            mockedStatic.when(LocalDateTime::now).thenReturn(fixedTime);
            
            LocalDateTime now = LocalDateTime.now();
            
            assertThat(now).isEqualTo(fixedTime);
        }
    }
}
```

### Mocking Final Classes

```java
// Mockito can mock final classes (since Mockito 2)
@ExtendWith(MockitoExtension.class)
class FinalClassMockingTest {
    
    @Mock
    private FinalUserService finalUserService;
    
    @Test
    void shouldMockFinalClass() {
        when(finalUserService.getUser()).thenReturn(new User());
        
        User user = finalUserService.getUser();
        
        assertThat(user).isNotNull();
    }
}
```

### Deep Stubs

```java
@ExtendWith(MockitoExtension.class)
class DeepStubsTest {
    
    @Mock(answer = Answers.RETURNS_DEEP_STUBS)
    private UserService userService;
    
    @Test
    void shouldUseDeepStubs() {
        when(userService.getUser().getAddress().getCity())
            .thenReturn("New York");
        
        String city = userService.getUser().getAddress().getCity();
        
        assertThat(city).isEqualTo("New York");
    }
}
```

### BDD Style

```java
import static org.mockito.BDDMockito.*;

@ExtendWith(MockitoExtension.class)
class BDDStyleTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldUseBDDStyle() {
        // Given
        given(userRepository.findById(1L))
            .willReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        // When
        User user = userService.findById(1L);
        
        // Then
        then(userRepository).should().findById(1L);
        assertThat(user.getName()).isEqualTo("John");
    }
}
```

### Timeout Verification

```java
@ExtendWith(MockitoExtension.class)
class TimeoutVerificationTest {
    
    @Mock
    private UserRepository userRepository;
    
    @Test
    void shouldVerifyWithTimeout() throws InterruptedException {
        new Thread(() -> {
            try {
                Thread.sleep(100);
                userRepository.save(new User());
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }).start();
        
        verify(userRepository, timeout(200)).save(any());
    }
}
```

---

## üí° Best Practices

### 1. Don't Mock Value Objects

```java
// ‚úÖ Good - Use real value objects
@Test
void shouldUseRealValueObjects() {
    User user = new User(1L, "John", "john@example.com");
    when(userRepository.findById(1L)).thenReturn(Optional.of(user));
}

// ‚ùå Bad - Don't mock value objects
@Test
void shouldNotMockValueObjects() {
    User user = mock(User.class);
    when(user.getName()).thenReturn("John");
    // Unnecessarily complex
}
```

### 2. Use @InjectMocks Wisely

```java
// ‚úÖ Good - Clear dependencies
@Mock
private UserRepository userRepository;

@InjectMocks
private UserService userService;

// ‚ùå Bad - Too many dependencies (consider refactoring)
@Mock private Dep1 dep1;
@Mock private Dep2 dep2;
@Mock private Dep3 dep3;
@Mock private Dep4 dep4;
@Mock private Dep5 dep5;
@InjectMocks
private ComplexService complexService;
```

### 3. Verify What Matters

```java
// ‚úÖ Good - Verify important interactions
@Test
void shouldVerifyImportantInteraction() {
    userService.deleteUser(1L);
    
    verify(userRepository).delete(any());
    verify(emailService).sendGoodbye(any());
}

// ‚ùå Bad - Over-verification
@Test
void shouldNotOverVerify() {
    userService.getUser(1L);
    
    verify(logger).debug(anyString());  // Don't verify logging
    verify(cache).get(anyString());     // Implementation detail
}
```

### 4. Avoid Stubbing Unnecessarily

```java
// ‚úÖ Good - Only stub what's needed
@Test
void shouldOnlyStubWhatIsNeeded() {
    when(userRepository.findById(1L))
        .thenReturn(Optional.of(new User()));
    
    userService.getUser(1L);
}

// ‚ùå Bad - Unused stubs
@Test
void shouldNotStubUnused() {
    when(userRepository.findById(1L)).thenReturn(Optional.of(new User()));
    when(userRepository.findAll()).thenReturn(Collections.emptyList());  // Not used
    when(userRepository.count()).thenReturn(10L);  // Not used
}
```

### 5. Use Descriptive Names

```java
// ‚úÖ Good
@Test
void shouldSendWelcomeEmailWhenUserIsCreated() { }

@Test
void shouldThrowExceptionWhenUserNotFound() { }

// ‚ùå Bad
@Test
void test1() { }

@Test
void testUserService() { }
```

---

## üé§ Interview Questions

### Q1: What is Mockito?
**Answer:** A popular Java mocking framework used to create mock objects for unit testing.

### Q2: Difference between @Mock and @MockBean?
**Answer:**
- @Mock: Mockito annotation for plain JUnit tests
- @MockBean: Spring Boot annotation that adds mock to Spring context

### Q3: What is @InjectMocks?
**Answer:** Annotation that creates an instance and injects @Mock dependencies into it.

### Q4: How to stub a method?
**Answer:** `when(mock.method()).thenReturn(value)`

### Q5: How to verify a method was called?
**Answer:** `verify(mock).method()`

### Q6: How to stub void methods?
**Answer:** `doNothing().when(mock).voidMethod()` or `doThrow().when(mock).voidMethod()`

### Q7: What are argument matchers?
**Answer:** Flexible argument matching for stubbing and verification (any(), eq(), contains(), etc.)

### Q8: How to verify method call count?
**Answer:** `verify(mock, times(n)).method()`

### Q9: How to verify method never called?
**Answer:** `verify(mock, never()).method()`

### Q10: What is ArgumentCaptor?
**Answer:** Captures arguments passed to mocked methods for assertions.

### Q11: Can Mockito mock final classes?
**Answer:** Yes, Mockito 2+ can mock final classes and methods.

### Q12: How to stub multiple calls?
**Answer:**
```java
when(mock.method())
    .thenReturn(value1)
    .thenReturn(value2);
```

### Q13: What is @Spy?
**Answer:** Creates a spy that uses real methods unless stubbed.

### Q14: How to verify call order?
**Answer:**
```java
InOrder inOrder = inOrder(mock1, mock2);
inOrder.verify(mock1).method1();
inOrder.verify(mock2).method2();
```

### Q15: How to stub exceptions?
**Answer:** `when(mock.method()).thenThrow(new Exception())`

### Q16: What is thenAnswer()?
**Answer:** Allows custom logic for stubbed method using Answer callback.

### Q17: How to mock static methods?
**Answer:** Use `mockStatic()` with try-with-resources (Mockito 3.4+)

### Q18: What is RETURNS_DEEP_STUBS?
**Answer:** Answer that allows chaining method calls on mocks.

### Q19: Difference between verify() and when()?
**Answer:**
- when(): Stubbing (setup)
- verify(): Verification (assertion)

### Q20: When not to use Mockito?
**Answer:** Integration tests, testing value objects, testing simple getters/setters.

---

## üìö Summary

### Key Points

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock
    private UserRepository userRepository;
    
    @InjectMocks
    private UserService userService;
    
    @Test
    void shouldTestWithMockito() {
        // Given - Stub
        when(userRepository.findById(1L))
            .thenReturn(Optional.of(new User(1L, "John", "john@example.com")));
        
        // When - Execute
        User user = userService.findById(1L);
        
        // Then - Assert & Verify
        assertThat(user.getName()).isEqualTo("John");
        verify(userRepository).findById(1L);
    }
}
```

### Best Practices

```
‚úÖ Use @Mock for dependencies
‚úÖ Use @InjectMocks for class under test
‚úÖ Stub with when().thenReturn()
‚úÖ Verify with verify()
‚úÖ Use argument matchers
‚úÖ Don't mock value objects
‚úÖ Verify what matters
‚úÖ Avoid over-stubbing
```

**Next:** Integration Testing ‚Üí

