# üåç Environment Variables - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [Accessing Environment Variables](#accessing-environment-variables)
- [Setting Environment Variables](#setting-environment-variables)
- [Binding Environment Variables](#binding-environment-variables)
- [Naming Conventions](#naming-conventions)
- [System Properties vs Environment Variables](#system-properties-vs-environment-variables)
- [Environment Variable in Different Contexts](#environment-variable-in-different-contexts)
- [Docker and Kubernetes](#docker-and-kubernetes)
- [Cloud Platforms](#cloud-platforms)
- [Security Considerations](#security-considerations)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**Environment Variables** are OS-level variables used to configure applications externally without modifying code.

### Benefits

- ‚úÖ **External configuration**: No code changes needed
- ‚úÖ **Security**: Keep secrets out of code
- ‚úÖ **Cloud-ready**: Standard approach in cloud platforms
- ‚úÖ **12-Factor App**: Follows 12-factor methodology
- ‚úÖ **Cross-platform**: Works on all operating systems

---

## üîç Accessing Environment Variables

### Using @Value

```java
@Component
public class AppComponent {
    
    @Value("${APP_NAME}")
    private String appName;
    
    @Value("${SERVER_PORT:8080}")
    private int port;
    
    @Value("${DB_PASSWORD}")
    private String dbPassword;
}
```

### Using Environment

```java
@Component
public class EnvironmentComponent {
    
    @Autowired
    private Environment env;
    
    public void accessVariables() {
        // Get environment variable
        String appName = env.getProperty("APP_NAME");
        
        // Get with default value
        String port = env.getProperty("SERVER_PORT", "8080");
        
        // Get required variable (throws exception if not found)
        String dbPassword = env.getRequiredProperty("DB_PASSWORD");
        
        // Get with type conversion
        Integer maxUsers = env.getProperty("MAX_USERS", Integer.class, 100);
        
        // Check if exists
        boolean hasApiKey = env.containsProperty("API_KEY");
    }
}
```

### Using System.getenv()

```java
@Component
public class SystemEnvComponent {
    
    public void accessEnvVars() {
        // Get single variable
        String appName = System.getenv("APP_NAME");
        
        // Get with default (manual)
        String port = System.getenv().getOrDefault("SERVER_PORT", "8080");
        
        // Get all environment variables
        Map<String, String> allEnvVars = System.getenv();
        
        // Check if exists
        boolean hasApiKey = System.getenv().containsKey("API_KEY");
    }
}
```

### Using @ConfigurationProperties

```java
@ConfigurationProperties(prefix = "app")
public class AppProperties {
    
    // Binds to APP_NAME environment variable
    private String name;
    
    // Binds to APP_MAX_USERS
    private int maxUsers;
    
    // Binds to APP_DATABASE_URL
    private String databaseUrl;
    
    // Getters and setters
}
```

```bash
# Set environment variables
export APP_NAME=MyApplication
export APP_MAX_USERS=100
export APP_DATABASE_URL=jdbc:mysql://localhost:3306/db
```

---

## ‚öôÔ∏è Setting Environment Variables

### Linux/macOS

```bash
# Temporary (current session only)
export APP_NAME=MyApplication
export SERVER_PORT=8080
export DB_PASSWORD=secret123

# Verify
echo $APP_NAME
printenv APP_NAME

# Unset
unset APP_NAME

# List all
printenv
env
```

### Persistent (Linux/macOS)

```bash
# Add to ~/.bashrc or ~/.zshrc
echo 'export APP_NAME=MyApplication' >> ~/.bashrc
echo 'export SERVER_PORT=8080' >> ~/.bashrc

# Reload
source ~/.bashrc

# Or add to /etc/environment (system-wide)
sudo nano /etc/environment
# Add: APP_NAME=MyApplication
```

### Windows (CMD)

```cmd
REM Temporary
set APP_NAME=MyApplication
set SERVER_PORT=8080

REM Verify
echo %APP_NAME%

REM List all
set
```

### Windows (PowerShell)

```powershell
# Temporary
$env:APP_NAME = "MyApplication"
$env:SERVER_PORT = "8080"

# Verify
$env:APP_NAME
Get-ChildItem Env:APP_NAME

# List all
Get-ChildItem Env:
```

### Persistent (Windows)

```powershell
# User-level
[System.Environment]::SetEnvironmentVariable("APP_NAME", "MyApplication", "User")

# System-level (requires admin)
[System.Environment]::SetEnvironmentVariable("APP_NAME", "MyApplication", "Machine")

# Verify
[System.Environment]::GetEnvironmentVariable("APP_NAME", "User")
```

---

## üîó Binding Environment Variables

### In application.properties

```properties
# application.properties
app.name=${APP_NAME:MyApp}
server.port=${SERVER_PORT:8080}
spring.datasource.url=${DB_URL:jdbc:h2:mem:devdb}
spring.datasource.username=${DB_USERNAME:sa}
spring.datasource.password=${DB_PASSWORD}

# JWT configuration
app.jwt.secret=${JWT_SECRET}
app.jwt.expiration=${JWT_EXPIRATION:3600000}

# External APIs
app.payment.api.url=${PAYMENT_API_URL}
app.payment.api.key=${PAYMENT_API_KEY}
```

### In application.yml

```yaml
# application.yml
app:
  name: ${APP_NAME:MyApp}
  max-users: ${APP_MAX_USERS:100}
  
server:
  port: ${SERVER_PORT:8080}

spring:
  datasource:
    url: ${DB_URL:jdbc:h2:mem:devdb}
    username: ${DB_USERNAME:sa}
    password: ${DB_PASSWORD}
  
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME}
    password: ${MAIL_PASSWORD}
```

### Direct Binding (No Properties File)

```java
@Component
public class DirectBindingComponent {
    
    // Directly from environment variable
    @Value("${DATABASE_URL}")
    private String databaseUrl;
    
    @Value("${API_KEY}")
    private String apiKey;
    
    @Value("${MAX_CONNECTIONS:20}")
    private int maxConnections;
}
```

---

## üìè Naming Conventions

### Environment Variable Format

**Standard:** `UPPER_CASE_WITH_UNDERSCORES`

```bash
export APP_NAME=MyApplication
export SERVER_PORT=8080
export DB_CONNECTION_URL=jdbc:mysql://localhost:3306/db
export MAX_POOL_SIZE=20
```

### Spring Boot Relaxed Binding

Spring Boot automatically maps environment variables to properties:

```bash
# Environment variable
export APP_MAX_USERS=100
```

Maps to any of these property formats:
- `app.max-users`
- `app.maxUsers`
- `app.max_users`
- `APP_MAX_USERS`

```java
@ConfigurationProperties(prefix = "app")
public class AppProperties {
    private int maxUsers;  // Binds to APP_MAX_USERS
}
```

### Mapping Examples

| Environment Variable | Property Name |
|---------------------|---------------|
| `APP_NAME` | `app.name` |
| `SERVER_PORT` | `server.port` |
| `DB_CONNECTION_URL` | `db.connection.url` |
| `SPRING_DATASOURCE_URL` | `spring.datasource.url` |
| `APP_MAX_USERS` | `app.max-users` |

### Nested Properties

```bash
# Environment variables
export APP_DATABASE_URL=jdbc:mysql://localhost:3306/db
export APP_DATABASE_USERNAME=admin
export APP_DATABASE_PASSWORD=secret
export APP_DATABASE_POOL_SIZE=20
```

```java
@ConfigurationProperties(prefix = "app")
public class AppProperties {
    
    private Database database;
    
    public static class Database {
        private String url;        // APP_DATABASE_URL
        private String username;   // APP_DATABASE_USERNAME
        private String password;   // APP_DATABASE_PASSWORD
        private int poolSize;      // APP_DATABASE_POOL_SIZE
    }
}
```

---

## üÜö System Properties vs Environment Variables

### Comparison

| Feature | System Properties | Environment Variables |
|---------|------------------|----------------------|
| **Scope** | JVM-specific | OS-level |
| **Setting** | `-D` flag | `export` command |
| **Access** | `System.getProperty()` | `System.getenv()` |
| **Format** | `property.name` | `PROPERTY_NAME` |
| **Mutability** | Can be changed at runtime | Read-only in JVM |
| **Priority** | Higher | Lower |

### System Properties

```bash
# Set via command line
java -Dserver.port=8080 -Dapp.name=MyApp -jar app.jar
```

```java
// Access
String port = System.getProperty("server.port");
String appName = System.getProperty("app.name", "DefaultApp");

// Set at runtime
System.setProperty("app.feature", "enabled");
```

### Environment Variables

```bash
# Set in shell
export SERVER_PORT=8080
export APP_NAME=MyApp
java -jar app.jar
```

```java
// Access (read-only)
String port = System.getenv("SERVER_PORT");
String appName = System.getenv("APP_NAME");

// Cannot set at runtime
// System.setenv() doesn't exist
```

### Priority Order

Spring Boot property resolution order:

1. **Command-line arguments** (highest)
2. **System properties** (`-D` flags)
3. **Environment variables**
4. **Config files** (lowest)

```bash
# Environment variable
export SERVER_PORT=8080

# System property (overrides environment)
java -Dserver.port=9090 -jar app.jar

# Command-line argument (overrides everything)
java -jar app.jar --server.port=7070

# Result: port = 7070
```

---

## üîß Environment Variable in Different Contexts

### Running from JAR

```bash
# Set environment variables
export DB_URL=jdbc:mysql://localhost:3306/proddb
export DB_USERNAME=admin
export DB_PASSWORD=secret123

# Run application
java -jar myapp.jar
```

### Running from IDE (IntelliJ)

```
Run ‚Üí Edit Configurations ‚Üí Environment variables:
DB_URL=jdbc:mysql://localhost:3306/devdb;DB_USERNAME=admin;DB_PASSWORD=secret
```

### Running from IDE (Eclipse/STS)

```
Run Configurations ‚Üí Environment tab ‚Üí New:
Name: DB_URL
Value: jdbc:mysql://localhost:3306/devdb
```

### Maven/Gradle Build

```bash
# Set for build process
export BUILD_VERSION=1.0.0
export BUILD_TIMESTAMP=$(date +%s)

# Maven
mvn clean package

# Gradle
gradle build
```

### Spring Boot Maven Plugin

```bash
# Pass environment variables
mvn spring-boot:run -Dspring-boot.run.env.DB_URL=jdbc:mysql://localhost:3306/db
```

### Spring Boot Gradle Plugin

```bash
# Pass environment variables
gradle bootRun --args='--spring.profiles.active=dev'
```

---

## üê≥ Docker and Kubernetes

### Docker

```dockerfile
# Dockerfile
FROM openjdk:17-jdk-alpine
COPY target/myapp.jar app.jar

# Set default environment variables
ENV APP_NAME=MyApplication
ENV SERVER_PORT=8080

ENTRYPOINT ["java", "-jar", "/app.jar"]
```

### Docker Run

```bash
# Pass environment variables
docker run -e DB_URL=jdbc:mysql://db:3306/mydb \
           -e DB_USERNAME=admin \
           -e DB_PASSWORD=secret \
           -p 8080:8080 \
           myapp:latest
```

### Docker Compose

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    image: myapp:latest
    environment:
      - APP_NAME=MyApplication
      - SERVER_PORT=8080
      - DB_URL=jdbc:mysql://db:3306/mydb
      - DB_USERNAME=admin
      - DB_PASSWORD=secret
    env_file:
      - .env
    ports:
      - "8080:8080"
```

```.env
# .env file
APP_NAME=MyApplication
SERVER_PORT=8080
DB_URL=jdbc:mysql://db:3306/mydb
DB_USERNAME=admin
DB_PASSWORD=secret
```

### Kubernetes ConfigMap

```yaml
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_NAME: "MyApplication"
  SERVER_PORT: "8080"
  DB_URL: "jdbc:mysql://db-service:3306/mydb"
```

### Kubernetes Secret

```yaml
# secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: app-secrets
type: Opaque
data:
  DB_USERNAME: YWRtaW4=     # base64 encoded "admin"
  DB_PASSWORD: c2VjcmV0MTIz # base64 encoded "secret123"
```

### Kubernetes Deployment

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  template:
    spec:
      containers:
      - name: myapp
        image: myapp:latest
        envFrom:
          - configMapRef:
              name: app-config
          - secretRef:
              name: app-secrets
        env:
          - name: JAVA_OPTS
            value: "-Xmx512m -Xms256m"
```

---

## ‚òÅÔ∏è Cloud Platforms

### AWS Elastic Beanstalk

```bash
# Set via AWS Console or CLI
aws elasticbeanstalk update-environment \
    --environment-name myapp-env \
    --option-settings \
      Namespace=aws:elasticbeanstalk:application:environment,OptionName=DB_URL,Value=jdbc:mysql://... \
      Namespace=aws:elasticbeanstalk:application:environment,OptionName=DB_USERNAME,Value=admin
```

### AWS ECS Task Definition

```json
{
  "containerDefinitions": [
    {
      "name": "myapp",
      "image": "myapp:latest",
      "environment": [
        {
          "name": "APP_NAME",
          "value": "MyApplication"
        },
        {
          "name": "SERVER_PORT",
          "value": "8080"
        }
      ],
      "secrets": [
        {
          "name": "DB_PASSWORD",
          "valueFrom": "arn:aws:secretsmanager:region:account:secret:db-password"
        }
      ]
    }
  ]
}
```

### Heroku

```bash
# Set config vars
heroku config:set DB_URL=jdbc:postgres://...
heroku config:set DB_USERNAME=admin
heroku config:set DB_PASSWORD=secret

# View all
heroku config

# Unset
heroku config:unset DB_PASSWORD
```

### Google Cloud Run

```bash
# Deploy with environment variables
gcloud run deploy myapp \
    --image gcr.io/project/myapp:latest \
    --set-env-vars="APP_NAME=MyApp,SERVER_PORT=8080" \
    --set-env-vars="DB_URL=jdbc:mysql://..."
```

### Azure App Service

```bash
# Set application settings
az webapp config appsettings set \
    --resource-group myResourceGroup \
    --name myapp \
    --settings DB_URL=jdbc:sqlserver://... DB_USERNAME=admin
```

---

## üîê Security Considerations

### 1. Never Commit Secrets to Version Control

```bash
# ‚ùå BAD - In application.properties
spring.datasource.password=secret123

# ‚úÖ GOOD - Use environment variable
spring.datasource.password=${DB_PASSWORD}
```

### 2. Use Secrets Management

```yaml
# AWS Secrets Manager
spring:
  datasource:
    password: ${sm://myapp/db/password}

# HashiCorp Vault
spring:
  cloud:
    vault:
      token: ${VAULT_TOKEN}
      uri: ${VAULT_URI}
```

### 3. Restrict Access to Environment Variables

```bash
# Set file permissions for .env files
chmod 600 .env

# Don't expose in logs
# ‚ùå
logger.info("DB Password: " + dbPassword);

# ‚úÖ
logger.info("Database connection configured");
```

### 4. Use Different Secrets per Environment

```bash
# Development
export DB_PASSWORD=dev_password

# Production
export DB_PASSWORD=${PROD_DB_PASSWORD_FROM_SECRETS_MANAGER}
```

### 5. Rotate Secrets Regularly

```java
@Configuration
public class SecretRotationConfig {
    
    @Bean
    @RefreshScope
    public DataSource dataSource(Environment env) {
        // Gets refreshed when secrets rotate
        String password = env.getProperty("DB_PASSWORD");
        // Configure datasource
    }
}
```

---

## üìå Best Practices

### 1. Use Descriptive Names

```bash
# ‚úÖ Clear and descriptive
export DATABASE_CONNECTION_URL=jdbc:mysql://localhost:3306/db
export PAYMENT_API_KEY=pk_live_abc123
export MAX_CONNECTION_POOL_SIZE=20

# ‚ùå Ambiguous
export URL=jdbc:mysql://localhost:3306/db
export KEY=pk_live_abc123
export SIZE=20
```

### 2. Provide Defaults

```properties
# application.properties
server.port=${SERVER_PORT:8080}
app.max-users=${MAX_USERS:100}
logging.level.root=${LOG_LEVEL:INFO}
```

### 3. Group Related Variables

```bash
# Database configuration
export DB_HOST=localhost
export DB_PORT=3306
export DB_NAME=mydb
export DB_USERNAME=admin
export DB_PASSWORD=secret

# Application configuration
export APP_NAME=MyApp
export APP_VERSION=1.0.0
export APP_MAX_USERS=100
```

### 4. Document Required Variables

```java
/**
 * Application configuration.
 * 
 * Required environment variables:
 * - DB_URL: Database connection URL
 * - DB_USERNAME: Database username
 * - DB_PASSWORD: Database password
 * - JWT_SECRET: JWT signing secret
 * 
 * Optional environment variables:
 * - SERVER_PORT: Server port (default: 8080)
 * - APP_MAX_USERS: Max concurrent users (default: 100)
 */
@Configuration
public class AppConfig {
}
```

### 5. Use .env Files for Local Development

```.env
# .env (not committed to git)
DB_URL=jdbc:mysql://localhost:3306/devdb
DB_USERNAME=admin
DB_PASSWORD=devpassword
JWT_SECRET=devsecret123
```

```bash
# .gitignore
.env
.env.local
.env.*.local
```

### 6. Validate on Startup

```java
@Component
public class EnvironmentValidator implements ApplicationListener<ApplicationReadyEvent> {
    
    @Value("${DB_PASSWORD}")
    private String dbPassword;
    
    @Value("${JWT_SECRET}")
    private String jwtSecret;
    
    @Override
    public void onApplicationEvent(ApplicationReadyEvent event) {
        if (dbPassword == null || dbPassword.isEmpty()) {
            throw new IllegalStateException("DB_PASSWORD environment variable not set");
        }
        if (jwtSecret == null || jwtSecret.length() < 32) {
            throw new IllegalStateException("JWT_SECRET must be at least 32 characters");
        }
    }
}
```

### 7. Use Environment-Specific Prefixes

```bash
# Development
export DEV_DB_URL=jdbc:h2:mem:devdb
export DEV_DB_USERNAME=sa

# Production
export PROD_DB_URL=jdbc:mysql://prod-server:3306/db
export PROD_DB_USERNAME=prod_user
```

---

## üé§ Interview Questions

### Q1: What are environment variables?
**Answer:** OS-level key-value pairs used to configure applications externally without modifying code. Accessed via `System.getenv()` in Java.

### Q2: How to set environment variable in Linux?
**Answer:**
```bash
export APP_NAME=MyApp  # Temporary
echo 'export APP_NAME=MyApp' >> ~/.bashrc  # Persistent
```

### Q3: How to access environment variable in Spring Boot?
**Answer:**
```java
@Value("${APP_NAME}")
private String appName;

// Or
env.getProperty("APP_NAME");
```

### Q4: Environment variable naming convention?
**Answer:** `UPPER_CASE_WITH_UNDERSCORES`

Example: `DB_CONNECTION_URL`, `MAX_POOL_SIZE`

### Q5: Difference between system properties and environment variables?
**Answer:**
- **System properties**: JVM-specific, set via `-D`, mutable
- **Environment variables**: OS-level, set via `export`, read-only in JVM

### Q6: How does Spring Boot map environment variables to properties?
**Answer:** Relaxed binding - `APP_MAX_USERS` maps to `app.max-users`, `app.maxUsers`, etc.

### Q7: Priority: environment variable vs system property?
**Answer:** System property has higher priority and overrides environment variable.

### Q8: How to pass environment variables to Docker container?
**Answer:**
```bash
docker run -e DB_URL=jdbc:mysql://db:3306/db myapp
```

### Q9: How to secure sensitive environment variables?
**Answer:**
- Use secrets management (AWS Secrets Manager, Vault)
- Never commit to version control
- Restrict file permissions
- Rotate regularly

### Q10: How to validate required environment variables on startup?
**Answer:**
```java
@Value("${REQUIRED_VAR}")
private String requiredVar;

// Or
env.getRequiredProperty("REQUIRED_VAR");  // Throws exception if missing
```

---

## üìö Summary

### Setting Environment Variables

```bash
# Linux/macOS
export APP_NAME=MyApp
export SERVER_PORT=8080

# Windows (CMD)
set APP_NAME=MyApp

# Windows (PowerShell)
$env:APP_NAME = "MyApp"
```

### Accessing in Spring Boot

```java
// @Value
@Value("${APP_NAME:DefaultApp}")
private String appName;

// Environment
String appName = env.getProperty("APP_NAME", "DefaultApp");

// System.getenv()
String appName = System.getenv("APP_NAME");

// @ConfigurationProperties
@ConfigurationProperties(prefix = "app")
public class AppProperties {
    private String name;  // APP_NAME
}
```

### Naming Convention

| Format | Example |
|--------|---------|
| **Environment Variable** | `APP_MAX_USERS` |
| **Property Name** | `app.max-users` |
| **Java Field** | `maxUsers` |

### Docker/Kubernetes

```yaml
# docker-compose.yml
environment:
  - APP_NAME=MyApp
  - SERVER_PORT=8080

# Kubernetes
env:
  - name: APP_NAME
    valueFrom:
      configMapKeyRef:
        name: app-config
        key: APP_NAME
```

### Best Practices

1. Use descriptive names (`DATABASE_URL`, not `URL`)
2. Provide defaults (`${PORT:8080}`)
3. Never commit secrets to git
4. Document required variables
5. Validate on startup
6. Use secrets management for production
7. Group related variables

**Next:** Command-line Arguments ‚Üí

