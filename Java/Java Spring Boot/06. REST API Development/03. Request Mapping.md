# üó∫Ô∏è Request Mapping - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [@RequestMapping Annotation](#requestmapping-annotation)
- [Shortcut Annotations](#shortcut-annotations)
- [Path Variables](#path-variables)
- [Request Parameters](#request-parameters)
- [Headers and Consumes/Produces](#headers-and-consumesproduces)
- [Multiple Mappings](#multiple-mappings)
- [Path Patterns](#path-patterns)
- [Class-Level Mapping](#class-level-mapping)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**Request Mapping** maps HTTP requests to handler methods in Spring REST controllers.

### Key Annotations

- `@RequestMapping` - Generic mapping (all HTTP methods)
- `@GetMapping` - GET requests
- `@PostMapping` - POST requests
- `@PutMapping` - PUT requests
- `@PatchMapping` - PATCH requests
- `@DeleteMapping` - DELETE requests

---

## üéØ @RequestMapping Annotation

### Basic Syntax

```java
@RequestMapping(
    value = "/path",
    method = RequestMethod.GET,
    params = "param=value",
    headers = "header=value",
    consumes = "application/json",
    produces = "application/json"
)
```

### Simple Example

```java
@RestController
public class UserController {
    
    @RequestMapping("/users")
    public List<User> getUsers() {
        return userService.findAll();
    }
}
```

### With HTTP Method

```java
@RequestMapping(value = "/users", method = RequestMethod.GET)
public List<User> getUsers() {
    return userService.findAll();
}

@RequestMapping(value = "/users", method = RequestMethod.POST)
public User createUser(@RequestBody User user) {
    return userService.save(user);
}
```

### Multiple Methods

```java
@RequestMapping(value = "/users", method = {RequestMethod.GET, RequestMethod.HEAD})
public List<User> getUsers() {
    return userService.findAll();
}
```

---

## ‚ö° Shortcut Annotations

### @GetMapping

```java
// Instead of:
@RequestMapping(value = "/users", method = RequestMethod.GET)
public List<User> getUsers() {
    return userService.findAll();
}

// Use:
@GetMapping("/users")
public List<User> getUsers() {
    return userService.findAll();
}
```

### @PostMapping

```java
@PostMapping("/users")
public User createUser(@RequestBody User user) {
    return userService.save(user);
}
```

### @PutMapping

```java
@PutMapping("/users/{id}")
public User updateUser(@PathVariable Long id, @RequestBody User user) {
    return userService.update(id, user);
}
```

### @PatchMapping

```java
@PatchMapping("/users/{id}")
public User patchUser(@PathVariable Long id, @RequestBody Map<String, Object> updates) {
    return userService.patch(id, updates);
}
```

### @DeleteMapping

```java
@DeleteMapping("/users/{id}")
public void deleteUser(@PathVariable Long id) {
    userService.delete(id);
}
```

### Complete Example

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
    
    @PutMapping("/{id}")
    public User updateUser(@PathVariable Long id, @RequestBody User user) {
        return userService.update(id, user);
    }
    
    @PatchMapping("/{id}")
    public User patchUser(@PathVariable Long id, @RequestBody Map<String, Object> updates) {
        return userService.patch(id, updates);
    }
    
    @DeleteMapping("/{id}")
    public void deleteUser(@PathVariable Long id) {
        userService.delete(id);
    }
}
```

---

## üîó Path Variables

### Single Path Variable

```java
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}
```

**Request:** `GET /users/123`

### Multiple Path Variables

```java
@GetMapping("/users/{userId}/orders/{orderId}")
public Order getOrder(
        @PathVariable Long userId,
        @PathVariable Long orderId) {
    return orderService.findByUserAndId(userId, orderId);
}
```

**Request:** `GET /users/123/orders/456`

### Named Path Variables

```java
@GetMapping("/users/{userId}")
public User getUser(@PathVariable("userId") Long id) {
    return userService.findById(id);
}
```

### Optional Path Variables

```java
@GetMapping({"/users", "/users/{id}"})
public ResponseEntity<?> getUsers(@PathVariable(required = false) Long id) {
    if (id == null) {
        return ResponseEntity.ok(userService.findAll());
    }
    return ResponseEntity.ok(userService.findById(id));
}
```

### Path Variable with Regex

```java
// Only numeric IDs
@GetMapping("/users/{id:[0-9]+}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}

// Email pattern
@GetMapping("/users/email/{email:.+@.+\\..+}")
public User getUserByEmail(@PathVariable String email) {
    return userService.findByEmail(email);
}
```

---

## üîç Request Parameters

### Single Parameter

```java
@GetMapping("/users/search")
public List<User> searchUsers(@RequestParam String name) {
    return userService.findByName(name);
}
```

**Request:** `GET /users/search?name=John`

### Multiple Parameters

```java
@GetMapping("/users/search")
public List<User> searchUsers(
        @RequestParam String name,
        @RequestParam int minAge,
        @RequestParam int maxAge) {
    return userService.search(name, minAge, maxAge);
}
```

**Request:** `GET /users/search?name=John&minAge=25&maxAge=35`

### Optional Parameters

```java
@GetMapping("/users/search")
public List<User> searchUsers(
        @RequestParam String name,
        @RequestParam(required = false) Integer minAge,
        @RequestParam(required = false) Integer maxAge) {
    return userService.search(name, minAge, maxAge);
}
```

**Request:** `GET /users/search?name=John` (minAge and maxAge are optional)

### Default Values

```java
@GetMapping("/users")
public Page<User> getUsers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size,
        @RequestParam(defaultValue = "id") String sortBy) {
    
    Pageable pageable = PageRequest.of(page, size, Sort.by(sortBy));
    return userService.findAll(pageable);
}
```

**Request:** `GET /users?page=2&size=20&sortBy=name`

### Map of Parameters

```java
@GetMapping("/users/search")
public List<User> searchUsers(@RequestParam Map<String, String> params) {
    String name = params.get("name");
    String email = params.get("email");
    Integer age = params.containsKey("age") ? Integer.parseInt(params.get("age")) : null;
    
    return userService.search(name, email, age);
}
```

### List Parameters

```java
@GetMapping("/users")
public List<User> getUsersByIds(@RequestParam List<Long> ids) {
    return userService.findByIds(ids);
}
```

**Request:** `GET /users?ids=1,2,3,4,5` or `GET /users?ids=1&ids=2&ids=3`

---

## üéõÔ∏è Headers and Consumes/Produces

### Request Headers

```java
@GetMapping("/users")
public List<User> getUsers(@RequestHeader("X-API-Version") String apiVersion) {
    if ("v2".equals(apiVersion)) {
        return userService.findAllV2();
    }
    return userService.findAll();
}
```

**Request:**
```
GET /users
X-API-Version: v2
```

### Multiple Headers

```java
@GetMapping("/users")
public List<User> getUsers(
        @RequestHeader("User-Agent") String userAgent,
        @RequestHeader(value = "X-Request-ID", required = false) String requestId) {
    logger.info("Request from: {}, ID: {}", userAgent, requestId);
    return userService.findAll();
}
```

### Header Mapping

```java
@GetMapping(value = "/users", headers = "X-API-Version=v2")
public List<User> getUsersV2() {
    return userService.findAllV2();
}

@GetMapping(value = "/users", headers = "X-API-Version=v1")
public List<User> getUsersV1() {
    return userService.findAll();
}
```

### Consumes (Content-Type)

```java
@PostMapping(value = "/users", consumes = "application/json")
public User createUserJson(@RequestBody User user) {
    return userService.save(user);
}

@PostMapping(value = "/users", consumes = "application/xml")
public User createUserXml(@RequestBody User user) {
    return userService.save(user);
}
```

### Produces (Accept Header)

```java
@GetMapping(value = "/users/{id}", produces = "application/json")
public User getUserJson(@PathVariable Long id) {
    return userService.findById(id);
}

@GetMapping(value = "/users/{id}", produces = "application/xml")
public User getUserXml(@PathVariable Long id) {
    return userService.findById(id);
}
```

### Multiple Media Types

```java
@GetMapping(value = "/users", produces = {"application/json", "application/xml"})
public List<User> getUsers() {
    return userService.findAll();
}

@PostMapping(value = "/users", consumes = {"application/json", "application/xml"})
public User createUser(@RequestBody User user) {
    return userService.save(user);
}
```

---

## üî¢ Multiple Mappings

### Multiple Paths

```java
@GetMapping({"/users", "/members", "/accounts"})
public List<User> getUsers() {
    return userService.findAll();
}
```

**Requests:**
- `GET /users`
- `GET /members`
- `GET /accounts`

### Multiple Methods for Same Path

```java
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}

@DeleteMapping("/users/{id}")
public void deleteUser(@PathVariable Long id) {
    userService.delete(id);
}
```

### Method Overloading with Different Parameters

```java
@GetMapping("/users")
public List<User> getAllUsers() {
    return userService.findAll();
}

@GetMapping("/users")
public List<User> searchUsers(@RequestParam String name) {
    return userService.findByName(name);
}
```

---

## üé® Path Patterns

### Wildcard (?)

```java
// Matches: /files/a, /files/b, /files/1
@GetMapping("/files/?")
public String getFile(@PathVariable String filename) {
    return "File: " + filename;
}
```

### Asterisk (*)

```java
// Matches: /files/abc, /files/test.txt
@GetMapping("/files/*")
public String getFile() {
    return "File handler";
}

// Matches: /static/css/style.css, /static/js/app.js
@GetMapping("/static/*/style.css")
public String getStyle() {
    return "Style file";
}
```

### Double Asterisk (**)

```java
// Matches: /docs/file.pdf, /docs/sub/file.pdf, /docs/a/b/c/file.pdf
@GetMapping("/docs/**")
public String getDocs() {
    return "Documentation";
}
```

### Ant-style Patterns

```java
// Matches: /users/123, /users/abc
@GetMapping("/users/*")
public User getUser() { }

// Matches: /users/123/orders/456, /users/123/products/789/reviews/1
@GetMapping("/users/**/orders/*")
public List<Order> getOrders() { }

// Matches: /files/test, /files/t, /files/txt
@GetMapping("/files/t?st")
public String getFile() { }
```

### Path Variable with Pattern

```java
@GetMapping("/users/{id:[0-9]+}")
public User getUser(@PathVariable Long id) {
    return userService.findById(id);
}

@GetMapping("/files/{filename:.+}")
public Resource getFile(@PathVariable String filename) {
    return fileService.getFile(filename);
}
```

---

## üè¢ Class-Level Mapping

### Base Path

```java
@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    // GET /api/v1/users
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    // GET /api/v1/users/{id}
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // POST /api/v1/users
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
}
```

### Multiple Base Paths

```java
@RestController
@RequestMapping({"/api/users", "/api/v1/users"})
public class UserController {
    
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
}
```

**Accessible at:**
- `GET /api/users`
- `GET /api/v1/users`

### Combining Class and Method Mappings

```java
@RestController
@RequestMapping("/api")
public class ApiController {
    
    // GET /api/users
    @GetMapping("/users")
    public List<User> getUsers() {
        return userService.findAll();
    }
    
    // GET /api/products
    @GetMapping("/products")
    public List<Product> getProducts() {
        return productService.findAll();
    }
}
```

### Headers and Produces at Class Level

```java
@RestController
@RequestMapping(
    value = "/api/users",
    produces = "application/json",
    consumes = "application/json"
)
public class UserController {
    
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
}
```

---

## üìå Best Practices

### 1. Use HTTP Method-Specific Annotations

```java
// ‚úÖ Clear and concise
@GetMapping("/users")
@PostMapping("/users")
@PutMapping("/users/{id}")
@DeleteMapping("/users/{id}")

// ‚ùå Verbose
@RequestMapping(value = "/users", method = RequestMethod.GET)
@RequestMapping(value = "/users", method = RequestMethod.POST)
```

### 2. Use RESTful URLs

```java
// ‚úÖ RESTful
@GetMapping("/users")
@GetMapping("/users/{id}")
@GetMapping("/users/{userId}/orders")
@PostMapping("/users")

// ‚ùå Non-RESTful
@GetMapping("/getAllUsers")
@GetMapping("/getUserById")
@GetMapping("/getOrdersForUser")
@PostMapping("/createUser")
```

### 3. Version Your API

```java
// ‚úÖ Versioned API
@RestController
@RequestMapping("/api/v1/users")
public class UserControllerV1 {
}

@RestController
@RequestMapping("/api/v2/users")
public class UserControllerV2 {
}
```

### 4. Use Meaningful Path Variables

```java
// ‚úÖ Descriptive
@GetMapping("/users/{userId}/orders/{orderId}")
public Order getOrder(@PathVariable Long userId, @PathVariable Long orderId) { }

// ‚ùå Ambiguous
@GetMapping("/users/{id1}/orders/{id2}")
public Order getOrder(@PathVariable Long id1, @PathVariable Long id2) { }
```

### 5. Use Query Parameters for Filtering

```java
// ‚úÖ Query parameters for filters
@GetMapping("/users")
public List<User> getUsers(
        @RequestParam(required = false) String name,
        @RequestParam(required = false) Integer minAge,
        @RequestParam(required = false) Integer maxAge,
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {
    return userService.search(name, minAge, maxAge, page, size);
}

// ‚ùå Too many path variables
@GetMapping("/users/{name}/{minAge}/{maxAge}")
public List<User> getUsers(@PathVariable String name, 
                            @PathVariable int minAge, 
                            @PathVariable int maxAge) { }
```

### 6. Use Proper HTTP Status Codes

```java
@GetMapping("/{id}")
public ResponseEntity<User> getUser(@PathVariable Long id) {
    return userService.findById(id)
        .map(ResponseEntity::ok)                    // 200 OK
        .orElse(ResponseEntity.notFound().build()); // 404 Not Found
}

@PostMapping
public ResponseEntity<User> createUser(@RequestBody User user) {
    User created = userService.save(user);
    return ResponseEntity
        .status(HttpStatus.CREATED)                 // 201 Created
        .body(created);
}
```

### 7. Document Path Variables and Parameters

```java
@GetMapping("/{id}")
@Operation(summary = "Get user by ID")
public User getUser(
        @Parameter(description = "User ID", required = true, example = "123")
        @PathVariable Long id) {
    return userService.findById(id);
}

@GetMapping("/search")
public List<User> searchUsers(
        @Parameter(description = "User name to search", example = "John")
        @RequestParam String name,
        
        @Parameter(description = "Minimum age", example = "18")
        @RequestParam(required = false) Integer minAge) {
    return userService.search(name, minAge);
}
```

---

## üé§ Interview Questions

### Q1: What is @RequestMapping?
**Answer:** Annotation that maps HTTP requests to handler methods. Can specify path, HTTP method, headers, params, consumes, and produces.

### Q2: Difference between @RequestMapping and @GetMapping?
**Answer:**
- **@RequestMapping**: Generic, requires `method` parameter
- **@GetMapping**: Shortcut for GET requests only, more concise

### Q3: What are shortcut mapping annotations?
**Answer:** @GetMapping, @PostMapping, @PutMapping, @PatchMapping, @DeleteMapping - HTTP method-specific shortcuts for @RequestMapping.

### Q4: How to map multiple paths to same method?
**Answer:**
```java
@GetMapping({"/users", "/members"})
public List<User> getUsers() { }
```

### Q5: What is @PathVariable?
**Answer:** Extracts values from URI path:
```java
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) { }
```

### Q6: What is @RequestParam?
**Answer:** Extracts query parameters:
```java
@GetMapping("/users")
public List<User> getUsers(@RequestParam String name) { }
```

### Q7: Difference between @PathVariable and @RequestParam?
**Answer:**
- **@PathVariable**: From URI path (`/users/123`)
- **@RequestParam**: From query string (`/users?id=123`)

### Q8: How to make parameter optional?
**Answer:**
```java
@RequestParam(required = false) String name
// Or
@RequestParam(defaultValue = "default") String name
```

### Q9: What is consumes in @RequestMapping?
**Answer:** Specifies Content-Type that method can consume (accept):
```java
@PostMapping(consumes = "application/json")
```

### Q10: What is produces in @RequestMapping?
**Answer:** Specifies Content-Type that method can produce (return):
```java
@GetMapping(produces = "application/json")
```

---

## üìö Summary

### Mapping Annotations

```java
// Generic
@RequestMapping(value = "/users", method = RequestMethod.GET)

// HTTP-specific shortcuts
@GetMapping("/users")
@PostMapping("/users")
@PutMapping("/users/{id}")
@PatchMapping("/users/{id}")
@DeleteMapping("/users/{id}")
```

### Path Variables

```java
@GetMapping("/users/{id}")
public User getUser(@PathVariable Long id) { }

@GetMapping("/users/{userId}/orders/{orderId}")
public Order getOrder(@PathVariable Long userId, @PathVariable Long orderId) { }
```

### Request Parameters

```java
@GetMapping("/users")
public List<User> getUsers(
    @RequestParam String name,
    @RequestParam(required = false) Integer age,
    @RequestParam(defaultValue = "0") int page
) { }
```

### Complete Example

```java
@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    @GetMapping
    public List<User> getAllUsers(
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size) {
        return userService.findAll(page, size);
    }
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        return userService.findById(id)
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }
    
    @GetMapping("/search")
    public List<User> searchUsers(
            @RequestParam String name,
            @RequestParam(required = false) Integer minAge) {
        return userService.search(name, minAge);
    }
    
    @PostMapping(consumes = "application/json", produces = "application/json")
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User created = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(
            @PathVariable Long id,
            @RequestBody User user) {
        return userService.update(id, user)
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }
    
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
}
```

**Next:** Path Variables & Query Parameters ‚Üí

