# üéÆ RestController Basics - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [What is REST](#what-is-rest)
- [@RestController Annotation](#restcontroller-annotation)
- [@Controller vs @RestController](#controller-vs-restcontroller)
- [Creating First REST API](#creating-first-rest-api)
- [JSON Serialization](#json-serialization)
- [Response Structure](#response-structure)
- [Exception Handling](#exception-handling)
- [Testing REST Controllers](#testing-rest-controllers)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**@RestController** is a specialized controller annotation for building RESTful web services in Spring Boot.

### Benefits

- ‚úÖ **Simplified REST development**: Combines @Controller and @ResponseBody
- ‚úÖ **Automatic JSON conversion**: No manual serialization needed
- ‚úÖ **Clean API design**: Focused on data exchange
- ‚úÖ **HTTP-centric**: Works directly with HTTP methods
- ‚úÖ **Convention over configuration**: Minimal boilerplate

---

## üåê What is REST

### REST Principles

**REST** (Representational State Transfer) - Architectural style for distributed systems.

**Key Constraints:**

1. **Client-Server**: Separation of concerns
2. **Stateless**: Each request contains all information needed
3. **Cacheable**: Responses can be cached
4. **Uniform Interface**: Standard HTTP methods
5. **Layered System**: Client doesn't know server architecture
6. **Code on Demand** (optional): Server can send executable code

### RESTful API Characteristics

```
Resource-based:     /users, /products, /orders
HTTP Methods:       GET, POST, PUT, DELETE, PATCH
Stateless:          No session state on server
JSON/XML:           Standard data formats
HTTP Status Codes:  200, 201, 404, 500, etc.
```

### REST vs Traditional Web

| Feature | Traditional MVC | REST API |
|---------|----------------|----------|
| **Response** | HTML pages | JSON/XML data |
| **State** | Server-side sessions | Stateless |
| **View** | Server-side templates | Client renders |
| **Primary Use** | Browser applications | APIs, mobile apps |
| **Content Type** | text/html | application/json |

---

## üéØ @RestController Annotation

### Basic Definition

```java
@RestController
public class UserController {
    
    @GetMapping("/users")
    public List<User> getAllUsers() {
        return userService.findAll();
    }
}
```

### What @RestController Does

```java
// @RestController is equivalent to:
@Controller
@ResponseBody
public class UserController {
    // Methods
}
```

**Breakdown:**
- `@Controller`: Marks as Spring MVC controller
- `@ResponseBody`: Serializes return values to HTTP response body (JSON/XML)

### Complete Example

```java
@RestController
@RequestMapping("/api/v1")
public class ProductController {
    
    @Autowired
    private ProductService productService;
    
    @GetMapping("/products")
    public List<Product> getAllProducts() {
        return productService.findAll();
    }
    
    @GetMapping("/products/{id}")
    public Product getProduct(@PathVariable Long id) {
        return productService.findById(id);
    }
    
    @PostMapping("/products")
    public Product createProduct(@RequestBody Product product) {
        return productService.save(product);
    }
    
    @PutMapping("/products/{id}")
    public Product updateProduct(@PathVariable Long id, @RequestBody Product product) {
        return productService.update(id, product);
    }
    
    @DeleteMapping("/products/{id}")
    public void deleteProduct(@PathVariable Long id) {
        productService.delete(id);
    }
}
```

---

## üÜö @Controller vs @RestController

### @Controller (Traditional MVC)

```java
@Controller
public class WebController {
    
    // Returns view name (HTML page)
    @GetMapping("/home")
    public String home(Model model) {
        model.addAttribute("message", "Welcome");
        return "home";  // Returns view name (home.html)
    }
    
    // Returns JSON (needs @ResponseBody)
    @GetMapping("/api/data")
    @ResponseBody
    public Data getData() {
        return new Data("value");  // Serialized to JSON
    }
}
```

### @RestController (REST API)

```java
@RestController
public class ApiController {
    
    // All methods automatically return JSON
    @GetMapping("/api/users")
    public List<User> getUsers() {
        return userService.findAll();  // Automatically serialized to JSON
    }
    
    @GetMapping("/api/users/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);  // Automatically serialized to JSON
    }
}
```

### Comparison Table

| Feature | @Controller | @RestController |
|---------|-------------|----------------|
| **Purpose** | Web pages (MVC) | REST APIs |
| **Default Response** | View name (HTML) | JSON/XML data |
| **@ResponseBody** | Required per method | Automatic for all |
| **Return Type** | String (view name) | Objects (serialized) |
| **Content-Type** | text/html | application/json |
| **Use Case** | Traditional web apps | APIs, microservices |

### Mixed Approach

```java
@Controller
public class HybridController {
    
    // Returns HTML view
    @GetMapping("/dashboard")
    public String dashboard(Model model) {
        return "dashboard";
    }
    
    // Returns JSON data
    @GetMapping("/api/stats")
    @ResponseBody
    public Stats getStats() {
        return statsService.getStats();
    }
}
```

---

## üöÄ Creating First REST API

### Step 1: Create Model

```java
public class User {
    private Long id;
    private String name;
    private String email;
    private int age;
    
    // Constructors
    public User() {}
    
    public User(Long id, String name, String email, int age) {
        this.id = id;
        this.name = name;
        this.email = email;
        this.age = age;
    }
    
    // Getters and Setters
    public Long getId() {
        return id;
    }
    
    public void setId(Long id) {
        this.id = id;
    }
    
    public String getName() {
        return name;
    }
    
    public void setName(String name) {
        this.name = name;
    }
    
    public String getEmail() {
        return email;
    }
    
    public void setEmail(String email) {
        this.email = email;
    }
    
    public int getAge() {
        return age;
    }
    
    public void setAge(int age) {
        this.age = age;
    }
}
```

### Step 2: Create Service

```java
@Service
public class UserService {
    
    private List<User> users = new ArrayList<>();
    private AtomicLong counter = new AtomicLong();
    
    public UserService() {
        // Initialize with sample data
        users.add(new User(counter.incrementAndGet(), "John Doe", "john@example.com", 30));
        users.add(new User(counter.incrementAndGet(), "Jane Smith", "jane@example.com", 25));
    }
    
    public List<User> findAll() {
        return new ArrayList<>(users);
    }
    
    public User findById(Long id) {
        return users.stream()
            .filter(user -> user.getId().equals(id))
            .findFirst()
            .orElse(null);
    }
    
    public User save(User user) {
        user.setId(counter.incrementAndGet());
        users.add(user);
        return user;
    }
    
    public User update(Long id, User updatedUser) {
        User user = findById(id);
        if (user != null) {
            user.setName(updatedUser.getName());
            user.setEmail(updatedUser.getEmail());
            user.setAge(updatedUser.getAge());
            return user;
        }
        return null;
    }
    
    public boolean delete(Long id) {
        return users.removeIf(user -> user.getId().equals(id));
    }
}
```

### Step 3: Create REST Controller

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    // GET all users
    @GetMapping
    public List<User> getAllUsers() {
        return userService.findAll();
    }
    
    // GET user by ID
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        return userService.findById(id);
    }
    
    // POST create user
    @PostMapping
    public User createUser(@RequestBody User user) {
        return userService.save(user);
    }
    
    // PUT update user
    @PutMapping("/{id}")
    public User updateUser(@PathVariable Long id, @RequestBody User user) {
        return userService.update(id, user);
    }
    
    // DELETE user
    @DeleteMapping("/{id}")
    public void deleteUser(@PathVariable Long id) {
        userService.delete(id);
    }
}
```

### Step 4: Test API

```bash
# GET all users
curl http://localhost:8080/api/users

# GET user by ID
curl http://localhost:8080/api/users/1

# POST create user
curl -X POST http://localhost:8080/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Bob Wilson","email":"bob@example.com","age":35}'

# PUT update user
curl -X PUT http://localhost:8080/api/users/1 \
  -H "Content-Type: application/json" \
  -d '{"name":"John Updated","email":"john.new@example.com","age":31}'

# DELETE user
curl -X DELETE http://localhost:8080/api/users/1
```

---

## üìÑ JSON Serialization

### Jackson (Default JSON Library)

Spring Boot uses **Jackson** for JSON serialization/deserialization.

### Automatic Serialization

```java
@RestController
public class ProductController {
    
    @GetMapping("/api/product")
    public Product getProduct() {
        Product product = new Product();
        product.setId(1L);
        product.setName("Laptop");
        product.setPrice(999.99);
        return product;  // Automatically converted to JSON
    }
}
```

**Response:**
```json
{
  "id": 1,
  "name": "Laptop",
  "price": 999.99
}
```

### Jackson Annotations

```java
public class User {
    
    @JsonProperty("user_id")
    private Long id;
    
    @JsonProperty("full_name")
    private String name;
    
    @JsonIgnore
    private String password;  // Excluded from JSON
    
    @JsonFormat(pattern = "yyyy-MM-dd")
    private LocalDate birthDate;
    
    @JsonInclude(JsonInclude.Include.NON_NULL)
    private String middleName;  // Only included if not null
    
    // Getters and setters
}
```

**JSON Output:**
```json
{
  "user_id": 1,
  "full_name": "John Doe",
  "birthDate": "1990-05-15"
}
```

### Custom Serialization

```java
public class CustomDateSerializer extends JsonSerializer<LocalDate> {
    
    @Override
    public void serialize(LocalDate value, JsonGenerator gen, SerializerProvider serializers) 
            throws IOException {
        gen.writeString(value.format(DateTimeFormatter.ISO_DATE));
    }
}

public class User {
    
    @JsonSerialize(using = CustomDateSerializer.class)
    private LocalDate birthDate;
}
```

### Configuration

```yaml
# application.yml
spring:
  jackson:
    serialization:
      indent-output: true
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
    default-property-inclusion: non_null
```

---

## üì¶ Response Structure

### Simple Response

```java
@GetMapping("/api/message")
public String getMessage() {
    return "Hello, World!";
}
```

**Response:**
```
Hello, World!
```

### Object Response

```java
@GetMapping("/api/user")
public User getUser() {
    return new User(1L, "John", "john@example.com", 30);
}
```

**Response:**
```json
{
  "id": 1,
  "name": "John",
  "email": "john@example.com",
  "age": 30
}
```

### List Response

```java
@GetMapping("/api/users")
public List<User> getUsers() {
    return Arrays.asList(
        new User(1L, "John", "john@example.com", 30),
        new User(2L, "Jane", "jane@example.com", 25)
    );
}
```

**Response:**
```json
[
  {
    "id": 1,
    "name": "John",
    "email": "john@example.com",
    "age": 30
  },
  {
    "id": 2,
    "name": "Jane",
    "email": "jane@example.com",
    "age": 25
  }
]
```

### Map Response

```java
@GetMapping("/api/config")
public Map<String, Object> getConfig() {
    Map<String, Object> config = new HashMap<>();
    config.put("appName", "MyApp");
    config.put("version", "1.0.0");
    config.put("maxUsers", 100);
    return config;
}
```

**Response:**
```json
{
  "appName": "MyApp",
  "version": "1.0.0",
  "maxUsers": 100
}
```

### Wrapper Response

```java
public class ApiResponse<T> {
    private boolean success;
    private String message;
    private T data;
    
    // Constructors, getters, setters
}

@GetMapping("/api/user/{id}")
public ApiResponse<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    return new ApiResponse<>(true, "User found", user);
}
```

**Response:**
```json
{
  "success": true,
  "message": "User found",
  "data": {
    "id": 1,
    "name": "John",
    "email": "john@example.com",
    "age": 30
  }
}
```

---

## ‚ö†Ô∏è Exception Handling

### Basic Exception Handling

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            throw new ResponseStatusException(
                HttpStatus.NOT_FOUND, 
                "User not found with id: " + id
            );
        }
        return user;
    }
}
```

### Custom Exception

```java
public class UserNotFoundException extends RuntimeException {
    public UserNotFoundException(Long id) {
        super("User not found with id: " + id);
    }
}
```

### @ExceptionHandler

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public User getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            throw new UserNotFoundException(id);
        }
        return user;
    }
    
    @ExceptionHandler(UserNotFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public Map<String, String> handleUserNotFound(UserNotFoundException ex) {
        Map<String, String> error = new HashMap<>();
        error.put("error", "Not Found");
        error.put("message", ex.getMessage());
        return error;
    }
}
```

### Global Exception Handler

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    
    @ExceptionHandler(UserNotFoundException.class)
    @ResponseStatus(HttpStatus.NOT_FOUND)
    public ErrorResponse handleUserNotFound(UserNotFoundException ex) {
        return new ErrorResponse(
            HttpStatus.NOT_FOUND.value(),
            ex.getMessage(),
            LocalDateTime.now()
        );
    }
    
    @ExceptionHandler(Exception.class)
    @ResponseStatus(HttpStatus.INTERNAL_SERVER_ERROR)
    public ErrorResponse handleGenericException(Exception ex) {
        return new ErrorResponse(
            HttpStatus.INTERNAL_SERVER_ERROR.value(),
            "An error occurred",
            LocalDateTime.now()
        );
    }
}

public class ErrorResponse {
    private int status;
    private String message;
    private LocalDateTime timestamp;
    
    // Constructor, getters, setters
}
```

---

## üß™ Testing REST Controllers

### Unit Test with MockMvc

```java
@WebMvcTest(UserController.class)
class UserControllerTest {
    
    @Autowired
    private MockMvc mockMvc;
    
    @MockBean
    private UserService userService;
    
    @Test
    void getAllUsers_ReturnsUserList() throws Exception {
        // Given
        List<User> users = Arrays.asList(
            new User(1L, "John", "john@example.com", 30),
            new User(2L, "Jane", "jane@example.com", 25)
        );
        when(userService.findAll()).thenReturn(users);
        
        // When & Then
        mockMvc.perform(get("/api/users"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$").isArray())
            .andExpect(jsonPath("$[0].name").value("John"))
            .andExpect(jsonPath("$[1].name").value("Jane"));
    }
    
    @Test
    void getUser_WhenExists_ReturnsUser() throws Exception {
        // Given
        User user = new User(1L, "John", "john@example.com", 30);
        when(userService.findById(1L)).thenReturn(user);
        
        // When & Then
        mockMvc.perform(get("/api/users/1"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(1))
            .andExpect(jsonPath("$.name").value("John"));
    }
    
    @Test
    void createUser_ReturnsCreatedUser() throws Exception {
        // Given
        User user = new User(null, "Bob", "bob@example.com", 35);
        User savedUser = new User(3L, "Bob", "bob@example.com", 35);
        when(userService.save(any(User.class))).thenReturn(savedUser);
        
        // When & Then
        mockMvc.perform(post("/api/users")
                .contentType(MediaType.APPLICATION_JSON)
                .content("{\"name\":\"Bob\",\"email\":\"bob@example.com\",\"age\":35}"))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.id").value(3))
            .andExpect(jsonPath("$.name").value("Bob"));
    }
}
```

### Integration Test

```java
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class UserControllerIntegrationTest {
    
    @Autowired
    private TestRestTemplate restTemplate;
    
    @Test
    void getAllUsers_ReturnsUserList() {
        // When
        ResponseEntity<User[]> response = restTemplate.getForEntity("/api/users", User[].class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody()).isNotNull();
        assertThat(response.getBody().length).isGreaterThan(0);
    }
    
    @Test
    void createUser_ReturnsCreatedUser() {
        // Given
        User newUser = new User(null, "Test User", "test@example.com", 28);
        
        // When
        ResponseEntity<User> response = restTemplate.postForEntity("/api/users", newUser, User.class);
        
        // Then
        assertThat(response.getStatusCode()).isEqualTo(HttpStatus.OK);
        assertThat(response.getBody()).isNotNull();
        assertThat(response.getBody().getId()).isNotNull();
        assertThat(response.getBody().getName()).isEqualTo("Test User");
    }
}
```

---

## üìå Best Practices

### 1. Use Proper HTTP Methods

```java
// ‚úÖ Correct
@GetMapping("/users")           // Retrieve
@PostMapping("/users")          // Create
@PutMapping("/users/{id}")      // Update (full)
@PatchMapping("/users/{id}")    // Update (partial)
@DeleteMapping("/users/{id}")   // Delete

// ‚ùå Incorrect
@GetMapping("/createUser")
@GetMapping("/deleteUser/{id}")
```

### 2. Use Meaningful URLs

```java
// ‚úÖ RESTful URLs
@GetMapping("/api/users")
@GetMapping("/api/users/{id}")
@GetMapping("/api/users/{id}/orders")

// ‚ùå Non-RESTful URLs
@GetMapping("/api/getAllUsers")
@GetMapping("/api/getUserById")
@GetMapping("/api/getOrdersForUser")
```

### 3. Version Your API

```java
// ‚úÖ Versioned
@RestController
@RequestMapping("/api/v1/users")
public class UserControllerV1 {
}

@RestController
@RequestMapping("/api/v2/users")
public class UserControllerV2 {
}

// ‚ùå No versioning
@RestController
@RequestMapping("/api/users")
public class UserController {
}
```

### 4. Return Appropriate Status Codes

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        if (user == null) {
            return ResponseEntity.notFound().build();  // 404
        }
        return ResponseEntity.ok(user);  // 200
    }
    
    @PostMapping
    public ResponseEntity<User> createUser(@RequestBody User user) {
        User created = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);  // 201
    }
    
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();  // 204
    }
}
```

### 5. Use DTOs (Data Transfer Objects)

```java
// ‚úÖ Use DTOs
public class UserDTO {
    private Long id;
    private String name;
    private String email;
    // No password field
}

@PostMapping("/users")
public UserDTO createUser(@RequestBody UserCreateDTO dto) {
    User user = userService.create(dto);
    return UserMapper.toDTO(user);
}

// ‚ùå Expose entities directly
@PostMapping("/users")
public User createUser(@RequestBody User user) {
    return userService.save(user);  // May expose sensitive fields
}
```

### 6. Validate Input

```java
public class UserCreateDTO {
    
    @NotBlank(message = "Name is required")
    @Size(min = 2, max = 50)
    private String name;
    
    @NotBlank(message = "Email is required")
    @Email(message = "Invalid email format")
    private String email;
    
    @Min(value = 18, message = "Age must be at least 18")
    @Max(value = 120, message = "Age must be less than 120")
    private int age;
    
    // Getters and setters
}

@PostMapping("/users")
public UserDTO createUser(@Valid @RequestBody UserCreateDTO dto) {
    User user = userService.create(dto);
    return UserMapper.toDTO(user);
}
```

### 7. Document Your API

```java
@RestController
@RequestMapping("/api/v1/users")
@Tag(name = "User Management", description = "APIs for managing users")
public class UserController {
    
    @Operation(summary = "Get all users", description = "Retrieve a list of all users")
    @ApiResponses({
        @ApiResponse(responseCode = "200", description = "Successfully retrieved users"),
        @ApiResponse(responseCode = "500", description = "Internal server error")
    })
    @GetMapping
    public List<UserDTO> getAllUsers() {
        return userService.findAll();
    }
}
```

---

## üé§ Interview Questions

### Q1: What is @RestController?
**Answer:** Specialized controller annotation that combines @Controller and @ResponseBody. All methods automatically serialize return values to JSON/XML.

### Q2: Difference between @Controller and @RestController?
**Answer:**
- **@Controller**: Returns view names (HTML), needs @ResponseBody for JSON
- **@RestController**: Automatically returns JSON/XML for all methods

### Q3: What library does Spring Boot use for JSON serialization?
**Answer:** **Jackson** - automatically converts Java objects to JSON and vice versa.

### Q4: How to exclude a field from JSON response?
**Answer:**
```java
@JsonIgnore
private String password;
```

### Q5: How to handle exceptions in REST controller?
**Answer:** Use @ExceptionHandler in controller or @RestControllerAdvice for global handling.

### Q6: What are REST principles?
**Answer:** Client-Server, Stateless, Cacheable, Uniform Interface, Layered System, Code on Demand (optional).

### Q7: How to return different HTTP status codes?
**Answer:**
```java
return ResponseEntity.ok(user);              // 200
return ResponseEntity.status(HttpStatus.CREATED).body(user);  // 201
return ResponseEntity.notFound().build();    // 404
```

### Q8: What is content negotiation?
**Answer:** Process of selecting appropriate representation (JSON, XML) based on client's Accept header.

### Q9: How to test REST controllers?
**Answer:** Use MockMvc for unit tests, TestRestTemplate for integration tests.

### Q10: Best practices for REST API URLs?
**Answer:**
- Use nouns, not verbs (`/users`, not `/getUsers`)
- Use plural for collections (`/users`, not `/user`)
- Version API (`/api/v1/users`)
- Use hierarchy (`/users/{id}/orders`)

---

## üìö Summary

### Key Concepts

**@RestController:**
- Combines @Controller and @ResponseBody
- Automatic JSON/XML serialization
- Simplified REST API development

**Response Types:**
- Simple: String, primitives
- Objects: Automatically serialized
- Collections: Lists, Sets, Maps
- Wrapper: Custom response structures

**Exception Handling:**
- @ExceptionHandler for local handling
- @RestControllerAdvice for global handling
- ResponseStatusException for quick exceptions

### Complete Example

```java
@RestController
@RequestMapping("/api/v1/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @GetMapping
    public ResponseEntity<List<User>> getAllUsers() {
        return ResponseEntity.ok(userService.findAll());
    }
    
    @GetMapping("/{id}")
    public ResponseEntity<User> getUser(@PathVariable Long id) {
        return userService.findById(id)
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }
    
    @PostMapping
    public ResponseEntity<User> createUser(@Valid @RequestBody User user) {
        User created = userService.save(user);
        return ResponseEntity.status(HttpStatus.CREATED).body(created);
    }
    
    @PutMapping("/{id}")
    public ResponseEntity<User> updateUser(@PathVariable Long id, @Valid @RequestBody User user) {
        return userService.update(id, user)
            .map(ResponseEntity::ok)
            .orElse(ResponseEntity.notFound().build());
    }
    
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
}
```

**Next:** HTTP Methods ‚Üí

