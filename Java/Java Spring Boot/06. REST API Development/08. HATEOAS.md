# üîó HATEOAS - Complete Guide

## üìã Table of Contents
- [Introduction](#introduction)
- [What is HATEOAS](#what-is-hateoas)
- [Spring HATEOAS Setup](#spring-hateoas-setup)
- [Creating Links](#creating-links)
- [RepresentationModel](#representationmodel)
- [EntityModel](#entitymodel)
- [CollectionModel](#collectionmodel)
- [HAL Format](#hal-format)
- [Link Relations](#link-relations)
- [Best Practices](#best-practices)
- [Interview Questions](#interview-questions)

---

## üéØ Introduction

**HATEOAS** (Hypermedia As The Engine Of Application State) is a constraint of REST architecture where responses include links to related resources.

### Benefits

- **Discoverability**: Clients discover available actions
- **Self-documenting**: API tells clients what they can do
- **Decoupling**: Client doesn't need to hardcode URLs
- **Navigation**: Easy navigation between related resources

---

## üìö What is HATEOAS

### Without HATEOAS

```json
{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com"
}
```

Client needs to know:
- How to get orders: `/users/123/orders`
- How to update: `PUT /users/123`
- How to delete: `DELETE /users/123`

### With HATEOAS

```json
{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com",
  "_links": {
    "self": {
      "href": "http://localhost:8080/users/123"
    },
    "orders": {
      "href": "http://localhost:8080/users/123/orders"
    },
    "update": {
      "href": "http://localhost:8080/users/123"
    },
    "delete": {
      "href": "http://localhost:8080/users/123"
    }
  }
}
```

Client discovers available actions from response!

---

## üõ†Ô∏è Spring HATEOAS Setup

### Dependencies

```xml
<!-- pom.xml -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-hateoas</artifactId>
</dependency>
```

### Basic Configuration

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

No additional configuration needed! Spring Boot auto-configures HATEOAS.

---

## üîó Creating Links

### WebMvcLinkBuilder

```java
import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.*;

@GetMapping("/users/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    // Create self link
    Link selfLink = linkTo(methodOn(UserController.class).getUser(id)).withSelfRel();
    
    // Create other links
    Link ordersLink = linkTo(methodOn(UserController.class).getUserOrders(id)).withRel("orders");
    Link updateLink = linkTo(methodOn(UserController.class).updateUser(id, null)).withRel("update");
    Link deleteLink = linkTo(methodOn(UserController.class).deleteUser(id)).withRel("delete");
    
    return EntityModel.of(user, selfLink, ordersLink, updateLink, deleteLink);
}
```

### Manual Link Creation

```java
@GetMapping("/users/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    Link selfLink = Link.of("/users/" + id).withSelfRel();
    Link ordersLink = Link.of("/users/" + id + "/orders").withRel("orders");
    
    return EntityModel.of(user, selfLink, ordersLink);
}
```

### Link Types

```java
// Self link
Link selfLink = linkTo(UserController.class).slash(id).withSelfRel();

// Named relation
Link ordersLink = linkTo(methodOn(UserController.class).getUserOrders(id)).withRel("orders");

// Custom relation
Link customLink = linkTo(...).withRel("custom-action");

// Templated link
Link searchLink = Link.of("/users{?name,email}").withRel("search");
```

---

## üé≠ RepresentationModel

### Basic Usage

```java
public class UserModel extends RepresentationModel<UserModel> {
    private Long id;
    private String name;
    private String email;
    
    // Getters and setters
}

@GetMapping("/users/{id}")
public UserModel getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    UserModel model = new UserModel();
    model.setId(user.getId());
    model.setName(user.getName());
    model.setEmail(user.getEmail());
    
    // Add links
    model.add(linkTo(methodOn(UserController.class).getUser(id)).withSelfRel());
    model.add(linkTo(methodOn(UserController.class).getUserOrders(id)).withRel("orders"));
    
    return model;
}
```

### Response

```json
{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com",
  "_links": {
    "self": {
      "href": "http://localhost:8080/users/123"
    },
    "orders": {
      "href": "http://localhost:8080/users/123/orders"
    }
  }
}
```

---

## üì¶ EntityModel

### Basic Usage

```java
@GetMapping("/users/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    return EntityModel.of(user,
        linkTo(methodOn(UserController.class).getUser(id)).withSelfRel(),
        linkTo(methodOn(UserController.class).getUserOrders(id)).withRel("orders")
    );
}
```

### With Assembler

```java
@Component
public class UserModelAssembler implements RepresentationModelAssembler<User, EntityModel<User>> {
    
    @Override
    public EntityModel<User> toModel(User user) {
        return EntityModel.of(user,
            linkTo(methodOn(UserController.class).getUser(user.getId())).withSelfRel(),
            linkTo(methodOn(UserController.class).getUserOrders(user.getId())).withRel("orders"),
            linkTo(methodOn(UserController.class).getAllUsers()).withRel("users")
        );
    }
}

// Controller
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserModelAssembler assembler;
    
    @GetMapping("/{id}")
    public EntityModel<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id);
        return assembler.toModel(user);
    }
}
```

---

## üìö CollectionModel

### Basic Usage

```java
@GetMapping("/users")
public CollectionModel<EntityModel<User>> getAllUsers() {
    List<EntityModel<User>> users = userService.findAll().stream()
        .map(user -> EntityModel.of(user,
            linkTo(methodOn(UserController.class).getUser(user.getId())).withSelfRel(),
            linkTo(methodOn(UserController.class).getUserOrders(user.getId())).withRel("orders")
        ))
        .collect(Collectors.toList());
    
    return CollectionModel.of(users,
        linkTo(methodOn(UserController.class).getAllUsers()).withSelfRel()
    );
}
```

### Response

```json
{
  "_embedded": {
    "userList": [
      {
        "id": 1,
        "name": "John Doe",
        "email": "john@example.com",
        "_links": {
          "self": {"href": "http://localhost:8080/users/1"},
          "orders": {"href": "http://localhost:8080/users/1/orders"}
        }
      },
      {
        "id": 2,
        "name": "Jane Smith",
        "email": "jane@example.com",
        "_links": {
          "self": {"href": "http://localhost:8080/users/2"},
          "orders": {"href": "http://localhost:8080/users/2/orders"}
        }
      }
    ]
  },
  "_links": {
    "self": {"href": "http://localhost:8080/users"}
  }
}
```

### With Assembler

```java
@GetMapping("/users")
public CollectionModel<EntityModel<User>> getAllUsers() {
    List<EntityModel<User>> users = userService.findAll().stream()
        .map(assembler::toModel)
        .collect(Collectors.toList());
    
    return CollectionModel.of(users,
        linkTo(methodOn(UserController.class).getAllUsers()).withSelfRel()
    );
}
```

---

## üé® HAL Format

### HAL (Hypertext Application Language)

Default format used by Spring HATEOAS.

### Single Resource

```json
{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com",
  "_links": {
    "self": {
      "href": "http://localhost:8080/users/123"
    },
    "orders": {
      "href": "http://localhost:8080/users/123/orders"
    }
  }
}
```

### Collection

```json
{
  "_embedded": {
    "userList": [
      {
        "id": 1,
        "name": "John Doe",
        "_links": {
          "self": {"href": "/users/1"}
        }
      }
    ]
  },
  "_links": {
    "self": {"href": "/users"}
  }
}
```

### Embedded Resources

```java
@Data
public class OrderModel extends RepresentationModel<OrderModel> {
    private Long id;
    private String orderNumber;
    private BigDecimal total;
}

@GetMapping("/users/{id}")
public EntityModel<User> getUserWithOrders(@PathVariable Long id) {
    User user = userService.findById(id);
    List<OrderModel> orders = orderService.findByUserId(id).stream()
        .map(order -> {
            OrderModel model = new OrderModel();
            model.setId(order.getId());
            model.setOrderNumber(order.getOrderNumber());
            model.setTotal(order.getTotal());
            model.add(linkTo(methodOn(OrderController.class).getOrder(order.getId())).withSelfRel());
            return model;
        })
        .collect(Collectors.toList());
    
    EntityModel<User> userModel = EntityModel.of(user,
        linkTo(methodOn(UserController.class).getUser(id)).withSelfRel()
    );
    
    // Add embedded orders
    userModel.add(Link.of("/users/" + id + "/orders").withRel("orders"));
    
    return userModel;
}
```

---

## üîó Link Relations

### Standard Relations

```java
// Self link
link.withSelfRel()

// Collection
link.withRel("collection")

// Item
link.withRel("item")

// Next/Previous
link.withRel("next")
link.withRel("prev")

// First/Last
link.withRel("first")
link.withRel("last")
```

### IANA Relations

```java
import org.springframework.hateoas.IanaLinkRelations;

// Standard IANA relations
link.withRel(IanaLinkRelations.SELF)
link.withRel(IanaLinkRelations.NEXT)
link.withRel(IanaLinkRelations.PREV)
link.withRel(IanaLinkRelations.FIRST)
link.withRel(IanaLinkRelations.LAST)
link.withRel(IanaLinkRelations.COLLECTION)
```

### Custom Relations

```java
@GetMapping("/users/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    return EntityModel.of(user,
        linkTo(methodOn(UserController.class).getUser(id)).withSelfRel(),
        linkTo(methodOn(UserController.class).getUserOrders(id)).withRel("orders"),
        linkTo(methodOn(UserController.class).getUserProfile(id)).withRel("profile"),
        linkTo(methodOn(UserController.class).activateUser(id)).withRel("activate"),
        linkTo(methodOn(UserController.class).deactivateUser(id)).withRel("deactivate")
    );
}
```

### Conditional Links

```java
@GetMapping("/users/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    
    EntityModel<User> model = EntityModel.of(user,
        linkTo(methodOn(UserController.class).getUser(id)).withSelfRel()
    );
    
    // Add links based on state
    if (user.isActive()) {
        model.add(linkTo(methodOn(UserController.class).deactivateUser(id)).withRel("deactivate"));
    } else {
        model.add(linkTo(methodOn(UserController.class).activateUser(id)).withRel("activate"));
    }
    
    // Admin-only links
    if (SecurityContextHolder.getContext().getAuthentication()
            .getAuthorities().stream()
            .anyMatch(a -> a.getAuthority().equals("ROLE_ADMIN"))) {
        model.add(linkTo(methodOn(UserController.class).deleteUser(id)).withRel("delete"));
    }
    
    return model;
}
```

---

## üíº Complete Example

### Entity

```java
@Data
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    private String email;
    private boolean active;
}
```

### Model Assembler

```java
@Component
public class UserModelAssembler implements RepresentationModelAssembler<User, EntityModel<User>> {
    
    @Override
    public EntityModel<User> toModel(User user) {
        EntityModel<User> model = EntityModel.of(user,
            linkTo(methodOn(UserController.class).getUser(user.getId())).withSelfRel(),
            linkTo(methodOn(UserController.class).getAllUsers()).withRel("users")
        );
        
        // Conditional links
        if (user.isActive()) {
            model.add(linkTo(methodOn(UserController.class).deactivateUser(user.getId()))
                .withRel("deactivate"));
        } else {
            model.add(linkTo(methodOn(UserController.class).activateUser(user.getId()))
                .withRel("activate"));
        }
        
        // Related resources
        model.add(linkTo(methodOn(UserController.class).getUserOrders(user.getId()))
            .withRel("orders"));
        
        return model;
    }
}
```

### Controller

```java
@RestController
@RequestMapping("/api/users")
public class UserController {
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private UserModelAssembler assembler;
    
    @GetMapping("/{id}")
    public EntityModel<User> getUser(@PathVariable Long id) {
        User user = userService.findById(id)
            .orElseThrow(() -> new ResourceNotFoundException("User not found"));
        return assembler.toModel(user);
    }
    
    @GetMapping
    public CollectionModel<EntityModel<User>> getAllUsers() {
        List<EntityModel<User>> users = userService.findAll().stream()
            .map(assembler::toModel)
            .collect(Collectors.toList());
        
        return CollectionModel.of(users,
            linkTo(methodOn(UserController.class).getAllUsers()).withSelfRel()
        );
    }
    
    @PostMapping
    public ResponseEntity<EntityModel<User>> createUser(@RequestBody User user) {
        User created = userService.save(user);
        EntityModel<User> model = assembler.toModel(created);
        
        return ResponseEntity
            .created(model.getRequiredLink(IanaLinkRelations.SELF).toUri())
            .body(model);
    }
    
    @PutMapping("/{id}")
    public ResponseEntity<EntityModel<User>> updateUser(
            @PathVariable Long id,
            @RequestBody User user) {
        
        User updated = userService.update(id, user)
            .orElseThrow(() -> new ResourceNotFoundException("User not found"));
        
        return ResponseEntity.ok(assembler.toModel(updated));
    }
    
    @DeleteMapping("/{id}")
    public ResponseEntity<Void> deleteUser(@PathVariable Long id) {
        userService.delete(id);
        return ResponseEntity.noContent().build();
    }
    
    @PutMapping("/{id}/activate")
    public ResponseEntity<EntityModel<User>> activateUser(@PathVariable Long id) {
        User user = userService.activate(id);
        return ResponseEntity.ok(assembler.toModel(user));
    }
    
    @PutMapping("/{id}/deactivate")
    public ResponseEntity<EntityModel<User>> deactivateUser(@PathVariable Long id) {
        User user = userService.deactivate(id);
        return ResponseEntity.ok(assembler.toModel(user));
    }
    
    @GetMapping("/{id}/orders")
    public CollectionModel<EntityModel<Order>> getUserOrders(@PathVariable Long id) {
        List<EntityModel<Order>> orders = orderService.findByUserId(id).stream()
            .map(orderAssembler::toModel)
            .collect(Collectors.toList());
        
        return CollectionModel.of(orders,
            linkTo(methodOn(UserController.class).getUserOrders(id)).withSelfRel(),
            linkTo(methodOn(UserController.class).getUser(id)).withRel("user")
        );
    }
}
```

### Response Example

**GET /api/users/123**

```json
{
  "id": 123,
  "name": "John Doe",
  "email": "john@example.com",
  "active": true,
  "_links": {
    "self": {
      "href": "http://localhost:8080/api/users/123"
    },
    "users": {
      "href": "http://localhost:8080/api/users"
    },
    "deactivate": {
      "href": "http://localhost:8080/api/users/123/deactivate"
    },
    "orders": {
      "href": "http://localhost:8080/api/users/123/orders"
    }
  }
}
```

---

## üìå Best Practices

### 1. Use Assemblers for Consistency

```java
// ‚úÖ Good - Reusable assembler
@Component
public class UserModelAssembler implements RepresentationModelAssembler<User, EntityModel<User>> {
    @Override
    public EntityModel<User> toModel(User user) {
        // Consistent link creation
    }
}

// ‚ùå Bad - Duplicated logic
@GetMapping("/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    // Links created inline, repeated everywhere
}
```

### 2. Include Self Links

```java
// ‚úÖ Good
EntityModel.of(user,
    linkTo(methodOn(UserController.class).getUser(id)).withSelfRel()
)
```

### 3. Add Meaningful Relations

```java
// ‚úÖ Good - Descriptive relations
model.add(link.withRel("orders"));
model.add(link.withRel("profile"));
model.add(link.withRel("activate"));

// ‚ùå Bad - Generic relations
model.add(link.withRel("link1"));
model.add(link.withRel("related"));
```

### 4. Use Conditional Links

```java
// ‚úÖ Good - State-based links
if (user.isActive()) {
    model.add(linkTo(...).withRel("deactivate"));
} else {
    model.add(linkTo(...).withRel("activate"));
}
```

### 5. Handle Collections Properly

```java
// ‚úÖ Good - CollectionModel
@GetMapping
public CollectionModel<EntityModel<User>> getAllUsers() {
    List<EntityModel<User>> users = userService.findAll().stream()
        .map(assembler::toModel)
        .collect(Collectors.toList());
    
    return CollectionModel.of(users,
        linkTo(methodOn(UserController.class).getAllUsers()).withSelfRel()
    );
}
```

### 6. Use HAL Format

```java
// ‚úÖ Good - HAL is default, provides standard format
// Client can rely on _links and _embedded structure
```

### 7. Document HATEOAS Links

```java
@GetMapping("/{id}")
@Operation(summary = "Get user by ID")
@ApiResponse(responseCode = "200", description = "User found",
    content = @Content(
        schema = @Schema(implementation = EntityModel.class),
        examples = @ExampleObject(
            value = "{\"id\":123,\"name\":\"John\",\"_links\":{\"self\":{\"href\":\"/users/123\"}}}"
        )
    ))
public EntityModel<User> getUser(@PathVariable Long id) {
    return assembler.toModel(userService.findById(id));
}
```

---

## üé§ Interview Questions

### Q1: What is HATEOAS?
**Answer:** Hypermedia As The Engine Of Application State - REST constraint where responses include links to related resources, enabling discoverability and navigation.

### Q2: Why use HATEOAS?
**Answer:**
- **Discoverability**: Clients discover available actions
- **Self-documenting**: API tells what operations are possible
- **Decoupling**: Client doesn't hardcode URLs
- **Navigation**: Easy traversal between related resources

### Q3: What is HAL?
**Answer:** Hypertext Application Language - standard format for representing HATEOAS links with `_links` and `_embedded` sections.

### Q4: What is EntityModel?
**Answer:** Spring HATEOAS class that wraps domain object and adds links:
```java
EntityModel.of(user, selfLink, ordersLink)
```

### Q5: What is CollectionModel?
**Answer:** Spring HATEOAS class for wrapping collections with links:
```java
CollectionModel.of(users, selfLink)
```

### Q6: What is RepresentationModelAssembler?
**Answer:** Interface for converting domain objects to representation models with links:
```java
public interface RepresentationModelAssembler<T, D extends RepresentationModel<?>> {
    D toModel(T entity);
}
```

### Q7: How to create links?
**Answer:** Use WebMvcLinkBuilder:
```java
Link link = linkTo(methodOn(UserController.class).getUser(id)).withSelfRel();
```

### Q8: What is self link?
**Answer:** Link pointing to resource itself:
```java
link.withSelfRel()
```

### Q9: What are link relations?
**Answer:** Descriptive names for links indicating relationship:
- `self`: Resource itself
- `orders`: Related orders
- `next`/`prev`: Pagination
- Custom: `activate`, `deactivate`

### Q10: HATEOAS advantages?
**Answer:**
- Discoverability of API capabilities
- Reduced coupling between client and server
- Self-documenting API
- Easier API evolution
- Client-driven navigation

---

## üìö Summary

### HATEOAS Basics

```java
// Without HATEOAS
{
  "id": 123,
  "name": "John Doe"
}

// With HATEOAS
{
  "id": 123,
  "name": "John Doe",
  "_links": {
    "self": {"href": "/users/123"},
    "orders": {"href": "/users/123/orders"}
  }
}
```

### Spring HATEOAS Classes

```java
// EntityModel - Single resource with links
EntityModel<User> model = EntityModel.of(user,
    linkTo(...).withSelfRel(),
    linkTo(...).withRel("orders")
);

// CollectionModel - Collection with links
CollectionModel<EntityModel<User>> collection = CollectionModel.of(users,
    linkTo(...).withSelfRel()
);

// RepresentationModelAssembler - Convert entity to model
public class UserAssembler implements RepresentationModelAssembler<User, EntityModel<User>> {
    public EntityModel<User> toModel(User user) { }
}
```

### Creating Links

```java
// WebMvcLinkBuilder
Link link = linkTo(methodOn(UserController.class).getUser(id)).withSelfRel();

// Manual
Link link = Link.of("/users/" + id).withSelfRel();

// Relations
link.withSelfRel()              // self
link.withRel("orders")          // custom
link.withRel(IanaLinkRelations.NEXT)  // standard
```

### Complete Example

```java
@Component
public class UserAssembler implements RepresentationModelAssembler<User, EntityModel<User>> {
    public EntityModel<User> toModel(User user) {
        return EntityModel.of(user,
            linkTo(methodOn(UserController.class).getUser(user.getId())).withSelfRel(),
            linkTo(methodOn(UserController.class).getUserOrders(user.getId())).withRel("orders")
        );
    }
}

@GetMapping("/{id}")
public EntityModel<User> getUser(@PathVariable Long id) {
    User user = userService.findById(id);
    return assembler.toModel(user);
}
```

---

**REST API Development Complete!** üéâ

