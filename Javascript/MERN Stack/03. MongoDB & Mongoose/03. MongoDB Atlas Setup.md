# 03. MongoDB Atlas Setup

## What is MongoDB Atlas?

MongoDB Atlas is a **cloud-hosted database service** (Database as a Service).

**Benefits:**
- ✅ Free tier available
- ✅ No installation required
- ✅ Automatic backups
- ✅ Global deployment
- ✅ Built-in security

---

## Create Free Account

### Step 1: Sign Up

1. Go to: https://www.mongodb.com/cloud/atlas/register
2. Sign up with email or Google
3. Verify email

### Step 2: Create Organization

1. Enter organization name
2. Select "MongoDB Atlas"
3. Click "Next"

### Step 3: Create Project

1. Enter project name (e.g., "MyApp")
2. Click "Next"

---

## Create Cluster

### Step 1: Choose Plan

- Select **FREE** tier (M0)
- 512 MB storage
- Shared CPU
- Perfect for learning/small projects

### Step 2: Choose Region

- Select cloud provider (AWS/Google Cloud/Azure)
- Choose region closest to you
- Click "Create Cluster"

**Wait 3-5 minutes** for cluster creation.

---

## Configure Database Access

### Step 1: Create Database User

1. Go to **Database Access** (left menu)
2. Click **Add New Database User**
3. Choose **Password** authentication
4. Enter username: `admin`
5. Enter password: (save this!)
6. Set role: **Read and write to any database**
7. Click **Add User**

---

## Configure Network Access

### Step 1: Whitelist IP Address

1. Go to **Network Access** (left menu)
2. Click **Add IP Address**
3. Choose:
   - **Add Current IP Address** (for specific IP)
   - **Allow Access from Anywhere** (0.0.0.0/0) - for development
4. Click **Confirm**

⚠️ **Production**: Use specific IPs, not 0.0.0.0/0

---

## Get Connection String

### Step 1: Connect

1. Go to **Database** → **Clusters**
2. Click **Connect** on your cluster
3. Choose **Connect your application**
4. Select **Driver**: Node.js
5. Copy connection string:

```
mongodb+srv://admin:<password>@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
```

### Step 2: Replace Password

```
mongodb+srv://admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority
```

### Step 3: Add Database Name

```
mongodb+srv://admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/mydb?retryWrites=true&w=majority
```

---

## Test Connection (Node.js)

**Install MongoDB driver:**

```bash
npm install mongodb
```

**test.js:**

```javascript
const { MongoClient } = require('mongodb');

const uri = 'mongodb+srv://admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/?retryWrites=true&w=majority';

const client = new MongoClient(uri);

async function run() {
  try {
    await client.connect();
    console.log('✅ Connected to MongoDB Atlas!');
    
    const db = client.db('testdb');
    const collection = db.collection('users');
    
    await collection.insertOne({ name: 'John', age: 30 });
    console.log('✅ Document inserted!');
    
  } finally {
    await client.close();
  }
}

run().catch(console.error);
```

**Run:**

```bash
node test.js
```

---

## Using .env File

**Install dotenv:**

```bash
npm install dotenv
```

**.env:**

```
MONGO_URI=mongodb+srv://admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/mydb?retryWrites=true&w=majority
```

**app.js:**

```javascript
require('dotenv').config();
const { MongoClient } = require('mongodb');

const uri = process.env.MONGO_URI;
const client = new MongoClient(uri);

async function connect() {
  await client.connect();
  console.log('Connected to Atlas');
}

connect();
```

---

## MongoDB Compass (Connect)

1. Open **MongoDB Compass**
2. Paste connection string:
   ```
   mongodb+srv://admin:YOUR_PASSWORD@cluster0.xxxxx.mongodb.net/
   ```
3. Click **Connect**
4. View databases and collections visually

---

## Atlas Features

### Data Explorer

- View collections
- Run queries
- Insert/update/delete documents
- Create indexes

### Monitoring

- Query performance
- Connection stats
- Storage usage
- Real-time metrics

### Backups

- Automatic daily backups (paid tiers)
- Point-in-time recovery
- Download backups

---

## Free Tier Limits

| Feature | Limit |
|---------|-------|
| Storage | 512 MB |
| RAM | Shared |
| Connections | 500 |
| Backups | Manual only |
| Clusters | 1 |

---

## Best Practices

✅ **Use environment variables**: Never hardcode credentials  
✅ **Whitelist specific IPs**: In production  
✅ **Strong passwords**: Use complex passwords  
✅ **Least privilege**: Give minimum required permissions  
✅ **Monitor usage**: Check Atlas dashboard regularly  
❌ **Don't commit .env**: Add to .gitignore  

---

## Common Issues

**Connection timeout:**
- Check IP whitelist
- Verify network access

**Authentication failed:**
- Verify username/password
- Check special characters in password (URL encode)

**Network error:**
- Check internet connection
- Verify firewall settings

---

## Summary

**Steps:**
1. Sign up at mongodb.com/cloud/atlas
2. Create free cluster (M0)
3. Create database user
4. Whitelist IP (0.0.0.0/0 for dev)
5. Get connection string
6. Replace password and add DB name

**Connection String:**
```
mongodb+srv://username:password@cluster.mongodb.net/dbname
```

**Next**: Learn MongoDB Basics!
