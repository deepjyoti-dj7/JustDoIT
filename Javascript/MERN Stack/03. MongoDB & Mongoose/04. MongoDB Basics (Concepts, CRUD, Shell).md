# 04. MongoDB Basics (Concepts, CRUD, Shell)

## Core Concepts

### Database

Container for collections.

```javascript
// Show all databases
show dbs

// Create/switch database
use mydb

// Current database
db

// Delete database
db.dropDatabase()
```

### Collection

Group of documents (like a table).

```javascript
// Show collections
show collections

// Create collection
db.createCollection('users')

// Delete collection
db.users.drop()
```

### Document

JSON-like record (like a row).

```json
{
  "_id": ObjectId("507f1f77bcf86cd799439011"),
  "name": "John",
  "age": 30,
  "email": "john@example.com"
}
```

---

## CRUD Operations

### Create (Insert)

**Insert One:**

```javascript
db.users.insertOne({
  name: "John Doe",
  age: 30,
  email: "john@example.com"
});

// Output:
// { acknowledged: true, insertedId: ObjectId("...") }
```

**Insert Many:**

```javascript
db.users.insertMany([
  { name: "Alice", age: 25, city: "NYC" },
  { name: "Bob", age: 35, city: "LA" },
  { name: "Charlie", age: 28, city: "NYC" }
]);
```

---

### Read (Find)

**Find All:**

```javascript
db.users.find();

// Pretty print
db.users.find().pretty();
```

**Find with Filter:**

```javascript
// Find one
db.users.findOne({ name: "John" });

// Find by age
db.users.find({ age: 30 });

// Greater than
db.users.find({ age: { $gt: 25 } });

// Less than or equal
db.users.find({ age: { $lte: 30 } });

// Multiple conditions (AND)
db.users.find({ age: 30, city: "NYC" });

// OR condition
db.users.find({
  $or: [
    { age: 25 },
    { city: "LA" }
  ]
});
```

**Projection (Select fields):**

```javascript
// Only name and age (exclude _id)
db.users.find({}, { name: 1, age: 1, _id: 0 });

// Exclude email
db.users.find({}, { email: 0 });
```

**Limit & Sort:**

```javascript
// Limit results
db.users.find().limit(5);

// Sort ascending
db.users.find().sort({ age: 1 });

// Sort descending
db.users.find().sort({ age: -1 });

// Skip & limit (pagination)
db.users.find().skip(10).limit(5);
```

---

### Update

**Update One:**

```javascript
db.users.updateOne(
  { name: "John" },           // Filter
  { $set: { age: 31 } }       // Update
);

// Output:
// { acknowledged: true, matchedCount: 1, modifiedCount: 1 }
```

**Update Many:**

```javascript
db.users.updateMany(
  { city: "NYC" },
  { $set: { country: "USA" } }
);
```

**Replace One:**

```javascript
db.users.replaceOne(
  { name: "John" },
  { name: "John Doe", age: 32, email: "newemail@example.com" }
);
```

**Update Operators:**

```javascript
// Increment
db.users.updateOne(
  { name: "John" },
  { $inc: { age: 1 } }
);

// Add to array
db.users.updateOne(
  { name: "John" },
  { $push: { hobbies: "gaming" } }
);

// Remove field
db.users.updateOne(
  { name: "John" },
  { $unset: { email: "" } }
);
```

---

### Delete

**Delete One:**

```javascript
db.users.deleteOne({ name: "John" });

// Output:
// { acknowledged: true, deletedCount: 1 }
```

**Delete Many:**

```javascript
// Delete all from NYC
db.users.deleteMany({ city: "NYC" });

// Delete all documents
db.users.deleteMany({});
```

---

## Query Operators

### Comparison

```javascript
// Equal
db.users.find({ age: 30 });

// Not equal
db.users.find({ age: { $ne: 30 } });

// Greater than
db.users.find({ age: { $gt: 25 } });

// Greater than or equal
db.users.find({ age: { $gte: 25 } });

// Less than
db.users.find({ age: { $lt: 35 } });

// Less than or equal
db.users.find({ age: { $lte: 35 } });

// In array
db.users.find({ age: { $in: [25, 30, 35] } });

// Not in array
db.users.find({ age: { $nin: [25, 30] } });
```

### Logical

```javascript
// AND
db.users.find({ age: 30, city: "NYC" });

// OR
db.users.find({
  $or: [
    { age: 30 },
    { city: "NYC" }
  ]
});

// NOT
db.users.find({ age: { $not: { $gt: 30 } } });

// NOR
db.users.find({
  $nor: [
    { age: 30 },
    { city: "NYC" }
  ]
});
```

### Element

```javascript
// Field exists
db.users.find({ email: { $exists: true } });

// Type check
db.users.find({ age: { $type: "number" } });
```

---

## MongoDB Shell Commands

### Database Commands

```javascript
// Show databases
show dbs

// Use database
use mydb

// Current database
db

// Database stats
db.stats()

// Drop database
db.dropDatabase()
```

### Collection Commands

```javascript
// Show collections
show collections

// Create collection
db.createCollection('users')

// Collection stats
db.users.stats()

// Rename collection
db.users.renameCollection('customers')

// Drop collection
db.users.drop()
```

### Document Count

```javascript
// Count all
db.users.countDocuments();

// Count with filter
db.users.countDocuments({ age: { $gt: 25 } });
```

### Distinct Values

```javascript
// Get unique cities
db.users.distinct('city');
```

---

## Practical Examples

### User Management

```javascript
// Create user
db.users.insertOne({
  name: "John Doe",
  email: "john@example.com",
  age: 30,
  createdAt: new Date()
});

// Find user by email
db.users.findOne({ email: "john@example.com" });

// Update user age
db.users.updateOne(
  { email: "john@example.com" },
  { $set: { age: 31 } }
);

// Delete user
db.users.deleteOne({ email: "john@example.com" });
```

### Blog Posts

```javascript
// Create post
db.posts.insertOne({
  title: "MongoDB Tutorial",
  content: "Learn MongoDB...",
  author: "John",
  tags: ["database", "nosql"],
  likes: 0,
  createdAt: new Date()
});

// Find posts by author
db.posts.find({ author: "John" });

// Increment likes
db.posts.updateOne(
  { title: "MongoDB Tutorial" },
  { $inc: { likes: 1 } }
);

// Add tag
db.posts.updateOne(
  { title: "MongoDB Tutorial" },
  { $push: { tags: "tutorial" } }
);
```

---

## Summary

**Structure:**
- Database → Collections → Documents

**CRUD:**
```javascript
// Create
db.collection.insertOne({})
db.collection.insertMany([])

// Read
db.collection.find({})
db.collection.findOne({})

// Update
db.collection.updateOne({}, { $set: {} })
db.collection.updateMany({}, { $set: {} })

// Delete
db.collection.deleteOne({})
db.collection.deleteMany({})
```

**Operators:**
- `$gt`, `$lt`, `$gte`, `$lte`, `$ne`
- `$in`, `$nin`
- `$and`, `$or`, `$not`
- `$set`, `$inc`, `$push`, `$unset`

**Next**: Learn Data Modeling!
