# Frontend Integration (Axios & Fetch)

## Calling APIs from Frontend

**Two main options**:
1. **Fetch API** - Built-in, no installation
2. **Axios** - Popular library, more features

---

## Fetch API

### Basic GET Request

```js
fetch('http://localhost:3000/api/users')
  .then(response => response.json())
  .then(data => console.log(data))
  .catch(error => console.error('Error:', error));
```

### With async/await

```js
const getUsers = async () => {
  try {
    const response = await fetch('http://localhost:3000/api/users');
    const data = await response.json();
    console.log(data);
  } catch (error) {
    console.error('Error:', error);
  }
};
```

### POST Request

```js
const createUser = async (userData) => {
  try {
    const response = await fetch('http://localhost:3000/api/users', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(userData)
    });
    
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
  }
};

// Usage
const newUser = {
  name: 'John Doe',
  email: 'john@example.com'
};

createUser(newUser);
```

### PUT Request

```js
const updateUser = async (id, updates) => {
  const response = await fetch(`http://localhost:3000/api/users/${id}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(updates)
  });
  
  return response.json();
};
```

### DELETE Request

```js
const deleteUser = async (id) => {
  const response = await fetch(`http://localhost:3000/api/users/${id}`, {
    method: 'DELETE'
  });
  
  if (response.status === 204) {
    console.log('User deleted');
  }
};
```

### With Authentication

```js
const getProfile = async () => {
  const token = localStorage.getItem('token');
  
  const response = await fetch('http://localhost:3000/api/users/profile', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  return response.json();
};
```

---

## Axios

### Installation

```bash
npm install axios
```

### Basic GET Request

```js
import axios from 'axios';

const getUsers = async () => {
  try {
    const response = await axios.get('http://localhost:3000/api/users');
    console.log(response.data);
  } catch (error) {
    console.error('Error:', error.message);
  }
};
```

### POST Request

```js
const createUser = async (userData) => {
  try {
    const response = await axios.post('http://localhost:3000/api/users', userData);
    return response.data;
  } catch (error) {
    console.error('Error:', error.response?.data || error.message);
  }
};
```

### PUT Request

```js
const updateUser = async (id, updates) => {
  const response = await axios.put(`http://localhost:3000/api/users/${id}`, updates);
  return response.data;
};
```

### DELETE Request

```js
const deleteUser = async (id) => {
  await axios.delete(`http://localhost:3000/api/users/${id}`);
};
```

---

## Axios Configuration

### Base URL

```js
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3000/api',
  timeout: 5000,
  headers: {
    'Content-Type': 'application/json'
  }
});

// Usage
const getUsers = () => api.get('/users');
const getUser = (id) => api.get(`/users/${id}`);
```

### Interceptors (Authentication)

```js
import axios from 'axios';

const api = axios.create({
  baseURL: 'http://localhost:3000/api'
});

// Request interceptor - Add token to every request
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// Response interceptor - Handle errors globally
api.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // Unauthorized - redirect to login
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
    return Promise.reject(error);
  }
);

export default api;
```

---

## React Integration

### Using useState & useEffect

```jsx
import { useState, useEffect } from 'react';
import axios from 'axios';

function UsersList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchUsers = async () => {
      try {
        const response = await axios.get('http://localhost:3000/api/users');
        setUsers(response.data.data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    
    fetchUsers();
  }, []);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  
  return (
    <ul>
      {users.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

### Create User Form

```jsx
import { useState } from 'react';
import axios from 'axios';

function CreateUser() {
  const [formData, setFormData] = useState({
    name: '',
    email: ''
  });
  const [loading, setLoading] = useState(false);
  
  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  
  const handleSubmit = async (e) => {
    e.preventDefault();
    setLoading(true);
    
    try {
      const response = await axios.post('http://localhost:3000/api/users', formData);
      console.log('User created:', response.data);
      // Reset form
      setFormData({ name: '', email: '' });
    } catch (error) {
      console.error('Error:', error.response?.data);
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <input
        type="text"
        name="name"
        value={formData.name}
        onChange={handleChange}
        placeholder="Name"
        required
      />
      <input
        type="email"
        name="email"
        value={formData.email}
        onChange={handleChange}
        placeholder="Email"
        required
      />
      <button type="submit" disabled={loading}>
        {loading ? 'Creating...' : 'Create User'}
      </button>
    </form>
  );
}
```

---

## Custom Hooks

### useFetch Hook

```js
import { useState, useEffect } from 'react';
import axios from 'axios';

function useFetch(url) {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchData = async () => {
      try {
        const response = await axios.get(url);
        setData(response.data);
      } catch (err) {
        setError(err.message);
      } finally {
        setLoading(false);
      }
    };
    
    fetchData();
  }, [url]);
  
  return { data, loading, error };
}

// Usage
function UsersList() {
  const { data, loading, error } = useFetch('http://localhost:3000/api/users');
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  
  return (
    <ul>
      {data?.data.map(user => (
        <li key={user.id}>{user.name}</li>
      ))}
    </ul>
  );
}
```

### useAPI Hook (CRUD)

```js
import { useState } from 'react';
import axios from 'axios';

function useAPI(baseURL) {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  
  const request = async (method, url, data = null) => {
    setLoading(true);
    setError(null);
    
    try {
      const response = await axios({
        method,
        url: `${baseURL}${url}`,
        data
      });
      return response.data;
    } catch (err) {
      setError(err.response?.data || err.message);
      throw err;
    } finally {
      setLoading(false);
    }
  };
  
  return {
    loading,
    error,
    get: (url) => request('GET', url),
    post: (url, data) => request('POST', url, data),
    put: (url, data) => request('PUT', url, data),
    delete: (url) => request('DELETE', url)
  };
}

// Usage
function UserManager() {
  const api = useAPI('http://localhost:3000/api');
  
  const handleCreate = async () => {
    try {
      const user = await api.post('/users', { name: 'John', email: 'john@example.com' });
      console.log('Created:', user);
    } catch (error) {
      console.error('Failed:', error);
    }
  };
  
  return (
    <div>
      <button onClick={handleCreate} disabled={api.loading}>
        {api.loading ? 'Creating...' : 'Create User'}
      </button>
      {api.error && <div>Error: {api.error}</div>}
    </div>
  );
}
```

---

## Environment Variables

### .env

```
REACT_APP_API_URL=http://localhost:3000/api
```

### Usage

```js
const API_URL = process.env.REACT_APP_API_URL;

const getUsers = () => axios.get(`${API_URL}/users`);
```

### config.js

```js
const config = {
  apiUrl: process.env.REACT_APP_API_URL || 'http://localhost:3000/api'
};

export default config;
```

---

## Error Handling

### Try-Catch Pattern

```js
const createUser = async (userData) => {
  try {
    const response = await axios.post('/api/users', userData);
    return { success: true, data: response.data };
  } catch (error) {
    if (error.response) {
      // Server responded with error
      return {
        success: false,
        error: error.response.data.error || 'Server error'
      };
    } else if (error.request) {
      // Request made but no response
      return {
        success: false,
        error: 'No response from server'
      };
    } else {
      // Error setting up request
      return {
        success: false,
        error: error.message
      };
    }
  }
};
```

### Global Error Handler

```jsx
import { createContext, useContext, useState } from 'react';

const ErrorContext = createContext();

export function ErrorProvider({ children }) {
  const [error, setError] = useState(null);
  
  return (
    <ErrorContext.Provider value={{ error, setError }}>
      {children}
      {error && (
        <div className="error-toast">
          {error}
          <button onClick={() => setError(null)}>Ã—</button>
        </div>
      )}
    </ErrorContext.Provider>
  );
}

export const useError = () => useContext(ErrorContext);

// Usage
function MyComponent() {
  const { setError } = useError();
  
  const handleSubmit = async () => {
    try {
      await axios.post('/api/users', data);
    } catch (error) {
      setError(error.response?.data?.error || 'Something went wrong');
    }
  };
}
```

---

## Loading States

```jsx
function UsersList() {
  const [users, setUsers] = useState([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    axios.get('/api/users')
      .then(res => setUsers(res.data.data))
      .finally(() => setLoading(false));
  }, []);
  
  if (loading) {
    return (
      <div className="spinner">
        <div className="loading">Loading...</div>
      </div>
    );
  }
  
  return <ul>{users.map(user => <li key={user.id}>{user.name}</li>)}</ul>;
}
```

---

## Pagination

```jsx
import { useState, useEffect } from 'react';
import axios from 'axios';

function PaginatedUsers() {
  const [users, setUsers] = useState([]);
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(0);
  
  useEffect(() => {
    const fetchUsers = async () => {
      const response = await axios.get(`/api/users?page=${page}&limit=10`);
      setUsers(response.data.data);
      setTotalPages(response.data.pagination.pages);
    };
    
    fetchUsers();
  }, [page]);
  
  return (
    <div>
      <ul>
        {users.map(user => (
          <li key={user.id}>{user.name}</li>
        ))}
      </ul>
      
      <div>
        <button
          onClick={() => setPage(page - 1)}
          disabled={page === 1}
        >
          Previous
        </button>
        
        <span>Page {page} of {totalPages}</span>
        
        <button
          onClick={() => setPage(page + 1)}
          disabled={page === totalPages}
        >
          Next
        </button>
      </div>
    </div>
  );
}
```

---

## File Upload

```jsx
import { useState } from 'react';
import axios from 'axios';

function FileUpload() {
  const [file, setFile] = useState(null);
  const [uploading, setUploading] = useState(false);
  
  const handleFileChange = (e) => {
    setFile(e.target.files[0]);
  };
  
  const handleUpload = async () => {
    const formData = new FormData();
    formData.append('file', file);
    
    setUploading(true);
    
    try {
      const response = await axios.post('/api/upload', formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        },
        onUploadProgress: (progressEvent) => {
          const percent = Math.round(
            (progressEvent.loaded * 100) / progressEvent.total
          );
          console.log(`Upload Progress: ${percent}%`);
        }
      });
      
      console.log('Upload successful:', response.data);
    } catch (error) {
      console.error('Upload failed:', error);
    } finally {
      setUploading(false);
    }
  };
  
  return (
    <div>
      <input type="file" onChange={handleFileChange} />
      <button onClick={handleUpload} disabled={!file || uploading}>
        {uploading ? 'Uploading...' : 'Upload'}
      </button>
    </div>
  );
}
```

---

## Fetch vs Axios

| Feature | Fetch | Axios |
|---------|-------|-------|
| Built-in | Yes | No (install) |
| JSON parsing | Manual | Automatic |
| Request/Response interceptors | No | Yes |
| Progress tracking | Limited | Yes |
| Timeout | Manual | Built-in |
| Error handling | Complex | Simple |
| Browser support | Modern | All |

---

## Interview Questions

### Q1: What's the difference between Fetch and Axios?
**Answer**: Fetch is built-in but requires manual JSON parsing. Axios has more features (interceptors, auto-parsing, better error handling).

### Q2: How do you handle authentication in API calls?
**Answer**: Store token in localStorage, add to Authorization header using interceptors or manually.

### Q3: How do you handle loading states?
**Answer**: Use useState for loading boolean, set to true before request, false in finally block.

### Q4: What are Axios interceptors?
**Answer**: Functions that intercept requests/responses before they're handled, useful for adding auth tokens or global error handling.

### Q5: How do you prevent memory leaks in useEffect with API calls?
**Answer**: Use cleanup function to cancel pending requests or ignore results if component unmounted.

---

## Summary

- **Fetch**: Built-in, manual JSON parsing
- **Axios**: Popular library, more features
- **Base URL**: Configure once, reuse everywhere
- **Interceptors**: Add auth tokens, handle errors globally
- **Custom Hooks**: Reusable API logic (useFetch, useAPI)
- **Error Handling**: Try-catch, global error context
- **Loading States**: Boolean flag for UX
- **Environment Variables**: Store API URL
- **File Upload**: FormData with multipart/form-data
- **Best Practice**: Centralize API configuration*
