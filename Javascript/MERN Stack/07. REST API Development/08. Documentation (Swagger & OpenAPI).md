# API Documentation (Swagger & OpenAPI)

## Why Document APIs?

**Good documentation**:
- Helps developers understand your API
- Reduces support questions
- Speeds up integration
- Acts as a contract

> **Documentation is as important as the API itself.**

---

## What is Swagger?

**Swagger** is a set of tools for API documentation:
- **OpenAPI Specification**: Standard format for describing APIs
- **Swagger UI**: Interactive documentation
- **Swagger Editor**: Design APIs
- **Swagger Codegen**: Generate client SDKs

**OpenAPI** is the specification, **Swagger** is the toolset.

---

## swagger-jsdoc & swagger-ui-express

### Installation

```bash
npm install swagger-jsdoc swagger-ui-express
```

### Basic Setup

```js
// swagger.js
const swaggerJsdoc = require('swagger-jsdoc');
const swaggerUi = require('swagger-ui-express');

const options = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: 'My API',
      version: '1.0.0',
      description: 'A simple Express API',
      contact: {
        name: 'API Support',
        email: 'support@myapi.com'
      }
    },
    servers: [
      {
        url: 'http://localhost:3000',
        description: 'Development server'
      },
      {
        url: 'https://api.myapp.com',
        description: 'Production server'
      }
    ]
  },
  apis: ['./routes/*.js'] // Path to API docs
};

const specs = swaggerJsdoc(options);

module.exports = { specs, swaggerUi };
```

### server.js

```js
const { specs, swaggerUi } = require('./swagger');

// Swagger UI
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(specs));

// Access at: http://localhost:3000/api-docs
```

---

## Documenting Endpoints

### GET Endpoint

```js
/**
 * @swagger
 * /api/users:
 *   get:
 *     summary: Get all users
 *     tags: [Users]
 *     parameters:
 *       - in: query
 *         name: page
 *         schema:
 *           type: integer
 *         description: Page number
 *       - in: query
 *         name: limit
 *         schema:
 *           type: integer
 *         description: Items per page
 *     responses:
 *       200:
 *         description: List of users
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                 data:
 *                   type: array
 *                   items:
 *                     $ref: '#/components/schemas/User'
 */
router.get('/', getUsers);
```

### POST Endpoint

```js
/**
 * @swagger
 * /api/users:
 *   post:
 *     summary: Create a new user
 *     tags: [Users]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             required:
 *               - name
 *               - email
 *               - password
 *             properties:
 *               name:
 *                 type: string
 *               email:
 *                 type: string
 *                 format: email
 *               password:
 *                 type: string
 *                 format: password
 *     responses:
 *       201:
 *         description: User created successfully
 *       400:
 *         description: Invalid input
 */
router.post('/', createUser);
```

### GET by ID

```js
/**
 * @swagger
 * /api/users/{id}:
 *   get:
 *     summary: Get user by ID
 *     tags: [Users]
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *         description: User ID
 *     responses:
 *       200:
 *         description: User details
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/User'
 *       404:
 *         description: User not found
 */
router.get('/:id', getUser);
```

### PUT/PATCH Endpoint

```js
/**
 * @swagger
 * /api/users/{id}:
 *   put:
 *     summary: Update user
 *     tags: [Users]
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             type: object
 *             properties:
 *               name:
 *                 type: string
 *               email:
 *                 type: string
 *     responses:
 *       200:
 *         description: User updated
 *       404:
 *         description: User not found
 */
router.put('/:id', updateUser);
```

### DELETE Endpoint

```js
/**
 * @swagger
 * /api/users/{id}:
 *   delete:
 *     summary: Delete user
 *     tags: [Users]
 *     parameters:
 *       - in: path
 *         name: id
 *         required: true
 *         schema:
 *           type: string
 *     responses:
 *       204:
 *         description: User deleted
 *       404:
 *         description: User not found
 */
router.delete('/:id', deleteUser);
```

---

## Schemas/Components

### Defining Schemas

```js
/**
 * @swagger
 * components:
 *   schemas:
 *     User:
 *       type: object
 *       required:
 *         - name
 *         - email
 *       properties:
 *         id:
 *           type: string
 *           description: Auto-generated ID
 *         name:
 *           type: string
 *           description: User's name
 *         email:
 *           type: string
 *           format: email
 *           description: User's email
 *         role:
 *           type: string
 *           enum: [user, admin]
 *           default: user
 *         createdAt:
 *           type: string
 *           format: date-time
 *       example:
 *         id: 507f1f77bcf86cd799439011
 *         name: John Doe
 *         email: john@example.com
 *         role: user
 *         createdAt: 2024-01-01T00:00:00.000Z
 */
```

### Reusing Schemas

```js
/**
 * @swagger
 * /api/users:
 *   get:
 *     responses:
 *       200:
 *         content:
 *           application/json:
 *             schema:
 *               type: array
 *               items:
 *                 $ref: '#/components/schemas/User'
 */
```

---

## Authentication Documentation

### Bearer Token

```js
/**
 * @swagger
 * components:
 *   securitySchemes:
 *     bearerAuth:
 *       type: http
 *       scheme: bearer
 *       bearerFormat: JWT
 */

/**
 * @swagger
 * /api/users/profile:
 *   get:
 *     summary: Get user profile
 *     tags: [Users]
 *     security:
 *       - bearerAuth: []
 *     responses:
 *       200:
 *         description: User profile
 *       401:
 *         description: Unauthorized
 */
router.get('/profile', auth, getProfile);
```

### API Key

```js
/**
 * @swagger
 * components:
 *   securitySchemes:
 *     apiKey:
 *       type: apiKey
 *       in: header
 *       name: X-API-Key
 */
```

---

## Error Responses

```js
/**
 * @swagger
 * components:
 *   schemas:
 *     Error:
 *       type: object
 *       properties:
 *         success:
 *           type: boolean
 *           example: false
 *         error:
 *           type: object
 *           properties:
 *             message:
 *               type: string
 *             code:
 *               type: string
 */

/**
 * @swagger
 * /api/users/{id}:
 *   get:
 *     responses:
 *       404:
 *         description: User not found
 *         content:
 *           application/json:
 *             schema:
 *               $ref: '#/components/schemas/Error'
 */
```

---

## Complete Example

### routes/users.js

```js
const express = require('express');
const router = express.Router();
const {
  getUsers,
  getUser,
  createUser,
  updateUser,
  deleteUser
} = require('../controllers/userController');

/**
 * @swagger
 * tags:
 *   name: Users
 *   description: User management endpoints
 */

/**
 * @swagger
 * components:
 *   schemas:
 *     User:
 *       type: object
 *       required:
 *         - name
 *         - email
 *       properties:
 *         id:
 *           type: string
 *         name:
 *           type: string
 *         email:
 *           type: string
 *         role:
 *           type: string
 *           enum: [user, admin]
 *       example:
 *         id: 507f1f77bcf86cd799439011
 *         name: John Doe
 *         email: john@example.com
 *         role: user
 */

/**
 * @swagger
 * /api/users:
 *   get:
 *     summary: Get all users
 *     tags: [Users]
 *     parameters:
 *       - in: query
 *         name: page
 *         schema:
 *           type: integer
 *           default: 1
 *       - in: query
 *         name: limit
 *         schema:
 *           type: integer
 *           default: 10
 *     responses:
 *       200:
 *         description: List of users
 *         content:
 *           application/json:
 *             schema:
 *               type: object
 *               properties:
 *                 success:
 *                   type: boolean
 *                 data:
 *                   type: array
 *                   items:
 *                     $ref: '#/components/schemas/User'
 */
router.get('/', getUsers);

/**
 * @swagger
 * /api/users:
 *   post:
 *     summary: Create user
 *     tags: [Users]
 *     requestBody:
 *       required: true
 *       content:
 *         application/json:
 *           schema:
 *             $ref: '#/components/schemas/User'
 *     responses:
 *       201:
 *         description: User created
 *       400:
 *         description: Invalid input
 */
router.post('/', createUser);

module.exports = router;
```

---

## Advanced Features

### File Upload

```js
/**
 * @swagger
 * /api/upload:
 *   post:
 *     summary: Upload file
 *     tags: [Files]
 *     requestBody:
 *       required: true
 *       content:
 *         multipart/form-data:
 *           schema:
 *             type: object
 *             properties:
 *               file:
 *                 type: string
 *                 format: binary
 *     responses:
 *       200:
 *         description: File uploaded
 */
```

### Multiple Responses

```js
/**
 * @swagger
 * /api/users/{id}:
 *   get:
 *     responses:
 *       200:
 *         description: Success
 *       400:
 *         description: Bad request
 *       401:
 *         description: Unauthorized
 *       404:
 *         description: Not found
 *       500:
 *         description: Server error
 */
```

### Deprecated Endpoints

```js
/**
 * @swagger
 * /api/old-endpoint:
 *   get:
 *     deprecated: true
 *     summary: This endpoint is deprecated
 *     description: Use /api/new-endpoint instead
 */
```

---

## Customizing Swagger UI

```js
const swaggerOptions = {
  customCss: '.swagger-ui .topbar { display: none }',
  customSiteTitle: 'My API Docs',
  customfavIcon: '/favicon.ico'
};

app.use('/api-docs',
  swaggerUi.serve,
  swaggerUi.setup(specs, swaggerOptions)
);
```

---

## Alternative: Separate YAML File

### swagger.yaml

```yaml
openapi: 3.0.0
info:
  title: My API
  version: 1.0.0
  description: API documentation

servers:
  - url: http://localhost:3000
    description: Development

paths:
  /api/users:
    get:
      summary: Get all users
      tags:
        - Users
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
```

### Loading YAML

```js
const YAML = require('yamljs');
const swaggerDocument = YAML.load('./swagger.yaml');

app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(swaggerDocument));
```

---

## Best Practices

1. **Use tags** - Group related endpoints
2. **Define schemas** - Reuse components
3. **Document all responses** - Success and errors
4. **Add examples** - Help developers understand
5. **Include authentication** - Document security
6. **Keep it updated** - Documentation = code
7. **Use versioning** - Document each API version
8. **Add descriptions** - Explain complex logic

---

## Interview Questions

### Q1: What is OpenAPI?
**Answer**: A specification for describing REST APIs in a standard format. Swagger is a toolset that uses OpenAPI.

### Q2: What's the difference between Swagger and OpenAPI?
**Answer**: OpenAPI is the specification, Swagger is the toolset (UI, Editor, Codegen).

### Q3: How do you document authentication in Swagger?
**Answer**: Use `components.securitySchemes` to define auth (bearer, apiKey, etc.), then reference in endpoints.

### Q4: What's the benefit of API documentation?
**Answer**: Helps developers understand API, reduces support, speeds integration, acts as contract.

### Q5: Can Swagger generate client SDKs?
**Answer**: Yes, Swagger Codegen can generate client libraries in multiple languages from OpenAPI spec.

---

## Summary

- **Swagger**: Toolset for API documentation
- **OpenAPI**: Specification format
- **swagger-jsdoc**: Generate docs from JSDoc comments
- **swagger-ui-express**: Interactive documentation UI
- **Tags**: Group related endpoints
- **Components**: Reusable schemas
- **Security**: Document authentication/authorization
- **Best Practice**: Keep docs in sync with code
- **Access**: Usually at `/api-docs`
