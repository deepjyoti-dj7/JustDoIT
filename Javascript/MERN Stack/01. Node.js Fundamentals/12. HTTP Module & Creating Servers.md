# 12. HTTP Module & Creating Servers

## What is the HTTP Module?

The **http** module allows you to create web servers and make HTTP requests.

```javascript
const http = require('http');
```

---

## Creating a Simple Server

```javascript
const http = require('http');

// Create server
const server = http.createServer((req, res) => {
  res.writeHead(200, { 'Content-Type': 'text/plain' });
  res.end('Hello World!');
});

// Start listening
server.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```

Visit `http://localhost:3000` in your browser!

---

## Request Object (req)

```javascript
const server = http.createServer((req, res) => {
  console.log('Method:', req.method);        // GET, POST, etc.
  console.log('URL:', req.url);              // /about, /users
  console.log('Headers:', req.headers);      // Request headers
  
  res.end('Request received');
});

server.listen(3000);
```

---

## Response Object (res)

```javascript
const server = http.createServer((req, res) => {
  // Set status code and headers
  res.writeHead(200, {
    'Content-Type': 'text/html',
    'X-Custom-Header': 'MyValue'
  });
  
  // Send response body
  res.write('<h1>Hello World</h1>');
  res.write('<p>Welcome to my server</p>');
  
  // End response
  res.end();
});

server.listen(3000);
```

---

## Routing

Handle different URLs:

```javascript
const http = require('http');

const server = http.createServer((req, res) => {
  const { url, method } = req;
  
  if (url === '/' && method === 'GET') {
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.end('<h1>Home Page</h1>');
    
  } else if (url === '/about' && method === 'GET') {
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.end('<h1>About Page</h1>');
    
  } else if (url === '/api/users' && method === 'GET') {
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify({ users: ['John', 'Jane'] }));
    
  } else {
    res.writeHead(404, { 'Content-Type': 'text/html' });
    res.end('<h1>404 Not Found</h1>');
  }
});

server.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```

---

## Serving HTML

```javascript
const http = require('http');
const fs = require('fs');

const server = http.createServer((req, res) => {
  if (req.url === '/') {
    fs.readFile('index.html', (err, data) => {
      if (err) {
        res.writeHead(500);
        res.end('Error loading page');
        return;
      }
      
      res.writeHead(200, { 'Content-Type': 'text/html' });
      res.end(data);
    });
  }
});

server.listen(3000);
```

---

## Serving JSON API

```javascript
const http = require('http');

const users = [
  { id: 1, name: 'John' },
  { id: 2, name: 'Jane' }
];

const server = http.createServer((req, res) => {
  if (req.url === '/api/users' && req.method === 'GET') {
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify(users));
  } else {
    res.writeHead(404);
    res.end('Not Found');
  }
});

server.listen(3000);
```

---

## Handling POST Requests

```javascript
const http = require('http');

const server = http.createServer((req, res) => {
  if (req.url === '/api/users' && req.method === 'POST') {
    let body = '';
    
    // Collect data chunks
    req.on('data', (chunk) => {
      body += chunk.toString();
    });
    
    // When all data received
    req.on('end', () => {
      const user = JSON.parse(body);
      console.log('Received user:', user);
      
      res.writeHead(201, { 'Content-Type': 'application/json' });
      res.end(JSON.stringify({ message: 'User created', user }));
    });
    
  } else {
    res.writeHead(404);
    res.end('Not Found');
  }
});

server.listen(3000);
```

Test with:
```bash
curl -X POST http://localhost:3000/api/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Bob","age":25}'
```

---

## Query Parameters

```javascript
const http = require('http');
const url = require('url');

const server = http.createServer((req, res) => {
  const parsedUrl = url.parse(req.url, true);
  const query = parsedUrl.query;
  
  // http://localhost:3000/?name=John&age=30
  console.log('Name:', query.name);  // John
  console.log('Age:', query.age);    // 30
  
  res.end(`Hello ${query.name}, age ${query.age}`);
});

server.listen(3000);
```

---

## Status Codes

| Code | Meaning | Use Case |
|------|---------|----------|
| `200` | OK | Successful request |
| `201` | Created | Resource created (POST) |
| `204` | No Content | Successful, no body |
| `301` | Moved Permanently | Redirect (permanent) |
| `302` | Found | Redirect (temporary) |
| `400` | Bad Request | Invalid request |
| `401` | Unauthorized | Authentication required |
| `403` | Forbidden | No permission |
| `404` | Not Found | Resource not found |
| `500` | Internal Server Error | Server error |

---

## Setting Headers

```javascript
const server = http.createServer((req, res) => {
  // Method 1: writeHead
  res.writeHead(200, {
    'Content-Type': 'application/json',
    'X-Powered-By': 'Node.js',
    'Access-Control-Allow-Origin': '*'
  });
  
  // Method 2: setHeader
  res.setHeader('Content-Type', 'application/json');
  res.setHeader('Cache-Control', 'no-cache');
  
  res.end(JSON.stringify({ message: 'Hello' }));
});

server.listen(3000);
```

---

## Redirects

```javascript
const server = http.createServer((req, res) => {
  if (req.url === '/old-page') {
    res.writeHead(301, { 'Location': '/new-page' });
    res.end();
  } else if (req.url === '/new-page') {
    res.writeHead(200, { 'Content-Type': 'text/html' });
    res.end('<h1>New Page</h1>');
  }
});

server.listen(3000);
```

---

## Serving Static Files

```javascript
const http = require('http');
const fs = require('fs');
const path = require('path');

const server = http.createServer((req, res) => {
  let filePath = path.join(__dirname, 'public', req.url === '/' ? 'index.html' : req.url);
  
  const ext = path.extname(filePath);
  const contentType = {
    '.html': 'text/html',
    '.css': 'text/css',
    '.js': 'text/javascript',
    '.json': 'application/json',
    '.png': 'image/png',
    '.jpg': 'image/jpeg'
  }[ext] || 'text/plain';
  
  fs.readFile(filePath, (err, data) => {
    if (err) {
      res.writeHead(404);
      res.end('File not found');
      return;
    }
    
    res.writeHead(200, { 'Content-Type': contentType });
    res.end(data);
  });
});

server.listen(3000);
```

---

## Making HTTP Requests

### GET Request

```javascript
const http = require('http');

const options = {
  hostname: 'jsonplaceholder.typicode.com',
  path: '/users/1',
  method: 'GET'
};

const req = http.request(options, (res) => {
  let data = '';
  
  res.on('data', (chunk) => {
    data += chunk;
  });
  
  res.on('end', () => {
    console.log(JSON.parse(data));
  });
});

req.on('error', (err) => {
  console.error('Error:', err);
});

req.end();
```

### POST Request

```javascript
const http = require('http');

const postData = JSON.stringify({
  name: 'John',
  email: 'john@example.com'
});

const options = {
  hostname: 'jsonplaceholder.typicode.com',
  path: '/users',
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Content-Length': Buffer.byteLength(postData)
  }
};

const req = http.request(options, (res) => {
  let data = '';
  
  res.on('data', (chunk) => {
    data += chunk;
  });
  
  res.on('end', () => {
    console.log('Response:', JSON.parse(data));
  });
});

req.on('error', (err) => {
  console.error('Error:', err);
});

req.write(postData);
req.end();
```

---

## HTTPS Module

For secure connections:

```javascript
const https = require('https');

https.get('https://api.github.com/users/github', (res) => {
  let data = '';
  
  res.on('data', (chunk) => {
    data += chunk;
  });
  
  res.on('end', () => {
    console.log(JSON.parse(data));
  });
});
```

---

## Server Events

```javascript
const server = http.createServer();

// Request event
server.on('request', (req, res) => {
  res.end('Hello');
});

// Connection event
server.on('connection', (socket) => {
  console.log('New connection');
});

// Close event
server.on('close', () => {
  console.log('Server closed');
});

server.listen(3000);

// Close server after 10 seconds
setTimeout(() => {
  server.close();
}, 10000);
```

---

## Complete REST API Example

```javascript
const http = require('http');

let users = [
  { id: 1, name: 'John' },
  { id: 2, name: 'Jane' }
];

const server = http.createServer((req, res) => {
  const { method, url } = req;
  
  // GET all users
  if (url === '/api/users' && method === 'GET') {
    res.writeHead(200, { 'Content-Type': 'application/json' });
    res.end(JSON.stringify(users));
  }
  
  // GET user by ID
  else if (url.match(/\/api\/users\/\d+/) && method === 'GET') {
    const id = parseInt(url.split('/')[3]);
    const user = users.find(u => u.id === id);
    
    if (user) {
      res.writeHead(200, { 'Content-Type': 'application/json' });
      res.end(JSON.stringify(user));
    } else {
      res.writeHead(404);
      res.end('User not found');
    }
  }
  
  // POST create user
  else if (url === '/api/users' && method === 'POST') {
    let body = '';
    
    req.on('data', chunk => body += chunk);
    req.on('end', () => {
      const newUser = JSON.parse(body);
      newUser.id = users.length + 1;
      users.push(newUser);
      
      res.writeHead(201, { 'Content-Type': 'application/json' });
      res.end(JSON.stringify(newUser));
    });
  }
  
  // DELETE user
  else if (url.match(/\/api\/users\/\d+/) && method === 'DELETE') {
    const id = parseInt(url.split('/')[3]);
    users = users.filter(u => u.id !== id);
    
    res.writeHead(204);
    res.end();
  }
  
  else {
    res.writeHead(404);
    res.end('Not Found');
  }
});

server.listen(3000, () => {
  console.log('Server running on http://localhost:3000');
});
```

---

## Best Practices

✅ **Always set Content-Type**: Tells client what format the response is  
✅ **Handle errors**: Use try/catch and error events  
✅ **Use appropriate status codes**: Makes API intuitive  
✅ **Close responses**: Always call `res.end()`  
✅ **Parse request bodies properly**: Collect chunks first  
❌ **Don't use for production**: Use Express.js instead  
❌ **Don't forget error handlers**: Prevents server crashes  

---

## Summary

- **http.createServer()** creates a web server
- **req** object contains request information (method, url, headers)
- **res** object sends response (writeHead, write, end)
- Use routing to handle different URLs
- Parse POST data using `req.on('data')` and `req.on('end')`
- Set proper status codes and Content-Type headers
- For production, use frameworks like **Express.js**

**Next:** Learn about asynchronous programming with callbacks!
