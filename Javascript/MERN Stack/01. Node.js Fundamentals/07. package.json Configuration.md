# 07. package.json Configuration

## What is package.json?

**package.json** is the configuration file for your Node.js project. It contains:
- Project metadata
- Dependencies
- Scripts
- Configuration

---

## Creating package.json

```bash
# Interactive creation
npm init

# Skip questions (use defaults)
npm init -y
```

---

## Basic Structure

```json
{
  "name": "my-app",
  "version": "1.0.0",
  "description": "My awesome app",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "test": "jest"
  },
  "keywords": ["nodejs", "express"],
  "author": "Your Name",
  "license": "MIT",
  "dependencies": {
    "express": "^4.18.2"
  },
  "devDependencies": {
    "jest": "^29.0.0"
  }
}
```

---

## Essential Fields

### **name** (Required)

```json
{
  "name": "my-awesome-app"
}
```

Rules:
- Lowercase only
- No spaces (use hyphens)
- Max 214 characters
- No special characters

✅ `my-app`, `user-authentication`  
❌ `My App`, `my_app!`, `@special`

---

### **version** (Required)

```json
{
  "version": "1.0.0"
}
```

Format: `MAJOR.MINOR.PATCH`

```bash
# Update version
npm version patch  # 1.0.0 -> 1.0.1
npm version minor  # 1.0.0 -> 1.1.0
npm version major  # 1.0.0 -> 2.0.0
```

---

### **description**

```json
{
  "description": "A simple REST API for user management"
}
```

Shown in `npm search` results.

---

### **main**

```json
{
  "main": "index.js"
}
```

Entry point when your package is imported:

```javascript
// If package name is "my-lib"
const myLib = require('my-lib');  // Loads index.js
```

---

### **scripts**

Custom commands you can run:

```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest",
    "test:watch": "jest --watch",
    "build": "webpack --mode production",
    "lint": "eslint .",
    "format": "prettier --write ."
  }
}
```

Run scripts:
```bash
npm run dev
npm start      # 'start' doesn't need 'run'
npm test       # 'test' doesn't need 'run'
```

---

## Dependencies

### **dependencies** (Production)

Packages needed in production:

```json
{
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.0.0",
    "dotenv": "^16.0.3"
  }
}
```

Install:
```bash
npm install express
```

---

### **devDependencies** (Development Only)

Packages for development (testing, building):

```json
{
  "devDependencies": {
    "jest": "^29.0.0",
    "nodemon": "^2.0.20",
    "eslint": "^8.30.0"
  }
}
```

Install:
```bash
npm install --save-dev jest
# or
npm i -D jest
```

---

### **peerDependencies**

Packages your package expects the user to have:

```json
{
  "peerDependencies": {
    "react": "^18.0.0"
  }
}
```

Used in libraries (e.g., React plugins).

---

### **optionalDependencies**

Packages that enhance functionality but aren't required:

```json
{
  "optionalDependencies": {
    "fsevents": "^2.3.2"
  }
}
```

Installation continues even if these fail.

---

## Metadata Fields

### **author**

```json
{
  "author": "John Doe <john@example.com> (https://johndoe.com)"
}

// or object format
{
  "author": {
    "name": "John Doe",
    "email": "john@example.com",
    "url": "https://johndoe.com"
  }
}
```

---

### **contributors**

```json
{
  "contributors": [
    "Jane Smith <jane@example.com>",
    "Bob Johnson <bob@example.com>"
  ]
}
```

---

### **license**

```json
{
  "license": "MIT"
}
```

Common licenses:
- `MIT` - Most permissive
- `ISC` - Similar to MIT
- `Apache-2.0` - Patent protection
- `GPL-3.0` - Copyleft
- `UNLICENSED` - Private/proprietary

---

### **keywords**

```json
{
  "keywords": ["express", "api", "rest", "backend"]
}
```

Helps in npm search.

---

### **repository**

```json
{
  "repository": {
    "type": "git",
    "url": "https://github.com/username/repo.git"
  }
}
```

---

### **bugs**

```json
{
  "bugs": {
    "url": "https://github.com/username/repo/issues",
    "email": "bugs@example.com"
  }
}
```

---

### **homepage**

```json
{
  "homepage": "https://github.com/username/repo#readme"
}
```

---

## Engine Specifications

Specify Node.js/npm versions:

```json
{
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  }
}
```

Exact version:
```json
{
  "engines": {
    "node": "18.12.0"
  }
}
```

---

## Private Package

Prevent accidental publishing:

```json
{
  "private": true
}
```

---

## File Inclusion

### **files**

Files to include when publishing:

```json
{
  "files": [
    "lib/",
    "dist/",
    "README.md"
  ]
}
```

### **.npmignore**

Exclude files (like `.gitignore`):

```
node_modules/
*.log
.env
tests/
```

---

## Browser-Specific

For frontend packages:

```json
{
  "browser": "dist/bundle.js"
}
```

---

## Bin (CLI Tools)

Create command-line tools:

```json
{
  "bin": {
    "my-cli": "./bin/cli.js"
  }
}
```

Or single command:
```json
{
  "bin": "./bin/cli.js"
}
```

After `npm install -g`, you can run `my-cli` from terminal.

---

## Complete Example

```json
{
  "name": "express-user-api",
  "version": "1.0.0",
  "description": "User management REST API",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js",
    "test": "jest --coverage",
    "test:watch": "jest --watch",
    "lint": "eslint .",
    "format": "prettier --write ."
  },
  "keywords": [
    "express",
    "api",
    "users",
    "authentication"
  ],
  "author": {
    "name": "John Doe",
    "email": "john@example.com",
    "url": "https://johndoe.com"
  },
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/johndoe/express-user-api.git"
  },
  "bugs": {
    "url": "https://github.com/johndoe/express-user-api/issues"
  },
  "homepage": "https://github.com/johndoe/express-user-api#readme",
  "engines": {
    "node": ">=14.0.0",
    "npm": ">=6.0.0"
  },
  "dependencies": {
    "express": "^4.18.2",
    "mongoose": "^7.0.0",
    "dotenv": "^16.0.3",
    "bcrypt": "^5.1.0",
    "jsonwebtoken": "^9.0.0"
  },
  "devDependencies": {
    "nodemon": "^2.0.20",
    "jest": "^29.0.0",
    "supertest": "^6.3.0",
    "eslint": "^8.30.0",
    "prettier": "^2.8.0"
  }
}
```

---

## Useful Scripts Examples

### Development

```json
{
  "scripts": {
    "dev": "nodemon --watch src src/index.js",
    "dev:debug": "nodemon --inspect src/index.js"
  }
}
```

### Testing

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:unit": "jest --testPathPattern=unit",
    "test:integration": "jest --testPathPattern=integration"
  }
}
```

### Building

```json
{
  "scripts": {
    "build": "webpack --mode production",
    "build:dev": "webpack --mode development",
    "clean": "rm -rf dist"
  }
}
```

### Linting & Formatting

```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check ."
  }
}
```

### Combined

```json
{
  "scripts": {
    "prepare": "npm run build",
    "pretest": "npm run lint",
    "prepublishOnly": "npm test && npm run build"
  }
}
```

---

## Lifecycle Scripts

Run automatically at certain times:

| Script | When it Runs |
|--------|-------------|
| `preinstall` | Before package install |
| `postinstall` | After package install |
| `prepublish` | Before publish |
| `prepublishOnly` | Before publish (only) |
| `preversion` | Before version bump |
| `postversion` | After version bump |

Example:
```json
{
  "scripts": {
    "pretest": "npm run lint",
    "test": "jest",
    "posttest": "npm run coverage"
  }
}
```

---

## Best Practices

✅ **Use semantic versioning**: Follow MAJOR.MINOR.PATCH  
✅ **Lock exact versions in apps**: Use `npm install --save-exact`  
✅ **Separate dev dependencies**: Keeps production lean  
✅ **Add useful scripts**: Standardizes workflows  
✅ **Specify engines**: Avoid version conflicts  
✅ **Set private: true**: For non-published projects  
✅ **Add repository/bugs**: Helps users contribute  

---

## Summary

- **package.json** defines your project
- Required fields: `name`, `version`
- **dependencies** for production, **devDependencies** for development
- **scripts** define custom commands
- **engines** specify Node.js/npm versions
- Use semantic versioning (`MAJOR.MINOR.PATCH`)
- Set `private: true` to prevent accidental publishing

**Next:** Learn about the File System (fs) module!
