# 08. File System (fs) Module

## What is the fs Module?

The **fs (File System)** module allows you to work with files and directories on your computer.

```javascript
const fs = require('fs');
```

---

## Reading Files

### **Synchronous (Blocking)**

```javascript
const fs = require('fs');

// Blocks execution until file is read
const data = fs.readFileSync('file.txt', 'utf8');
console.log(data);
console.log('This runs after file is read');
```

### **Asynchronous (Non-blocking)** ✅ Recommended

```javascript
const fs = require('fs');

// Doesn't block - uses callback
fs.readFile('file.txt', 'utf8', (err, data) => {
  if (err) {
    console.error('Error reading file:', err);
    return;
  }
  console.log(data);
});
console.log('This runs immediately!');
```

### **Promises (Modern)** ✅ Best

```javascript
const fs = require('fs').promises;

// Using async/await
async function readFile() {
  try {
    const data = await fs.readFile('file.txt', 'utf8');
    console.log(data);
  } catch (err) {
    console.error('Error:', err);
  }
}

readFile();
```

---

## Writing Files

### **Write (Overwrite)**

```javascript
const fs = require('fs');

// Async
fs.writeFile('output.txt', 'Hello World!', (err) => {
  if (err) throw err;
  console.log('File written!');
});

// Sync
fs.writeFileSync('output.txt', 'Hello World!');
```

### **Append (Add to end)**

```javascript
fs.appendFile('log.txt', 'New log entry\n', (err) => {
  if (err) throw err;
  console.log('Appended!');
});
```

---

## Deleting Files

```javascript
// Delete file
fs.unlink('file.txt', (err) => {
  if (err) throw err;
  console.log('File deleted!');
});

// Sync version
fs.unlinkSync('file.txt');
```

---

## Checking if File Exists

```javascript
const fs = require('fs');

// Modern way (promises)
fs.promises.access('file.txt')
  .then(() => console.log('File exists'))
  .catch(() => console.log('File does not exist'));

// Using existsSync (easier)
if (fs.existsSync('file.txt')) {
  console.log('File exists');
} else {
  console.log('File does not exist');
}
```

---

## File Information (Stats)

```javascript
fs.stat('file.txt', (err, stats) => {
  if (err) throw err;
  
  console.log('Is file:', stats.isFile());
  console.log('Is directory:', stats.isDirectory());
  console.log('File size:', stats.size, 'bytes');
  console.log('Created:', stats.birthtime);
  console.log('Modified:', stats.mtime);
});
```

---

## Working with Directories

### **Create Directory**

```javascript
// Create single directory
fs.mkdir('new-folder', (err) => {
  if (err) throw err;
  console.log('Directory created!');
});

// Create nested directories (recursive)
fs.mkdir('path/to/folder', { recursive: true }, (err) => {
  if (err) throw err;
  console.log('Directories created!');
});
```

### **Read Directory Contents**

```javascript
fs.readdir('.', (err, files) => {
  if (err) throw err;
  console.log('Files:', files);
  // ['file1.txt', 'file2.js', 'folder1']
});

// With file types
fs.readdir('.', { withFileTypes: true }, (err, entries) => {
  if (err) throw err;
  
  entries.forEach(entry => {
    console.log(entry.name, entry.isDirectory() ? '[DIR]' : '[FILE]');
  });
});
```

### **Remove Directory**

```javascript
// Remove empty directory
fs.rmdir('folder', (err) => {
  if (err) throw err;
  console.log('Directory removed!');
});

// Remove directory with contents (Node 14.14+)
fs.rm('folder', { recursive: true }, (err) => {
  if (err) throw err;
  console.log('Directory and contents removed!');
});
```

---

## Renaming & Moving Files

```javascript
// Rename file
fs.rename('old.txt', 'new.txt', (err) => {
  if (err) throw err;
  console.log('File renamed!');
});

// Move file to different directory
fs.rename('file.txt', 'folder/file.txt', (err) => {
  if (err) throw err;
  console.log('File moved!');
});
```

---

## Copying Files

```javascript
// Copy file
fs.copyFile('source.txt', 'destination.txt', (err) => {
  if (err) throw err;
  console.log('File copied!');
});

// Don't overwrite if exists
fs.copyFile('source.txt', 'dest.txt', fs.constants.COPYFILE_EXCL, (err) => {
  if (err) {
    console.log('File already exists');
    return;
  }
  console.log('File copied!');
});
```

---

## Watching Files for Changes

```javascript
// Watch file for changes
fs.watch('file.txt', (eventType, filename) => {
  console.log('Event:', eventType);  // 'rename' or 'change'
  console.log('File:', filename);
});

// Watch directory
fs.watch('.', (eventType, filename) => {
  console.log(`${filename} ${eventType}d`);
});
```

---

## Practical Examples

### Example 1: Read JSON File

```javascript
const fs = require('fs').promises;

async function readJSON(filename) {
  try {
    const data = await fs.readFile(filename, 'utf8');
    return JSON.parse(data);
  } catch (err) {
    console.error('Error reading JSON:', err);
    return null;
  }
}

// Usage
const config = await readJSON('config.json');
console.log(config);
```

### Example 2: Write JSON File

```javascript
const fs = require('fs').promises;

async function writeJSON(filename, data) {
  try {
    await fs.writeFile(filename, JSON.stringify(data, null, 2));
    console.log('JSON saved!');
  } catch (err) {
    console.error('Error writing JSON:', err);
  }
}

// Usage
await writeJSON('data.json', { name: 'John', age: 30 });
```

### Example 3: List All Files Recursively

```javascript
const fs = require('fs').promises;
const path = require('path');

async function listFiles(dir) {
  const entries = await fs.readdir(dir, { withFileTypes: true });
  
  const files = await Promise.all(entries.map(async (entry) => {
    const fullPath = path.join(dir, entry.name);
    
    if (entry.isDirectory()) {
      return listFiles(fullPath);  // Recursive
    } else {
      return fullPath;
    }
  }));
  
  return files.flat();
}

// Usage
const allFiles = await listFiles('.');
console.log(allFiles);
```

### Example 4: Create Backup

```javascript
const fs = require('fs').promises;

async function backupFile(filename) {
  const timestamp = new Date().toISOString().replace(/:/g, '-');
  const backupName = `${filename}.${timestamp}.bak`;
  
  try {
    await fs.copyFile(filename, backupName);
    console.log(`Backup created: ${backupName}`);
  } catch (err) {
    console.error('Backup failed:', err);
  }
}

// Usage
await backupFile('important.txt');
```

---

## Common Encoding Types

```javascript
// UTF-8 (default for text)
fs.readFile('file.txt', 'utf8', callback);

// Binary
fs.readFile('image.png', (err, buffer) => {
  // buffer contains binary data
});

// Other encodings
fs.readFile('file.txt', 'ascii', callback);
fs.readFile('file.txt', 'base64', callback);
```

---

## Error Handling

```javascript
// Always handle errors!
fs.readFile('file.txt', 'utf8', (err, data) => {
  if (err) {
    if (err.code === 'ENOENT') {
      console.error('File not found');
    } else if (err.code === 'EACCES') {
      console.error('Permission denied');
    } else {
      console.error('Error:', err);
    }
    return;
  }
  console.log(data);
});

// With promises
try {
  const data = await fs.promises.readFile('file.txt', 'utf8');
  console.log(data);
} catch (err) {
  console.error('Error:', err.message);
}
```

---

## Sync vs Async Comparison

| Operation | Synchronous | Asynchronous |
|-----------|-------------|--------------|
| **Blocks?** | ✅ Yes | ❌ No |
| **Use in production?** | ❌ Rarely | ✅ Always |
| **Error handling** | try/catch | Callback/Promise |
| **When to use?** | Scripts, initialization | Web servers, APIs |

---

## Best Practices

✅ **Use async methods**: Don't block the event loop  
✅ **Handle errors**: Always check for errors  
✅ **Use promises**: Cleaner than callbacks  
✅ **Close file descriptors**: Use `fs.close()` after `fs.open()`  
✅ **Use path module**: For cross-platform paths  
❌ **Avoid sync in servers**: Blocks all requests  

---

## Summary

- `fs` module works with files and directories
- Async methods (callbacks/promises) are preferred
- `readFile()` reads, `writeFile()` writes, `appendFile()` appends
- `mkdir()` creates directories, `readdir()` lists contents
- `stat()` gets file info, `watch()` monitors changes
- Always handle errors properly
- Use `fs.promises` for cleaner async code

**Next:** Learn about Path and OS modules!
