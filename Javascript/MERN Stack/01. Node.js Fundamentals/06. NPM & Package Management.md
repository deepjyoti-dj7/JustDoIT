# 06. NPM & Package Management

## What is NPM?

**NPM (Node Package Manager)** is the default package manager for Node.js. It helps you:
- Install third-party packages
- Manage dependencies
- Share your own packages
- Run scripts

```bash
npm --version  # Check version
```

---

## Installing Packages

### **Local Installation** (Project-specific)

```bash
# Install package in current project
npm install express

# or shorthand
npm i express

# Install multiple packages
npm install express mongoose dotenv
```

### **Global Installation** (System-wide)

```bash
# Install globally (available everywhere)
npm install -g nodemon

# Use cases: CLI tools, development utilities
```

### **Dev Dependencies** (Only for development)

```bash
# Install as dev dependency
npm install --save-dev jest

# or shorthand
npm i -D jest

# Examples: testing tools, build tools, linters
```

---

## Package Types

| Type | Command | When to Use |
|------|---------|-------------|
| **Regular** | `npm i express` | Production code (deployed) |
| **Dev** | `npm i -D jest` | Development only (testing, building) |
| **Global** | `npm i -g nodemon` | CLI tools |

---

## Uninstalling Packages

```bash
# Uninstall local package
npm uninstall express

# Uninstall global package
npm uninstall -g nodemon

# Shorthand
npm un express
```

---

## Updating Packages

```bash
# Update specific package
npm update express

# Update all packages
npm update

# Check for outdated packages
npm outdated
```

---

## Viewing Installed Packages

```bash
# List local packages
npm list

# List only top-level packages
npm list --depth=0

# List global packages
npm list -g --depth=0
```

---

## Semantic Versioning (SemVer)

```
Version: MAJOR.MINOR.PATCH
Example: 2.14.3

MAJOR (2): Breaking changes
MINOR (14): New features (backward compatible)
PATCH (3): Bug fixes
```

### Version Symbols

```json
{
  "express": "4.18.2",      // Exact version
  "mongoose": "^7.0.0",     // Minor updates allowed (^)
  "dotenv": "~16.0.3",      // Patch updates allowed (~)
  "lodash": "*"             // Any version (not recommended)
}
```

| Symbol | Meaning | Updates Allowed |
|--------|---------|-----------------|
| `4.18.2` | Exact | None |
| `^4.18.2` | Compatible | 4.x.x (not 5.0.0) |
| `~4.18.2` | Patch | 4.18.x (not 4.19.0) |
| `*` | Latest | Any |

---

## NPM Scripts

Define custom commands in `package.json`:

```json
{
  "scripts": {
    "start": "node app.js",
    "dev": "nodemon app.js",
    "test": "jest",
    "build": "webpack"
  }
}
```

Run scripts:
```bash
npm run start
npm run dev
npm run test

# 'start' and 'test' can omit 'run'
npm start
npm test
```

---

## package-lock.json

```bash
# Automatically created when you install packages
# DO NOT edit manually
# DO commit to version control
```

**Purpose:**
- Locks exact versions of all dependencies
- Ensures consistent installs across teams
- Speeds up installation

---

## Common Commands

| Command | Description |
|---------|-------------|
| `npm init` | Create package.json |
| `npm install` | Install all dependencies |
| `npm install <pkg>` | Install package |
| `npm i -D <pkg>` | Install dev dependency |
| `npm i -g <pkg>` | Install globally |
| `npm uninstall <pkg>` | Remove package |
| `npm update` | Update packages |
| `npm outdated` | Check outdated packages |
| `npm list` | List installed packages |
| `npm run <script>` | Run custom script |

---

## Practical Examples

### Example 1: Start New Project

```bash
# Create folder and initialize
mkdir my-project
cd my-project
npm init -y  # -y skips questions

# Install packages
npm install express mongoose dotenv

# Install dev tools
npm i -D nodemon jest eslint
```

### Example 2: Install Specific Version

```bash
# Install exact version
npm install express@4.18.2

# Install latest major version
npm install express@4

# Install beta version
npm install react@next
```

### Example 3: Clean Install

```bash
# Remove node_modules and reinstall
rm -rf node_modules
npm install

# or use clean install (faster, stricter)
npm ci
```

---

## npx - Package Runner

```bash
# Run package without installing globally
npx create-react-app my-app

# Run local package
npx nodemon app.js

# Try package temporarily
npx cowsay "Hello!"
```

---

## Finding Packages

```bash
# Search for packages
npm search express

# View package info
npm info express

# Open package homepage
npm home express

# View package repository
npm repo express
```

---

## Publishing Your Package

```bash
# 1. Create npm account at npmjs.com
# 2. Login
npm login

# 3. Publish
npm publish

# Update version before publishing
npm version patch  # 1.0.0 -> 1.0.1
npm version minor  # 1.0.0 -> 1.1.0
npm version major  # 1.0.0 -> 2.0.0
```

---

## .npmrc Configuration

Create `.npmrc` file for custom settings:

```ini
# Set npm registry
registry=https://registry.npmjs.org/

# Save exact versions by default
save-exact=true

# Increase installation timeout
timeout=120000
```

---

## Common Issues

### Issue 1: Permission Errors (Global Install)

```bash
# Don't use sudo! Use nvm instead
# Or fix npm permissions:
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
export PATH=~/.npm-global/bin:$PATH
```

### Issue 2: Package Not Found

```bash
# Clear cache
npm cache clean --force

# Reinstall
rm -rf node_modules package-lock.json
npm install
```

### Issue 3: Version Conflicts

```bash
# Check dependencies tree
npm list express

# Force latest versions
npm update --depth 9999
```

---

## Best Practices

✅ **Commit package-lock.json**: Ensures consistent installs  
✅ **Use exact versions in production**: Avoid surprises  
✅ **Separate dev dependencies**: Keep production lean  
✅ **Use npm scripts**: Standardize commands across team  
✅ **Keep packages updated**: Security and features  
❌ **Don't commit node_modules**: Too large, regenerate from package.json  
❌ **Don't install globally unnecessarily**: Use npx instead  

---

## npm vs npx vs yarn

| | npm | npx | yarn |
|-|-----|-----|------|
| **Purpose** | Package manager | Package runner | Alternative to npm |
| **Install** | Permanent | Temporary | Permanent |
| **Speed** | Good | N/A | Faster |
| **Lock file** | package-lock.json | N/A | yarn.lock |

---

## Summary

- **npm** manages Node.js packages
- `npm install <package>` to install
- `npm i -D <package>` for dev dependencies
- `npm i -g <package>` for global install
- **Semantic versioning**: `^` (minor), `~` (patch)
- **package-lock.json** locks exact versions
- **npm scripts** for custom commands
- **npx** runs packages without installing

**Next:** Learn about package.json configuration!
