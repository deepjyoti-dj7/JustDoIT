# 08. Git Workflow

## Introduction

Effective Git workflows enable team collaboration, code quality, and organized development. This guide covers branching strategies, commit conventions, and collaboration best practices.

---

## Git Branching Strategies

### 1. Git Flow

Structured workflow with multiple branch types.

**Branch Types**:
- `main` - Production-ready code
- `develop` - Integration branch for features
- `feature/*` - New features
- `release/*` - Release preparation
- `hotfix/*` - Production bug fixes

**Workflow**:
```bash
# Start new feature
git checkout develop
git checkout -b feature/user-authentication

# Work on feature
git add .
git commit -m "feat: add login functionality"

# Finish feature
git checkout develop
git merge feature/user-authentication
git branch -d feature/user-authentication

# Create release
git checkout develop
git checkout -b release/1.0.0
# Bug fixes only

# Finish release
git checkout main
git merge release/1.0.0
git tag -a v1.0.0 -m "Version 1.0.0"
git checkout develop
git merge release/1.0.0
git branch -d release/1.0.0

# Hotfix
git checkout main
git checkout -b hotfix/critical-bug
# Fix the bug
git checkout main
git merge hotfix/critical-bug
git tag -a v1.0.1 -m "Hotfix 1.0.1"
git checkout develop
git merge hotfix/critical-bug
git branch -d hotfix/critical-bug
```

### 2. GitHub Flow

Simpler workflow, ideal for continuous deployment.

**Branch Types**:
- `main` - Production-ready code
- `feature/*` - All new work

**Workflow**:
```bash
# Create branch from main
git checkout main
git pull origin main
git checkout -b feature/add-comments

# Make changes and commit
git add .
git commit -m "feat: add comment system"

# Push to remote
git push origin feature/add-comments

# Create Pull Request on GitHub
# After review and approval, merge to main
# Deploy automatically
```

### 3. Trunk-Based Development

Developers work on short-lived branches or directly on `main`.

```bash
# Create short-lived branch
git checkout main
git pull origin main
git checkout -b quick-fix

# Make small change
git add .
git commit -m "fix: resolve login bug"

# Push and create PR immediately
git push origin quick-fix

# Merge quickly (within a day)
```

---

## Branch Naming Conventions

### Format

```
<type>/<short-description>
```

### Types

- `feature/` - New features
- `bugfix/` - Bug fixes
- `hotfix/` - Urgent production fixes
- `refactor/` - Code refactoring
- `docs/` - Documentation changes
- `test/` - Test additions/changes
- `chore/` - Maintenance tasks

### Examples

```bash
git checkout -b feature/user-profile
git checkout -b bugfix/login-error
git checkout -b hotfix/payment-gateway
git checkout -b refactor/api-routes
git checkout -b docs/readme-update
git checkout -b test/user-controller
git checkout -b chore/update-dependencies
```

---

## Commit Message Conventions

### Conventional Commits Format

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types

- `feat` - New feature
- `fix` - Bug fix
- `docs` - Documentation
- `style` - Code style (formatting)
- `refactor` - Code refactoring
- `perf` - Performance improvement
- `test` - Tests
- `chore` - Maintenance
- `build` - Build system
- `ci` - CI/CD

### Examples

```bash
# Simple commits
git commit -m "feat: add user registration"
git commit -m "fix: resolve login validation error"
git commit -m "docs: update API documentation"

# With scope
git commit -m "feat(auth): add JWT authentication"
git commit -m "fix(api): handle null values in response"

# With body and footer
git commit -m "feat(payment): integrate Stripe

Added Stripe payment gateway for subscription plans.
Implemented webhook handlers for payment events.

Closes #123"
```

### Best Practices

1. **Use imperative mood**: "add" not "added"
2. **Keep subject under 50 characters**
3. **Capitalize subject**
4. **No period at end**
5. **Separate subject from body with blank line**
6. **Wrap body at 72 characters**
7. **Explain what and why, not how**

---

## Pull Request Workflow

### 1. Creating a PR

```bash
# Ensure branch is up to date
git checkout main
git pull origin main
git checkout feature/new-feature
git merge main  # or git rebase main

# Push branch
git push origin feature/new-feature

# Create PR on GitHub
```

### 2. PR Template

**`.github/pull_request_template.md`**:
```markdown
## Description
Brief description of changes

## Type of Change
- [ ] Bug fix (non-breaking change)
- [ ] New feature (non-breaking change)
- [ ] Breaking change
- [ ] Documentation update

## How Has This Been Tested?
- [ ] Unit tests
- [ ] Integration tests
- [ ] Manual testing

## Checklist
- [ ] Code follows project style guidelines
- [ ] Self-review performed
- [ ] Comments added for complex code
- [ ] Documentation updated
- [ ] No new warnings
- [ ] Tests added/updated
- [ ] All tests pass

## Screenshots (if applicable)

## Related Issues
Closes #
```

### 3. Code Review Process

1. **Author**: Create PR with clear description
2. **Reviewers**: Assigned automatically or manually
3. **Review**: Check code quality, functionality, tests
4. **Feedback**: Request changes if needed
5. **Update**: Author addresses feedback
6. **Approval**: Reviewers approve PR
7. **Merge**: Merge to target branch

### 4. Merge Strategies

**Merge Commit**:
```bash
git checkout main
git merge feature/new-feature
# Creates merge commit, preserves history
```

**Squash and Merge**:
```bash
git checkout main
git merge --squash feature/new-feature
git commit -m "feat: add new feature"
# Combines all commits into one
```

**Rebase and Merge**:
```bash
git checkout feature/new-feature
git rebase main
git checkout main
git merge feature/new-feature
# Linear history, no merge commit
```

---

## Common Git Commands

### Basic Operations

```bash
# Clone repository
git clone <url>

# Check status
git status

# Add files
git add .
git add <file>

# Commit
git commit -m "message"
git commit -am "message"  # Add and commit

# Push
git push origin <branch>

# Pull
git pull origin <branch>

# Fetch
git fetch origin
```

### Branch Management

```bash
# List branches
git branch
git branch -a  # Include remote

# Create branch
git branch <name>
git checkout -b <name>

# Switch branch
git checkout <name>
git switch <name>  # Git 2.23+

# Delete branch
git branch -d <name>
git branch -D <name>  # Force delete

# Rename branch
git branch -m <old> <new>
```

### Undoing Changes

```bash
# Discard changes in working directory
git restore <file>
git checkout -- <file>

# Unstage files
git restore --staged <file>
git reset HEAD <file>

# Undo last commit (keep changes)
git reset --soft HEAD~1

# Undo last commit (discard changes)
git reset --hard HEAD~1

# Revert commit (creates new commit)
git revert <commit-hash>
```

### Stashing

```bash
# Stash changes
git stash
git stash save "WIP: feature"

# List stashes
git stash list

# Apply stash
git stash apply
git stash apply stash@{0}

# Pop stash (apply and remove)
git stash pop

# Drop stash
git stash drop stash@{0}
```

### Rebase

```bash
# Rebase current branch onto main
git rebase main

# Interactive rebase (last 3 commits)
git rebase -i HEAD~3

# Continue after resolving conflicts
git rebase --continue

# Abort rebase
git rebase --abort
```

### Cherry-pick

```bash
# Apply specific commit to current branch
git cherry-pick <commit-hash>

# Cherry-pick multiple commits
git cherry-pick <hash1> <hash2>
```

---

## .gitignore

### Backend (Node.js)

```gitignore
# Dependencies
node_modules/

# Environment variables
.env
.env.local
.env.production

# Logs
logs/
*.log
npm-debug.log*

# Build
dist/
build/

# Coverage
coverage/

# OS
.DS_Store
Thumbs.db

# IDE
.vscode/
.idea/
*.swp
*.swo

# Temp
*.tmp
.cache/
```

### Frontend (React)

```gitignore
# Dependencies
node_modules/

# Production build
build/
dist/

# Environment
.env
.env.local
.env.production

# Testing
coverage/

# Misc
.DS_Store
*.log
npm-debug.log*

# IDE
.vscode/
.idea/
```

---

## Git Hooks

### Pre-commit Hook

**`.husky/pre-commit`**:
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx lint-staged
```

### Pre-push Hook

**`.husky/pre-push`**:
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm test
```

### Commit-msg Hook

**`.husky/commit-msg`**:
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npx --no-install commitlint --edit $1
```

---

## Semantic Versioning

### Format: MAJOR.MINOR.PATCH

- **MAJOR**: Breaking changes (1.0.0 → 2.0.0)
- **MINOR**: New features (1.0.0 → 1.1.0)
- **PATCH**: Bug fixes (1.0.0 → 1.0.1)

### Creating Tags

```bash
# Annotated tag (recommended)
git tag -a v1.0.0 -m "Release version 1.0.0"

# Lightweight tag
git tag v1.0.0

# Push tags
git push origin v1.0.0
git push origin --tags

# List tags
git tag

# Delete tag
git tag -d v1.0.0
git push origin :refs/tags/v1.0.0
```

---

## Collaboration Best Practices

### 1. Keep Branches Updated

```bash
# Regularly sync with main
git checkout main
git pull origin main
git checkout feature/my-feature
git merge main
```

### 2. Small, Focused Commits

```bash
# ❌ Bad - one large commit
git add .
git commit -m "Added features and fixed bugs"

# ✅ Good - multiple focused commits
git add auth.js
git commit -m "feat: add login functionality"
git add validation.js
git commit -m "feat: add input validation"
git add auth.test.js
git commit -m "test: add auth tests"
```

### 3. Write Descriptive Commit Messages

```bash
# ❌ Bad
git commit -m "fix"
git commit -m "updated files"

# ✅ Good
git commit -m "fix: resolve null pointer exception in getUserById"
git commit -m "feat(api): add pagination to user list endpoint"
```

### 4. Review Your Changes Before Committing

```bash
git diff  # See unstaged changes
git diff --staged  # See staged changes
git status  # Check what's being committed
```

---

## Interview Questions

**Q1: Git Flow vs GitHub Flow?**
- **Git Flow**: Multiple branch types (main, develop, feature, release, hotfix)
- **GitHub Flow**: Simple (main + feature branches), continuous deployment

**Q2: What is a merge conflict and how to resolve?**
- Occurs when same code modified in different branches
- Resolve: Edit conflicted files, mark as resolved, commit

**Q3: Difference between merge and rebase?**
- **Merge**: Combines branches, creates merge commit, preserves history
- **Rebase**: Replays commits on top of another branch, linear history

**Q4: What is git cherry-pick?**
- Apply specific commit from one branch to another
- Usage: `git cherry-pick <commit-hash>`

**Q5: What is semantic versioning?**
- MAJOR.MINOR.PATCH
- MAJOR: Breaking changes
- MINOR: New features (backward compatible)
- PATCH: Bug fixes

---

## Summary

- **Branching**: Git Flow (structured), GitHub Flow (simple), Trunk-based (fast)
- **Commits**: Conventional commits, imperative mood, focused changes
- **PRs**: Clear descriptions, code review, merge strategies
- **Commands**: branch, commit, merge, rebase, stash, cherry-pick
- **Collaboration**: Keep updated, small commits, descriptive messages
- **Versioning**: Semantic versioning (MAJOR.MINOR.PATCH)
