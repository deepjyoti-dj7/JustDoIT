# 11. Common Pitfalls & Interview Questions

## Introduction

This guide covers common mistakes in MERN development and comprehensive interview questions to test your knowledge.

---

## Common Pitfalls

### 1. Missing Error Handling

**❌ Bad**:
```javascript
app.get('/api/users/:id', async (req, res) => {
  const user = await User.findById(req.params.id);
  res.json(user); // What if user is null? What if DB error?
});
```

**✅ Good**:
```javascript
app.get('/api/users/:id', async (req, res, next) => {
  try {
    const user = await User.findById(req.params.id);
    if (!user) {
      return res.status(404).json({ error: 'User not found' });
    }
    res.json(user);
  } catch (error) {
    next(error);
  }
});
```

### 2. Not Validating Input

**❌ Bad**:
```javascript
app.post('/api/users', async (req, res) => {
  const user = await User.create(req.body); // Dangerous!
  res.json(user);
});
```

**✅ Good**:
```javascript
const { body, validationResult } = require('express-validator');

app.post('/api/users',
  [
    body('email').isEmail(),
    body('password').isLength({ min: 6 }),
    body('name').trim().notEmpty()
  ],
  async (req, res) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    const user = await User.create(req.body);
    res.json(user);
  }
);
```

### 3. Exposing Sensitive Data

**❌ Bad**:
```javascript
app.get('/api/users', async (req, res) => {
  const users = await User.find(); // Returns passwords!
  res.json(users);
});
```

**✅ Good**:
```javascript
app.get('/api/users', async (req, res) => {
  const users = await User.find().select('-password');
  res.json(users);
});

// Or in schema
userSchema.methods.toJSON = function() {
  const user = this.toObject();
  delete user.password;
  return user;
};
```

### 4. Storing Passwords in Plain Text

**❌ Bad**:
```javascript
const user = await User.create({
  email: req.body.email,
  password: req.body.password // Plain text!
});
```

**✅ Good**:
```javascript
const bcrypt = require('bcryptjs');

userSchema.pre('save', async function(next) {
  if (!this.isModified('password')) return next();
  this.password = await bcrypt.hash(this.password, 10);
  next();
});
```

### 5. N+1 Query Problem

**❌ Bad**:
```javascript
const posts = await Post.find();

for (let post of posts) {
  post.author = await User.findById(post.authorId); // N queries!
}
```

**✅ Good**:
```javascript
const posts = await Post.find().populate('author'); // 1 query!
```

### 6. Not Using Environment Variables

**❌ Bad**:
```javascript
mongoose.connect('mongodb://localhost:27017/mydb');
const JWT_SECRET = 'my_secret_key';
```

**✅ Good**:
```javascript
require('dotenv').config();

mongoose.connect(process.env.MONGO_URI);
const JWT_SECRET = process.env.JWT_SECRET;
```

### 7. Memory Leaks (Not Closing Connections)

**❌ Bad**:
```javascript
app.get('/api/data', async (req, res) => {
  const client = new MongoClient(uri);
  await client.connect();
  const data = await client.db().collection('data').find().toArray();
  res.json(data);
  // Connection not closed!
});
```

**✅ Good**:
```javascript
// Use connection pooling with Mongoose
mongoose.connect(uri, { maxPoolSize: 10 });

app.get('/api/data', async (req, res) => {
  const data = await Data.find();
  res.json(data);
});
```

### 8. Inefficient React Renders

**❌ Bad**:
```javascript
function UserList({ users }) {
  return users.map(user => <User user={user} />); // Re-renders all on any change
}
```

**✅ Good**:
```javascript
const User = React.memo(({ user }) => {
  return <div>{user.name}</div>;
});

function UserList({ users }) {
  return users.map(user => <User key={user.id} user={user} />);
}
```

### 9. Not Handling CORS

**❌ Bad**:
```javascript
// No CORS configuration
app.get('/api/users', (req, res) => {
  res.json(users); // Frontend can't access!
});
```

**✅ Good**:
```javascript
const cors = require('cors');

app.use(cors({
  origin: process.env.FRONTEND_URL,
  credentials: true
}));
```

### 10. Missing Rate Limiting

**❌ Bad**:
```javascript
app.post('/api/auth/login', async (req, res) => {
  // Vulnerable to brute force attacks!
});
```

**✅ Good**:
```javascript
const rateLimit = require('express-rate-limit');

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000,
  max: 5
});

app.post('/api/auth/login', limiter, async (req, res) => {
  // Protected
});
```

### 11. useEffect Dependencies

**❌ Bad**:
```javascript
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, []); // Missing userId dependency!
  
  return <div>{user?.name}</div>;
}
```

**✅ Good**:
```javascript
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetchUser(userId).then(setUser);
  }, [userId]); // Correct dependencies
  
  return <div>{user?.name}</div>;
}
```

### 12. Large Bundle Size

**❌ Bad**:
```javascript
import _ from 'lodash'; // Imports entire library!
import moment from 'moment'; // Large library
```

**✅ Good**:
```javascript
import debounce from 'lodash/debounce'; // Import specific function
import { format } from 'date-fns'; // Smaller alternative

// Or use code splitting
const Dashboard = React.lazy(() => import('./Dashboard'));
```

---

## Interview Questions

### JavaScript Fundamentals

**Q1: What is the difference between `var`, `let`, and `const`?**
- `var`: Function-scoped, hoisted, can be redeclared
- `let`: Block-scoped, not hoisted, can be reassigned
- `const`: Block-scoped, not hoisted, cannot be reassigned (but objects can be mutated)

**Q2: Explain closures with an example**
```javascript
function outer() {
  let count = 0;
  return function inner() {
    count++;
    return count;
  };
}
const counter = outer();
counter(); // 1
counter(); // 2
// inner() has access to outer's variables even after outer() returns
```

**Q3: What is the event loop?**
- JavaScript is single-threaded
- Event loop manages async operations
- Call stack → Web APIs → Callback queue → Call stack

**Q4: Difference between `==` and `===`?**
- `==`: Loose equality, type coercion (5 == "5" is true)
- `===`: Strict equality, no type coercion (5 === "5" is false)

**Q5: What is `this` keyword?**
- Refers to the object that is executing the current function
- In regular functions: depends on how function is called
- In arrow functions: lexically bound (inherits from outer scope)

### React

**Q6: What is Virtual DOM?**
- Lightweight copy of actual DOM
- React compares Virtual DOM with previous version
- Only updates changed parts in real DOM (reconciliation)

**Q7: useState vs useReducer?**
- `useState`: Simple state, independent updates
- `useReducer`: Complex state, multiple sub-values, state transitions

**Q8: When to use useMemo vs useCallback?**
- `useMemo`: Memoize expensive calculations, returns value
- `useCallback`: Memoize functions to prevent re-creation, returns function

**Q9: What is prop drilling and how to avoid it?**
- Passing props through multiple levels
- Solutions: Context API, Redux, Component composition

**Q10: Controlled vs Uncontrolled components?**
- **Controlled**: Form data controlled by React state
- **Uncontrolled**: Form data controlled by DOM (use refs)

### Node.js/Express

**Q11: What is middleware in Express?**
- Functions that have access to req, res, next
- Execute code, modify req/res, end request, call next middleware
```javascript
app.use((req, res, next) => {
  console.log('Request:', req.method, req.url);
  next();
});
```

**Q12: Difference between app.use() and app.get()?**
- `app.use()`: Executes for all HTTP methods, can be middleware
- `app.get()`: Only for GET requests, route handler

**Q13: How does Node.js handle concurrency?**
- Single-threaded with event loop
- Non-blocking I/O operations
- Async operations handled by libuv (thread pool)

**Q14: What is CORS and how to enable it?**
- Cross-Origin Resource Sharing
- Security feature to allow/restrict cross-origin requests
```javascript
const cors = require('cors');
app.use(cors());
```

**Q15: What is the purpose of package-lock.json?**
- Locks exact versions of dependencies
- Ensures consistent installs across environments
- Faster installs (doesn't resolve versions again)

### MongoDB/Mongoose

**Q16: SQL vs NoSQL?**
- **SQL**: Structured, relational, ACID, schema-based (PostgreSQL, MySQL)
- **NoSQL**: Flexible schema, horizontal scaling, eventual consistency (MongoDB)

**Q17: What are indexes in MongoDB?**
- Special data structures for faster queries
- Trade-off: Faster reads, slower writes, more storage
```javascript
userSchema.index({ email: 1 });
```

**Q18: Explain aggregation pipeline**
```javascript
User.aggregate([
  { $match: { isActive: true } },
  { $group: { _id: '$country', count: { $sum: 1 } } },
  { $sort: { count: -1 } }
]);
// Match → Group → Sort
```

**Q19: populate() vs manual join?**
- `populate()`: Mongoose helper to reference other documents
- Manual: Multiple queries and combining data
```javascript
const posts = await Post.find().populate('author');
```

**Q20: What is schema validation?**
```javascript
const userSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true },
  age: { type: Number, min: 0, max: 120 }
});
```

### Redux

**Q21: What is Redux and when to use it?**
- State management library
- Use when: Complex state, shared across many components, frequent updates

**Q22: Redux flow?**
1. Component dispatches action
2. Action goes to reducer
3. Reducer updates state
4. Store notifies subscribers
5. Component re-renders

**Q23: What are Redux Thunk and Redux Saga?**
- **Thunk**: Middleware for async actions, returns function instead of object
- **Saga**: Middleware using generators, more powerful for complex async

**Q24: Redux Toolkit benefits?**
- Less boilerplate
- createSlice combines actions and reducers
- Immer for immutable updates
- Built-in DevTools and middleware

### Authentication/Security

**Q25: JWT vs Sessions?**
- **JWT**: Stateless, token stored on client, scalable
- **Sessions**: Stateful, stored on server, more secure

**Q26: How to secure API endpoints?**
- Authentication (JWT, sessions)
- Authorization (role-based)
- Input validation
- Rate limiting
- HTTPS
- CORS

**Q27: What is XSS and how to prevent?**
- Cross-Site Scripting: Injecting malicious scripts
- Prevention: Sanitize input, escape output, CSP headers

**Q28: What is CSRF?**
- Cross-Site Request Forgery: Tricks user into unwanted actions
- Prevention: CSRF tokens, SameSite cookies

### Testing

**Q29: Unit vs Integration vs E2E testing?**
- **Unit**: Test individual functions/components
- **Integration**: Test multiple units working together
- **E2E**: Test entire user flow

**Q30: What is mocking?**
- Replacing dependencies with fake versions for testing
```javascript
jest.mock('axios');
axios.get.mockResolvedValue({ data: { name: 'John' } });
```

### Performance

**Q31: How to optimize React performance?**
- React.memo for components
- useMemo for expensive calculations
- useCallback for functions
- Code splitting with React.lazy
- Virtualization for long lists

**Q32: How to optimize database queries?**
- Use indexes
- Select only needed fields
- Pagination instead of fetching all
- Use lean() for read-only data
- Aggregation pipelines

**Q33: What is lazy loading?**
- Load resources only when needed
- Reduces initial bundle size
```javascript
const Dashboard = React.lazy(() => import('./Dashboard'));
```

### System Design

**Q34: How to handle file uploads?**
- Multer middleware
- Validate file type and size
- Store in cloud (AWS S3, Cloudinary)
- Or local storage with proper security

**Q35: How to implement real-time features?**
- WebSockets (Socket.io)
- Server-Sent Events
- Long polling

**Q36: How to scale MERN application?**
- Horizontal scaling (add servers)
- Load balancing
- Caching (Redis)
- Database replication
- CDN for static assets
- Microservices architecture

**Q37: What is CI/CD?**
- **CI**: Continuous Integration (automated testing)
- **CD**: Continuous Deployment (automated deployment)
- Tools: GitHub Actions, Jenkins, CircleCI

**Q38: Monolith vs Microservices?**
- **Monolith**: Single application, easier to develop, harder to scale
- **Microservices**: Separate services, complex, scale independently

### General

**Q39: RESTful API principles?**
- Use HTTP methods (GET, POST, PUT, DELETE)
- Resource-based URLs (/users, /users/:id)
- Stateless
- JSON responses
- Proper status codes

**Q40: HTTP status codes?**
- 200: OK
- 201: Created
- 400: Bad Request
- 401: Unauthorized
- 403: Forbidden
- 404: Not Found
- 500: Internal Server Error

---

## Coding Challenges

### 1. Implement debounce
```javascript
function debounce(func, delay) {
  let timeoutId;
  return function(...args) {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => func.apply(this, args), delay);
  };
}
```

### 2. Deep clone object
```javascript
function deepClone(obj) {
  if (obj === null || typeof obj !== 'object') return obj;
  if (obj instanceof Date) return new Date(obj);
  if (obj instanceof Array) return obj.map(item => deepClone(item));
  
  const cloned = {};
  for (let key in obj) {
    if (obj.hasOwnProperty(key)) {
      cloned[key] = deepClone(obj[key]);
    }
  }
  return cloned;
}
```

### 3. Implement Promise.all
```javascript
function promiseAll(promises) {
  return new Promise((resolve, reject) => {
    const results = [];
    let completed = 0;
    
    promises.forEach((promise, index) => {
      Promise.resolve(promise)
        .then(value => {
          results[index] = value;
          completed++;
          if (completed === promises.length) {
            resolve(results);
          }
        })
        .catch(reject);
    });
  });
}
```

---

## Summary

- **Common Pitfalls**: Missing error handling, no validation, exposing sensitive data, N+1 queries, useEffect dependencies
- **Key Concepts**: Closures, event loop, Virtual DOM, middleware, JWT, indexes
- **Performance**: React.memo, useMemo, code splitting, database indexing, caching
- **Security**: Input validation, password hashing, rate limiting, CORS, XSS/CSRF prevention
- **Best Practice**: Write tests, use TypeScript, follow conventions, document code
