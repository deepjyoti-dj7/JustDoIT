# 07. Code Quality (ESLint, Prettier, Reviews)

## Introduction

Code quality tools ensure consistent, maintainable, and error-free code across teams. This guide covers ESLint, Prettier, and code review best practices for MERN applications.

---

## ESLint (Linting)

### What is ESLint?

Static code analysis tool to identify problematic patterns and enforce coding standards.

### Installation

```bash
# Backend
npm install --save-dev eslint
npx eslint --init

# Frontend (Create React App already includes it)
npm install --save-dev eslint
```

### Configuration (.eslintrc.json)

**Backend (Node.js)**:
```json
{
  "env": {
    "node": true,
    "es2021": true,
    "jest": true
  },
  "extends": "eslint:recommended",
  "parserOptions": {
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  "rules": {
    "no-console": "warn",
    "no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "prefer-const": "error",
    "no-var": "error",
    "eqeqeq": ["error", "always"],
    "curly": ["error", "all"],
    "semi": ["error", "always"],
    "quotes": ["error", "single"]
  }
}
```

**Frontend (React)**:
```json
{
  "env": {
    "browser": true,
    "es2021": true,
    "jest": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "parserOptions": {
    "ecmaFeatures": {
      "jsx": true
    },
    "ecmaVersion": 12,
    "sourceType": "module"
  },
  "plugins": ["react", "react-hooks"],
  "rules": {
    "react/prop-types": "off",
    "react/react-in-jsx-scope": "off",
    "no-unused-vars": ["warn", { "argsIgnorePattern": "^_" }],
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  },
  "settings": {
    "react": {
      "version": "detect"
    }
  }
}
```

### Popular Configurations

```bash
# Airbnb style guide
npm install --save-dev eslint-config-airbnb

# Standard JS
npm install --save-dev eslint-config-standard

# Google style guide
npm install --save-dev eslint-config-google
```

**Using Airbnb**:
```json
{
  "extends": ["airbnb", "airbnb/hooks"]
}
```

### Common Rules

```json
{
  "rules": {
    // Possible Errors
    "no-console": "warn",
    "no-debugger": "error",
    "no-dupe-keys": "error",
    "no-duplicate-case": "error",
    
    // Best Practices
    "eqeqeq": ["error", "always"],
    "no-eval": "error",
    "no-implicit-globals": "error",
    "no-return-await": "error",
    "require-await": "error",
    
    // Variables
    "no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "no-use-before-define": "error",
    
    // ES6
    "arrow-body-style": ["error", "as-needed"],
    "prefer-const": "error",
    "prefer-template": "error",
    "no-var": "error",
    
    // React
    "react/jsx-uses-react": "error",
    "react/jsx-uses-vars": "error",
    "react/prop-types": "off"
  }
}
```

### Ignore Files (.eslintignore)

```
node_modules/
build/
dist/
coverage/
*.min.js
.env
```

### NPM Scripts

```json
{
  "scripts": {
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "lint:watch": "esw . --watch --changed --clear"
  }
}
```

---

## Prettier (Code Formatting)

### What is Prettier?

Opinionated code formatter that enforces consistent style.

### Installation

```bash
npm install --save-dev prettier
```

### Configuration (.prettierrc)

```json
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

### Ignore Files (.prettierignore)

```
node_modules/
build/
dist/
coverage/
package-lock.json
.env
```

### NPM Scripts

```json
{
  "scripts": {
    "format": "prettier --write \"**/*.{js,jsx,json,md}\"",
    "format:check": "prettier --check \"**/*.{js,jsx,json,md}\""
  }
}
```

---

## ESLint + Prettier Integration

### Installation

```bash
npm install --save-dev eslint-config-prettier eslint-plugin-prettier
```

### Configuration

```json
{
  "extends": [
    "eslint:recommended",
    "plugin:react/recommended",
    "prettier" // Must be last
  ],
  "plugins": ["react", "prettier"],
  "rules": {
    "prettier/prettier": "error"
  }
}
```

---

## Husky (Git Hooks)

### Pre-commit Hooks

Automatically run linting and formatting before commits.

```bash
npm install --save-dev husky lint-staged
npx husky install
npm set-script prepare "husky install"
npx husky add .husky/pre-commit "npx lint-staged"
```

### Configuration (package.json)

```json
{
  "lint-staged": {
    "*.{js,jsx}": [
      "eslint --fix",
      "prettier --write"
    ],
    "*.{json,md}": [
      "prettier --write"
    ]
  },
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "pre-push": "npm test"
    }
  }
}
```

---

## VS Code Integration

### settings.json

```json
{
  // ESLint
  "eslint.enable": true,
  "eslint.validate": ["javascript", "javascriptreact"],
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  
  // Prettier
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "editor.formatOnSave": true,
  
  // JavaScript
  "javascript.updateImportsOnFileMove.enabled": "always",
  
  // File associations
  "files.associations": {
    "*.jsx": "javascriptreact"
  }
}
```

### Recommended Extensions

```json
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "dsznajder.es7-react-js-snippets",
    "formulahendry.auto-rename-tag",
    "christian-kohler.path-intellisense"
  ]
}
```

---

## EditorConfig

Ensures consistent coding styles across different editors.

### .editorconfig

```ini
root = true

[*]
charset = utf-8
end_of_line = lf
insert_final_newline = true
trim_trailing_whitespace = true

[*.{js,jsx,json}]
indent_style = space
indent_size = 2

[*.md]
trim_trailing_whitespace = false
```

---

## Code Review Best Practices

### 1. Review Checklist

**Functionality**:
- [ ] Code works as expected
- [ ] Edge cases handled
- [ ] No obvious bugs

**Code Quality**:
- [ ] Code is readable and maintainable
- [ ] Follows project conventions
- [ ] No code duplication
- [ ] Functions are small and focused
- [ ] Good variable/function names

**Security**:
- [ ] No security vulnerabilities
- [ ] Input validation
- [ ] No sensitive data exposed

**Testing**:
- [ ] Tests added for new features
- [ ] Tests pass
- [ ] Edge cases covered

**Performance**:
- [ ] No unnecessary re-renders (React)
- [ ] Efficient algorithms
- [ ] No memory leaks

### 2. Providing Feedback

**Be Constructive**:
```
❌ "This code is bad"
✅ "Consider extracting this into a separate function for better readability"
```

**Ask Questions**:
```
"Why did you choose this approach over X?"
"Have you considered using Y instead?"
```

**Praise Good Code**:
```
"Great use of useMemo here!"
"Nice error handling!"
```

### 3. Pull Request Template

```markdown
## Description
Brief description of changes

## Type of Change
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation update

## Checklist
- [ ] Code follows style guidelines
- [ ] Self-review performed
- [ ] Comments added for complex code
- [ ] Documentation updated
- [ ] Tests added/updated
- [ ] All tests pass
- [ ] No new warnings

## Screenshots (if applicable)

## Related Issues
Closes #123
```

---

## Code Smells to Avoid

### 1. Long Functions

```javascript
// ❌ Bad - 100+ lines function
function processUserData(user) {
  // Validation
  // Transformation
  // Database operations
  // Email sending
  // ...
}

// ✅ Good - Split into smaller functions
function processUserData(user) {
  const validated = validateUser(user);
  const transformed = transformUser(validated);
  const saved = saveUser(transformed);
  sendWelcomeEmail(saved);
  return saved;
}
```

### 2. Magic Numbers

```javascript
// ❌ Bad
if (user.age > 18) { ... }

// ✅ Good
const ADULT_AGE = 18;
if (user.age > ADULT_AGE) { ... }
```

### 3. Deep Nesting

```javascript
// ❌ Bad
if (user) {
  if (user.isActive) {
    if (user.hasPermission) {
      // Do something
    }
  }
}

// ✅ Good - Early returns
if (!user) return;
if (!user.isActive) return;
if (!user.hasPermission) return;
// Do something
```

### 4. Inconsistent Naming

```javascript
// ❌ Bad
const usr = getUser();
const user_id = usr.id;
const UserName = usr.name;

// ✅ Good
const user = getUser();
const userId = user.id;
const userName = user.name;
```

### 5. Duplicate Code

```javascript
// ❌ Bad
function getActiveUsers() {
  return users.filter(u => u.isActive);
}

function getActivePremiumUsers() {
  return users.filter(u => u.isActive && u.isPremium);
}

// ✅ Good
function filterUsers(predicate) {
  return users.filter(predicate);
}

const activeUsers = filterUsers(u => u.isActive);
const activePremiumUsers = filterUsers(u => u.isActive && u.isPremium);
```

---

## Code Documentation

### JSDoc Comments

```javascript
/**
 * Fetches user by ID from database
 * @param {string} userId - The user's ID
 * @returns {Promise<Object>} User object
 * @throws {Error} If user not found
 */
async function getUserById(userId) {
  const user = await User.findById(userId);
  if (!user) throw new Error('User not found');
  return user;
}

/**
 * React component for displaying user profile
 * @param {Object} props
 * @param {Object} props.user - User object
 * @param {Function} props.onEdit - Callback when edit clicked
 */
function UserProfile({ user, onEdit }) {
  // ...
}
```

---

## CI/CD Quality Checks

### GitHub Actions Workflow

```yaml
name: Code Quality

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '16'
      - run: npm ci
      - run: npm run lint
      - run: npm run format:check
      - run: npm test
```

---

## Interview Questions

**Q1: Difference between ESLint and Prettier?**
- **ESLint**: Code quality (bugs, best practices)
- **Prettier**: Code formatting (style)

**Q2: What are pre-commit hooks?**
- Scripts that run before commits
- Used for linting, formatting, testing
- Implemented with Husky + lint-staged

**Q3: What is EditorConfig?**
- Maintains consistent coding styles
- Works across different editors
- Defines indent, charset, line endings

**Q4: Code review best practices?**
- Check functionality, quality, security
- Be constructive and respectful
- Ask questions, praise good code
- Use PR templates

**Q5: Common code smells?**
- Long functions
- Magic numbers
- Deep nesting
- Duplicate code
- Inconsistent naming

---

## Summary

- **ESLint**: Catch errors, enforce best practices
- **Prettier**: Consistent code formatting
- **Husky**: Pre-commit hooks for quality checks
- **EditorConfig**: Consistent styles across editors
- **Code Reviews**: Ensure quality, share knowledge
- **Documentation**: JSDoc for better understanding
- **CI/CD**: Automated quality checks in pipeline
