# 07. Frontend Upload (React & Drag-Drop)

## Introduction

Building user-friendly file upload interfaces in React involves handling file selection, drag-and-drop, validation, and providing visual feedback.

---

## Basic File Upload Component

```javascript
// components/FileUpload.jsx
import { useState } from 'react';
import axios from 'axios';

const FileUpload = () => {
  const [file, setFile] = useState(null);
  const [uploading, setUploading] = useState(false);
  const [uploadedUrl, setUploadedUrl] = useState(null);
  const [error, setError] = useState('');
  
  const handleFileChange = (e) => {
    const selectedFile = e.target.files[0];
    
    if (selectedFile) {
      // Validate file
      if (selectedFile.size > 5 * 1024 * 1024) {
        setError('File size must be less than 5MB');
        return;
      }
      
      setFile(selectedFile);
      setError('');
    }
  };
  
  const handleUpload = async () => {
    if (!file) {
      setError('Please select a file');
      return;
    }
    
    setUploading(true);
    setError('');
    
    const formData = new FormData();
    formData.append('file', file);
    
    try {
      const { data } = await axios.post('/api/upload', formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        }
      });
      
      setUploadedUrl(data.url);
      alert('File uploaded successfully!');
    } catch (err) {
      setError(err.response?.data?.message || 'Upload failed');
    } finally {
      setUploading(false);
    }
  };
  
  return (
    <div>
      <h2>Upload File</h2>
      
      <input 
        type="file" 
        onChange={handleFileChange}
        disabled={uploading}
      />
      
      {file && <p>Selected: {file.name} ({(file.size / 1024).toFixed(2)} KB)</p>}
      
      {error && <p style={{ color: 'red' }}>{error}</p>}
      
      <button onClick={handleUpload} disabled={!file || uploading}>
        {uploading ? 'Uploading...' : 'Upload'}
      </button>
      
      {uploadedUrl && (
        <div>
          <h3>Uploaded File:</h3>
          <a href={uploadedUrl} target="_blank" rel="noopener noreferrer">
            {uploadedUrl}
          </a>
        </div>
      )}
    </div>
  );
};

export default FileUpload;
```

---

## Image Upload with Preview

```javascript
// components/ImageUpload.jsx
import { useState } from 'react';
import axios from 'axios';

const ImageUpload = () => {
  const [file, setFile] = useState(null);
  const [preview, setPreview] = useState(null);
  const [uploading, setUploading] = useState(false);
  
  const handleFileChange = (e) => {
    const selectedFile = e.target.files[0];
    
    if (selectedFile) {
      // Validate image type
      if (!selectedFile.type.startsWith('image/')) {
        alert('Please select an image file');
        return;
      }
      
      setFile(selectedFile);
      
      // Create preview
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreview(reader.result);
      };
      reader.readAsDataURL(selectedFile);
    }
  };
  
  const handleUpload = async () => {
    if (!file) return;
    
    setUploading(true);
    
    const formData = new FormData();
    formData.append('image', file);
    
    try {
      const { data } = await axios.post('/api/upload/image', formData);
      alert('Image uploaded successfully!');
    } catch (error) {
      alert('Upload failed');
    } finally {
      setUploading(false);
    }
  };
  
  const handleRemove = () => {
    setFile(null);
    setPreview(null);
  };
  
  return (
    <div style={{ textAlign: 'center' }}>
      <h2>Upload Image</h2>
      
      {!preview ? (
        <div>
          <input 
            type="file" 
            onChange={handleFileChange}
            accept="image/*"
            style={{ display: 'none' }}
            id="file-input"
          />
          <label htmlFor="file-input">
            <button as="span" style={{ cursor: 'pointer' }}>
              Choose Image
            </button>
          </label>
        </div>
      ) : (
        <div>
          <img 
            src={preview} 
            alt="Preview" 
            style={{ maxWidth: '300px', marginBottom: '10px' }}
          />
          <div>
            <button onClick={handleUpload} disabled={uploading}>
              {uploading ? 'Uploading...' : 'Upload'}
            </button>
            <button onClick={handleRemove}>Remove</button>
          </div>
        </div>
      )}
    </div>
  );
};

export default ImageUpload;
```

---

## Multiple Files Upload

```javascript
// components/MultipleFileUpload.jsx
import { useState } from 'react';
import axios from 'axios';

const MultipleFileUpload = () => {
  const [files, setFiles] = useState([]);
  const [previews, setPreviews] = useState([]);
  const [uploading, setUploading] = useState(false);
  
  const handleFileChange = (e) => {
    const selectedFiles = Array.from(e.target.files);
    setFiles(selectedFiles);
    
    // Create previews
    const previewPromises = selectedFiles.map(file => {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onloadend = () => {
          resolve({
            name: file.name,
            preview: reader.result
          });
        };
        reader.readAsDataURL(file);
      });
    });
    
    Promise.all(previewPromises).then(setPreviews);
  };
  
  const handleUpload = async () => {
    if (files.length === 0) return;
    
    setUploading(true);
    
    const formData = new FormData();
    files.forEach(file => {
      formData.append('photos', file);
    });
    
    try {
      const { data } = await axios.post('/api/upload/multiple', formData);
      alert(`${data.files.length} files uploaded successfully!`);
      setFiles([]);
      setPreviews([]);
    } catch (error) {
      alert('Upload failed');
    } finally {
      setUploading(false);
    }
  };
  
  const removeFile = (index) => {
    setFiles(files.filter((_, i) => i !== index));
    setPreviews(previews.filter((_, i) => i !== index));
  };
  
  return (
    <div>
      <h2>Upload Multiple Files</h2>
      
      <input 
        type="file" 
        onChange={handleFileChange}
        accept="image/*"
        multiple
      />
      
      <p>Selected: {files.length} file(s)</p>
      
      {previews.length > 0 && (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '10px' }}>
          {previews.map((item, index) => (
            <div key={index} style={{ position: 'relative' }}>
              <img 
                src={item.preview} 
                alt={item.name} 
                style={{ width: '100%', height: '150px', objectFit: 'cover' }}
              />
              <button 
                onClick={() => removeFile(index)}
                style={{ position: 'absolute', top: '5px', right: '5px' }}
              >
                X
              </button>
              <p style={{ fontSize: '12px' }}>{item.name}</p>
            </div>
          ))}
        </div>
      )}
      
      <button onClick={handleUpload} disabled={files.length === 0 || uploading}>
        {uploading ? 'Uploading...' : `Upload ${files.length} file(s)`}
      </button>
    </div>
  );
};

export default MultipleFileUpload;
```

---

## Drag and Drop Upload

```javascript
// components/DragDropUpload.jsx
import { useState } from 'react';
import axios from 'axios';

const DragDropUpload = () => {
  const [files, setFiles] = useState([]);
  const [isDragging, setIsDragging] = useState(false);
  const [uploading, setUploading] = useState(false);
  
  const handleDragEnter = (e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(true);
  };
  
  const handleDragLeave = (e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
  };
  
  const handleDragOver = (e) => {
    e.preventDefault();
    e.stopPropagation();
  };
  
  const handleDrop = (e) => {
    e.preventDefault();
    e.stopPropagation();
    setIsDragging(false);
    
    const droppedFiles = Array.from(e.dataTransfer.files);
    
    // Validate files
    const validFiles = droppedFiles.filter(file => {
      if (!file.type.startsWith('image/')) {
        alert(`${file.name} is not an image`);
        return false;
      }
      if (file.size > 5 * 1024 * 1024) {
        alert(`${file.name} is too large (max 5MB)`);
        return false;
      }
      return true;
    });
    
    setFiles(prev => [...prev, ...validFiles]);
  };
  
  const handleFileInput = (e) => {
    const selectedFiles = Array.from(e.target.files);
    setFiles(prev => [...prev, ...selectedFiles]);
  };
  
  const handleUpload = async () => {
    if (files.length === 0) return;
    
    setUploading(true);
    
    const formData = new FormData();
    files.forEach(file => formData.append('photos', file));
    
    try {
      const { data } = await axios.post('/api/upload/multiple', formData);
      alert(`${data.files.length} files uploaded!`);
      setFiles([]);
    } catch (error) {
      alert('Upload failed');
    } finally {
      setUploading(false);
    }
  };
  
  const removeFile = (index) => {
    setFiles(files.filter((_, i) => i !== index));
  };
  
  return (
    <div>
      <h2>Drag & Drop Upload</h2>
      
      <div
        onDragEnter={handleDragEnter}
        onDragOver={handleDragOver}
        onDragLeave={handleDragLeave}
        onDrop={handleDrop}
        style={{
          border: `2px dashed ${isDragging ? '#4CAF50' : '#ccc'}`,
          borderRadius: '8px',
          padding: '40px',
          textAlign: 'center',
          backgroundColor: isDragging ? '#f0f8ff' : '#fafafa',
          cursor: 'pointer',
          transition: 'all 0.3s'
        }}
      >
        <input 
          type="file" 
          onChange={handleFileInput}
          accept="image/*"
          multiple
          style={{ display: 'none' }}
          id="file-input"
        />
        
        <label htmlFor="file-input" style={{ cursor: 'pointer' }}>
          <div>
            <p style={{ fontSize: '18px', margin: '10px 0' }}>
              {isDragging ? 'Drop files here' : 'Drag & drop files here'}
            </p>
            <p style={{ color: '#888' }}>or</p>
            <button style={{ marginTop: '10px' }}>Browse Files</button>
          </div>
        </label>
      </div>
      
      {files.length > 0 && (
        <div style={{ marginTop: '20px' }}>
          <h3>Selected Files ({files.length})</h3>
          <ul>
            {files.map((file, index) => (
              <li key={index} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '5px 0' }}>
                <span>{file.name} ({(file.size / 1024).toFixed(2)} KB)</span>
                <button onClick={() => removeFile(index)}>Remove</button>
              </li>
            ))}
          </ul>
          
          <button onClick={handleUpload} disabled={uploading}>
            {uploading ? 'Uploading...' : `Upload ${files.length} file(s)`}
          </button>
        </div>
      )}
    </div>
  );
};

export default DragDropUpload;
```

---

## Custom Hook for File Upload

```javascript
// hooks/useFileUpload.js
import { useState } from 'react';
import axios from 'axios';

export const useFileUpload = (url, options = {}) => {
  const [files, setFiles] = useState([]);
  const [uploading, setUploading] = useState(false);
  const [progress, setProgress] = useState(0);
  const [error, setError] = useState(null);
  const [uploadedFiles, setUploadedFiles] = useState([]);
  
  const validateFile = (file) => {
    const { maxSize = 5 * 1024 * 1024, allowedTypes = [] } = options;
    
    if (file.size > maxSize) {
      throw new Error(`File too large. Max size: ${maxSize / (1024 * 1024)}MB`);
    }
    
    if (allowedTypes.length > 0 && !allowedTypes.includes(file.type)) {
      throw new Error(`File type not allowed. Allowed: ${allowedTypes.join(', ')}`);
    }
  };
  
  const addFiles = (newFiles) => {
    try {
      const validFiles = [];
      
      for (const file of newFiles) {
        validateFile(file);
        validFiles.push(file);
      }
      
      setFiles(prev => [...prev, ...validFiles]);
      setError(null);
    } catch (err) {
      setError(err.message);
    }
  };
  
  const removeFile = (index) => {
    setFiles(files.filter((_, i) => i !== index));
  };
  
  const upload = async () => {
    if (files.length === 0) {
      setError('No files selected');
      return;
    }
    
    setUploading(true);
    setError(null);
    setProgress(0);
    
    const formData = new FormData();
    files.forEach(file => {
      formData.append(options.fieldName || 'files', file);
    });
    
    try {
      const { data } = await axios.post(url, formData, {
        headers: {
          'Content-Type': 'multipart/form-data'
        },
        onUploadProgress: (progressEvent) => {
          const percentCompleted = Math.round(
            (progressEvent.loaded * 100) / progressEvent.total
          );
          setProgress(percentCompleted);
        }
      });
      
      setUploadedFiles(data.files || []);
      setFiles([]);
      setProgress(100);
      
      return data;
    } catch (err) {
      setError(err.response?.data?.message || 'Upload failed');
      throw err;
    } finally {
      setUploading(false);
    }
  };
  
  const reset = () => {
    setFiles([]);
    setProgress(0);
    setError(null);
    setUploadedFiles([]);
  };
  
  return {
    files,
    uploading,
    progress,
    error,
    uploadedFiles,
    addFiles,
    removeFile,
    upload,
    reset
  };
};
```

### Usage

```javascript
// components/FileUploadWithHook.jsx
import { useFileUpload } from '../hooks/useFileUpload';

const FileUploadWithHook = () => {
  const {
    files,
    uploading,
    progress,
    error,
    uploadedFiles,
    addFiles,
    removeFile,
    upload
  } = useFileUpload('/api/upload', {
    maxSize: 5 * 1024 * 1024,
    allowedTypes: ['image/jpeg', 'image/png'],
    fieldName: 'photos'
  });
  
  const handleFileChange = (e) => {
    addFiles(Array.from(e.target.files));
  };
  
  return (
    <div>
      <h2>File Upload with Custom Hook</h2>
      
      <input type="file" onChange={handleFileChange} multiple />
      
      {error && <p style={{ color: 'red' }}>{error}</p>}
      
      {files.length > 0 && (
        <div>
          <h3>Files ({files.length})</h3>
          <ul>
            {files.map((file, index) => (
              <li key={index}>
                {file.name}
                <button onClick={() => removeFile(index)}>Remove</button>
              </li>
            ))}
          </ul>
          
          <button onClick={upload} disabled={uploading}>
            {uploading ? `Uploading... ${progress}%` : 'Upload'}
          </button>
        </div>
      )}
      
      {uploadedFiles.length > 0 && (
        <div>
          <h3>Uploaded Files</h3>
          <ul>
            {uploadedFiles.map((file, index) => (
              <li key={index}>
                <a href={file.url}>{file.filename}</a>
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
};

export default FileUploadWithHook;
```

---

## Interview Questions

**Q1: How do you handle file uploads in React?**
- Use `<input type="file" />` for file selection
- Create `FormData` object
- Append files with `formData.append('field', file)`
- Send with axios/fetch with `Content-Type: multipart/form-data`

**Q2: How do you create image previews?**
```javascript
const reader = new FileReader();
reader.onloadend = () => setPreview(reader.result);
reader.readAsDataURL(file);
```

**Q3: How do you implement drag and drop?**
Use these events:
- `onDragEnter`: When dragging enters drop zone
- `onDragOver`: Prevent default to allow drop
- `onDragLeave`: When dragging leaves drop zone
- `onDrop`: Handle dropped files

**Q4: How do you validate files on the frontend?**
```javascript
if (file.size > 5 * 1024 * 1024) {
  alert('File too large');
  return;
}
if (!file.type.startsWith('image/')) {
  alert('Only images allowed');
  return;
}
```

**Q5: What's the difference between single and multiple file upload?**
- Single: `<input type="file" />` → `e.target.files[0]`
- Multiple: `<input type="file" multiple />` → `Array.from(e.target.files)`

---

## Best Practices

1. **Validate on both client and server**
2. **Show previews** before uploading
3. **Display progress** for large files
4. **Allow removing files** before upload
5. **Use FormData** for file uploads
6. **Implement drag and drop** for better UX
7. **Show file names and sizes**
8. **Handle errors gracefully**
9. **Disable upload button** while uploading
10. **Clear input after upload**

---

## Summary

- **Basic upload**: `<input type="file" />` + `FormData`
- **Preview**: Use `FileReader.readAsDataURL()`
- **Multiple files**: Add `multiple` attribute, use `Array.from()`
- **Drag & drop**: Handle `onDragEnter/Over/Leave/Drop` events
- **Custom hook**: Encapsulate upload logic for reusability
- **Validation**: Check file size and type before upload
- **FormData**: Append files with `.append('field', file)`
- **Progress**: Use axios `onUploadProgress` callback
