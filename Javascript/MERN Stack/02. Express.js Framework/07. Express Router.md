# 07. Express Router

## What is Express Router?

Router is a mini Express application for organizing routes into modules.

---

## Basic Router Setup

```javascript
const express = require('express');
const router = express.Router();

// Define routes
router.get('/', (req, res) => {
  res.send('User list');
});

router.get('/:id', (req, res) => {
  res.send(`User ${req.params.id}`);
});

router.post('/', (req, res) => {
  res.send('User created');
});

module.exports = router;
```

**Use in main app:**

```javascript
const express = require('express');
const userRoutes = require('./routes/users');

const app = express();

app.use('/users', userRoutes);

app.listen(3000);
```

---

## Router Structure

**Project structure:**

```
project/
├── app.js
├── routes/
│   ├── users.js
│   ├── posts.js
│   └── auth.js
```

**routes/users.js:**

```javascript
const express = require('express');
const router = express.Router();

router.get('/', (req, res) => {
  res.json({ message: 'Get all users' });
});

router.get('/:id', (req, res) => {
  res.json({ message: `Get user ${req.params.id}` });
});

router.post('/', (req, res) => {
  res.json({ message: 'Create user' });
});

router.put('/:id', (req, res) => {
  res.json({ message: `Update user ${req.params.id}` });
});

router.delete('/:id', (req, res) => {
  res.json({ message: `Delete user ${req.params.id}` });
});

module.exports = router;
```

**app.js:**

```javascript
const express = require('express');
const userRoutes = require('./routes/users');
const postRoutes = require('./routes/posts');
const authRoutes = require('./routes/auth');

const app = express();

app.use(express.json());

// Mount routers
app.use('/api/users', userRoutes);
app.use('/api/posts', postRoutes);
app.use('/auth', authRoutes);

app.listen(3000);
```

---

## Router Middleware

```javascript
const router = express.Router();

// Router-level middleware
router.use((req, res, next) => {
  console.log('Time:', Date.now());
  next();
});

// Specific route middleware
router.use('/:id', (req, res, next) => {
  console.log('User ID:', req.params.id);
  next();
});

router.get('/:id', (req, res) => {
  res.send('User page');
});
```

---

## Complete Example

**routes/products.js:**

```javascript
const express = require('express');
const router = express.Router();

// Middleware for all product routes
router.use((req, res, next) => {
  console.log('Product route accessed');
  next();
});

// GET /api/products
router.get('/', (req, res) => {
  res.json([
    { id: 1, name: 'Product 1', price: 100 },
    { id: 2, name: 'Product 2', price: 200 }
  ]);
});

// GET /api/products/:id
router.get('/:id', (req, res) => {
  res.json({
    id: req.params.id,
    name: 'Product',
    price: 100
  });
});

// POST /api/products
router.post('/', (req, res) => {
  res.status(201).json({
    message: 'Product created',
    product: req.body
  });
});

// PUT /api/products/:id
router.put('/:id', (req, res) => {
  res.json({
    message: `Product ${req.params.id} updated`,
    product: req.body
  });
});

// DELETE /api/products/:id
router.delete('/:id', (req, res) => {
  res.json({ message: `Product ${req.params.id} deleted` });
});

module.exports = router;
```

---

## Route Parameters in Router

```javascript
const router = express.Router();

// Param middleware
router.param('id', (req, res, next, id) => {
  console.log(`ID: ${id}`);
  req.userId = id;
  next();
});

router.get('/users/:id', (req, res) => {
  res.send(`User ${req.userId}`);
});
```

---

## Nested Routers

```javascript
const express = require('express');
const app = express();

// Main router
const apiRouter = express.Router();

// Sub-routers
const userRouter = express.Router();
const postRouter = express.Router();

userRouter.get('/', (req, res) => res.send('Users'));
postRouter.get('/', (req, res) => res.send('Posts'));

// Mount sub-routers on main router
apiRouter.use('/users', userRouter);
apiRouter.use('/posts', postRouter);

// Mount main router on app
app.use('/api', apiRouter);

// Routes:
// GET /api/users
// GET /api/posts
```

---

## Best Practices

✅ **Organize by feature**: Separate routers for users, posts, etc.  
✅ **Use route prefixes**: `/api/users`, `/api/posts`  
✅ **Keep routes RESTful**: GET, POST, PUT, DELETE  
✅ **Use router middleware**: For authentication, logging  
✅ **Export routers**: Use `module.exports`  

---

## Summary

**Router:**
- Mini Express application
- Organizes routes into modules
- Supports middleware

**Pattern:**
```javascript
// routes/users.js
const router = express.Router();
router.get('/', handler);
module.exports = router;

// app.js
app.use('/api/users', require('./routes/users'));
```
