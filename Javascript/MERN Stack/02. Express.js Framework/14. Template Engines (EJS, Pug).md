# 14. Template Engines (EJS, Pug)

## What are Template Engines?

Generate dynamic HTML by combining templates with data.

---

## EJS (Embedded JavaScript)

### Installation

```bash
npm install ejs
```

### Setup

```javascript
const express = require('express');
const app = express();

// Set EJS as template engine
app.set('view engine', 'ejs');
app.set('views', './views');  // Default

app.get('/', (req, res) => {
  res.render('index', { title: 'Home' });
});

app.listen(3000);
```

### EJS Syntax

**views/index.ejs:**

```ejs
<!DOCTYPE html>
<html>
<head>
  <title><%= title %></title>
</head>
<body>
  <h1>Hello <%= name %>!</h1>
  
  <% if (isLoggedIn) { %>
    <p>Welcome back!</p>
  <% } else { %>
    <p>Please login</p>
  <% } %>
  
  <ul>
    <% users.forEach(user => { %>
      <li><%= user.name %></li>
    <% }); %>
  </ul>
</body>
</html>
```

**Tags:**
- `<%= %>` - Output (escaped)
- `<%- %>` - Output (unescaped HTML)
- `<% %>` - Control flow (if, for, etc.)
- `<%# %>` - Comment

### EJS Example

```javascript
app.get('/users', (req, res) => {
  const users = [
    { id: 1, name: 'John' },
    { id: 2, name: 'Jane' }
  ];
  
  res.render('users', {
    title: 'Users',
    users: users,
    isLoggedIn: true
  });
});
```

---

## Pug (formerly Jade)

### Installation

```bash
npm install pug
```

### Setup

```javascript
const express = require('express');
const app = express();

app.set('view engine', 'pug');
app.set('views', './views');

app.get('/', (req, res) => {
  res.render('index', { title: 'Home' });
});

app.listen(3000);
```

### Pug Syntax

**views/index.pug:**

```pug
doctype html
html
  head
    title= title
  body
    h1 Hello #{name}!
    
    if isLoggedIn
      p Welcome back!
    else
      p Please login
    
    ul
      each user in users
        li= user.name
```

**Features:**
- Indentation-based (no closing tags)
- `=` for escaped output
- `!=` for unescaped output
- `#{}` for interpolation

### Pug Example

```javascript
app.get('/products', (req, res) => {
  const products = [
    { id: 1, name: 'Product 1', price: 100 },
    { id: 2, name: 'Product 2', price: 200 }
  ];
  
  res.render('products', {
    title: 'Products',
    products: products
  });
});
```

---

## EJS vs Pug Comparison

| Feature | EJS | Pug |
|---------|-----|-----|
| **Syntax** | HTML-like | Indentation-based |
| **Learning Curve** | Easy | Moderate |
| **Readability** | Familiar | Concise |
| **Closing Tags** | Required | Not needed |
| **Flexibility** | High | High |

---

## Partials (EJS)

**views/partials/header.ejs:**

```ejs
<header>
  <h1>My Website</h1>
  <nav>
    <a href="/">Home</a>
    <a href="/about">About</a>
  </nav>
</header>
```

**views/index.ejs:**

```ejs
<!DOCTYPE html>
<html>
<body>
  <%- include('partials/header') %>
  
  <main>
    <h2>Welcome</h2>
  </main>
  
  <%- include('partials/footer') %>
</body>
</html>
```

---

## Layouts (Pug)

**views/layout.pug:**

```pug
doctype html
html
  head
    title= title
  body
    header
      h1 My Website
    block content
    footer
      p © 2024
```

**views/home.pug:**

```pug
extends layout

block content
  h2 Welcome
  p This is the home page
```

---

## Best Practices

✅ **Use partials**: For reusable components  
✅ **Escape user input**: Use `<%= %>` in EJS  
✅ **Organize views**: Use folders for structure  
✅ **Pass only needed data**: Don't pass entire objects  
❌ **Don't put logic in templates**: Keep it in routes/controllers  

---

## Summary

**Template Engines:**
- Render dynamic HTML
- EJS: HTML-like syntax
- Pug: Indentation-based

**EJS Pattern:**
```javascript
app.set('view engine', 'ejs');
res.render('page', { data });
```

**Pug Pattern:**
```javascript
app.set('view engine', 'pug');
res.render('page', { data });
```
