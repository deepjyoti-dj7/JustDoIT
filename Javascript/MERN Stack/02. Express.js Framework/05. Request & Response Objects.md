# 05. Request & Response Objects

## Request Object (req)

The **request object** contains information about the HTTP request.

---

## Request Properties

### req.params

Route parameters:

```javascript
app.get('/users/:id', (req, res) => {
  console.log(req.params.id);
  res.send(`User ID: ${req.params.id}`);
});

// GET /users/123 → req.params.id = '123'
```

### req.query

Query string parameters:

```javascript
app.get('/search', (req, res) => {
  console.log(req.query);
  res.json(req.query);
});

// GET /search?name=John&age=30
// req.query = { name: 'John', age: '30' }
```

### req.body

Request body (requires middleware):

```javascript
app.use(express.json());

app.post('/users', (req, res) => {
  console.log(req.body);
  res.json(req.body);
});

// POST /users
// Body: { "name": "John", "email": "john@example.com" }
// req.body = { name: 'John', email: 'john@example.com' }
```

### req.headers

HTTP headers:

```javascript
app.get('/test', (req, res) => {
  console.log(req.headers);
  console.log(req.headers['content-type']);
  console.log(req.headers['user-agent']);
  
  res.send('Check console');
});
```

### req.method

HTTP method:

```javascript
app.all('/test', (req, res) => {
  console.log(req.method);  // GET, POST, PUT, DELETE, etc.
  res.send(`Method: ${req.method}`);
});
```

### req.url & req.path

```javascript
app.get('/users/profile', (req, res) => {
  console.log(req.url);   // /users/profile?page=1
  console.log(req.path);  // /users/profile
  
  res.send('URL info');
});
```

### req.protocol & req.secure

```javascript
app.get('/test', (req, res) => {
  console.log(req.protocol);  // 'http' or 'https'
  console.log(req.secure);    // true if HTTPS, false if HTTP
  
  res.send(`Protocol: ${req.protocol}`);
});
```

### req.hostname & req.ip

```javascript
app.get('/info', (req, res) => {
  console.log(req.hostname);  // 'localhost' or 'example.com'
  console.log(req.ip);        // Client IP address
  
  res.json({
    hostname: req.hostname,
    ip: req.ip
  });
});
```

### req.cookies

Access cookies (requires cookie-parser):

```javascript
const cookieParser = require('cookie-parser');
app.use(cookieParser());

app.get('/test', (req, res) => {
  console.log(req.cookies);
  res.json(req.cookies);
});
```

---

## Request Methods

### req.get()

Get header value:

```javascript
app.get('/test', (req, res) => {
  const contentType = req.get('Content-Type');
  const userAgent = req.get('User-Agent');
  
  res.json({ contentType, userAgent });
});
```

### req.is()

Check content type:

```javascript
app.post('/data', (req, res) => {
  if (req.is('application/json')) {
    res.send('JSON received');
  } else if (req.is('text/html')) {
    res.send('HTML received');
  } else {
    res.send('Other type');
  }
});
```

### req.accepts()

Check accepted response types:

```javascript
app.get('/data', (req, res) => {
  if (req.accepts('json')) {
    res.json({ message: 'JSON response' });
  } else if (req.accepts('html')) {
    res.send('<h1>HTML response</h1>');
  } else {
    res.send('Plain text');
  }
});
```

---

## Response Object (res)

The **response object** sends data back to the client.

---

## Response Methods

### res.send()

Send response (auto-detects type):

```javascript
app.get('/text', (req, res) => {
  res.send('Hello World');  // text/html
});

app.get('/object', (req, res) => {
  res.send({ message: 'Hello' });  // application/json
});

app.get('/array', (req, res) => {
  res.send([1, 2, 3]);  // application/json
});
```

### res.json()

Send JSON response:

```javascript
app.get('/users', (req, res) => {
  res.json({
    users: [
      { id: 1, name: 'John' },
      { id: 2, name: 'Jane' }
    ]
  });
});
```

### res.status()

Set status code:

```javascript
app.get('/users/:id', (req, res) => {
  const user = findUser(req.params.id);
  
  if (!user) {
    return res.status(404).json({ error: 'User not found' });
  }
  
  res.status(200).json(user);
});

// Can chain
res.status(201).json({ message: 'Created' });
res.status(204).send();
```

### res.sendFile()

Send a file:

```javascript
const path = require('path');

app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'public', 'index.html'));
});

app.get('/download', (req, res) => {
  res.sendFile(path.join(__dirname, 'files', 'document.pdf'));
});
```

### res.download()

Prompt file download:

```javascript
app.get('/download/:file', (req, res) => {
  const file = path.join(__dirname, 'files', req.params.file);
  res.download(file);
});
```

### res.redirect()

Redirect to another URL:

```javascript
app.get('/old-url', (req, res) => {
  res.redirect('/new-url');
});

app.get('/home', (req, res) => {
  res.redirect(301, '/');  // Permanent redirect
});

app.get('/google', (req, res) => {
  res.redirect('https://google.com');
});
```

### res.render()

Render template:

```javascript
app.set('view engine', 'ejs');

app.get('/profile', (req, res) => {
  res.render('profile', {
    name: 'John',
    age: 30
  });
});
```

---

## Setting Headers

### res.set() / res.header()

```javascript
app.get('/test', (req, res) => {
  res.set('Content-Type', 'text/plain');
  res.set('X-Custom-Header', 'MyValue');
  
  // Or set multiple
  res.set({
    'Content-Type': 'text/html',
    'X-Powered-By': 'Express'
  });
  
  res.send('Headers set');
});
```

### res.type()

Set Content-Type:

```javascript
app.get('/test', (req, res) => {
  res.type('json');      // application/json
  res.type('html');      // text/html
  res.type('text');      // text/plain
  res.type('.pdf');      // application/pdf
  
  res.send('Type set');
});
```

---

## Cookies

### res.cookie()

Set cookie:

```javascript
app.get('/login', (req, res) => {
  res.cookie('token', 'abc123', {
    maxAge: 900000,    // Expires in 15 min
    httpOnly: true,    // Not accessible via JavaScript
    secure: true,      // Only HTTPS
    sameSite: 'strict' // CSRF protection
  });
  
  res.send('Cookie set');
});
```

### res.clearCookie()

Remove cookie:

```javascript
app.get('/logout', (req, res) => {
  res.clearCookie('token');
  res.send('Cookie cleared');
});
```

---

## Response Status Codes

```javascript
// Success
res.status(200).send('OK');
res.status(201).json({ message: 'Created' });
res.status(204).send();  // No content

// Client Errors
res.status(400).json({ error: 'Bad request' });
res.status(401).json({ error: 'Unauthorized' });
res.status(403).json({ error: 'Forbidden' });
res.status(404).json({ error: 'Not found' });

// Server Errors
res.status(500).json({ error: 'Internal server error' });
res.status(503).json({ error: 'Service unavailable' });
```

---

## Practical Examples

### API Response Format

```javascript
app.get('/api/users', (req, res) => {
  const users = getUsers();
  
  res.status(200).json({
    success: true,
    count: users.length,
    data: users
  });
});

app.post('/api/users', (req, res) => {
  const newUser = createUser(req.body);
  
  res.status(201).json({
    success: true,
    message: 'User created',
    data: newUser
  });
});
```

### Error Handling

```javascript
app.get('/api/users/:id', (req, res) => {
  const user = findUser(req.params.id);
  
  if (!user) {
    return res.status(404).json({
      success: false,
      error: 'User not found'
    });
  }
  
  res.status(200).json({
    success: true,
    data: user
  });
});
```

### File Upload Response

```javascript
app.post('/upload', upload.single('file'), (req, res) => {
  if (!req.file) {
    return res.status(400).json({
      success: false,
      error: 'No file uploaded'
    });
  }
  
  res.status(201).json({
    success: true,
    message: 'File uploaded',
    filename: req.file.filename,
    size: req.file.size
  });
});
```

### Content Negotiation

```javascript
app.get('/data', (req, res) => {
  const data = { message: 'Hello World' };
  
  res.format({
    'application/json': () => {
      res.json(data);
    },
    'text/html': () => {
      res.send('<h1>Hello World</h1>');
    },
    'text/plain': () => {
      res.send('Hello World');
    },
    default: () => {
      res.status(406).send('Not Acceptable');
    }
  });
});
```

---

## Request/Response Cheat Sheet

### Request (req)

| Property/Method | Description |
|-----------------|-------------|
| `req.params` | Route parameters |
| `req.query` | Query string parameters |
| `req.body` | Request body |
| `req.headers` | HTTP headers |
| `req.method` | HTTP method |
| `req.path` | URL path |
| `req.cookies` | Cookies |
| `req.ip` | Client IP |
| `req.get(header)` | Get header value |

### Response (res)

| Method | Description |
|--------|-------------|
| `res.send()` | Send response |
| `res.json()` | Send JSON |
| `res.status()` | Set status code |
| `res.sendFile()` | Send file |
| `res.download()` | Download file |
| `res.redirect()` | Redirect |
| `res.cookie()` | Set cookie |
| `res.set()` | Set header |

---

## Best Practices

✅ **Validate input**: Check req.body, req.params, req.query  
✅ **Use proper status codes**: 200, 201, 400, 404, 500  
✅ **Send consistent responses**: Use same format for all endpoints  
✅ **Set security headers**: Use helmet middleware  
✅ **Handle errors gracefully**: Always check for null/undefined  
❌ **Don't trust user input**: Always validate and sanitize  
❌ **Don't send sensitive data**: Remove passwords, tokens from response  

---

## Summary

**Request Object (req):**
- Contains client request data
- Access via: params, query, body, headers
- Use methods: get(), is(), accepts()

**Response Object (res):**
- Sends data back to client
- Methods: send(), json(), status(), sendFile()
- Set headers, cookies, status codes

**Common Pattern:**
```javascript
app.get('/api/resource/:id', (req, res) => {
  // 1. Get data from request
  const { id } = req.params;
  
  // 2. Process
  const data = processData(id);
  
  // 3. Send response
  res.status(200).json(data);
});
```

**Next:** Learn about Middleware!
