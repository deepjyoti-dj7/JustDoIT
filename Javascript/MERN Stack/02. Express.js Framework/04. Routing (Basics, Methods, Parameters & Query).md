# 04. Routing (Basics, Methods, Parameters & Query)

## What is Routing?

Routing determines how an application responds to client requests at specific endpoints (URLs).

```javascript
app.METHOD(PATH, HANDLER)
```

- **METHOD**: HTTP method (get, post, put, delete, etc.)
- **PATH**: Route path (URL)
- **HANDLER**: Function to execute when route is matched

---

## Basic Routes

```javascript
const express = require('express');
const app = express();

// Home page
app.get('/', (req, res) => {
  res.send('Home Page');
});

// About page
app.get('/about', (req, res) => {
  res.send('About Page');
});

// Contact page
app.get('/contact', (req, res) => {
  res.send('Contact Page');
});

app.listen(3000);
```

---

## HTTP Methods

### GET - Retrieve Data

```javascript
app.get('/users', (req, res) => {
  res.json([
    { id: 1, name: 'John' },
    { id: 2, name: 'Jane' }
  ]);
});
```

### POST - Create Data

```javascript
app.post('/users', (req, res) => {
  const newUser = req.body;
  // Save to database
  res.status(201).json(newUser);
});
```

### PUT - Update Data (Replace)

```javascript
app.put('/users/:id', (req, res) => {
  const { id } = req.params;
  const updatedUser = req.body;
  // Update entire user
  res.json({ id, ...updatedUser });
});
```

### PATCH - Update Data (Partial)

```javascript
app.patch('/users/:id', (req, res) => {
  const { id } = req.params;
  const updates = req.body;
  // Update only provided fields
  res.json({ id, ...updates });
});
```

### DELETE - Remove Data

```javascript
app.delete('/users/:id', (req, res) => {
  const { id } = req.params;
  // Delete from database
  res.status(204).send();
});
```

---

## Route Parameters

Dynamic segments in the URL path.

### Single Parameter

```javascript
app.get('/users/:id', (req, res) => {
  const userId = req.params.id;
  res.send(`User ID: ${userId}`);
});

// GET /users/123 → User ID: 123
```

### Multiple Parameters

```javascript
app.get('/users/:userId/posts/:postId', (req, res) => {
  const { userId, postId } = req.params;
  res.send(`User: ${userId}, Post: ${postId}`);
});

// GET /users/5/posts/10 → User: 5, Post: 10
```

### Optional Parameters

```javascript
app.get('/users/:id?', (req, res) => {
  if (req.params.id) {
    res.send(`User ID: ${req.params.id}`);
  } else {
    res.send('All users');
  }
});

// GET /users → All users
// GET /users/123 → User ID: 123
```

### Parameter Patterns

```javascript
// Only digits
app.get('/users/:id(\\d+)', (req, res) => {
  res.send(`User ID: ${req.params.id}`);
});

// GET /users/123 ✅ Works
// GET /users/abc ❌ Not matched
```

---

## Query Strings

Data sent in URL after `?` symbol.

### Basic Query Parameters

```javascript
app.get('/search', (req, res) => {
  const query = req.query.q;
  const page = req.query.page || 1;
  
  res.send(`Search: ${query}, Page: ${page}`);
});

// GET /search?q=javascript&page=2
// → Search: javascript, Page: 2
```

### Multiple Query Parameters

```javascript
app.get('/products', (req, res) => {
  const { category, minPrice, maxPrice, sort } = req.query;
  
  res.json({
    category,
    minPrice,
    maxPrice,
    sort
  });
});

// GET /products?category=electronics&minPrice=100&maxPrice=500&sort=price
```

### Array Query Parameters

```javascript
app.get('/filter', (req, res) => {
  const tags = req.query.tags;
  
  // /filter?tags=javascript&tags=nodejs
  // tags = ['javascript', 'nodejs']
  
  res.json({ tags });
});
```

### Default Values

```javascript
app.get('/items', (req, res) => {
  const page = parseInt(req.query.page) || 1;
  const limit = parseInt(req.query.limit) || 10;
  const sort = req.query.sort || 'name';
  
  res.json({ page, limit, sort });
});

// GET /items → { page: 1, limit: 10, sort: 'name' }
// GET /items?page=2&limit=20 → { page: 2, limit: 20, sort: 'name' }
```

---

## Combining Parameters and Query

```javascript
app.get('/users/:id/posts', (req, res) => {
  const userId = req.params.id;
  const page = req.query.page || 1;
  const limit = req.query.limit || 10;
  
  res.json({
    userId,
    page,
    limit,
    message: `Fetching posts for user ${userId}`
  });
});

// GET /users/5/posts?page=2&limit=20
```

---

## Route Matching

Routes are matched in order they are defined:

```javascript
// Specific route first
app.get('/users/new', (req, res) => {
  res.send('New user form');
});

// Parameter route after
app.get('/users/:id', (req, res) => {
  res.send(`User ${req.params.id}`);
});

// If reversed, /users/new would match :id route!
```

---

## Route Chaining

Same path with different methods:

```javascript
app.route('/users')
  .get((req, res) => {
    res.send('Get all users');
  })
  .post((req, res) => {
    res.send('Create user');
  });

app.route('/users/:id')
  .get((req, res) => {
    res.send(`Get user ${req.params.id}`);
  })
  .put((req, res) => {
    res.send(`Update user ${req.params.id}`);
  })
  .delete((req, res) => {
    res.send(`Delete user ${req.params.id}`);
  });
```

---

## Wildcard Routes

```javascript
// Match any path starting with /api/
app.get('/api/*', (req, res) => {
  res.send('API endpoint');
});

// Catch all (404 handler - put at end)
app.get('*', (req, res) => {
  res.status(404).send('Page not found');
});
```

---

## Regular Expression Routes

```javascript
// Match paths containing 'fly'
app.get(/.*fly$/, (req, res) => {
  res.send('Matched: butterfly, dragonfly, etc.');
});

// Match specific pattern
app.get(/^\/users\/(\d+)$/, (req, res) => {
  res.send('User route with regex');
});
```

---

## Practical Examples

### RESTful API

```javascript
const express = require('express');
const app = express();

app.use(express.json());

let users = [
  { id: 1, name: 'John' },
  { id: 2, name: 'Jane' }
];

// GET all users
app.get('/api/users', (req, res) => {
  res.json(users);
});

// GET single user
app.get('/api/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));
  
  if (!user) {
    return res.status(404).json({ error: 'User not found' });
  }
  
  res.json(user);
});

// POST create user
app.post('/api/users', (req, res) => {
  const newUser = {
    id: users.length + 1,
    name: req.body.name
  };
  
  users.push(newUser);
  res.status(201).json(newUser);
});

// PUT update user
app.put('/api/users/:id', (req, res) => {
  const user = users.find(u => u.id === parseInt(req.params.id));
  
  if (!user) {
    return res.status(404).json({ error: 'User not found' });
  }
  
  user.name = req.body.name;
  res.json(user);
});

// DELETE user
app.delete('/api/users/:id', (req, res) => {
  const index = users.findIndex(u => u.id === parseInt(req.params.id));
  
  if (index === -1) {
    return res.status(404).json({ error: 'User not found' });
  }
  
  users.splice(index, 1);
  res.status(204).send();
});

app.listen(3000);
```

### Search & Filter

```javascript
app.get('/api/products', (req, res) => {
  let { category, minPrice, maxPrice, search, page = 1, limit = 10 } = req.query;
  
  let products = getAllProducts();
  
  // Filter by category
  if (category) {
    products = products.filter(p => p.category === category);
  }
  
  // Filter by price range
  if (minPrice) {
    products = products.filter(p => p.price >= parseFloat(minPrice));
  }
  if (maxPrice) {
    products = products.filter(p => p.price <= parseFloat(maxPrice));
  }
  
  // Search by name
  if (search) {
    products = products.filter(p => 
      p.name.toLowerCase().includes(search.toLowerCase())
    );
  }
  
  // Pagination
  const startIndex = (page - 1) * limit;
  const endIndex = page * limit;
  const paginatedProducts = products.slice(startIndex, endIndex);
  
  res.json({
    products: paginatedProducts,
    total: products.length,
    page: parseInt(page),
    totalPages: Math.ceil(products.length / limit)
  });
});

// GET /api/products?category=electronics&minPrice=100&maxPrice=500&search=phone&page=1&limit=20
```

---

## Best Practices

✅ **Use descriptive paths**: `/users` not `/u`  
✅ **Use plural nouns**: `/users` not `/user`  
✅ **Use HTTP methods correctly**: GET (read), POST (create), PUT/PATCH (update), DELETE (delete)  
✅ **Validate parameters**: Check if ID exists, is valid type  
✅ **Handle 404s**: Return appropriate error for non-existent resources  
✅ **Use proper status codes**: 200, 201, 204, 400, 404, 500  
✅ **Order routes correctly**: Specific routes before parameter routes  
❌ **Don't use verbs in URLs**: `/getUsers` → `/users`  
❌ **Don't mix concerns**: Keep routes focused  

---

## Summary

**Route Structure:**
- `app.METHOD(path, handler)`
- Methods: GET, POST, PUT, PATCH, DELETE

**Route Parameters:**
- Dynamic: `/users/:id`
- Optional: `/users/:id?`
- Multiple: `/users/:userId/posts/:postId`

**Query Strings:**
- Access with `req.query`
- `/search?q=term&page=1`
- Good for filtering, sorting, pagination

**Best Practices:**
- RESTful design
- Proper HTTP methods
- Meaningful URLs
- Parameter validation

**Next:** Learn about Request & Response objects!
