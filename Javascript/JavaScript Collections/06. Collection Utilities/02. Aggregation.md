# Aggregation

## Sum, Min, Max

### Sum
```javascript
const numbers = [1, 2, 3, 4, 5];
const sum = numbers.reduce((acc, n) => acc + n, 0);
console.log(sum);  // 15

// Object property sum
const items = [{price: 10}, {price: 20}, {price: 30}];
const total = items.reduce((sum, item) => sum + item.price, 0);
```

### Min and Max
```javascript
const numbers = [5, 2, 8, 1, 9];

const max = Math.max(...numbers);  // 9
const min = Math.min(...numbers);  // 1

// With reduce
const max2 = numbers.reduce((a, b) => Math.max(a, b));
const min2 = numbers.reduce((a, b) => Math.min(a, b));

// For objects
const items = [{val: 5}, {val: 2}, {val: 8}];
const maxItem = items.reduce((max, item) => 
  item.val > max.val ? item : max
);
```

## Counting

### Count Occurrences
```javascript
const fruits = ['apple', 'banana', 'apple', 'orange', 'banana', 'apple'];

const count = fruits.reduce((acc, fruit) => {
  acc[fruit] = (acc[fruit] || 0) + 1;
  return acc;
}, {});

console.log(count);  // {apple: 3, banana: 2, orange: 1}
```

### Count by Condition
```javascript
const numbers = [1, 2, 3, 4, 5, 6, 7, 8];
const evenCount = numbers.filter(n => n % 2 === 0).length;

// Or with reduce
const evenCount2 = numbers.reduce((count, n) => 
  count + (n % 2 === 0 ? 1 : 0), 0
);
```

## Averaging

### Simple Average
```javascript
const numbers = [10, 20, 30, 40, 50];
const avg = numbers.reduce((sum, n) => sum + n, 0) / numbers.length;
console.log(avg);  // 30
```

### Average of Property
```javascript
const students = [
  {name: 'A', score: 85},
  {name: 'B', score: 90},
  {name: 'C', score: 78}
];

const avgScore = students.reduce((sum, s) => sum + s.score, 0) / students.length;
console.log(avgScore);  // 84.33
```

## reduce() Patterns

### Multiple Aggregations
```javascript
const numbers = [1, 2, 3, 4, 5];

const stats = numbers.reduce((acc, n) => ({
  sum: acc.sum + n,
  min: Math.min(acc.min, n),
  max: Math.max(acc.max, n),
  count: acc.count + 1
}), {sum: 0, min: Infinity, max: -Infinity, count: 0});

stats.avg = stats.sum / stats.count;
console.log(stats);  // {sum: 15, min: 1, max: 5, count: 5, avg: 3}
```

### Flattening and Aggregating
```javascript
const orders = [
  {items: [{price: 10}, {price: 20}]},
  {items: [{price: 30}]}
];

const totalValue = orders.reduce((sum, order) => 
  sum + order.items.reduce((s, item) => s + item.price, 0), 0
);
```

## Custom Aggregations

### Histogram
```javascript
const scores = [85, 92, 78, 90, 88, 95, 72, 89];

const histogram = scores.reduce((acc, score) => {
  const bucket = Math.floor(score / 10) * 10;
  acc[bucket] = (acc[bucket] || 0) + 1;
  return acc;
}, {});

console.log(histogram);  // {70: 2, 80: 3, 90: 3}
```

### Pivot Table
```javascript
const sales = [
  {product: 'A', region: 'East', amount: 100},
  {product: 'A', region: 'West', amount: 150},
  {product: 'B', region: 'East', amount: 200}
];

const pivot = sales.reduce((acc, sale) => {
  if (!acc[sale.product]) acc[sale.product] = {};
  acc[sale.product][sale.region] = sale.amount;
  return acc;
}, {});

console.log(pivot);
// {A: {East: 100, West: 150}, B: {East: 200}}
```

### Statistical Summary
```javascript
function summarize(arr) {
  const sum = arr.reduce((a, b) => a + b, 0);
  const sorted = [...arr].sort((a, b) => a - b);
  const mid = Math.floor(arr.length / 2);
  
  return {
    count: arr.length,
    sum,
    mean: sum / arr.length,
    median: arr.length % 2 ? sorted[mid] : (sorted[mid-1] + sorted[mid]) / 2,
    min: Math.min(...arr),
    max: Math.max(...arr)
  };
}

const data = [1, 2, 3, 4, 5, 6, 7, 8, 9];
console.log(summarize(data));
```

## Key Takeaways

- **reduce()** is powerful for aggregations
- Use **Math.max/min** with spread for simple cases
- **Count** with reduce or filter().length
- **Average** = sum / count
- Combine multiple aggregations in single reduce
- Custom functions for complex aggregations
