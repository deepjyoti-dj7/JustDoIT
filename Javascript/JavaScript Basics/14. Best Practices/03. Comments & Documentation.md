# Comments & Documentation

Best practices for writing effective comments and documentation in JavaScript code.

---

## When to Comment

### Comment the Why, Not the What

Code should be self-explanatory for "what" it does.

```javascript
// Bad - obvious comment
// Increment i by 1
i++;

// Loop through users
for (const user of users) {
  // Print user name
  console.log(user.name);
}

// Good - explains why
// Skip cache for admin users as their permissions change frequently
if (user.isAdmin) {
  return await fetchUserFromDatabase(user.id);
}

// Retry failed requests due to intermittent network issues
for (let attempt = 0; attempt < MAX_RETRIES; attempt++) {
  try {
    return await fetch(url);
  } catch (error) {
    if (attempt === MAX_RETRIES - 1) throw error;
  }
}
```

### Complex Logic

Explain complex algorithms or business logic.

```javascript
// Good - explain complex logic
function calculateShippingCost(order) {
  // Base shipping cost depends on weight
  // 0-5kg: $5, 5-10kg: $10, 10+kg: $15
  let cost = order.weight <= 5 ? 5 : order.weight <= 10 ? 10 : 15;
  
  // Apply 20% discount for orders over $100
  // This is a promotional offer valid until end of year
  if (order.total > 100) {
    cost *= 0.8;
  }
  
  // Express shipping adds 50% to base cost
  if (order.expressShipping) {
    cost *= 1.5;
  }
  
  return cost;
}
```

### Workarounds and Hacks

Document temporary solutions and hacks.

```javascript
// TODO: Remove this hack once API v2 is deployed
// API v1 returns timestamps as strings, v2 will return numbers
const timestamp = typeof data.timestamp === 'string'
  ? parseInt(data.timestamp)
  : data.timestamp;

// HACK: Clear cache manually due to library bug
// See issue: https://github.com/library/issues/123
cache.clear();
setTimeout(() => cache.init(), 100);

// FIXME: This breaks for dates before 1970
// Need to use a proper date library
const age = Math.floor((Date.now() - birthdate) / 31557600000);
```

---

## Types of Comments

### Single-Line Comments

For brief explanations.

```javascript
// Calculate total with tax
const total = subtotal * 1.1;

// Validate email format
if (!isValidEmail(email)) {
  throw new Error('Invalid email');
}
```

### Multi-Line Comments

For longer explanations.

```javascript
/*
 * Process payment using the following steps:
 * 1. Validate payment method
 * 2. Check available balance
 * 3. Apply transaction fee
 * 4. Record transaction
 * 5. Send confirmation email
 */
function processPayment(paymentData) {
  // Implementation
}

/*
 * IMPORTANT: This function modifies the input array
 * in place for performance reasons. Clone the array
 * before calling if you need to preserve the original.
 */
function sortInPlace(array) {
  return array.sort();
}
```

---

## JSDoc Comments

### Function Documentation

```javascript
/**
 * Calculates the total price including tax and shipping.
 * 
 * @param {number} subtotal - The subtotal before tax
 * @param {number} taxRate - Tax rate as decimal (e.g., 0.1 for 10%)
 * @param {number} shippingCost - Flat shipping cost
 * @returns {number} The total price
 * @throws {Error} If subtotal is negative
 * 
 * @example
 * const total = calculateTotal(100, 0.1, 5);
 * // Returns: 115
 */
function calculateTotal(subtotal, taxRate, shippingCost) {
  if (subtotal < 0) {
    throw new Error('Subtotal cannot be negative');
  }
  
  const tax = subtotal * taxRate;
  return subtotal + tax + shippingCost;
}
```

### Class Documentation

```javascript
/**
 * Manages shopping cart operations.
 * 
 * @class
 * @example
 * const cart = new ShoppingCart();
 * cart.addItem({ id: 1, name: 'Product', price: 10 });
 * console.log(cart.getTotal()); // 10
 */
class ShoppingCart {
  /**
   * Creates a new shopping cart.
   * 
   * @constructor
   * @param {Object} [options={}] - Configuration options
   * @param {number} [options.taxRate=0.1] - Tax rate as decimal
   */
  constructor(options = {}) {
    this.items = [];
    this.taxRate = options.taxRate ?? 0.1;
  }
  
  /**
   * Adds an item to the cart.
   * 
   * @param {Object} item - The item to add
   * @param {number} item.id - Item ID
   * @param {string} item.name - Item name
   * @param {number} item.price - Item price
   * @returns {void}
   */
  addItem(item) {
    this.items.push(item);
  }
  
  /**
   * Calculates the total price including tax.
   * 
   * @returns {number} Total price
   */
  getTotal() {
    const subtotal = this.items.reduce((sum, item) => sum + item.price, 0);
    return subtotal * (1 + this.taxRate);
  }
}
```

### Type Definitions

```javascript
/**
 * @typedef {Object} User
 * @property {number} id - User ID
 * @property {string} name - User name
 * @property {string} email - Email address
 * @property {boolean} isActive - Whether user is active
 */

/**
 * Fetches a user by ID.
 * 
 * @param {number} id - User ID
 * @returns {Promise<User>} The user object
 */
async function getUser(id) {
  const response = await fetch(`/api/users/${id}`);
  return response.json();
}

/**
 * @typedef {Object} Product
 * @property {number} id - Product ID
 * @property {string} name - Product name
 * @property {number} price - Product price
 * @property {string[]} tags - Product tags
 */

/**
 * Filters products by tag.
 * 
 * @param {Product[]} products - Array of products
 * @param {string} tag - Tag to filter by
 * @returns {Product[]} Filtered products
 */
function filterByTag(products, tag) {
  return products.filter(p => p.tags.includes(tag));
}
```

---

## TODO Comments

### Mark Future Work

```javascript
// TODO: Add pagination support
function getUsers() {
  return fetch('/api/users').then(r => r.json());
}

// TODO: Implement caching to reduce API calls
async function fetchData(url) {
  return await fetch(url).then(r => r.json());
}

// TODO: Add input validation
// TODO: Handle edge cases (empty array, null values)
function processData(data) {
  return data.map(item => transform(item));
}
```

### Include Context

```javascript
// TODO @john: Review this logic before merge
// The current implementation assumes UTC timezone
function formatDate(date) {
  return date.toISOString();
}

// TODO: Remove after Q1 2024
// Temporary workaround for legacy API compatibility
function convertLegacyFormat(data) {
  // ...
}

// TODO: Performance optimization needed
// This currently O(n²), should be optimized to O(n log n)
function findDuplicates(array) {
  // ...
}
```

---

## Deprecated Code

### Mark Deprecated Features

```javascript
/**
 * Gets user by ID.
 * 
 * @deprecated Use getUserById instead
 * @param {number} id - User ID
 * @returns {Promise<User>}
 */
function getUser(id) {
  console.warn('getUser is deprecated, use getUserById instead');
  return getUserById(id);
}

/**
 * @deprecated Since version 2.0. Use fetchUsers instead.
 */
function loadUsers() {
  return fetchUsers();
}
```

---

## What NOT to Comment

### Obvious Code

```javascript
// Bad - obvious comments
const name = 'John';  // Set name to John
const age = 30;       // Set age to 30

// Add 1 to counter
counter++;

// Return true
return true;

// Good - no comment needed (code is self-explanatory)
const userName = 'John';
const userAge = 30;
counter++;
return isValid;
```

### Bad Code

Don't comment bad code - rewrite it.

```javascript
// Bad - commenting bad code
// This is a hack to get around the limitation
const result = data.map(x => x.value).filter(y => y).reduce((a, b) => a + b);

// Good - write clear code
const validValues = data
  .map(item => item.value)
  .filter(value => value !== null && value !== undefined);

const total = validValues.reduce((sum, value) => sum + value, 0);
```

### Commented-Out Code

Remove it - use version control instead.

```javascript
// Bad - commented code
function processData(data) {
  // const oldWay = data.map(x => transform(x));
  // return oldWay.filter(x => x.valid);
  
  return data
    .map(transform)
    .filter(x => x.valid);
}

// Good - remove commented code
function processData(data) {
  return data
    .map(transform)
    .filter(x => x.valid);
}
```

---

## Code Examples in Comments

### Provide Usage Examples

```javascript
/**
 * Formats a number as currency.
 * 
 * @example
 * formatCurrency(1234.56);
 * // Returns: "$1,234.56"
 * 
 * @example
 * formatCurrency(1234.56, 'EUR');
 * // Returns: "€1,234.56"
 */
function formatCurrency(amount, currency = 'USD') {
  const symbols = { USD: '$', EUR: '€', GBP: '£' };
  const formatted = amount.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
  return `${symbols[currency]}${formatted}`;
}

/**
 * Debounces a function.
 * 
 * @example
 * const debouncedSearch = debounce((query) => {
 *   searchAPI(query);
 * }, 300);
 * 
 * input.addEventListener('input', (e) => {
 *   debouncedSearch(e.target.value);
 * });
 */
function debounce(func, delay) {
  let timeoutId;
  return function(...args) {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => func.apply(this, args), delay);
  };
}
```

---

## Section Dividers

### Organize Large Files

```javascript
// ============================================================================
// Utility Functions
// ============================================================================

function formatDate(date) { /* ... */ }
function formatCurrency(amount) { /* ... */ }

// ============================================================================
// API Functions
// ============================================================================

async function fetchUsers() { /* ... */ }
async function createUser(data) { /* ... */ }

// ============================================================================
// Event Handlers
// ============================================================================

function handleClick(event) { /* ... */ }
function handleSubmit(event) { /* ... */ }

// ============================================================================
// Exports
// ============================================================================

export { formatDate, formatCurrency, fetchUsers };
```

---

## Warning Comments

### Highlight Important Information

```javascript
/**
 * WARNING: This function modifies the input array in place!
 * Clone the array if you need to preserve the original.
 */
function sortArray(array) {
  return array.sort();
}

/**
 * IMPORTANT: Must be called before any other initialization
 * Calling this multiple times will cause unexpected behavior
 */
function initializeApp(config) {
  // ...
}

/**
 * NOTE: This relies on third-party service
 * May fail if service is down
 */
async function geocode(address) {
  // ...
}
```

---

## Regular Expressions

### Explain Complex Regex

```javascript
// Bad - no explanation
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

// Good - explain pattern
/**
 * Email validation regex:
 * - ^[^\s@]+   : Start with one or more non-whitespace, non-@ characters
 * - @          : Literal @ symbol
 * - [^\s@]+    : One or more non-whitespace, non-@ characters
 * - \.         : Literal dot
 * - [^\s@]+$   : End with one or more non-whitespace, non-@ characters
 */
const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

// Or break it down
const emailRegex = new RegExp(
  '^[^\\s@]+' +  // Local part (before @)
  '@' +          // @ symbol
  '[^\\s@]+' +   // Domain name
  '\\.' +        // Dot
  '[^\\s@]+$'    // Top-level domain
);
```

---

## README and Documentation Files

### Project Documentation

```markdown
# Project Name

Brief description of what the project does.

## Installation

\`\`\`bash
npm install package-name
\`\`\`

## Usage

\`\`\`javascript
import { functionName } from 'package-name';

const result = functionName(arg1, arg2);
\`\`\`

## API Reference

### functionName(arg1, arg2)

Description of what the function does.

**Parameters:**
- `arg1` (string): Description of arg1
- `arg2` (number): Description of arg2

**Returns:**
- (Object): Description of return value

**Example:**
\`\`\`javascript
const result = functionName('test', 42);
// { value: 42, name: 'test' }
\`\`\`

## Contributing

Guidelines for contributing.

## License

MIT
```

---

## Comments Maintenance

### Keep Comments Up to Date

```javascript
// Bad - outdated comment
// Returns array of user names
function getUsers() {
  return fetch('/api/users')
    .then(r => r.json())
    .then(users => users);  // Returns full user objects now!
}

// Good - accurate comment
/**
 * Fetches all users from the API.
 * 
 * @returns {Promise<User[]>} Array of user objects
 */
async function getUsers() {
  const response = await fetch('/api/users');
  return response.json();
}
```

### Remove Obsolete Comments

```javascript
// Bad - irrelevant comment
// Note: This used to connect to MySQL
const db = connectToPostgres();

// Good - remove obsolete comment
const db = connectToPostgres();
```

---

## Key Takeaways

- **Comment why, not what**: Code should be self-explanatory
- **Use JSDoc**: For functions, classes, and types
- **TODO comments**: Mark future work with context
- **Deprecation warnings**: Document deprecated code
- **Examples**: Provide usage examples
- **Don't comment obvious code**: Let code speak
- **Remove commented code**: Use version control
- **Keep current**: Update comments when code changes
- **Explain complex logic**: Algorithms, business rules, regex
- **Warning comments**: Highlight important caveats
- Write comments that add value
- Prefer self-documenting code over comments
- Use linters to enforce documentation standards
