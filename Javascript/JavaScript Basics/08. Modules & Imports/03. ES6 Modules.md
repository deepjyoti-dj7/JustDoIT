# ES6 Modules

Modern JavaScript module system using `import` and `export` - the standard for both browsers and Node.js.

---

## Basic Syntax

### Named Exports

```javascript
// math.js
export const PI = 3.14159;

export function add(a, b) {
  return a + b;
}

export function subtract(a, b) {
  return a - b;
}
```

### Importing Named Exports

```javascript
// app.js
import { PI, add, subtract } from './math.js';

console.log(PI);           // 3.14159
console.log(add(5, 3));    // 8
console.log(subtract(5, 3)); // 2
```

---

## Default Export

One default export per module.

```javascript
// logger.js
export default function log(message) {
  console.log(`[LOG] ${message}`);
}

// app.js
import log from './logger.js';
log("Hello World");
```

### Default Export Variations

```javascript
// Function
export default function() { }

// Class
export default class User { }

// Value
export default 42;

// Object
export default {
  name: "John",
  age: 30
};
```

---

## Mixed Exports

Combining default and named exports.

```javascript
// utils.js
export const VERSION = '1.0.0';

export function helper() {
  return "Helper function";
}

export default class Utils {
  static doSomething() {
    return "Main utility";
  }
}

// app.js
import Utils, { VERSION, helper } from './utils.js';

console.log(Utils.doSomething());
console.log(VERSION);
console.log(helper());
```

---

## Import Variations

### Import All

```javascript
// math.js
export const PI = 3.14;
export function add(a, b) { return a + b; }
export function subtract(a, b) { return a - b; }

// app.js
import * as math from './math.js';

console.log(math.PI);
console.log(math.add(5, 3));
console.log(math.subtract(5, 3));
```

### Renaming Imports

```javascript
// Import with alias
import { add as sum, subtract as diff } from './math.js';

console.log(sum(5, 3));   // 8
console.log(diff(5, 3));  // 2
```

### Renaming Exports

```javascript
// math.js
function add(a, b) { return a + b; }
function subtract(a, b) { return a - b; }

export { add as sum, subtract as difference };

// app.js
import { sum, difference } from './math.js';
```

---

## Export Patterns

### Inline Exports

```javascript
// Inline export
export const name = "John";
export function greet() { return "Hello"; }
export class User { }
```

### End-of-File Exports

```javascript
// Define first
const name = "John";
function greet() { return "Hello"; }
class User { }

// Export at the end
export { name, greet, User };
```

### Re-exporting

```javascript
// users/index.js
export { createUser, deleteUser } from './userService.js';
export { UserModel } from './userModel.js';
export { default as UserValidator } from './userValidator.js';

// Now can import from index
import { createUser, UserModel } from './users/index.js';
```

### Export Everything

```javascript
// Re-export all
export * from './module1.js';
export * from './module2.js';

// Re-export all with namespace
export * as utils from './utils.js';
```

---

## Dynamic Imports

Import modules at runtime.

```javascript
// Static import (top-level only)
import { func } from './module.js';

// Dynamic import (anywhere)
async function loadModule() {
  const module = await import('./module.js');
  module.func();
}

// Or with .then()
import('./module.js')
  .then(module => {
    module.func();
  })
  .catch(err => {
    console.error('Failed to load module:', err);
  });
```

### Conditional Loading

```javascript
let module;

if (condition) {
  module = await import('./moduleA.js');
} else {
  module = await import('./moduleB.js');
}

module.doSomething();
```

### Lazy Loading

```javascript
// Load only when needed
button.addEventListener('click', async () => {
  const { heavyFunction } = await import('./heavyModule.js');
  heavyFunction();
});
```

---

## Browser Usage

### HTML Script Tag

```html
<!-- type="module" required -->
<script type="module">
  import { add } from './math.js';
  console.log(add(2, 3));
</script>

<!-- External module file -->
<script type="module" src="app.js"></script>
```

### Features in Browser

```javascript
// Automatic strict mode
// No need for 'use strict'

// Deferred by default
// Scripts execute after HTML parsing

// Own scope (not global)
var x = 10;  // Not added to window
```

### CORS Restrictions

```html
<!-- Must be served via HTTP/HTTPS, not file:// -->
<script type="module" src="app.js"></script>

<!-- Cross-origin modules need CORS headers -->
<script type="module" src="https://example.com/module.js"></script>
```

---

## Node.js Usage

### Option 1: .mjs Extension

```javascript
// math.mjs
export const add = (a, b) => a + b;

// app.mjs
import { add } from './math.mjs';
console.log(add(2, 3));
```

### Option 2: package.json

```json
{
  "type": "module"
}
```

Now `.js` files are treated as ES6 modules:

```javascript
// math.js (ES6 module)
export const add = (a, b) => a + b;

// app.js
import { add } from './math.js';
console.log(add(2, 3));
```

### Using CommonJS in ES6 Modules

```javascript
// Import CommonJS module
import pkg from 'commonjs-package';

// Create require function
import { createRequire } from 'module';
const require = createRequire(import.meta.url);
const oldModule = require('./old-commonjs-module');
```

---

## Practical Examples

### User Module

```javascript
// user.js
export class User {
  constructor(name, email) {
    this.name = name;
    this.email = email;
  }
  
  greet() {
    return `Hello, I'm ${this.name}`;
  }
}

export function createUser(name, email) {
  return new User(name, email);
}

export const DEFAULT_ROLE = 'user';

// app.js
import { User, createUser, DEFAULT_ROLE } from './user.js';

const user = createUser("John", "john@example.com");
console.log(user.greet());
console.log(DEFAULT_ROLE);
```

### API Service

```javascript
// api.js
const BASE_URL = 'https://api.example.com';

export async function fetchUser(id) {
  const response = await fetch(`${BASE_URL}/users/${id}`);
  return await response.json();
}

export async function createUser(userData) {
  const response = await fetch(`${BASE_URL}/users`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(userData)
  });
  return await response.json();
}

export default {
  fetchUser,
  createUser
};

// app.js
import { fetchUser } from './api.js';
// Or
import api from './api.js';

const user = await fetchUser(123);
```

### Configuration

```javascript
// config.js
export const config = {
  api: {
    baseURL: 'https://api.example.com',
    timeout: 5000
  },
  features: {
    darkMode: true,
    notifications: true
  }
};

export const { api, features } = config;

export default config;

// app.js
import { config } from './config.js';
// Or
import { api, features } from './config.js';
```

---

## Advanced Patterns

### Barrel Exports

```javascript
// components/index.js
export { Button } from './Button.js';
export { Input } from './Input.js';
export { Modal } from './Modal.js';
export { Card } from './Card.js';

// app.js
import { Button, Input, Modal } from './components/index.js';
```

### Namespace Pattern

```javascript
// utils/index.js
export * as string from './string.js';
export * as array from './array.js';
export * as object from './object.js';

// app.js
import * as utils from './utils/index.js';

utils.string.capitalize("hello");
utils.array.unique([1, 2, 2, 3]);
```

### Singleton Pattern

```javascript
// database.js
class Database {
  constructor() {
    this.connection = null;
  }
  
  connect() {
    if (!this.connection) {
      this.connection = "Connected";
    }
    return this.connection;
  }
}

export default new Database();

// app.js
import db from './database.js';
db.connect();
```

---

## Module Meta Information

### import.meta

```javascript
// Current module URL
console.log(import.meta.url);
// file:///home/user/project/module.js

// Useful for constructing paths
const __filename = new URL('', import.meta.url).pathname;
const __dirname = new URL('.', import.meta.url).pathname;
```

### In Browser

```javascript
// Load worker relative to current module
const worker = new Worker(
  new URL('./worker.js', import.meta.url)
);

// Load image
const image = new URL('../images/logo.png', import.meta.url).href;
```

---

## Tree Shaking

ES6 modules enable dead code elimination.

```javascript
// utils.js
export function usedFunction() {
  return "I'm used";
}

export function unusedFunction() {
  return "I'm never used";
}

// app.js
import { usedFunction } from './utils.js';
usedFunction();

// After bundling (webpack, rollup):
// unusedFunction is removed (tree-shaken)
```

---

## Comparing with CommonJS

### Static vs Dynamic

```javascript
// ES6 - Static (parsed, not executed)
import { func } from './module.js';  // Top-level only

// CommonJS - Dynamic (executed)
const { func } = require('./module.js');  // Anywhere

if (condition) {
  const module = require('./module.js');  // Works in CommonJS
  // import ... from './module.js';  // Error in ES6
}
```

### Live Bindings

```javascript
// counter.js (ES6)
export let count = 0;
export function increment() {
  count++;
}

// app.js
import { count, increment } from './counter.js';
console.log(count);  // 0
increment();
console.log(count);  // 1 (live binding!)

// CommonJS would show 0 both times (copy)
```

---

## Best Practices

1. **Use named exports for multiple exports**
   ```javascript
   export { func1, func2, func3 };
   ```

2. **Default export for main functionality**
   ```javascript
   export default class MainClass { }
   ```

3. **Include .js extension in imports**
   ```javascript
   import { func } from './module.js';  // Good for browsers
   ```

4. **Organize with barrel exports**
   ```javascript
   // index.js
   export * from './module1.js';
   export * from './module2.js';
   ```

5. **Use dynamic imports for code splitting**
   ```javascript
   const module = await import('./heavy-module.js');
   ```

---

## Common Pitfalls

### Missing File Extension

```javascript
// ✗ May not work in browsers
import { func } from './module';

// ✓ Include extension
import { func } from './module.js';
```

### Import Must Be Top-Level

```javascript
// ✗ Error
if (condition) {
  import { func } from './module.js';
}

// ✓ Use dynamic import
if (condition) {
  const module = await import('./module.js');
}
```

### Can't Modify Imports

```javascript
import { value } from './module.js';
value = 10;  // Error: Assignment to constant variable
```

---

## Key Takeaways

- **ES6 modules** are the JavaScript standard
- **`import`** and **`export`** keywords
- **Named exports**: `export const func = () => {}`
- **Default export**: `export default class {}`
- **Static structure** - analyzed at parse time
- **Live bindings** - changes reflect in imports
- **Tree shaking** - unused code eliminated
- **Dynamic imports** - `import()` for runtime loading
- **Browser support** - use `type="module"`
- **Node.js** - use `.mjs` or `"type": "module"`
- **Prefer ES6** for new projects
- **Include .js extension** in imports
