# Creating & Removing Elements

Methods for dynamically creating, adding, and removing DOM elements.

---

## createElement()

Creates a new element node.

```javascript
const div = document.createElement('div');
const paragraph = document.createElement('p');
const button = document.createElement('button');

console.log(div);  // <div></div>

// Element exists but not in DOM yet
console.log(div.parentNode);  // null
```

### Set Attributes and Content

```javascript
const link = document.createElement('a');

link.href = 'https://example.com';
link.textContent = 'Visit Example';
link.className = 'external-link';
link.target = '_blank';

console.log(link);
// <a href="https://example.com" class="external-link" target="_blank">Visit Example</a>
```

---

## createTextNode()

Creates a text node.

```javascript
const textNode = document.createTextNode('Hello World');

const paragraph = document.createElement('p');
paragraph.appendChild(textNode);

console.log(paragraph);  // <p>Hello World</p>

// Usually, textContent is simpler
const paragraph2 = document.createElement('p');
paragraph2.textContent = 'Hello World';  // Easier way
```

---

## appendChild()

Adds a node as the last child of a parent element.

```javascript
const list = document.querySelector('ul');
const item = document.createElement('li');

item.textContent = 'New Item';
list.appendChild(item);

// <ul>
//   <li>New Item</li>  <!-- Added at end -->
// </ul>
```

### Move Existing Element

```javascript
const existingDiv = document.querySelector('.box');
const container = document.querySelector('.container');

// Moves (not copies) the element
container.appendChild(existingDiv);
```

### Creating Multiple Elements

```javascript
const list = document.querySelector('ul');

for (let i = 1; i <= 5; i++) {
  const item = document.createElement('li');
  item.textContent = `Item ${i}`;
  list.appendChild(item);
}
```

---

## append()

Modern alternative to appendChild(). Can append multiple nodes and strings.

```javascript
const container = document.querySelector('.container');

// Append single element
const div = document.createElement('div');
container.append(div);

// Append multiple elements
const p1 = document.createElement('p');
const p2 = document.createElement('p');
container.append(p1, p2);

// Append text directly (no need for createTextNode)
container.append('Some text');

// Mix elements and text
container.append('Hello ', document.createElement('strong'), '!');
```

### append() vs appendChild()

```javascript
// appendChild - returns the node, only one at a time
const child = parent.appendChild(newElement);

// append - returns undefined, multiple at once
parent.append(elem1, elem2, 'text');
```

---

## insertBefore()

Inserts a node before a reference node.

```javascript
const parent = document.querySelector('.list');
const newItem = document.createElement('li');
const referenceItem = parent.querySelector('li:nth-child(2)');

// Insert before second item
parent.insertBefore(newItem, referenceItem);

// Insert as first child
parent.insertBefore(newItem, parent.firstChild);
```

---

## prepend()

Adds nodes at the beginning of a parent.

```javascript
const list = document.querySelector('ul');

const item = document.createElement('li');
item.textContent = 'First Item';

list.prepend(item);  // Adds at start

// Multiple elements
list.prepend(item1, item2, 'Text');
```

---

## insertAdjacentElement()

Inserts an element at a specified position relative to another element.

```javascript
const target = document.querySelector('.target');
const newElement = document.createElement('div');

// beforebegin: before the target element
target.insertAdjacentElement('beforebegin', newElement);

// afterbegin: first child of target
target.insertAdjacentElement('afterbegin', newElement);

// beforeend: last child of target
target.insertAdjacentElement('beforeend', newElement);

// afterend: after the target element
target.insertAdjacentElement('afterend', newElement);
```

### Visual Representation

```html
<!-- beforebegin -->
<div class="target">
  <!-- afterbegin -->
  Content
  <!-- beforeend -->
</div>
<!-- afterend -->
```

---

## insertAdjacentHTML()

Parses HTML string and inserts at specified position.

```javascript
const container = document.querySelector('.container');

// Add HTML at start
container.insertAdjacentHTML('afterbegin', '<p>First paragraph</p>');

// Add HTML at end
container.insertAdjacentHTML('beforeend', '<p>Last paragraph</p>');

// Add complex HTML
container.insertAdjacentHTML('beforeend', `
  <div class="card">
    <h3>Title</h3>
    <p>Description</p>
  </div>
`);
```

### Positions

```javascript
element.insertAdjacentHTML('beforebegin', html);  // Before element
element.insertAdjacentHTML('afterbegin', html);   // First child
element.insertAdjacentHTML('beforeend', html);    // Last child
element.insertAdjacentHTML('afterend', html);     // After element
```

---

## removeChild()

Removes a child node from a parent.

```javascript
const parent = document.querySelector('.list');
const child = document.querySelector('.list-item');

parent.removeChild(child);

// Store removed element
const removed = parent.removeChild(child);
console.log(removed);  // Can use later
```

### Remove by Index

```javascript
const list = document.querySelector('ul');

// Remove first child
list.removeChild(list.firstChild);

// Remove last child
list.removeChild(list.lastChild);

// Remove specific child
list.removeChild(list.children[2]);
```

---

## remove()

Modern way to remove an element (removes itself).

```javascript
const element = document.querySelector('.to-remove');

element.remove();  // Removes itself from DOM

// No need for parent reference
// Old way: element.parentNode.removeChild(element);
```

### Remove Multiple Elements

```javascript
const items = document.querySelectorAll('.item');

items.forEach(item => item.remove());
```

---

## replaceChild()

Replaces a child node with another node.

```javascript
const parent = document.querySelector('.container');
const oldChild = document.querySelector('.old');
const newChild = document.createElement('div');

newChild.textContent = 'New Element';

parent.replaceChild(newChild, oldChild);
```

---

## replaceWith()

Modern alternative to replaceChild().

```javascript
const oldElement = document.querySelector('.old');
const newElement = document.createElement('div');

newElement.textContent = 'New Element';

// Replace old with new
oldElement.replaceWith(newElement);

// Can replace with multiple nodes
oldElement.replaceWith(elem1, elem2, 'text');
```

---

## cloneNode()

Creates a copy of a node.

```javascript
const original = document.querySelector('.card');

// Shallow clone (no children)
const shallowClone = original.cloneNode();

// Deep clone (with all children)
const deepClone = original.cloneNode(true);

document.body.appendChild(deepClone);
```

### Practical Example

```javascript
function duplicateElement(selector) {
  const original = document.querySelector(selector);
  const clone = original.cloneNode(true);
  
  original.parentNode.insertBefore(clone, original.nextSibling);
}

duplicateElement('.card');
```

---

## DocumentFragment

Efficient way to create multiple elements before adding to DOM.

```javascript
const fragment = document.createDocumentFragment();

for (let i = 0; i < 100; i++) {
  const item = document.createElement('li');
  item.textContent = `Item ${i}`;
  fragment.appendChild(item);
}

// Single DOM update (more efficient)
document.querySelector('ul').appendChild(fragment);
```

### Why Use Fragments?

```javascript
// Bad - 100 DOM updates (slow)
const list = document.querySelector('ul');
for (let i = 0; i < 100; i++) {
  const item = document.createElement('li');
  list.appendChild(item);  // Reflow each time
}

// Good - 1 DOM update (fast)
const fragment = document.createDocumentFragment();
for (let i = 0; i < 100; i++) {
  const item = document.createElement('li');
  fragment.appendChild(item);  // No reflow
}
list.appendChild(fragment);  // Single reflow
```

---

## Practical Examples

### Create Card Component

```javascript
function createCard(title, description) {
  const card = document.createElement('div');
  card.className = 'card';
  
  const heading = document.createElement('h3');
  heading.textContent = title;
  
  const para = document.createElement('p');
  para.textContent = description;
  
  const button = document.createElement('button');
  button.textContent = 'Learn More';
  button.className = 'btn';
  
  card.append(heading, para, button);
  
  return card;
}

const card = createCard('JavaScript', 'Modern programming language');
document.body.appendChild(card);
```

### Create List from Array

```javascript
function createList(items, className) {
  const ul = document.createElement('ul');
  ul.className = className;
  
  items.forEach(item => {
    const li = document.createElement('li');
    li.textContent = item;
    ul.appendChild(li);
  });
  
  return ul;
}

const fruits = ['Apple', 'Banana', 'Orange'];
const list = createList(fruits, 'fruit-list');
document.body.appendChild(list);
```

### Create Table

```javascript
function createTable(data) {
  const table = document.createElement('table');
  
  // Header
  const thead = document.createElement('thead');
  const headerRow = document.createElement('tr');
  
  Object.keys(data[0]).forEach(key => {
    const th = document.createElement('th');
    th.textContent = key;
    headerRow.appendChild(th);
  });
  
  thead.appendChild(headerRow);
  table.appendChild(thead);
  
  // Body
  const tbody = document.createElement('tbody');
  
  data.forEach(row => {
    const tr = document.createElement('tr');
    
    Object.values(row).forEach(value => {
      const td = document.createElement('td');
      td.textContent = value;
      tr.appendChild(td);
    });
    
    tbody.appendChild(tr);
  });
  
  table.appendChild(tbody);
  return table;
}

const data = [
  { name: 'John', age: 30, city: 'New York' },
  { name: 'Jane', age: 25, city: 'London' }
];

const table = createTable(data);
document.body.appendChild(table);
```

### Clear All Children

```javascript
function clearElement(selector) {
  const element = document.querySelector(selector);
  
  // Method 1: remove()
  while (element.firstChild) {
    element.firstChild.remove();
  }
  
  // Method 2: innerHTML (simpler but slower for large trees)
  element.innerHTML = '';
  
  // Method 3: replaceChildren (modern)
  element.replaceChildren();
}

clearElement('.container');
```

### Toggle Element

```javascript
function toggleElement(selector) {
  const element = document.querySelector(selector);
  
  if (element.parentNode) {
    // Store position before removing
    const parent = element.parentNode;
    const nextSibling = element.nextSibling;
    
    element.remove();
    
    // Store reference to restore later
    element._parent = parent;
    element._nextSibling = nextSibling;
  } else if (element._parent) {
    // Restore to original position
    element._parent.insertBefore(element, element._nextSibling);
  }
}
```

---

## Performance Tips

### Batch DOM Updates

```javascript
// Bad - multiple reflows
for (let i = 0; i < 100; i++) {
  const div = document.createElement('div');
  document.body.appendChild(div);
}

// Good - single reflow
const fragment = document.createDocumentFragment();
for (let i = 0; i < 100; i++) {
  const div = document.createElement('div');
  fragment.appendChild(div);
}
document.body.appendChild(fragment);
```

### Hide Element During Updates

```javascript
const list = document.querySelector('ul');

// Hide element
list.style.display = 'none';

// Make changes
for (let i = 0; i < 100; i++) {
  const item = document.createElement('li');
  list.appendChild(item);
}

// Show again
list.style.display = '';
```

### Use innerHTML for Simple Cases

```javascript
// For simple static content, innerHTML is fine
container.innerHTML = '<p>Hello <strong>World</strong></p>';

// For dynamic content with data, use createElement
const para = document.createElement('p');
para.textContent = userInput;  // Safe from XSS
container.appendChild(para);
```

---

## Security Considerations

### Avoid innerHTML with User Input

```javascript
// Dangerous - XSS vulnerability
const userInput = '<img src=x onerror=alert("XSS")>';
div.innerHTML = userInput;  // Code executes!

// Safe - escapes HTML
div.textContent = userInput;  // Displays as text

// Safe - creates proper elements
const p = document.createElement('p');
p.textContent = userInput;
div.appendChild(p);
```

---

## Key Takeaways

- **createElement**: Create new elements
- **appendChild**: Add as last child (returns node)
- **append**: Modern, multiple nodes, text support
- **prepend**: Add as first child
- **insertBefore**: Insert at specific position
- **insertAdjacentElement/HTML**: Four position options
- **remove**: Remove element (modern)
- **removeChild**: Remove child from parent (legacy)
- **replaceWith**: Replace element (modern)
- **cloneNode**: Copy elements (true for deep copy)
- **DocumentFragment**: Batch operations efficiently
- Avoid innerHTML with user input (XSS risk)
- Use fragments for multiple insertions
- Cache references to avoid repeated queries
