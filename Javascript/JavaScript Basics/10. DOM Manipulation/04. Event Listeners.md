# Event Listeners

Methods for attaching and managing event handlers in JavaScript.

---

## addEventListener()

Attaches an event handler to an element without overwriting existing handlers.

```javascript
const button = document.querySelector('button');

button.addEventListener('click', () => {
  console.log('Button clicked!');
});

// Can add multiple listeners
button.addEventListener('click', () => {
  console.log('Another handler');
});

// Both handlers will execute
```

### Event Types

```javascript
// Mouse events
element.addEventListener('click', handler);
element.addEventListener('dblclick', handler);
element.addEventListener('mouseenter', handler);
element.addEventListener('mouseleave', handler);
element.addEventListener('mousemove', handler);
element.addEventListener('mousedown', handler);
element.addEventListener('mouseup', handler);

// Keyboard events
element.addEventListener('keydown', handler);
element.addEventListener('keyup', handler);
element.addEventListener('keypress', handler);  // Deprecated

// Form events
form.addEventListener('submit', handler);
input.addEventListener('input', handler);
input.addEventListener('change', handler);
input.addEventListener('focus', handler);
input.addEventListener('blur', handler);

// Document events
document.addEventListener('DOMContentLoaded', handler);
window.addEventListener('load', handler);
window.addEventListener('resize', handler);
window.addEventListener('scroll', handler);
```

---

## Event Object

Every event handler receives an event object with information about the event.

```javascript
button.addEventListener('click', (event) => {
  console.log(event.type);           // 'click'
  console.log(event.target);         // Element that triggered event
  console.log(event.currentTarget);  // Element with listener attached
  console.log(event.timeStamp);      // When event occurred
});
```

### Mouse Event Properties

```javascript
element.addEventListener('click', (e) => {
  console.log(e.clientX);    // X coordinate relative to viewport
  console.log(e.clientY);    // Y coordinate relative to viewport
  console.log(e.pageX);      // X coordinate relative to document
  console.log(e.pageY);      // Y coordinate relative to document
  console.log(e.button);     // Which mouse button (0=left, 1=middle, 2=right)
  console.log(e.ctrlKey);    // Was Ctrl key pressed?
  console.log(e.shiftKey);   // Was Shift key pressed?
  console.log(e.altKey);     // Was Alt key pressed?
});
```

### Keyboard Event Properties

```javascript
document.addEventListener('keydown', (e) => {
  console.log(e.key);        // 'a', 'Enter', 'ArrowUp', etc.
  console.log(e.code);       // 'KeyA', 'Enter', 'ArrowUp', etc.
  console.log(e.keyCode);    // Numeric code (deprecated)
  console.log(e.ctrlKey);    // Was Ctrl pressed?
  console.log(e.shiftKey);   // Was Shift pressed?
  console.log(e.altKey);     // Was Alt pressed?
});
```

---

## preventDefault()

Prevents the default action of an event.

```javascript
// Prevent form submission
form.addEventListener('submit', (e) => {
  e.preventDefault();
  console.log('Form not submitted');
});

// Prevent link navigation
link.addEventListener('click', (e) => {
  e.preventDefault();
  console.log('Link not followed');
});

// Prevent context menu
element.addEventListener('contextmenu', (e) => {
  e.preventDefault();
  console.log('Right-click disabled');
});
```

### Conditional Prevention

```javascript
form.addEventListener('submit', (e) => {
  const isValid = validateForm();
  
  if (!isValid) {
    e.preventDefault();
    console.log('Invalid form');
  }
});
```

---

## stopPropagation()

Stops the event from bubbling up the DOM tree.

```javascript
child.addEventListener('click', (e) => {
  e.stopPropagation();
  console.log('Child clicked');
});

parent.addEventListener('click', () => {
  console.log('Parent clicked');  // Won't execute if child is clicked
});
```

### stopImmediatePropagation()

```javascript
button.addEventListener('click', (e) => {
  e.stopImmediatePropagation();
  console.log('First handler');
});

button.addEventListener('click', () => {
  console.log('Second handler');  // Won't execute
});
```

---

## removeEventListener()

Removes an event handler from an element.

```javascript
function handleClick() {
  console.log('Clicked');
}

// Add listener
button.addEventListener('click', handleClick);

// Remove listener
button.removeEventListener('click', handleClick);
```

### Must Use Named Function

```javascript
// Won't work - can't remove anonymous function
button.addEventListener('click', () => {
  console.log('Click');
});
button.removeEventListener('click', () => {
  console.log('Click');
});  // Different function reference!

// Works - same function reference
function handler() {
  console.log('Click');
}
button.addEventListener('click', handler);
button.removeEventListener('click', handler);  // Removed
```

### One-Time Event

```javascript
function handleClick() {
  console.log('Clicked once');
  button.removeEventListener('click', handleClick);
}

button.addEventListener('click', handleClick);

// Or use 'once' option (modern)
button.addEventListener('click', () => {
  console.log('Clicked once');
}, { once: true });
```

---

## Event Options

### capture

```javascript
// Event captured during capture phase instead of bubble phase
parent.addEventListener('click', () => {
  console.log('Parent');
}, { capture: true });

child.addEventListener('click', () => {
  console.log('Child');
});

// Click child: Logs "Parent" then "Child"
```

### once

```javascript
// Listener removed after first execution
button.addEventListener('click', () => {
  console.log('Executed once');
}, { once: true });
```

### passive

```javascript
// Indicates listener won't call preventDefault()
// Improves scroll performance
document.addEventListener('scroll', () => {
  console.log('Scrolling');
}, { passive: true });
```

### Combined Options

```javascript
element.addEventListener('click', handler, {
  capture: true,
  once: true,
  passive: false
});
```

---

## Event Bubbling

Events propagate from child to parent (bottom to top).

```javascript
// HTML: <div id="parent"><div id="child">Click</div></div>

const parent = document.getElementById('parent');
const child = document.getElementById('child');

child.addEventListener('click', () => {
  console.log('Child clicked');
});

parent.addEventListener('click', () => {
  console.log('Parent clicked');
});

// Click child: Logs "Child clicked" then "Parent clicked"
```

### Event Capturing

Opposite of bubbling (top to bottom).

```javascript
parent.addEventListener('click', () => {
  console.log('Parent');
}, true);  // Use capture phase

child.addEventListener('click', () => {
  console.log('Child');
}, false);  // Use bubble phase (default)

// Click child: Logs "Parent" then "Child"
```

---

## Event Delegation

Attach a single listener to a parent instead of multiple listeners to children.

```javascript
// Instead of this (inefficient)
const buttons = document.querySelectorAll('.btn');
buttons.forEach(button => {
  button.addEventListener('click', handleClick);
});

// Do this (efficient)
document.querySelector('.container').addEventListener('click', (e) => {
  if (e.target.matches('.btn')) {
    handleClick(e);
  }
});
```

### Dynamic Elements

```javascript
// Works for elements added after page load
const list = document.querySelector('ul');

list.addEventListener('click', (e) => {
  if (e.target.tagName === 'LI') {
    console.log('List item clicked:', e.target.textContent);
  }
});

// Add new item dynamically - listener still works
const newItem = document.createElement('li');
newItem.textContent = 'New Item';
list.appendChild(newItem);
```

### Practical Example

```javascript
function setupTodoList() {
  const list = document.querySelector('.todo-list');
  
  list.addEventListener('click', (e) => {
    // Delete button clicked
    if (e.target.matches('.delete-btn')) {
      e.target.closest('li').remove();
    }
    
    // Checkbox clicked
    if (e.target.matches('.todo-checkbox')) {
      e.target.closest('li').classList.toggle('completed');
    }
    
    // Edit button clicked
    if (e.target.matches('.edit-btn')) {
      const li = e.target.closest('li');
      const text = li.querySelector('.todo-text');
      text.contentEditable = true;
      text.focus();
    }
  });
}
```

---

## Common Event Patterns

### Form Validation

```javascript
const form = document.querySelector('form');
const emailInput = document.querySelector('#email');

emailInput.addEventListener('input', (e) => {
  const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.target.value);
  
  if (isValid) {
    emailInput.classList.remove('invalid');
    emailInput.classList.add('valid');
  } else {
    emailInput.classList.remove('valid');
    emailInput.classList.add('invalid');
  }
});

form.addEventListener('submit', (e) => {
  e.preventDefault();
  
  if (validateForm()) {
    submitForm();
  }
});
```

### Debounce Search

```javascript
let timeout;

searchInput.addEventListener('input', (e) => {
  clearTimeout(timeout);
  
  timeout = setTimeout(() => {
    search(e.target.value);
  }, 300);
});
```

### Toggle Menu

```javascript
const menuButton = document.querySelector('.menu-btn');
const menu = document.querySelector('.menu');

menuButton.addEventListener('click', () => {
  menu.classList.toggle('open');
});

// Close menu when clicking outside
document.addEventListener('click', (e) => {
  if (!menu.contains(e.target) && !menuButton.contains(e.target)) {
    menu.classList.remove('open');
  }
});
```

### Drag and Drop

```javascript
const draggable = document.querySelector('.draggable');

draggable.addEventListener('dragstart', (e) => {
  e.dataTransfer.setData('text/plain', e.target.id);
  e.target.classList.add('dragging');
});

draggable.addEventListener('dragend', (e) => {
  e.target.classList.remove('dragging');
});

const dropzone = document.querySelector('.dropzone');

dropzone.addEventListener('dragover', (e) => {
  e.preventDefault();  // Allow drop
  dropzone.classList.add('drag-over');
});

dropzone.addEventListener('dragleave', () => {
  dropzone.classList.remove('drag-over');
});

dropzone.addEventListener('drop', (e) => {
  e.preventDefault();
  const id = e.dataTransfer.getData('text/plain');
  const element = document.getElementById(id);
  dropzone.appendChild(element);
  dropzone.classList.remove('drag-over');
});
```

### Infinite Scroll

```javascript
window.addEventListener('scroll', () => {
  const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
  
  if (scrollTop + clientHeight >= scrollHeight - 100) {
    loadMoreContent();
  }
});
```

### Keyboard Shortcuts

```javascript
document.addEventListener('keydown', (e) => {
  // Ctrl + S to save
  if (e.ctrlKey && e.key === 's') {
    e.preventDefault();
    saveDocument();
  }
  
  // Escape to close modal
  if (e.key === 'Escape') {
    closeModal();
  }
  
  // Arrow keys for navigation
  if (e.key === 'ArrowLeft') {
    navigatePrevious();
  }
  if (e.key === 'ArrowRight') {
    navigateNext();
  }
});
```

---

## Custom Events

### Create and Dispatch

```javascript
// Create custom event
const myEvent = new CustomEvent('myevent', {
  detail: { message: 'Hello World' },
  bubbles: true,
  cancelable: true
});

// Listen for custom event
element.addEventListener('myevent', (e) => {
  console.log(e.detail.message);  // 'Hello World'
});

// Dispatch event
element.dispatchEvent(myEvent);
```

### Practical Example

```javascript
class Counter {
  constructor() {
    this.count = 0;
    this.element = document.createElement('div');
  }
  
  increment() {
    this.count++;
    
    // Dispatch custom event
    const event = new CustomEvent('countchanged', {
      detail: { count: this.count }
    });
    this.element.dispatchEvent(event);
  }
}

const counter = new Counter();

counter.element.addEventListener('countchanged', (e) => {
  console.log('Count is now:', e.detail.count);
});

counter.increment();  // Logs: "Count is now: 1"
```

---

## Memory Leaks

### Remove Listeners When Done

```javascript
function setupModal() {
  const closeBtn = document.querySelector('.close-btn');
  
  function handleClose() {
    modal.style.display = 'none';
    // Remove listener to prevent memory leak
    closeBtn.removeEventListener('click', handleClose);
  }
  
  closeBtn.addEventListener('click', handleClose);
}
```

### Use AbortController (Modern)

```javascript
const controller = new AbortController();

button.addEventListener('click', () => {
  console.log('Clicked');
}, { signal: controller.signal });

// Remove all listeners attached with this signal
controller.abort();
```

---

## Best Practices

```javascript
// 1. Use addEventListener, not onclick
element.addEventListener('click', handler);  // Good
element.onclick = handler;                   // Avoid

// 2. Use event delegation for dynamic content
parent.addEventListener('click', (e) => {
  if (e.target.matches('.child')) { /* ... */ }
});

// 3. Named functions for removable listeners
function handler() { /* ... */ }
element.addEventListener('click', handler);
element.removeEventListener('click', handler);

// 4. Prevent default when needed
form.addEventListener('submit', (e) => {
  e.preventDefault();
});

// 5. Remove listeners to prevent memory leaks
cleanup() {
  element.removeEventListener('click', handler);
}

// 6. Use passive for scroll/touch events
window.addEventListener('scroll', handler, { passive: true });

// 7. Debounce expensive operations
let timeout;
input.addEventListener('input', () => {
  clearTimeout(timeout);
  timeout = setTimeout(expensiveOperation, 300);
});
```

---

## Key Takeaways

- **addEventListener**: Attach event handlers (multiple allowed)
- **removeEventListener**: Remove specific handler
- **Event object**: Contains event details (type, target, etc.)
- **preventDefault**: Stop default behavior
- **stopPropagation**: Stop event bubbling
- **Event delegation**: Single listener for multiple children
- **Options**: capture, once, passive for fine control
- Use named functions for removable listeners
- Clean up listeners to prevent memory leaks
- Use event delegation for dynamic elements
- Debounce expensive operations
- Custom events for component communication
