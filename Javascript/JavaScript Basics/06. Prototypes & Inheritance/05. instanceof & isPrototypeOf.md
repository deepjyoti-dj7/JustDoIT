# instanceof & isPrototypeOf

These operators check relationships between objects and constructors/prototypes in the prototype chain.

---

## instanceof Operator

Checks if an object is an instance of a constructor (checks prototype chain).

### Basic Usage

```javascript
function Person(name) {
  this.name = name;
}

const person = new Person("John");

console.log(person instanceof Person);   // true
console.log(person instanceof Object);   // true
console.log(person instanceof Array);    // false
```

### How It Works

`instanceof` checks if `Constructor.prototype` exists anywhere in the object's prototype chain.

```javascript
// Checks: object.__proto__ === Constructor.prototype
// Or: object.__proto__.__proto__ === Constructor.prototype
// And so on up the chain

const arr = [1, 2, 3];

console.log(arr instanceof Array);   // true
console.log(arr instanceof Object);  // true (Array inherits from Object)
console.log(arr instanceof String);  // false
```

---

## Inheritance Checking

```javascript
function Animal() {}
function Dog() {}

Dog.prototype = Object.create(Animal.prototype);

const dog = new Dog();

console.log(dog instanceof Dog);      // true
console.log(dog instanceof Animal);   // true
console.log(dog instanceof Object);   // true

// Chain: dog → Dog.prototype → Animal.prototype → Object.prototype
```

---

## Primitives and instanceof

```javascript
console.log("hello" instanceof String);  // false (primitive)
console.log(new String("hello") instanceof String);  // true (object)

console.log(42 instanceof Number);       // false (primitive)
console.log(new Number(42) instanceof Number);  // true (object)

console.log(true instanceof Boolean);    // false (primitive)
console.log(new Boolean(true) instanceof Boolean);  // true (object)
```

---

## Custom instanceof Check

```javascript
class MyClass {
  static [Symbol.hasInstance](obj) {
    // Custom instanceof logic
    return obj.customProperty === true;
  }
}

const obj1 = { customProperty: true };
const obj2 = { customProperty: false };

console.log(obj1 instanceof MyClass);  // true
console.log(obj2 instanceof MyClass);  // false
```

---

## isPrototypeOf Method

Checks if an object exists in another object's prototype chain.

### Basic Usage

```javascript
const animal = {
  eats: true
};

const rabbit = Object.create(animal);

console.log(animal.isPrototypeOf(rabbit));  // true
console.log(Object.prototype.isPrototypeOf(rabbit));  // true
console.log(Array.prototype.isPrototypeOf(rabbit));   // false
```

### With Constructors

```javascript
function Person(name) {
  this.name = name;
}

const person = new Person("John");

console.log(Person.prototype.isPrototypeOf(person));  // true
console.log(Object.prototype.isPrototypeOf(person));  // true
```

---

## instanceof vs isPrototypeOf

### Key Differences

```javascript
function Person() {}
const person = new Person();

// instanceof: object vs constructor
console.log(person instanceof Person);  // true

// isPrototypeOf: prototype vs object
console.log(Person.prototype.isPrototypeOf(person));  // true
```

### Example Comparison

```javascript
const animal = { eats: true };
const rabbit = Object.create(animal);

// isPrototypeOf works with plain objects
console.log(animal.isPrototypeOf(rabbit));  // true

// instanceof needs a constructor
// No constructor function, so can't use instanceof directly
```

---

## Checking Multiple Levels

```javascript
function Animal() {}
function Mammal() {}
function Dog() {}

Mammal.prototype = Object.create(Animal.prototype);
Dog.prototype = Object.create(Mammal.prototype);

const dog = new Dog();

// instanceof checks entire chain
console.log(dog instanceof Dog);      // true
console.log(dog instanceof Mammal);   // true
console.log(dog instanceof Animal);   // true
console.log(dog instanceof Object);   // true

// isPrototypeOf also checks entire chain
console.log(Dog.prototype.isPrototypeOf(dog));     // true
console.log(Mammal.prototype.isPrototypeOf(dog));  // true
console.log(Animal.prototype.isPrototypeOf(dog));  // true
console.log(Object.prototype.isPrototypeOf(dog));  // true
```

---

## Practical Use Cases

### Type Checking

```javascript
function processInput(input) {
  if (input instanceof Array) {
    return input.map(x => x * 2);
  } else if (input instanceof Object) {
    return Object.values(input);
  } else {
    return [input];
  }
}

console.log(processInput([1, 2, 3]));     // [2, 4, 6]
console.log(processInput({ a: 1, b: 2 })); // [1, 2]
console.log(processInput(5));              // [5]
```

### Polymorphism

```javascript
function Animal() {}
Animal.prototype.speak = function() {
  return "Some sound";
};

function Dog() {}
Dog.prototype = Object.create(Animal.prototype);
Dog.prototype.speak = function() {
  return "Woof!";
};

function makeAnimalSpeak(animal) {
  if (animal instanceof Animal) {
    console.log(animal.speak());
  } else {
    console.log("Not an animal");
  }
}

makeAnimalSpeak(new Dog());  // "Woof!"
```

### Error Handling

```javascript
try {
  throw new TypeError("Custom error");
} catch (e) {
  if (e instanceof TypeError) {
    console.log("Type error:", e.message);
  } else if (e instanceof ReferenceError) {
    console.log("Reference error:", e.message);
  } else {
    console.log("Unknown error");
  }
}
```

---

## Cross-frame Issues

```javascript
// In iframe context, Array from iframe !== Array from parent
const iframe = document.createElement('iframe');
document.body.appendChild(iframe);

const iframeArray = new iframe.contentWindow.Array();

console.log(iframeArray instanceof Array);  // false (different Array constructor)
console.log(Array.isArray(iframeArray));     // true (better check)

// Better: Use Array.isArray() for arrays
```

---

## Alternative Type Checks

### For Arrays
```javascript
// ✓ Recommended
Array.isArray([1, 2, 3]);  // true

// ✗ Can fail across frames
[1, 2, 3] instanceof Array;
```

### For Objects
```javascript
// Check for plain object
Object.prototype.toString.call(obj) === '[object Object]'

// Or
obj?.constructor === Object
```

### For null/undefined
```javascript
// instanceof doesn't work with null/undefined
null instanceof Object;       // false
undefined instanceof Object;  // false

// Use strict equality
value === null
value === undefined
value == null  // Checks both
```

---

## Checking Constructor Changes

```javascript
function Person() {}
const person = new Person();

console.log(person instanceof Person);  // true

// Change prototype
Person.prototype = {};

console.log(person instanceof Person);  // false (prototype changed!)
```

---

## Best Practices

1. **Use instanceof for constructor checks**
   ```javascript
   if (obj instanceof MyClass) { }
   ```

2. **Use isPrototypeOf for prototype checks**
   ```javascript
   if (MyProto.isPrototypeOf(obj)) { }
   ```

3. **Use Array.isArray() for arrays**
   ```javascript
   Array.isArray(arr)  // Not: arr instanceof Array
   ```

4. **Use typeof for primitives**
   ```javascript
   typeof str === 'string'  // Not: str instanceof String
   ```

5. **Handle cross-frame issues**
   ```javascript
   // For arrays
   Array.isArray(value)
   
   // For plain objects
   Object.prototype.toString.call(value) === '[object Object]'
   ```

---

## Common Pitfalls

### Primitive Confusion
```javascript
"string" instanceof String  // false (primitive)
new String("string") instanceof String  // true (object)

// Use typeof for primitives
typeof "string" === 'string'  // true
```

### Null and Undefined
```javascript
null instanceof Object      // false
undefined instanceof Object // false

// These don't have prototypes
Object.getPrototypeOf(null)  // TypeError
```

### Changed Prototypes
```javascript
function Test() {}
const obj = new Test();

console.log(obj instanceof Test);  // true

Test.prototype = {};
console.log(obj instanceof Test);  // false!
```

---

## Performance Considerations

```javascript
// instanceof is generally fast
// But for simple checks, typeof is faster

typeof value === 'string'  // Fastest for primitives
value instanceof String    // Slower, walks prototype chain
```

---

## Key Takeaways

- **`instanceof`**: Checks if constructor's prototype is in object's chain
- **`isPrototypeOf()`**: Checks if object is in another's prototype chain
- **`instanceof` syntax**: `object instanceof Constructor`
- **`isPrototypeOf` syntax**: `prototype.isPrototypeOf(object)`
- **Works with inheritance** - checks entire chain
- **Doesn't work with primitives** - only objects
- **Cross-frame issues** - use `Array.isArray()` for arrays
- **Use `typeof`** for primitive type checking
- **Both check entire chain**, not just immediate prototype
