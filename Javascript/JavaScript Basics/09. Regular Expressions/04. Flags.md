# Regex Flags

Flags modify how regular expressions behave - they control matching behavior globally.

---

## Available Flags

```javascript
g  // Global - find all matches
i  // Ignore case - case-insensitive
m  // Multiline - ^ and $ match line breaks
s  // Dotall - . matches newlines
u  // Unicode - proper Unicode matching
y  // Sticky - match at exact position
d  // Indices - capture group indices (ES2022)
```

---

## g - Global Flag

Find all matches instead of stopping at first match.

```javascript
const text = 'cat bat rat';

// Without g - finds first match only
const regex1 = /at/;
console.log(text.match(regex1));
// ['at', index: 1, input: 'cat bat rat']

// With g - finds all matches
const regex2 = /at/g;
console.log(text.match(regex2));
// ['at', 'at', 'at']
```

### Global with replace()

```javascript
const text = 'hello world, hello universe';

// Without g - replaces first only
console.log(text.replace(/hello/, 'hi'));
// 'hi world, hello universe'

// With g - replaces all
console.log(text.replace(/hello/g, 'hi'));
// 'hi world, hi universe'
```

### Global with exec()

```javascript
const regex = /\d+/g;
const text = '42 cats and 7 dogs';

let match;
while ((match = regex.exec(text)) !== null) {
  console.log(`Found ${match[0]} at ${match.index}`);
}
// Found 42 at 0
// Found 7 at 12
```

---

## i - Ignore Case Flag

Case-insensitive matching.

```javascript
const regex = /hello/i;

console.log(regex.test('hello'));  // true
console.log(regex.test('Hello'));  // true
console.log(regex.test('HELLO'));  // true
console.log(regex.test('HeLLo'));  // true

// Extract words (case-insensitive)
const text = 'JavaScript and javascript';
console.log(text.match(/javascript/gi));
// ['JavaScript', 'javascript']
```

---

## m - Multiline Flag

Makes `^` and `$` match start/end of each line, not just string.

```javascript
const text = `line 1
line 2
line 3`;

// Without m - matches start of entire string only
const regex1 = /^line/;
console.log(text.match(regex1));
// ['line']

// With m - matches start of each line
const regex2 = /^line/gm;
console.log(text.match(regex2));
// ['line', 'line', 'line']
```

### End of Line Matching

```javascript
const text = `apple
banana
orange`;

// Match end of each line
const regex = /e$/gm;
console.log(text.match(regex));
// ['e', 'e']  (apple, orange)
```

---

## s - Dotall Flag (ES2018)

Makes `.` match newline characters.

```javascript
const text = 'hello\nworld';

// Without s - . doesn't match newline
const regex1 = /hello.world/;
console.log(regex1.test(text));  // false

// With s - . matches newline
const regex2 = /hello.world/s;
console.log(regex2.test(text));  // true

// Practical: Extract content including newlines
const html = '<div>\nhello\nworld\n</div>';
console.log(html.match(/<div>.*<\/div>/s));
// ['<div>\nhello\nworld\n</div>']
```

---

## u - Unicode Flag (ES2015)

Enables proper Unicode support.

```javascript
// Without u - treats surrogate pairs as two characters
const regex1 = /^.$/;
console.log(regex1.test('ðŸ˜€'));  // false

// With u - treats emoji as one character
const regex2 = /^.$/u;
console.log(regex2.test('ðŸ˜€'));  // true

// Unicode property escapes (requires u flag)
const emoji = /\p{Emoji}/u;
console.log(emoji.test('ðŸ˜€'));  // true
console.log(emoji.test('a'));   // false

// Match any letter (Unicode-aware)
const letter = /\p{Letter}/u;
console.log(letter.test('a'));  // true
console.log(letter.test('Î±'));  // true (Greek)
console.log(letter.test('æ¼¢'));  // true (Chinese)
```

### Unicode Code Point

```javascript
// Match specific Unicode character
const regex = /\u{1F600}/u;  // ðŸ˜€
console.log(regex.test('ðŸ˜€'));  // true
```

---

## y - Sticky Flag (ES2015)

Matches only at lastIndex position (no skipping).

```javascript
const regex = /foo/y;
const text = 'foo foo foo';

// Start at position 0
regex.lastIndex = 0;
console.log(regex.exec(text));  // ['foo'] at index 0

// Must start at exact position
regex.lastIndex = 4;
console.log(regex.exec(text));  // ['foo'] at index 4

// Won't find match if not at exact position
regex.lastIndex = 5;
console.log(regex.exec(text));  // null (no match)
```

### Sticky vs Global

```javascript
const text = 'foo bar foo';

// Global - skips non-matching text
const global = /foo/g;
global.lastIndex = 4;
console.log(global.exec(text));  // ['foo'] at index 8

// Sticky - must match at exact position
const sticky = /foo/y;
sticky.lastIndex = 4;
console.log(sticky.exec(text));  // null (doesn't skip 'bar')
```

---

## d - Indices Flag (ES2022)

Captures start and end indices of groups.

```javascript
const regex = /(\d+)-(\d+)/d;
const text = 'Price: 10-20';

const match = regex.exec(text);

console.log(match[0]);        // '10-20'
console.log(match[1]);        // '10'
console.log(match[2]);        // '20'

// With d flag, get indices
console.log(match.indices);
// [[7, 12], [7, 9], [10, 12]]
```

---

## Combining Flags

Multiple flags can be combined.

```javascript
// Global + case-insensitive
const regex1 = /hello/gi;

// Global + multiline + case-insensitive
const regex2 = /^line/gmi;

// All common flags
const regex3 = /pattern/gimus;
```

### Common Combinations

```javascript
// Find all words (global + case-insensitive)
const words = /\w+/gi;

// Match lines (global + multiline)
const lines = /^.+$/gm;

// Unicode-aware emoji matching
const emojis = /\p{Emoji}/gu;

// HTML tag matching (dotall + global)
const tags = /<.*?>/gs;
```

---

## Accessing Flags

### flags Property

```javascript
const regex = /hello/gi;

console.log(regex.flags);    // 'gi'
console.log(regex.global);   // true
console.log(regex.ignoreCase); // true
console.log(regex.multiline);  // false
console.log(regex.sticky);     // false
console.log(regex.unicode);    // false
console.log(regex.dotAll);     // false
```

---

## Practical Examples

### Extract All Email Addresses

```javascript
const text = 'Contact us: john@example.com or jane@example.com';
const emailRegex = /[\w.-]+@[\w.-]+\.\w+/g;

console.log(text.match(emailRegex));
// ['john@example.com', 'jane@example.com']
```

### Case-Insensitive Search and Replace

```javascript
const text = 'JavaScript is great. javascript is awesome!';
const result = text.replace(/javascript/gi, 'JS');

console.log(result);
// 'JS is great. JS is awesome!'
```

### Extract All Lines Starting with '#'

```javascript
const markdown = `# Title
Content here
## Subtitle
More content
# Another Title`;

const headers = markdown.match(/^#+.+$/gm);
console.log(headers);
// ['# Title', '## Subtitle', '# Another Title']
```

### Remove HTML Tags

```javascript
const html = '<p>Hello <b>world</b></p>';
const text = html.replace(/<.*?>/gs, '');

console.log(text);  // 'Hello world'
```

### Unicode Username Validation

```javascript
const username = /^[\p{Letter}\p{Number}_]{3,20}$/u;

console.log(username.test('user_123'));   // true
console.log(username.test('ç”¨æˆ·123'));    // true
console.log(username.test('Î±Î²Î³'));        // true
console.log(username.test('user@123'));   // false
```

---

## Setting Flags Dynamically

```javascript
// With constructor
const pattern = 'hello';
const flags = 'gi';
const regex = new RegExp(pattern, flags);

console.log(regex.test('HELLO'));  // true

// Build flags conditionally
let flagString = 'g';
if (caseInsensitive) flagString += 'i';
if (multiline) flagString += 'm';

const dynamicRegex = new RegExp(pattern, flagString);
```

---

## Flag Best Practices

1. **Use g for replace all**
   ```javascript
   text.replace(/old/g, 'new');
   ```

2. **Use i for case-insensitive**
   ```javascript
   /keyword/i.test(input);
   ```

3. **Use m for line-by-line**
   ```javascript
   /^line/gm.match(multilineText);
   ```

4. **Use u for Unicode**
   ```javascript
   /\p{Emoji}/u.test(text);
   ```

5. **Use s for multi-line content**
   ```javascript
   /<div>.*?<\/div>/gs.match(html);
   ```

---

## Common Pitfalls

### Forgetting g for replaceAll

```javascript
// âœ— Only replaces first
'foo foo'.replace(/foo/, 'bar');  // 'bar foo'

// âœ“ Replaces all
'foo foo'.replace(/foo/g, 'bar');  // 'bar bar'
```

### Sticky lastIndex Issues

```javascript
const regex = /foo/y;
regex.lastIndex = 10;

// lastIndex not at match position
console.log(regex.test('foo'));  // false

// Reset lastIndex
regex.lastIndex = 0;
console.log(regex.test('foo'));  // true
```

### Unicode Without u Flag

```javascript
// âœ— Doesn't work
/\p{Emoji}/.test('ðŸ˜€');  // SyntaxError

// âœ“ Requires u flag
/\p{Emoji}/u.test('ðŸ˜€');  // true
```

---

## Performance Considerations

```javascript
// âœ“ Global flag is generally faster for multiple matches
const regex = /pattern/g;

// âœ— Creating regex in loop is slower
for (let i = 0; i < items.length; i++) {
  items[i].match(/pattern/g);  // Creates new regex each time
}

// âœ“ Create once, reuse
const regex = /pattern/g;
for (let i = 0; i < items.length; i++) {
  items[i].match(regex);
}
```

---

## Key Takeaways

- **g (global)**: Find all matches, not just first
- **i (ignore case)**: Case-insensitive matching
- **m (multiline)**: ^ and $ match line starts/ends
- **s (dotall)**: . matches newlines
- **u (unicode)**: Proper Unicode support
- **y (sticky)**: Match at exact position
- **d (indices)**: Capture group positions
- **Combine flags**: `/pattern/gim`
- **Access via properties**: `regex.global`, `regex.flags`
- **u flag required** for Unicode properties
- **Use g** for global replace
- **Reset lastIndex** when reusing sticky/global regex
