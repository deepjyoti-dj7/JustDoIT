# throw Statement

Explicitly throw exceptions to signal error conditions in your code.

---

## Basic Syntax

```javascript
throw expression;
```

The `throw` statement throws a user-defined exception and stops execution of the current function.

```javascript
throw new Error("Something went wrong");
throw "Error message";  // Can throw any value
throw 404;
throw true;
throw { message: "Custom error" };
```

---

## Throwing Errors

### Throw Error Object

```javascript
function divide(a, b) {
  if (b === 0) {
    throw new Error("Division by zero is not allowed");
  }
  return a / b;
}

try {
  console.log(divide(10, 0));
} catch (error) {
  console.log("Error:", error.message);
}
```

### Throw String (Not Recommended)

```javascript
function checkAge(age) {
  if (age < 18) {
    throw "Age must be 18 or older";
  }
  return true;
}

try {
  checkAge(16);
} catch (error) {
  console.log(error);  // "Age must be 18 or older"
  // No stack trace, harder to debug
}
```

---

## Error Types

### Generic Error

```javascript
throw new Error("Generic error message");
```

### SyntaxError

```javascript
function parseCustomFormat(str) {
  if (!str.startsWith("{")) {
    throw new SyntaxError("Invalid format: must start with '{'");
  }
  // Parse logic
}
```

### TypeError

```javascript
function greet(person) {
  if (typeof person !== 'object') {
    throw new TypeError("Expected an object");
  }
  return `Hello, ${person.name}`;
}
```

### ReferenceError

```javascript
function checkVariable(varName) {
  if (!window[varName]) {
    throw new ReferenceError(`Variable ${varName} is not defined`);
  }
}
```

### RangeError

```javascript
function setAge(age) {
  if (age < 0 || age > 150) {
    throw new RangeError("Age must be between 0 and 150");
  }
  return age;
}
```

---

## Practical Examples

### Validation

```javascript
function createUser(username, email) {
  if (!username) {
    throw new Error("Username is required");
  }
  
  if (!email) {
    throw new Error("Email is required");
  }
  
  if (!email.includes("@")) {
    throw new Error("Invalid email format");
  }
  
  return { username, email };
}

try {
  const user = createUser("john", "invalid-email");
} catch (error) {
  console.error("Validation failed:", error.message);
}
```

### Function Arguments

```javascript
function calculateArea(width, height) {
  if (typeof width !== 'number' || typeof height !== 'number') {
    throw new TypeError("Width and height must be numbers");
  }
  
  if (width <= 0 || height <= 0) {
    throw new RangeError("Width and height must be positive");
  }
  
  return width * height;
}

try {
  console.log(calculateArea(10, 5));   // 50
  console.log(calculateArea(-5, 10));  // Throws RangeError
} catch (error) {
  console.error(error.message);
}
```

### API Response Validation

```javascript
async function fetchUser(id) {
  const response = await fetch(`/api/users/${id}`);
  
  if (!response.ok) {
    throw new Error(`HTTP Error: ${response.status}`);
  }
  
  const data = await response.json();
  
  if (!data || !data.id) {
    throw new Error("Invalid user data received");
  }
  
  return data;
}

try {
  const user = await fetchUser(123);
  console.log(user);
} catch (error) {
  console.error("Failed to fetch user:", error.message);
}
```

---

## Custom Error Conditions

### Business Logic Errors

```javascript
function withdrawMoney(account, amount) {
  if (amount <= 0) {
    throw new Error("Withdrawal amount must be positive");
  }
  
  if (amount > account.balance) {
    throw new Error("Insufficient funds");
  }
  
  if (amount > account.dailyLimit) {
    throw new Error("Exceeds daily withdrawal limit");
  }
  
  account.balance -= amount;
  return account.balance;
}
```

### State Validation

```javascript
class Order {
  constructor() {
    this.status = 'pending';
  }
  
  ship() {
    if (this.status !== 'pending') {
      throw new Error(`Cannot ship order in ${this.status} status`);
    }
    this.status = 'shipped';
  }
  
  cancel() {
    if (this.status === 'delivered') {
      throw new Error("Cannot cancel delivered order");
    }
    this.status = 'cancelled';
  }
}

try {
  const order = new Order();
  order.ship();
  order.ship();  // Throws error
} catch (error) {
  console.error(error.message);
}
```

---

## Throwing in Different Contexts

### In Constructors

```javascript
class User {
  constructor(name, age) {
    if (!name) {
      throw new Error("Name is required");
    }
    
    if (age < 0) {
      throw new RangeError("Age cannot be negative");
    }
    
    this.name = name;
    this.age = age;
  }
}

try {
  const user = new User("", 25);
} catch (error) {
  console.error("User creation failed:", error.message);
}
```

### In Getters/Setters

```javascript
class Temperature {
  constructor() {
    this._celsius = 0;
  }
  
  get fahrenheit() {
    return (this._celsius * 9/5) + 32;
  }
  
  set fahrenheit(value) {
    if (typeof value !== 'number') {
      throw new TypeError("Temperature must be a number");
    }
    
    if (value < -459.67) {  // Absolute zero in Fahrenheit
      throw new RangeError("Temperature below absolute zero");
    }
    
    this._celsius = (value - 32) * 5/9;
  }
}

try {
  const temp = new Temperature();
  temp.fahrenheit = -500;  // Throws RangeError
} catch (error) {
  console.error(error.message);
}
```

### In Async Functions

```javascript
async function processData(data) {
  if (!data) {
    throw new Error("No data provided");
  }
  
  // Async operations
  const result = await someAsyncOperation(data);
  
  if (!result.success) {
    throw new Error("Processing failed");
  }
  
  return result;
}

// Caught with try-catch or .catch()
processData(null)
  .catch(error => console.error(error.message));
```

---

## Re-throwing Errors

```javascript
function processUser(user) {
  try {
    validateUser(user);
    saveUser(user);
  } catch (error) {
    console.error("Error processing user:", error.message);
    throw error;  // Re-throw for caller to handle
  }
}

try {
  processUser(invalidUser);
} catch (error) {
  console.error("Caught in main:", error.message);
}
```

### Wrapping Errors

```javascript
function highLevelOperation() {
  try {
    lowLevelOperation();
  } catch (error) {
    throw new Error(`High-level operation failed: ${error.message}`);
  }
}
```

---

## Conditional Throwing

```javascript
function processPayment(amount, balance) {
  if (amount <= 0) {
    throw new Error("Invalid payment amount");
  }
  
  if (balance < amount) {
    throw new Error("Insufficient balance");
  }
  
  // Process payment
  return balance - amount;
}

// Or with early returns
function processPayment2(amount, balance) {
  if (amount <= 0) throw new Error("Invalid payment amount");
  if (balance < amount) throw new Error("Insufficient balance");
  
  return balance - amount;
}
```

---

## Best Practices

1. **Throw Error objects, not strings**
   ```javascript
   // ✗ Bad
   throw "Something went wrong";
   
   // ✓ Good
   throw new Error("Something went wrong");
   ```

2. **Use appropriate Error types**
   ```javascript
   // ✓ Specific and clear
   throw new TypeError("Expected string, got number");
   throw new RangeError("Value out of range");
   throw new SyntaxError("Invalid JSON format");
   ```

3. **Provide descriptive messages**
   ```javascript
   // ✗ Vague
   throw new Error("Error");
   
   // ✓ Descriptive
   throw new Error("Failed to parse user data: invalid email format");
   ```

4. **Validate early**
   ```javascript
   function processData(data) {
     // Validate at the start
     if (!data) throw new Error("Data is required");
     if (!Array.isArray(data)) throw new TypeError("Data must be an array");
     
     // Process data
   }
   ```

5. **Don't throw in finally**
   ```javascript
   // ✗ Avoid throwing in finally
   try {
     operation();
   } finally {
     // throw new Error("Don't do this");  // Masks original error
   }
   ```

---

## Common Pitfalls

### Throwing Non-Error Objects

```javascript
// ✗ Hard to debug
throw "Error message";
throw 404;
throw { code: 500 };

// ✓ Proper Error object with stack trace
throw new Error("Error message");
```

### Too Generic Messages

```javascript
// ✗ Not helpful
throw new Error("Invalid input");

// ✓ Specific and actionable
throw new Error("Invalid email: must contain @ symbol");
```

### Not Catching Thrown Errors

```javascript
// ✗ Uncaught error crashes program
function riskyOperation() {
  throw new Error("Something failed");
}
riskyOperation();  // Uncaught!

// ✓ Catch or document that caller should catch
function riskyOperation() {
  throw new Error("Something failed");
}

try {
  riskyOperation();
} catch (error) {
  console.error(error.message);
}
```

---

## When to Throw

**✓ DO throw when:**
- Invalid arguments passed to function
- Preconditions not met
- Operation cannot continue safely
- Data validation fails
- Unrecoverable error state

**✗ DON'T throw for:**
- Expected conditions (use return values)
- Control flow (use if/else)
- Warnings (use console.warn)
- Optional features (provide fallbacks)

```javascript
// ✗ Don't throw for expected cases
function findUser(id) {
  const user = database.find(id);
  if (!user) throw new Error("User not found");  // Expected case
  return user;
}

// ✓ Return null/undefined for expected cases
function findUser(id) {
  return database.find(id) || null;
}

// ✓ Throw for unexpected errors
function findUser(id) {
  if (typeof id !== 'number') {
    throw new TypeError("User ID must be a number");
  }
  return database.find(id) || null;
}
```

---

## Key Takeaways

- **`throw`** stops execution and transfers control to catch block
- **Always throw Error objects** for proper stack traces
- **Use specific error types** (TypeError, RangeError, etc.)
- **Provide descriptive messages** for easier debugging
- **Validate early** and fail fast
- **Re-throw** errors you can't handle
- **Don't use throw for control flow** - use if/else
- **Throw for unexpected conditions**, return for expected ones
- **Caught errors** continue program execution
- **Uncaught errors** crash the program
